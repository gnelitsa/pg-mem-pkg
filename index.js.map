{"version":3,"sources":["webpack/bootstrap","./src/interfaces-private.ts","./src/utils.ts","./src/interfaces.ts","./src/datatypes/index.ts","./src/parser/context.ts","./src/transforms/transform-base.ts","./src/parser/expression-builder.ts","./src/execution/exec-utils.ts","./src/schema/readonly-table.ts","./src/datatypes/datatype-base.ts","./src/evaluator.ts","./src/transforms/selection.ts","external \"pgsql-ast-parser\"","./src/execution/select.ts","./src/datatypes/datatypes.ts","external \"object-hash\"","external \"immutable\"","external \"moment\"","./src/execution/clean-results.ts","./src/datatypes/t-record.ts","./src/execution/records-mutations/mutation-base.ts","./src/misc/buffer-node.ts","external \"lru-cache\"","./src/transforms/aggregation.ts","./src/transforms/join.ts","./src/transforms/alias.ts","./src/parser/parse-cache.ts","./src/schema/table-index.ts","external \"json-stable-stringify\"","./src/transforms/array-filter.ts","./src/misc/pg-escape.ts","./src/execution/schema-amends/create-sequence.ts","./src/execution/statement-exec.ts","./src/schema/view.ts","./src/transforms/seq-scan.ts","./src/index.ts","./src/db.ts","./src/schema/schema.ts","./src/parser/function-call.ts","./src/datatypes/datatypes-geometric.ts","./src/datatypes/t-interval.ts","./src/datatypes/t-time.ts","./src/datatypes/t-timestamp.ts","./src/datatypes/t-jsonb.ts","./src/datatypes/t-regtype.ts","./src/datatypes/t-regclass.ts","./src/datatypes/t-inet.ts","./src/table.ts","./src/transforms/restrictive-index.ts","./src/transforms/aggregations/count.ts","./src/transforms/aggregations/max-min.ts","./src/transforms/aggregations/sum.ts","./src/transforms/aggregations/array_agg.ts","./src/transforms/aggregations/avg.ts","./src/transforms/aggregations/json_aggs.ts","./src/transforms/aggregations/bool-aggregs.ts","./src/execution/records-mutations/deletion.ts","./src/execution/records-mutations/update.ts","./src/execution/records-mutations/insert.ts","./src/schema/values-table.ts","./src/schema/function-call-table.ts","./src/schema/btree-index.ts","external \"functional-red-black-tree\"","./src/column.ts","./src/constraints/generated.ts","./src/constraints/foreign-key.ts","./src/migrate/migrate.ts","./src/datatypes/t-custom-enum.ts","./src/datatypes/t-equivalent.ts","./src/schema/overload-resolver.ts","./src/schema/sequence.ts","./src/execution/schema-amends/create-table.ts","./src/execution/schema-amends/create-index.ts","./src/execution/schema-amends/alter.ts","./src/execution/schema-amends/alter-sequence.ts","./src/execution/schema-amends/drop-index.ts","./src/execution/schema-amends/drop-table.ts","./src/execution/schema-amends/drop-sequence.ts","./src/execution/transaction-statements.ts","./src/execution/records-mutations/truncate-table.ts","./src/execution/show.ts","./src/execution/set.ts","./src/execution/schema-amends/create-enum.ts","./src/execution/schema-amends/create-view.ts","./src/execution/schema-amends/create-materialized-view.ts","./src/execution/schema-amends/create-schema.ts","./src/execution/schema-amends/create-function.ts","./src/execution/schema-amends/do.ts","./src/execution/schema-amends/drop-type.ts","./src/transforms/build-filter.ts","./src/transforms/eq-filter.ts","./src/transforms/false-filter.ts","./src/transforms/and-filter.ts","./src/transforms/or-filter.ts","./src/transforms/in-filter.ts","./src/transforms/not-in-filter.ts","./src/transforms/startswith-filter.ts","./src/transforms/ineq-filter.ts","./src/transforms/between-filter.ts","./src/adapters/index.ts","./src/adapters/adapters.ts","./src/misc/pg-utils.ts","./src/transaction.ts","./src/transforms/limit.ts","./src/transforms/union.ts","./src/transforms/distinct.ts","./src/transforms/order-by.ts","./src/schema/pg-catalog/index.ts","./src/schema/pg-catalog/pg-attribute-list.ts","./src/schema/pg-catalog/pg-class.ts","./src/schema/pg-catalog/pg-constraints-list.ts","./src/schema/pg-catalog/pg-index-list.ts","./src/schema/pg-catalog/pg-namespace-list.ts","./src/schema/pg-catalog/pg-type-list.ts","./src/functions/index.ts","./src/functions/string.ts","./src/functions/date.ts","./src/functions/system.ts","./src/functions/sequence-fns.ts","./src/schema/pg-catalog/pg-range.ts","./src/schema/pg-catalog/pg-database.ts","./src/schema/pg-catalog/binary-operators.ts","./src/schema/pg-catalog/sql-function-language.ts","./src/schema/information-schema/index.ts","./src/schema/information-schema/columns-list.ts","./src/schema/information-schema/table-list.ts","./src/schema/information-schema/table-constraints.ts","./src/schema/information-schema/key-column-usage.ts","./src/schema/information-schema/constraint-column-usage.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 35);\n","import { IMemoryDb, IMemoryTable, DataType, IType, TableEvent, GlobalEvent, ISchema, SchemaField, MemoryDbOptions, nil, Schema, QueryError, ISubscription, LanguageCompiler, ArgDefDetails, QueryResult } from './interfaces';\r\nimport { Expr, SelectedColumn, SelectStatement, CreateColumnDef, AlterColumn, LimitStatement, OrderByStatement, TableConstraint, AlterSequenceChange, CreateSequenceOptions, QName, DataTypeDef, ExprRef, Name, BinaryOperator, ValuesStatement, CreateExtensionStatement, DropFunctionStatement, ExprCall } from 'pgsql-ast-parser';\r\nimport { Map as ImMap, Record, Set as ImSet } from 'immutable';\r\n\r\nexport * from './interfaces';\r\n\r\n\r\nexport const GLOBAL_VARS = Symbol('_global_vars');\r\n\r\n// export type PrimaryKey = string | number;\r\nconst ID = Symbol('_id');\r\nexport function getId(item: any): string {\r\n    if (!item) {\r\n        return '';\r\n    }\r\n    const got = item[ID];\r\n    if (!got) {\r\n        throw new Error('Unexpected: cannot get an ID of something which is not a record');\r\n    }\r\n    return got;\r\n}\r\n\r\nexport function setId<T = any>(item: T, id: string): T {\r\n    const got = (item as any)[ID];\r\n    if (got === id) {\r\n        return item;\r\n    }\r\n    if (got) {\r\n        throw new Error('Unexpected: Cannot update an ID');\r\n    }\r\n    (item as any)[ID] = id;\r\n    return item;\r\n}\r\n\r\nexport type RegClass = string | number;\r\nexport type RegType = string | number;\r\nexport type TypeQuery = DataTypeDef | DataType | number | _IType;\r\nexport interface _ISchema extends ISchema {\r\n    readonly name: string;\r\n    readonly db: _IDb;\r\n    readonly dualTable: _ITable;\r\n    /** If the given name refers to another schema, then get it. Else, get this */\r\n    getThisOrSiblingFor(name: QName): _ISchema;\r\n    executeCreateExtension(p: CreateExtensionStatement): void;\r\n    dropFunction(fn: DropFunctionStatement): void;\r\n    explainSelect(sql: string): _SelectExplanation;\r\n    explainLastSelect(): _SelectExplanation | undefined;\r\n    getTable(table: string): _ITable;\r\n    getTable(table: string, nullIfNotFound?: boolean): _ITable;\r\n    tablesCount(t: _Transaction): number;\r\n    listTables(t: _Transaction): Iterable<_ITable>;\r\n    declareTable(table: Schema, noSchemaChange?: boolean): _ITable;\r\n    createSequence(t: _Transaction, opts: CreateSequenceOptions | nil, name: QName | nil): _ISequence;\r\n    /** Get functions matching this overload */\r\n    resolveFunction(name: string | QName, args: IValue[], forceOwn?: boolean): _FunctionDefinition | nil;\r\n    /** Get an exact function def from its signature (do not use that to resolve overload) */\r\n    getFunction(name: string, args: _IType[]): _FunctionDefinition | nil;\r\n    /** Get operator matching this overload */\r\n    resolveOperator(name: BinaryOperator, left: IValue, right: IValue, forceOwn?: boolean): _OperatorDefinition | nil;\r\n\r\n    getObject(p: QName): _IRelation;\r\n    getObject(p: QName, opts: BeingCreated): _IRelation;\r\n    getObject(p: QName, opts?: QueryObjOpts): _IRelation | null;\r\n\r\n    getOwnObject(name: string): _IRelation | null;\r\n\r\n    parseType(t: string): _IType;\r\n\r\n\r\n    getType(t: TypeQuery): _IType;\r\n    getType(_t: TypeQuery, opts?: QueryObjOpts): _IType | null;\r\n\r\n    getOwnType(name: DataTypeDef): _IType | null\r\n\r\n    getObjectByRegClassId(reg: number): _IRelation;\r\n    getObjectByRegClassId(reg: number, opts?: QueryObjOpts): _IRelation | null;\r\n\r\n    getOwnObjectByRegClassId(reg: number): _IRelation | null;\r\n\r\n    getObjectByRegOrName(reg: RegClass): _IRelation;\r\n    getObjectByRegOrName(reg: RegClass, opts?: QueryObjOpts): _IRelation | null;\r\n\r\n    setReadonly(): void;\r\n\r\n    _registerTypeSizeable(name: string, type: (sz?: number) => _IType): this;\r\n    _registerType(type: _IType): this;\r\n    _unregisterType(type: _IType): this;\r\n\r\n    _reg_register(rel: _IRelation): Reg;\r\n    _reg_unregister(rel: _IRelation): void;\r\n    _reg_rename(rel: _IRelation, oldName: string, newName: string): void;\r\n\r\n}\r\n\r\n\r\nexport interface _IStatement {\r\n    readonly schema: _ISchema;\r\n    onExecuted(callback: OnStatementExecuted): void;\r\n}\r\n\r\nexport interface _IStatementExecutor {\r\n    execute(t: _Transaction): StatementResult;\r\n}\r\n\r\nexport interface StatementResult {\r\n    result: QueryResult;\r\n    state: _Transaction;\r\n}\r\n\r\nexport type OnStatementExecuted = (t: _Transaction) => void;\r\n\r\nexport interface QueryObjOpts extends Partial<BeingCreated> {\r\n    /** Returns null instead of throwing error if not found */\r\n    nullIfNotFound?: boolean;\r\n    /** Will only search in the current schema, or in the targeted schema (not in search path) */\r\n    skipSearch?: boolean;\r\n}\r\n\r\nexport interface BeingCreated {\r\n    beingCreated: _IRelation;\r\n}\r\n\r\nexport interface _FunctionDefinition {\r\n    name: string;\r\n    args: _ArgDefDetails[];\r\n    argsVariadic?: _IType | nil;\r\n    returns?: _IType | nil;\r\n    impure?: boolean;\r\n    allowNullArguments?: boolean;\r\n    implementation: (...args: any[]) => any;\r\n}\r\n\r\nexport interface _OperatorDefinition extends _FunctionDefinition {\r\n    commutative: boolean;\r\n    left: _IType;\r\n    right: _IType;\r\n    returns: _IType;\r\n}\r\n\r\nexport type _ArgDefDetails = ArgDefDetails & {\r\n    type: _IType;\r\n    default?: IValue;\r\n};\r\n\r\nexport interface _Transaction {\r\n    readonly isChild: boolean;\r\n    /** Create a new transaction within this transaction */\r\n    fork(): _Transaction;\r\n    /** Commit this transaction (returns the parent transaction) */\r\n    commit(): _Transaction;\r\n    /** Commits this transaction and all underlying transactions */\r\n    fullCommit(): _Transaction;\r\n    rollback(): _Transaction;\r\n    delete(identity: symbol): void;\r\n    /** Set data persisted in this transaction */\r\n    set<T>(identity: symbol, data: T): T;\r\n    /** Get data persisted in this transaction */\r\n    get<T>(identity: symbol): T;\r\n    getMap<T extends ImMap<any, any>>(identity: symbol): T;\r\n    getSet<T>(identity: symbol): ImSet<T>;\r\n    /** Get transient data, which will only exist within the scope of the current statement */\r\n    setTransient<T>(identity: symbol, data: T): T;\r\n    /** Set transient data, which will only exist within the scope of the current statement */\r\n    getTransient<T>(identity: symbol): T;\r\n    clearTransientData(): void;\r\n}\r\n\r\nexport interface Stats {\r\n    /** Returns this selection size, or null if it cannot be computed without iteration */\r\n    count: number;\r\n}\r\n\r\nexport interface _IAggregation {\r\n    checkIfIsKey(got: IValue): IValue;\r\n    getAggregation(name: string, call: ExprCall): IValue;\r\n}\r\n\r\nexport interface _ISelection<T = any> extends _IAlias {\r\n    readonly debugId?: string;\r\n\r\n    readonly ownerSchema: _ISchema;\r\n    readonly db: _IDb;\r\n    /** Tells if this statement is an execution without any meaningful result (\"update\" with no \"returning\", etc...) */\r\n    readonly isExecutionWithNoResult: boolean;\r\n    /** Column list (those visible when select *) */\r\n    readonly columns: ReadonlyArray<IValue>;\r\n    /** True when this is an aggregation being built */\r\n    isAggregation(): this is _IAggregation;\r\n    /** Statistical measure of how many items will be returned by this selection */\r\n    entropy(t: _Transaction): number;\r\n    enumerate(t: _Transaction): Iterable<T>;\r\n\r\n    /** Returns true if the given value is present in this */\r\n    hasItem(value: T, t: _Transaction): boolean;\r\n\r\n    stats(t: _Transaction): Stats | null;\r\n\r\n    /** Gets the index associated with this value (or returns null) */\r\n    getIndex(...forValue: IValue[]): _IIndex<T> | nil;\r\n    /** All columns. A bit like .columns`, but including records selections */\r\n    listSelectableIdentities(): Iterable<IValue>;\r\n    filter(where: Expr | nil): _ISelection;\r\n    limit(limit: LimitStatement): _ISelection;\r\n    orderBy(orderBy: OrderByStatement[] | nil): _ISelection;\r\n    groupBy(grouping: Expr[] | nil): _ISelection;\r\n    distinct(select?: Expr[]): _ISelection;\r\n    union(right: _ISelection): _ISelection;\r\n    getColumn(column: string | ExprRef): IValue;\r\n    getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue | nil;\r\n    setAlias(alias?: string): _ISelection;\r\n    isOriginOf(a: IValue): boolean;\r\n    explain(e: _Explainer): _SelectExplanation;\r\n\r\n    /** Select a specific subset */\r\n    select(select: (string | SelectedColumn)[]): _ISelection;\r\n\r\n    /** Limit selection to a specific alias (in joins) */\r\n    selectAlias(alias: string): _IAlias | nil;\r\n}\r\n\r\nexport interface _IAlias {\r\n    listColumns(): Iterable<IValue>;\r\n}\r\n\r\n\r\nexport interface _Explainer {\r\n    readonly transaction: _Transaction;\r\n    idFor(sel: _ISelection): string | number;\r\n}\r\n\r\nexport type _SelectExplanation = {\r\n    /** A jointure */\r\n    id: string | number;\r\n    _: 'join';\r\n    /**  The restrictive table (the one which MUST have a matched elemnt) */\r\n    restrictive: _SelectExplanation;\r\n    /** The joined table */\r\n    joined: _SelectExplanation;\r\n    inner: boolean;\r\n    on: {\r\n        /** 'with' will have to be scanned with this expression */\r\n        seqScan: _ExprExplanation;\r\n    } | {\r\n        /** Which seq id will be iterated (could be either 'join' or 'with' when there is an inner join) */\r\n        iterate: string | number;\r\n        /** Which iteration side has been chosen (always 'restrictive' for non inner joins) */\r\n        iterateSide: 'joined' | 'restrictive';\r\n        /** the index table on the other table that can be used to lookup corresponding item(s) */\r\n        joinIndex: _IndexExplanation;\r\n        /** It will be matched with this expression (computable from the other table) */\r\n        matches: _ExprExplanation;\r\n        /** True if there is a predicate filter that is also applied (happens when there are 'ANDs' in join condition) */\r\n        filtered?: boolean;\r\n    }\r\n} | {\r\n    /** A selection transformation */\r\n    id: string | number;\r\n    _: 'map';\r\n    select?: {\r\n        what: _ExprExplanation;\r\n        as: string;\r\n    }[];\r\n    of: _SelectExplanation;\r\n} | {\r\n    id: string | number;\r\n    _: 'orderBy';\r\n    of: _SelectExplanation;\r\n} | {\r\n    /** A selection transformation */\r\n    id: string | number;\r\n    _: 'limit';\r\n    take?: _ExprExplanation;\r\n    skip?: _ExprExplanation;\r\n    on: _SelectExplanation;\r\n} | {\r\n    /** A selection transformation */\r\n    id: string | number;\r\n    _: 'distinct';\r\n    of: _SelectExplanation;\r\n} | {\r\n    /** A table */\r\n    _: 'table';\r\n    table: string;\r\n} | {\r\n    /** An AND filter */\r\n    id: string | number;\r\n    _: 'and',\r\n    enumerate: _SelectExplanation;\r\n    andCheck: _SelectExplanation[];\r\n} | {\r\n    /** A raw array definition */\r\n    id: string | number;\r\n    _: 'constantSet';\r\n    rawArrayLen: number;\r\n} | {\r\n    /** One of the following operators on an index:\r\n     * - (NOT) IN\r\n     * - (NOT) LIKE\r\n     * - (NOT) BETWEEN\r\n     * - < > <= >= = !=\r\n     *\r\n     * (against constants) */\r\n    id: string | number;\r\n    _: 'eq' | 'ineq' | 'neq' | 'inside' | 'outside';\r\n    entropy: number;\r\n    /** The index that will be used to check equality */\r\n    on: _IndexExplanation;\r\n} | {\r\n    /** An empty set */\r\n    id: string | number;\r\n    _: 'empty';\r\n} | {\r\n    /** An union set */\r\n    id: string | number;\r\n    _: 'union',\r\n    union: _SelectExplanation[];\r\n} | {\r\n    /** A seq-scan filter of another set */\r\n    id: string | number;\r\n    _: 'seqFilter';\r\n    filtered: _SelectExplanation;\r\n} | {\r\n    id: string | number;\r\n    _: 'aggregate';\r\n    aggregator: {\r\n        /** aggregation will iterate the whole lot */\r\n        seqScan: _ExprExplanation;\r\n    } | {\r\n        /** aggregation uses an index items which already contains required aggregations */\r\n        index: _IndexExplanation\r\n    } | {\r\n        /** aggregation is trivial (select count(*) from table) */\r\n        trivial: _ISelection;\r\n    };\r\n}\r\n\r\nexport type _IndexExplanation = {\r\n    /** BTree index on expression */\r\n    _: 'btree';\r\n    onTable: string;\r\n    btree: string[];\r\n} | {\r\n    _: 'indexMap';\r\n    of: _IndexExplanation;\r\n} | {\r\n    _: 'indexRestriction';\r\n    /** This index will receive a lookup for each item of \"for\" collection */\r\n    lookup: _IndexExplanation;\r\n    /** Enumerated collection */\r\n    for: _SelectExplanation;\r\n} | {\r\n    /** Uses an index of a column propagated by a join */\r\n    _: 'indexOnJoin';\r\n    /** The in propagated column that is used */\r\n    index: _IndexExplanation;\r\n    /** How elements from the other table will be joined */\r\n    strategy: _IndexExplanation | 'catastrophic';\r\n};\r\n\r\nexport type _ExprExplanation = {\r\n    constant: true;\r\n} | {\r\n    /** ID of the origin of this selection */\r\n    on: string | number;\r\n    col: string;\r\n}\r\n\r\nexport interface _IDb extends IMemoryDb {\r\n    readonly options: MemoryDbOptions;\r\n    readonly public: _ISchema;\r\n    readonly data: _Transaction;\r\n    readonly searchPath: ReadonlyArray<string>;\r\n\r\n    createSchema(db: string): _ISchema;\r\n    getSchema(db?: string | null, nullIfNotFound?: false): _ISchema;\r\n    getSchema(db: string, nullIfNotFound: true): _ISchema | null;\r\n    raiseTable(table: string, event: TableEvent): void;\r\n    raiseGlobal(event: GlobalEvent, ...args: any[]): void;\r\n    listSchemas(): _ISchema[];\r\n    onSchemaChange(): void;\r\n    getTable(name: string, nullIfNotExists?: boolean): _ITable;\r\n    getExtension(name: string): (schema: ISchema) => void;\r\n    /** Get functions matching this overload */\r\n    resolveFunction(name: string | QName, types: IValue[]): _FunctionDefinition | nil;\r\n    /** Get operators matching this overload */\r\n    resolveOperator(name: BinaryOperator, left: IValue, right: IValue): _OperatorDefinition | nil;\r\n    getLanguage(name: string): LanguageCompiler;\r\n}\r\nexport type OnConflictHandler = { ignore: 'all' | _IIndex } | {\r\n    onIndex: _IIndex;\r\n    update: (item: any, excluded: any, t: _Transaction) => void;\r\n}\r\n\r\nexport type DropHandler = (t: _Transaction, cascade: boolean) => void;\r\nexport type TruncateHandler = (t: _Transaction, opts: TruncateOpts) => void;\r\nexport type IndexHandler = (act: 'create' | 'drop', idx: _INamedIndex) => void;\r\n\r\nexport interface _RelationBase {\r\n    readonly name: string;\r\n    readonly reg: Reg;\r\n    readonly ownerSchema?: _ISchema;\r\n}\r\n\r\nexport interface Reg {\r\n    readonly typeId: number;\r\n    readonly classId: number;\r\n}\r\n\r\nexport interface ChangeOpts {\r\n    onConflict?: OnConflictHandler | nil;\r\n    overriding?: 'user' | 'system' | nil;\r\n}\r\n\r\nexport interface _ITable<T = any> extends IMemoryTable<T>, _RelationBase {\r\n    readonly type: 'table';\r\n    readonly hidden: boolean;\r\n    readonly db: _IDb;\r\n    readonly selection: _ISelection<T>;\r\n    readonly ownerSchema: _ISchema;\r\n    doInsert(t: _Transaction, toInsert: T, opts?: ChangeOpts): T;\r\n    setHidden(): this;\r\n    setReadonly(): this;\r\n    delete(t: _Transaction, toDelete: T): void;\r\n    update(t: _Transaction, toUpdate: T): T;\r\n    createIndex(t: _Transaction, expressions: CreateIndexDef): _IConstraint | nil;\r\n    createIndex(t: _Transaction, expressions: Name[], type: 'primary' | 'unique', indexName?: string): _IConstraint;\r\n    setReadonly(): this;\r\n    /** Create a column */\r\n    addColumn(column: SchemaField | CreateColumnDef, t: _Transaction): _Column;\r\n    /** Get a column to modify it */\r\n    getColumnRef(column: string): _Column;\r\n    getColumnRef(column: string, nullIfNotFound?: boolean): _Column | nil;\r\n    rename(to: string): this;\r\n    getConstraint(constraint: string): _IConstraint | nil;\r\n    addConstraint(constraint: TableConstraint, t: _Transaction): _IConstraint | nil;\r\n    getIndex(...forValues: IValue[]): _IIndex | nil;\r\n    dropIndex(t: _Transaction, name: string): void;\r\n    drop(t: _Transaction, cascade: boolean): void;\r\n    /** Will be executed when one of the given columns is affected (update/delete) */\r\n    onBeforeChange(columns: (string | _Column)[], check: ChangeHandler<T>): ISubscription;\r\n    /** Will be executed once all 'onBeforeChange' handlers have ran (coherency checks) */\r\n    onCheckChange(columns: 'all' | (string | _Column)[], check: ChangeHandler<T>): ISubscription;\r\n    onDrop(sub: DropHandler): ISubscription;\r\n    onIndex(sub: IndexHandler): ISubscription;\r\n    onTruncate(sub: TruncateHandler): ISubscription;\r\n    truncate(t: _Transaction, truncateOpts?: TruncateOpts): void;\r\n}\r\n\r\nexport interface TruncateOpts {\r\n    restartIdentity?: boolean;\r\n    cascade?: boolean;\r\n}\r\n\r\nexport interface _IView extends _RelationBase {\r\n    readonly type: 'view';\r\n    readonly db: _IDb;\r\n    readonly selection: _ISelection;\r\n    drop(t: _Transaction): void;\r\n}\r\n\r\n\r\nexport interface _IConstraint {\r\n    readonly name: string | nil;\r\n    uninstall(t: _Transaction): void;\r\n}\r\n\r\nexport type ChangeHandler<T = any> = (old: T | null, neu: T | null, t: _Transaction, opts: ChangeOpts) => void;\r\n\r\nexport interface _Column {\r\n    readonly notNull: boolean;\r\n    readonly default: IValue | nil;\r\n    readonly expression: IValue;\r\n    readonly usedInIndexes: ReadonlySet<_IIndex>;\r\n    readonly table: _ITable;\r\n    readonly name: string;\r\n    alter(alter: AlterColumn, t: _Transaction): this;\r\n    rename(to: string, t: _Transaction): this;\r\n    drop(t: _Transaction): void;\r\n    onDrop(sub: DropHandler): ISubscription;\r\n}\r\n\r\nexport interface CreateIndexDef {\r\n    ifNotExists?: boolean;\r\n    columns: CreateIndexColDef[];\r\n    indexName?: string;\r\n    unique?: boolean;\r\n    notNull?: boolean;\r\n    primary?: boolean;\r\n    predicate?: IValue;\r\n}\r\nexport interface CreateIndexColDef {\r\n    value: IValue;\r\n    nullsLast?: boolean;\r\n    desc?: boolean\r\n}\r\n\r\n\r\nexport interface _IType<TRaw = any> extends IType, _RelationBase {\r\n    readonly type: 'type';\r\n    /** Data type */\r\n    readonly primary: DataType;\r\n    /** Reg type name */\r\n    readonly name: string; // | null;\r\n    readonly reg: Reg;\r\n\r\n    toString(): string;\r\n    equals(a: TRaw, b: TRaw): boolean | null;\r\n    gt(a: TRaw, b: TRaw): boolean | null;\r\n    ge(a: TRaw, b: TRaw): boolean | null;\r\n    lt(a: TRaw, b: TRaw): boolean | null;\r\n    le(a: TRaw, b: TRaw): boolean | null;\r\n    canConvertImplicit(to: _IType<TRaw>): boolean | nil;\r\n    canCast(to: _IType<TRaw>): boolean | nil;\r\n    cast<T = any>(value: IValue<TRaw>, to: _IType<T>): IValue<T>;\r\n    convertImplicit<T = any>(value: IValue<TRaw>, to: _IType<T>): IValue<T>;\r\n    prefer(type: _IType<any>): _IType | nil;\r\n\r\n    /** Build an array type for this type */\r\n    asArray(): _IType<TRaw[]>;\r\n    asList(): _IType<TRaw[]>;\r\n\r\n    /** Get an unicity hash */\r\n    hash(value: TRaw): string | number | null;\r\n\r\n    drop(t: _Transaction): void;\r\n}\r\n\r\nexport interface Parameter {\r\n    readonly index: number;\r\n    readonly value: IValue;\r\n}\r\n\r\nexport interface IValue<TRaw = any> {\r\n    /** Columns used in this expression (if any) */\r\n    readonly usedColumns: ReadonlySet<IValue>;\r\n\r\n    readonly type: _IType<TRaw>;\r\n\r\n    /** is 'any()' call ? */\r\n    readonly isAny: boolean;\r\n\r\n    /** Is a constant... i.e. not dependent on columns. ex: (2+2) or NOW() */\r\n    readonly isConstant: boolean;\r\n\r\n    /** Is REAL constant (i.e. 2+2, not varying expressions like NOW()) */\r\n    readonly isConstantReal: boolean;\r\n\r\n    /** Is a literal constant ? (constant not defined as an operation) */\r\n    readonly isConstantLiteral: boolean;\r\n\r\n    /** Will be set if there is an index on this value */\r\n    readonly index: _IIndex | nil;\r\n\r\n    /** Originates from this selection */\r\n    readonly origin: _ISelection | nil;\r\n\r\n\r\n    /** Column ID, or null */\r\n    readonly id: string | nil;\r\n\r\n    /** Hash of this value (used to identify indexed expressions) */\r\n    readonly hash: string;\r\n\r\n    /** Get value if is a constant */\r\n    get(): any;\r\n    /** Get value if is NOT a constant */\r\n    get(raw: TRaw, t?: _Transaction | nil): any;\r\n\r\n    setId(newId: string): IValue;\r\n    canCast(to: _IType): boolean;\r\n    cast<T = any>(to: _IType<T>): IValue<T>;\r\n    convertImplicit<T = any>(to: _IType<T>): IValue<T>;\r\n\r\n    /**\r\n     * Creates a copy of this column that can\r\n     **/\r\n    setWrapper<TNew>(newOrigin: _ISelection, unwrap: (val: TRaw) => TNew, newType: _IType<TNew>): IValue<TNew>;\r\n    setWrapper(newOrigin: _ISelection, unwrap: (val: TRaw) => TRaw): IValue<TRaw>;\r\n    map(unwrap: (val: TRaw) => TRaw): IValue<TRaw>;\r\n    map<TNew>(unwrap: (val: TRaw) => TNew, newType: _IType<TNew>): IValue<TNew>;\r\n    setOrigin(origin: _ISelection): IValue<TRaw>;\r\n    clone(): IValue<any>;\r\n\r\n    explain(e: _Explainer): _ExprExplanation;\r\n}\r\n\r\nexport type IndexKey = unknown[];\r\nexport interface IndexExpression {\r\n    readonly hash: string;\r\n    readonly type: _IType;\r\n}\r\n\r\nexport interface _INamedIndex<T = any> extends _IIndex<T>, _RelationBase {\r\n    readonly type: 'index';\r\n    readonly onTable: _ITable<T>;\r\n    drop(t: _Transaction): void;\r\n}\r\n\r\n\r\n\r\nexport interface _IIndex<T = any> {\r\n    readonly unique?: boolean;\r\n    readonly expressions: IndexExpression[];\r\n\r\n    /** Returns a measure of how many items will be returned by this op */\r\n    entropy(t: IndexOp): number;\r\n\r\n    /** Returns this selection stats, or null if it cannot be computed without iteration */\r\n    stats(t: _Transaction, key?: IndexKey): Stats | null;\r\n\r\n    /** Get values equating the given key */\r\n    eqFirst(rawKey: IndexKey, t: _Transaction): T | null;\r\n\r\n    enumerate(op: IndexOp): Iterable<T>;\r\n\r\n    explain(e: _Explainer): _IndexExplanation;\r\n\r\n    iterateKeys(t: _Transaction): Iterable<IndexKey> | null;\r\n}\r\n\r\nexport type IndexOp = {\r\n    type: 'eq' | 'neq' | 'gt' | 'lt' | 'ge' | 'le';\r\n    key: IndexKey;\r\n    t: _Transaction;\r\n    matchNull?: boolean;\r\n} | {\r\n    type: 'inside' | 'outside'\r\n    lo: IndexKey;\r\n    hi: IndexKey;\r\n    t: _Transaction;\r\n} | {\r\n    type: 'nin';\r\n    keys: IndexKey[];\r\n    t: _Transaction;\r\n}\r\n\r\nexport interface TableRecordDef<T> {\r\n    hasPrimary?: boolean;\r\n    readonly?: boolean;\r\n    hidden?: boolean;\r\n    name?: string;\r\n    dataId?: symbol;\r\n\r\n    serials: ImMap<string, number>;\r\n    it: number;\r\n    indexByHash: ImMap<string, _IIndex<T>>;\r\n    indexByName: ImMap<string, _IIndex<T>>;\r\n    columnsByName: ImMap<string, CR<T>>;\r\n}\r\n\r\nexport interface TableColumnRecordDef<T> {\r\n    default: IValue;\r\n    notNull: boolean;\r\n    usedInIndexes: ImSet<_IIndex>;\r\n    type: _IType;\r\n    name: string;\r\n}\r\n\r\nexport type TR<T> = Record<TableRecordDef<T>>;\r\nexport type CR<T> = Record<TableColumnRecordDef<T>>;\r\nexport const EmtpyTable = Record<TableRecordDef<any>>({\r\n    serials: ImMap(),\r\n    it: 0,\r\n    indexByHash: ImMap(),\r\n    indexByName: ImMap(),\r\n    columnsByName: ImMap(),\r\n});\r\n\r\nexport const NewColumn = Record<TableColumnRecordDef<any>>({\r\n    default: null as any,\r\n    notNull: false,\r\n    usedInIndexes: ImSet(),\r\n    type: null as any,\r\n    name: null as any,\r\n});\r\n\r\nexport type _IRelation = _ITable | _ISequence | _INamedIndex | _IType | _IView;\r\n\r\nexport function asIndex(o: _IRelation): _INamedIndex;\r\nexport function asIndex(o: _IRelation | null): _INamedIndex | null;\r\nexport function asIndex(o: _IRelation | null) {\r\n    if (!o) {\r\n        return null;\r\n    }\r\n    if (o.type === 'index') {\r\n        return o;\r\n    }\r\n    throw new QueryError(`\"${o.name}\" is not an index`);\r\n}\r\n\r\nexport function asType(o: _IRelation): _IType;\r\nexport function asType(o: _IRelation | null): _IType | null;\r\nexport function asType(o: _IRelation | null) {\r\n    if (!o) {\r\n        return null;\r\n    }\r\n    if (o.type === 'type') {\r\n        return o;\r\n    }\r\n    throw new QueryError(`\"${o.name}\" is not a type`);\r\n}\r\n\r\nexport function asSeq(o: _IRelation): _ISequence;\r\nexport function asSeq(o: _IRelation | null): _ISequence | null;\r\nexport function asSeq(o: _IRelation | null) {\r\n    if (!o) {\r\n        return null;\r\n    }\r\n    if (o.type === 'sequence') {\r\n        return o;\r\n    }\r\n    throw new QueryError(`\"${o.name}\" is not a sequence`);\r\n}\r\n\r\nexport function asTable(o: _IRelation): _ITable;\r\nexport function asTable(o: _IRelation | null): _ITable | null;\r\nexport function asTable(o: _IRelation | null, nullIfNotType?: boolean): _ITable | null;\r\nexport function asTable(o: _IRelation | null, nullIfNotType?: boolean) {\r\n    if (!o) {\r\n        return null;\r\n    }\r\n    if (o.type === 'table') {\r\n        return o;\r\n    }\r\n    if (nullIfNotType) {\r\n        return null;\r\n    }\r\n    throw new QueryError(`\"${o.name}\" is not a table`);\r\n}\r\n\r\n\r\nexport type _ISelectable = _ITable | _IView;\r\nexport function asSelectable(o: _IRelation): _ISelectable;\r\nexport function asSelectable(o: _IRelation | null): _ISelectable | null;\r\nexport function asSelectable(o: _IRelation | null, nullIfNotType?: boolean): _ISelectable | null;\r\nexport function asSelectable(o: _IRelation | null, nullIfNotType?: boolean) {\r\n    if (!o) {\r\n        return null;\r\n    }\r\n    if (o.type === 'table' || o.type === 'view') {\r\n        return o;\r\n    }\r\n    if (nullIfNotType) {\r\n        return null;\r\n    }\r\n    throw new QueryError(`\"${o.name}\" is not selectable`);\r\n}\r\n\r\n\r\nexport function asView(o: _IRelation): _IView;\r\nexport function asView(o: _IRelation | null): _IView | null;\r\nexport function asView(o: _IRelation | null, nullIfNotType?: boolean): _IView | null;\r\nexport function asView(o: _IRelation | null, nullIfNotType?: boolean) {\r\n    if (!o) {\r\n        return null;\r\n    }\r\n    if (o.type === 'view') {\r\n        return o;\r\n    }\r\n    if (nullIfNotType) {\r\n        return null;\r\n    }\r\n    throw new QueryError({\r\n        code: '42809',\r\n        error: `\"${o.name}\" is not a view`,\r\n    });\r\n}\r\n\r\nexport interface _ISequence extends _RelationBase {\r\n\r\n    readonly type: 'sequence';\r\n    alter(t: _Transaction, opts: CreateSequenceOptions | AlterSequenceChange): this;\r\n    nextValue(t: _Transaction): number;\r\n    restart(t: _Transaction): void;\r\n    setValue(t: _Transaction, value: number): void;\r\n    currentValue(t: _Transaction): number;\r\n    drop(t: _Transaction): void;\r\n}\r\n\r\n\r\nexport interface AggregationComputer<TRet = any> {\r\n    readonly type: _IType;\r\n    /**  Compute from index  (ex: count(*) with a group-by) */\r\n    computeFromIndex?(key: IndexKey, index: _IIndex, t: _Transaction): TRet | undefined;\r\n    /**  Compute out of nowhere when there is no group\r\n     * (ex: when there is no grouping, count(*) on a table or count(xxx) when there is an index on xxx) */\r\n    computeNoGroup?(t: _Transaction): TRet | undefined;\r\n\r\n    /** When iterating, each new group will have its computer */\r\n    createGroup(t: _Transaction): AggregationGroupComputer<TRet>;\r\n}\r\n\r\nexport interface AggregationGroupComputer<TRet = any> {\r\n    /** When iterating, this will be called for each item in this group  */\r\n    feedItem(item: any): void;\r\n    /** Finish computation (sets aggregation on result) */\r\n    finish(): TRet | nil;\r\n}\r\n","import moment, { Duration, Moment } from \"moment\";\r\nimport { List } from \"immutable\";\r\nimport {\r\n  IValue,\r\n  NotSupported,\r\n  RegClass,\r\n  _IRelation,\r\n  _ISchema,\r\n  _ISelection,\r\n  _ITable,\r\n  _IType,\r\n  _Transaction,\r\n} from \"./interfaces-private\";\r\nimport {\r\n  BinaryOperator,\r\n  DataTypeDef,\r\n  Expr,\r\n  ExprRef,\r\n  ExprValueKeyword,\r\n  Interval,\r\n  nil,\r\n  parse,\r\n  QName,\r\n  SelectedColumn,\r\n} from \"pgsql-ast-parser\";\r\nimport {\r\n  ColumnNotFound,\r\n  ISubscription,\r\n  IType,\r\n  QueryError,\r\n  typeDefToStr,\r\n} from \"./interfaces\";\r\nimport { bufClone, bufCompare, isBuf } from \"./misc/buffer-node\";\r\n\r\nexport interface Ctor<T> extends Function {\r\n  new (...params: any[]): T;\r\n  prototype: T;\r\n}\r\n\r\nexport type Optional<T> = { [key in keyof T]?: T[key] };\r\nexport type SRecord<T> = Record<string, T>;\r\n\r\nexport function trimNullish<T>(value: T, depth = 5): T {\r\n  if (depth < 0) return value;\r\n  if (value instanceof Array) {\r\n    value.forEach((x) => trimNullish(x, depth - 1));\r\n  }\r\n  if (\r\n    typeof value !== \"object\" ||\r\n    value instanceof Date ||\r\n    moment.isMoment(value) ||\r\n    moment.isDuration(value)\r\n  )\r\n    return value;\r\n\r\n  if (!value) {\r\n    return value;\r\n  }\r\n\r\n  for (const k of Object.keys(value)) {\r\n    const val = (value as any)[k];\r\n    if (nullIsh(val)) delete (value as any)[k];\r\n    else trimNullish(val, depth - 1);\r\n  }\r\n  return value;\r\n}\r\n\r\nexport function watchUse<T>(rootValue: T): {\r\n  checked: T;\r\n  check?: () => string | null;\r\n} {\r\n  if (\r\n    !rootValue ||\r\n    (typeof globalThis !== \"undefined\" &&\r\n      (globalThis as any)?.process?.env?.[\"NOCHECKFULLQUERYUSAGE\"] === \"true\")\r\n  ) {\r\n    return { checked: rootValue };\r\n  }\r\n  if (typeof rootValue !== \"object\") {\r\n    throw new NotSupported();\r\n  }\r\n  if (Array.isArray(rootValue)) {\r\n    throw new NotSupported();\r\n  }\r\n  const toUse = new Map<string, any>();\r\n  function recurse(value: any, stack: List<string> = List()): any {\r\n    if (!value || typeof value !== \"object\") {\r\n      return value;\r\n    }\r\n    if (Array.isArray(value)) {\r\n      return value.map((x, i) => recurse(x, stack.push(`[${i}]`)));\r\n    }\r\n    // watch object\r\n    const ret: any = {};\r\n    for (const [k, _v] of Object.entries(value)) {\r\n      if (k[0] === \"_\") {\r\n        // ignore properties starting with '_'\r\n        ret[k] = _v;\r\n        continue;\r\n      }\r\n      const nstack = stack.push(\".\" + k);\r\n      let v = recurse(_v, nstack);\r\n      const nstackKey = nstack.join(\"\");\r\n      toUse.set(nstackKey, _v);\r\n      Object.defineProperty(ret, k, {\r\n        get() {\r\n          toUse.delete(nstackKey);\r\n          return v;\r\n        },\r\n        enumerable: true,\r\n      });\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  const final = recurse(rootValue);\r\n\r\n  const check = function () {\r\n    if (toUse.size) {\r\n      return (\r\n        `The query you ran generated an AST which parts have not been read by the query planner. \\\r\nThis means that those parts could be ignored:\r\n\r\n     ` +\r\n        [...toUse.entries()]\r\n          .map(([k, v]) => k + \" (\" + JSON.stringify(v) + \")\")\r\n          .join(\"\\n     \")\r\n      );\r\n    }\r\n    return null;\r\n  };\r\n  return { checked: final, check };\r\n}\r\n\r\nexport function deepEqual<T>(\r\n  a: T,\r\n  b: T,\r\n  strict?: boolean,\r\n  depth = 10,\r\n  numberDelta = 0.0001\r\n) {\r\n  return deepCompare(a, b, strict, depth, numberDelta) === 0;\r\n}\r\n\r\nexport function deepCompare<T>(\r\n  a: T,\r\n  b: T,\r\n  strict?: boolean,\r\n  depth = 10,\r\n  numberDelta = 0.0001\r\n): number {\r\n  if (depth < 0) {\r\n    throw new NotSupported(\"Comparing too deep entities\");\r\n  }\r\n\r\n  if (a === b) {\r\n    return 0;\r\n  }\r\n  if (!strict) {\r\n    // should not use '==' because it could call .toString() on objects when compared to strings.\r\n    // ... which is not ok. Especially when working with translatable objects, which .toString() returns a transaltion (a string, thus)\r\n    if (!a && !b) {\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  if (Array.isArray(a)) {\r\n    if (!Array.isArray(b)) {\r\n      return -1; // [] < {}\r\n    }\r\n    if (a.length !== b.length) {\r\n      return a.length > b.length ? 1 : -1;\r\n    }\r\n    for (let i = 0; i < a.length; i++) {\r\n      const inner = deepCompare(a[i], b[i], strict, depth - 1, numberDelta);\r\n      if (inner) return inner;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  if (Array.isArray(b)) {\r\n    return 1;\r\n  }\r\n\r\n  if (isBuf(a) || isBuf(b)) {\r\n    if (!isBuf(a)) {\r\n      return 1;\r\n    }\r\n    if (!isBuf(b)) {\r\n      return -1;\r\n    }\r\n    return bufCompare(a, b);\r\n  }\r\n\r\n  // handle dates\r\n  if (\r\n    a instanceof Date ||\r\n    b instanceof Date ||\r\n    moment.isMoment(a) ||\r\n    moment.isMoment(b)\r\n  ) {\r\n    let am;\r\n    let bm;\r\n    if (a instanceof Date || b instanceof Date) {\r\n      am = moment(a as Date);\r\n      bm = moment(b as Date);\r\n    } else {\r\n      am = moment(a as Moment);\r\n      bm = moment(b as Moment);\r\n    }\r\n\r\n    if (am.isValid() !== bm.isValid()) {\r\n      return am.isValid() ? -1 : 1;\r\n    }\r\n    const diff = am.diff(bm, \"seconds\");\r\n    if (Math.abs(diff) < 0.001) {\r\n      return 0;\r\n    }\r\n    return diff > 0 ? 1 : -1;\r\n  }\r\n\r\n  // handle durations\r\n  if (moment.isDuration(a) || moment.isDuration(b)) {\r\n    const da = moment.duration(a as Duration);\r\n    const db = moment.duration(b as Duration);\r\n    if (da.isValid() !== db.isValid()) {\r\n      return da.isValid() ? -1 : 1;\r\n    }\r\n    const diff = da.asMilliseconds() - db.asMilliseconds();\r\n    if (Math.abs(diff) < 1) {\r\n      return 0;\r\n    }\r\n    return diff > 0 ? 1 : -1;\r\n  }\r\n\r\n  const fa = Number.isFinite(<any>a);\r\n  const fb = Number.isFinite(<any>b);\r\n  if (fa && fb) {\r\n    if (Math.abs(<any>a - <any>b) <= numberDelta) {\r\n      return 0;\r\n    }\r\n    return a > b ? 1 : -1;\r\n  } else if (fa && b) {\r\n    return -1;\r\n  } else if (fb && a) {\r\n    return 1;\r\n  }\r\n\r\n  // === handle plain objects\r\n  if (typeof a !== \"object\") {\r\n    return 1; // objects are at the end\r\n  }\r\n  if (typeof b !== \"object\") {\r\n    return -1; // objects are at the end\r\n  }\r\n\r\n  if (!a || !b) {\r\n    return 0; // nulls\r\n  }\r\n\r\n  const ak = Object.keys(a);\r\n  const bk = Object.keys(b);\r\n  if (strict && ak.length !== bk.length) {\r\n    // longer objects at the end\r\n    return ak.length > bk.length ? 1 : -1;\r\n  }\r\n  const set: Iterable<string> = strict\r\n    ? Object.keys(a)\r\n    : new Set([...Object.keys(a), ...Object.keys(b)]);\r\n  for (const k of set) {\r\n    const inner = deepCompare(\r\n      (a as any)[k],\r\n      (b as any)[k],\r\n      strict,\r\n      depth - 1,\r\n      numberDelta\r\n    );\r\n    if (inner) {\r\n      return inner;\r\n    }\r\n  }\r\n  return 0;\r\n}\r\n\r\ntype Json = { [key: string]: Json } | Json[] | string | number | null;\r\nexport function queryJson(a: Json, b: Json) {\r\n  if (!a || !b) {\r\n    return (a ?? null) === (b ?? null);\r\n  }\r\n  if (a === b) {\r\n    return true;\r\n  }\r\n\r\n  if (typeof a === \"string\" || typeof b === \"string\") {\r\n    return false;\r\n  }\r\n\r\n  if (typeof a === \"number\" || typeof b === \"number\") {\r\n    return false;\r\n  }\r\n\r\n  if (Array.isArray(a)) {\r\n    // expecting array\r\n    if (!Array.isArray(b)) {\r\n      return false;\r\n    }\r\n    // => must match all those criteria\r\n    const toMatch = [...a];\r\n    for (const be of b) {\r\n      for (let i = 0; i < toMatch.length; i++) {\r\n        if (queryJson(toMatch[i], be)) {\r\n          // matched this criteria\r\n          toMatch.splice(i, 1);\r\n          break;\r\n        }\r\n      }\r\n      if (!toMatch.length) {\r\n        break;\r\n      }\r\n    }\r\n    return !toMatch.length;\r\n  }\r\n\r\n  if (Array.isArray(b)) {\r\n    return false;\r\n  }\r\n\r\n  if ((typeof a === \"object\") !== (typeof b === \"object\")) {\r\n    return false;\r\n  }\r\n  const akeys = Object.keys(a);\r\n  const bkeys = Object.keys(b);\r\n  if (akeys.length > bkeys.length) {\r\n    return false;\r\n  }\r\n  for (const ak of akeys) {\r\n    if (!(ak in (b as any))) {\r\n      return false;\r\n    }\r\n    if (!queryJson(a[ak], b[ak])) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function buildLikeMatcher(likeCondition: string, caseSensitive = true) {\r\n  // Escape regex characters from likeCondition\r\n  likeCondition = likeCondition.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$&\");\r\n  let likeRegexString = likeCondition.replace(/\\%/g, \".*\").replace(/_/g, \".\");\r\n  likeRegexString = \"^\" + likeRegexString + \"$\";\r\n  const reg = new RegExp(likeRegexString, caseSensitive ? \"\" : \"i\");\r\n\r\n  return (stringToMatch: string | number) => {\r\n    if (nullIsh(stringToMatch)) {\r\n      return null;\r\n    }\r\n    if (typeof stringToMatch != \"string\") {\r\n      stringToMatch = stringToMatch.toString();\r\n    }\r\n    return reg.test(stringToMatch);\r\n  };\r\n}\r\n\r\nexport function nullIsh(v: any): v is nil {\r\n  return v === null || v === undefined;\r\n}\r\n\r\nexport function hasNullish(...vals: any[]): boolean {\r\n  return vals.some((v) => nullIsh(v));\r\n}\r\n\r\nexport function sum(v: number[]): number {\r\n  return v.reduce((sum, el) => sum + el, 0);\r\n}\r\n\r\nexport function deepCloneSimple<T>(v: Partial<T>): T {\r\n  if (!v || typeof v !== \"object\" || v instanceof Date) {\r\n    return v as T;\r\n  }\r\n  if (Array.isArray(v)) {\r\n    return (v as any[]).map((x) => deepCloneSimple(x)) as any;\r\n  }\r\n  if (isBuf(v)) {\r\n    return bufClone(v) as any;\r\n  }\r\n\r\n  const ret: any = {};\r\n  for (const k of Object.keys(v)) {\r\n    ret[k] = deepCloneSimple((v as any)[k]);\r\n  }\r\n  for (const k of Object.getOwnPropertySymbols(v)) {\r\n    ret[k] = (v as any)[k]; // no need to deep clone that\r\n  }\r\n  return ret;\r\n}\r\n\r\nexport function isSelectAllArgList(select: Expr[]): boolean {\r\n  const [first] = select;\r\n  return (\r\n    select.length === 1 &&\r\n    first.type === \"ref\" &&\r\n    first.name === \"*\" &&\r\n    !first.table\r\n  );\r\n}\r\n\r\nexport function ignore(...val: any[]): void {\r\n  for (const v of val) {\r\n    if (!v) {\r\n      continue;\r\n    }\r\n    if (Array.isArray(v)) {\r\n      ignore(...v);\r\n      continue;\r\n    }\r\n    if (typeof v !== \"object\") {\r\n      continue;\r\n    }\r\n    ignore(...Object.values(v));\r\n  }\r\n}\r\n\r\nexport function combineSubs(...vals: ISubscription[]): ISubscription {\r\n  return {\r\n    unsubscribe: () => {\r\n      vals.forEach((u) => u?.unsubscribe());\r\n    },\r\n  };\r\n}\r\n\r\nexport interface ExecCtx {\r\n  readonly schema: _ISchema;\r\n  readonly transaction: _Transaction;\r\n  readonly parametersValues?: any[];\r\n}\r\nconst curCtx: ExecCtx[] = [];\r\nexport function executionCtx(): ExecCtx {\r\n  if (!curCtx.length) {\r\n    throw new Error(\"No execution context available\");\r\n  }\r\n  return curCtx[curCtx.length - 1];\r\n}\r\nexport function hasExecutionCtx(): boolean {\r\n  return curCtx.length > 0;\r\n}\r\n\r\nexport function pushExecutionCtx<T>(ctx: ExecCtx, act: () => T): T {\r\n  try {\r\n    curCtx.push(ctx);\r\n    return act();\r\n  } finally {\r\n    curCtx.pop();\r\n  }\r\n}\r\n\r\nexport function indexHash(this: void, vals: (IValue | string)[]) {\r\n  return vals\r\n    .map((x) => (typeof x === \"string\" ? x : x.hash))\r\n    .sort()\r\n    .join(\"|\");\r\n}\r\n\r\nexport function randomString(\r\n  length = 8,\r\n  chars = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\r\n): string {\r\n  var result = \"\";\r\n  for (var i = length; i > 0; --i)\r\n    result += chars[Math.floor(Math.random() * chars.length)];\r\n  return result;\r\n}\r\n\r\nexport function schemaOf(t: DataTypeDef): string | nil {\r\n  if (t.kind === \"array\") {\r\n    return schemaOf(t.arrayOf);\r\n  }\r\n  return t.schema;\r\n}\r\n\r\nexport function isType(t: any): t is _IType | IType {\r\n  return !!t?.[isType.TAG];\r\n}\r\nisType.TAG = Symbol();\r\n\r\nexport function suggestColumnName(expr: Expr | nil): string | null {\r\n  if (!expr) {\r\n    return null;\r\n  }\r\n  // suggest a column result name\r\n  switch (expr.type) {\r\n    case \"call\":\r\n      return expr.function.name;\r\n    case \"ref\":\r\n      return expr.name;\r\n    case \"keyword\":\r\n      return expr.keyword;\r\n    case \"cast\":\r\n      return typeDefToStr(expr.to);\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function findTemplate<T>(\r\n  this: void,\r\n  selection: _ISelection,\r\n  t: _Transaction,\r\n  template?: Partial<T>,\r\n  columns?: (keyof T)[]\r\n): Iterable<T> {\r\n  // === Build an SQL AST expression that matches\r\n  // this template\r\n  let expr: Expr | nil;\r\n  for (const [k, v] of Object.entries(template ?? {})) {\r\n    let right: Expr;\r\n    if (nullIsh(v)) {\r\n      // handle { myprop: null }\r\n      right = {\r\n        type: \"unary\",\r\n        op: \"IS NULL\",\r\n        operand: {\r\n          type: \"ref\",\r\n          name: k,\r\n        },\r\n      };\r\n    } else {\r\n      let value: Expr;\r\n      let op: BinaryOperator = \"=\";\r\n      switch (typeof v) {\r\n        case \"number\":\r\n          // handle {myprop: 42}\r\n          value = Number.isInteger(v)\r\n            ? { type: \"integer\", value: v }\r\n            : { type: \"numeric\", value: v };\r\n          break;\r\n        case \"string\":\r\n          // handle {myprop: 'blah'}\r\n          value = { type: \"string\", value: v };\r\n          break;\r\n        case \"object\":\r\n          // handle {myprop: new Date()}\r\n          if (moment.isMoment(v)) {\r\n            value = { type: \"string\", value: v.toISOString() };\r\n          } else if (v instanceof Date) {\r\n            value = { type: \"string\", value: moment(v).toISOString() };\r\n          } else {\r\n            // handle {myprop: {obj: \"test\"}}\r\n            op = \"@>\";\r\n            value = {\r\n              type: \"string\",\r\n              value: JSON.stringify(v),\r\n            };\r\n          }\r\n          break;\r\n        default:\r\n          throw new Error(\r\n            `Object type of property \"${k}\" not supported in template`\r\n          );\r\n      }\r\n      right = {\r\n        type: \"binary\",\r\n        op,\r\n        left: {\r\n          type: \"ref\",\r\n          name: k,\r\n        },\r\n        right: value,\r\n      };\r\n    }\r\n    expr = !expr\r\n      ? right\r\n      : {\r\n          type: \"binary\",\r\n          op: \"AND\",\r\n          left: expr,\r\n          right,\r\n        };\r\n  }\r\n\r\n  // === perform filter\r\n  let ret = selection.filter(expr);\r\n  if (columns) {\r\n    ret = ret.select(\r\n      columns.map<SelectedColumn>((x) => ({\r\n        expr: { type: \"ref\", name: x as string },\r\n      }))\r\n    );\r\n  }\r\n  return ret.enumerate(t);\r\n}\r\n\r\nfunction ver(v: string) {\r\n  if (!v || !/^\\d+(\\.\\d+)+$/.test(v)) {\r\n    throw new Error(\"Invalid semver \" + v);\r\n  }\r\n  return v.split(/\\./g).map((x) => parseInt(x, 10));\r\n}\r\nexport function compareVersions(_a: string, _b: string): number {\r\n  const a = ver(_a);\r\n  const b = ver(_b);\r\n  const m = Math.max(a.length, b.length);\r\n  for (let i = 0; i < m; i++) {\r\n    const d = (b[i] || 0) - (a[i] || 0);\r\n    if (d !== 0) {\r\n      return d;\r\n    }\r\n  }\r\n  return 0;\r\n}\r\n\r\nexport function intervalToSec(v: Interval) {\r\n  return (\r\n    (v.milliseconds ?? 0) / 1000 +\r\n    (v.seconds ?? 0) +\r\n    (v.minutes ?? 0) * 60 +\r\n    (v.hours ?? 0) * 3600 +\r\n    (v.days ?? 0) * 3600 * 24 +\r\n    (v.months ?? 0) * 3600 * 24 * 30 +\r\n    (v.years ?? 0) * 3600 * 24 * 30 * 12\r\n  );\r\n}\r\n\r\nexport function parseRegClass(_reg: RegClass): QName | number {\r\n  let reg = _reg;\r\n  if (typeof reg === \"string\" && /^\\d+$/.test(reg)) {\r\n    reg = parseInt(reg);\r\n  }\r\n  if (typeof reg === \"number\") {\r\n    return reg;\r\n  }\r\n  // todo remove casts after next pgsql-ast-parser release\r\n  try {\r\n    const ret = parse(reg, \"qualified_name\" as any) as QName;\r\n    return ret;\r\n  } catch (e) {\r\n    return { name: reg };\r\n  }\r\n}\r\n\r\nconst timeReg = /^(\\d+):(\\d+)(:(\\d+))?(\\.\\d+)?$/;\r\nexport function parseTime(str: string): moment.Moment {\r\n  const [_, a, b, __, c, d] = timeReg.exec(str) ?? [];\r\n  if (!_) {\r\n    throw new QueryError(`Invalid time format: ` + str);\r\n  }\r\n  const ms = d ? parseFloat(d) * 1000 : undefined;\r\n  let ret: moment.Moment;\r\n  if (c) {\r\n    ret = moment.utc({\r\n      h: parseInt(a, 10),\r\n      m: parseInt(b, 10),\r\n      s: parseInt(c, 10),\r\n      ms,\r\n    });\r\n  } else {\r\n    if (d) {\r\n      ret = moment.utc({\r\n        m: parseInt(a, 10),\r\n        s: parseInt(b, 10),\r\n        ms,\r\n      });\r\n    } else {\r\n      ret = moment.utc({\r\n        h: parseInt(a, 10),\r\n        m: parseInt(b, 10),\r\n        ms,\r\n      });\r\n    }\r\n  }\r\n  if (!ret.isValid()) {\r\n    throw new QueryError(`Invalid time format: ` + str);\r\n  }\r\n  return ret;\r\n}\r\n\r\nexport function colByName<T>(\r\n  refs: Map<string, T>,\r\n  ref: string | ExprRef,\r\n  nullIfNotFound: boolean | nil\r\n): T | nil {\r\n  const nm = typeof ref === \"string\" ? ref : !ref.table ? ref.name : null;\r\n  const got = nm ? refs.get(nm) : null;\r\n  if (!got && !nullIfNotFound) {\r\n    throw new ColumnNotFound(colToStr(ref));\r\n  }\r\n  return got;\r\n}\r\n\r\nexport function colToStr(col: string | ExprRef) {\r\n  if (typeof col === \"string\") {\r\n    return col;\r\n  }\r\n  if (!col.table) {\r\n    return col.name;\r\n  }\r\n  return col.table.name + \".\" + col.name;\r\n}\r\n\r\nexport function qnameToStr(col: string | QName) {\r\n  if (typeof col === \"string\") {\r\n    return col;\r\n  }\r\n  if (!col.schema) {\r\n    return col.name;\r\n  }\r\n  return col.schema + \".\" + col.name;\r\n}\r\n\r\nexport function asSingleName(col: string | ExprRef): string | nil {\r\n  if (typeof col === \"string\") {\r\n    return col;\r\n  }\r\n  if (col.table) {\r\n    return null;\r\n  }\r\n  return col.name;\r\n}\r\n\r\nexport function asSingleQName(\r\n  col: string | QName,\r\n  allowedSchema?: string\r\n): string | nil {\r\n  if (typeof col === \"string\") {\r\n    return col;\r\n  }\r\n  if (col.schema && col.schema !== allowedSchema) {\r\n    return null;\r\n  }\r\n  return col.name;\r\n}\r\n\r\nexport function errorMessage(error: unknown): string {\r\n  if (typeof error === \"string\") {\r\n    return error;\r\n  }\r\n  if (typeof error !== \"object\") {\r\n    return \"Unkown error message\";\r\n  }\r\n  return (error as any)?.message;\r\n}\r\n\r\nexport function it<T>(iterable: Iterable<T>): IteratorHelper<T> {\r\n  return iterable instanceof IteratorHelper\r\n    ? (iterable as any)\r\n    : new IteratorHelper(() => iterable);\r\n}\r\n\r\nexport class IteratorHelper<T> implements Iterable<T> {\r\n  constructor(private underlying: () => Iterable<T>) {}\r\n\r\n  [Symbol.iterator]() {\r\n    return this.underlying()[Symbol.iterator]();\r\n  }\r\n\r\n  flatten(): T extends Iterable<infer X> ? IteratorHelper<X> : never {\r\n    const that = this;\r\n    function* wrap() {\r\n      for (const v of (that.underlying() as any) ?? []) {\r\n        for (const x of v) {\r\n          yield x;\r\n        }\r\n      }\r\n    }\r\n    return new IteratorHelper(wrap) as any;\r\n  }\r\n\r\n  reduce<U>(\r\n    callbackfn: (previousValue: U, currentValue: T, currentIndex: number) => U,\r\n    initialValue: U\r\n  ): U {\r\n    let acc = initialValue;\r\n    let i = 0;\r\n    for (const v of this.underlying()) {\r\n      acc = callbackfn(acc, v, i);\r\n      i++;\r\n    }\r\n    return acc;\r\n  }\r\n}\r\n\r\nexport function fromEntries<K, V>(iterable: [K, V][]): Map<K, V> {\r\n  const ret = new Map<K, V>();\r\n  for (const [k, v] of iterable) {\r\n    ret.set(k, v);\r\n  }\r\n  return ret;\r\n}\r\n\r\nexport function notNil<T>(value: (T | nil)[] | nil): Exclude<T, null>[] {\r\n  return (value ?? []).filter((x) => !nullIsh(x)) as any[];\r\n}\r\n\r\n/** Modify an array if necessary */\r\nexport function modifyIfNecessary<T>(\r\n  values: T[],\r\n  mapper: (input: T) => T | nil\r\n): T[] {\r\n  let ret: T[] | undefined;\r\n  for (let i = 0; i < values.length; i++) {\r\n    const mapped = mapper(values[i]);\r\n    if (nullIsh(mapped)) {\r\n      continue;\r\n    }\r\n    if (!ret) {\r\n      ret = [...values];\r\n    }\r\n    ret[i] = mapped;\r\n  }\r\n  return ret ?? values;\r\n}\r\n","import { IMigrate } from './migrate/migrate-interfaces';\r\nimport { TableConstraint, CreateColumnDef, NodeLocation, DataTypeDef, FunctionArgumentMode, BinaryOperator, Statement } from 'pgsql-ast-parser';\r\n\r\n\r\nexport type nil = undefined | null;\r\n\r\nexport type Schema = {\r\n    name: string;\r\n    fields: SchemaField[];\r\n    constraints?: TableConstraint[];\r\n}\r\n\r\n\r\nexport interface SchemaField extends Omit<CreateColumnDef, 'dataType' | 'kind' | 'name'> {\r\n    type: IType | DataType;\r\n    name: string;\r\n    serial?: boolean;\r\n}\r\n\r\nexport interface IType {\r\n    /** Data type */\r\n    readonly primary: DataType;\r\n    readonly name: string;\r\n    toString(): string;\r\n\r\n    /** Create an array type of this type */\r\n    asArray(): IType;\r\n}\r\n\r\n// todo support all types https://www.postgresql.org/docs/9.5/datatype.html\r\nexport enum DataType {\r\n\r\n    inet = 'inet',\r\n    record = 'record',\r\n    uuid = 'uuid',\r\n    text = 'text',\r\n    citext = 'citext',\r\n    array = 'array',\r\n    list = 'list',\r\n    bigint = 'bigint',\r\n    float = 'float',\r\n    decimal = 'decimal',\r\n    integer = 'integer',\r\n    jsonb = 'jsonb',\r\n    regtype = 'regtype',\r\n    regclass = 'regclass',\r\n    json = 'json',\r\n    bytea = 'bytea',\r\n    interval = 'interval',\r\n    timestamp = 'timestamp',\r\n    timestamptz = 'timestamptz',\r\n    date = 'date',\r\n    time = 'time',\r\n    timetz = 'timetz',\r\n    null = 'null',\r\n    bool = 'bool',\r\n\r\n    point = 'point',\r\n    line = 'line',\r\n    lseg = 'lseg',\r\n    box = 'box',\r\n    path = 'path',\r\n    polygon = 'polygon',\r\n    circle = 'circle',\r\n}\r\n\r\nexport interface MemoryDbOptions {\r\n    /**\r\n     * If set to true, pg-mem will stop embbeding info about the SQL statement\r\n     * that has failed in exception messages.\r\n     */\r\n    noErrorDiagnostic?: boolean;\r\n    /**\r\n     * If set to true, then the query runner will not check that no AST part\r\n     * has been left behind when parsing the request.\r\n     *\r\n     * ... so setting it to true could lead to unnoticed ignored query parts.\r\n     *\r\n     * (advice: only set it to true as a workaround while an issue on https://github.com/oguimbal/pg-mem is being fixed... )\r\n     */\r\n    noAstCoverageCheck?: boolean;\r\n    /**\r\n     *  If set to true, this will throw an exception if\r\n     * you try to use an unsupported index type\r\n     * (only BTREE is supported at time of writing)\r\n     */\r\n    noIgnoreUnsupportedIndices?: boolean;\r\n    /**\r\n     * When set to true, this will auto create an index on foreign table when adding a foreign key.\r\n     *  Recommanded when using Typeorm .synchronize(), which creates foreign keys but not indices !\r\n     **/\r\n    readonly autoCreateForeignKeyIndices?: boolean;\r\n}\r\n\r\nexport interface IMemoryDb {\r\n    /**\r\n     * Adapters to create wrappers of this db compatible with known libraries\r\n     */\r\n    readonly adapters: LibAdapters;\r\n    /**\r\n     * The default 'public' schema\r\n     */\r\n    readonly public: ISchema;\r\n    /**\r\n     * Get an existing schema\r\n     */\r\n    getSchema(db?: string | null): ISchema;\r\n    /**\r\n     * Create a schema in this database\r\n     */\r\n    createSchema(name: string): ISchema;\r\n    /**\r\n     * Get a table to inspect it (in the public schema... this is a shortcut for db.public.getTable())\r\n     */\r\n    getTable<T = any>(table: string): IMemoryTable<T>;\r\n    getTable<T = any>(table: string, nullIfNotFound?: boolean): IMemoryTable<T> | null;\r\n\r\n    /** Subscribe to a global event */\r\n    on(event: 'query', handler: (query: string) => any): ISubscription;\r\n    on(event: GlobalEvent, handler: () => any): ISubscription;\r\n    on(event: GlobalEvent, handler: () => any): ISubscription;\r\n    /** Subscribe to an event on all tables */\r\n    on(event: TableEvent, handler: (table: string) => any): ISubscription;\r\n\r\n    /**\r\n     * Creates a restore point.\r\n     *  This operation is O(1) (instantaneous, even with millions of records).\r\n     * */\r\n    backup(): IBackup;\r\n\r\n    /**\r\n     * Registers an extension (that can be installed using the 'create extension' statement)\r\n     * @param name Extension name\r\n     * @param install How to install this extension on a given schema\r\n     */\r\n    registerExtension(name: string, install: (schema: ISchema) => void): this;\r\n\r\n    /** Registers a new language, usable in 'DO' blocks, or in 'CREATE FUNCTION' blocks */\r\n    registerLanguage(languageName: string, compiler: LanguageCompiler): this;\r\n}\r\n\r\nexport type QueryInterceptor = (query: string) => any[] | nil;\r\n\r\n\r\nexport type ArgDef = DataType | IType | ArgDefDetails;\r\n\r\nexport interface ArgDefDetails {\r\n    /** Argument type */\r\n    type: IType;\r\n    /** Optional argument name */\r\n    name?: string;\r\n    /**\r\n     *  Arguments are 'in' by default, but you can change that.\r\n     */\r\n    mode?: FunctionArgumentMode;\r\n}\r\n\r\nexport type LanguageCompiler = (options: ToCompile) => CompiledFunction;\r\n\r\nexport interface ToCompile {\r\n    /** Function being compiled (null for \"DO\" statements compilations) */\r\n    functioName?: string | nil;\r\n    /** Code to compile */\r\n    code: string;\r\n    /** Schema against which this compilation is performed */\r\n    schema: ISchema;\r\n    /** Expected arguments */\r\n    args: ArgDefDetails[];\r\n    /** Expected return type (if any) */\r\n    returns?: IType | nil;\r\n}\r\n\r\nexport class AdvancedResult {\r\n    constructor(readonly result: any, outArgs: any[]) {\r\n    }\r\n}\r\n\r\nexport type CompiledFunction = (...inArguments: any[]) => AdvancedResult | PlainResult;\r\n\r\nexport type PlainResult = Object | number | Date | null | void;\r\n\r\nexport interface CompiledFunctionResult {\r\n    /** The function result, if function \"returns\" something */\r\n    result?: any;\r\n    /** The functions out arguments, as indexed in the `args` passed to your language compiler function */\r\n    outArgs?: any[];\r\n}\r\n\r\nexport interface IBackup {\r\n    /**\r\n     * Restores data to the state when this backup has been performed.\r\n     *  This operation is O(1).\r\n     *  Schema must not have been changed since then !\r\n     **/\r\n    restore(): void;\r\n}\r\n\r\nexport interface LibAdapters {\r\n    /** Create a PG module that will be equivalent to require('pg') */\r\n    createPg(queryLatency?: number): { Pool: any; Client: any };\r\n\r\n    /** Create a pg-promise instance bound to this db */\r\n    createPgPromise(queryLatency?: number): any;\r\n\r\n    /** Create a slonik pool bound to this db */\r\n    createSlonik(queryLatency?: number): any;\r\n\r\n    /** Create a pg-native instance bound to this db */\r\n    createPgNative(queryLatency?: number): any;\r\n\r\n    /** Create a Typeorm connection bound to this db\r\n     * @deprecated Use `createTypeormDataSource` instead. See https://github.com/oguimbal/pg-mem/pull/238.\r\n     */\r\n    createTypeormConnection(typeOrmConnection: any, queryLatency?: number): any;\r\n\r\n    /** Create a Typeorm data source bound to this db */\r\n    createTypeormDataSource(typeOrmConnection: any, queryLatency?: number): any;\r\n\r\n    /** Create a Knex.js instance bound to this db */\r\n    createKnex(queryLatency?: number, knexConfig?: object): any;\r\n\r\n    /** Create a mikro-orm instance bound to this db */\r\n    createMikroOrm(mikroOrmOptions: any, queryLatency?: number): Promise<any>\r\n}\r\n\r\nexport type QueryOrAst = string | Statement | Statement[];\r\n\r\nexport interface ISchema {\r\n    /**\r\n     * Execute a query and return many results\r\n     */\r\n    many(query: QueryOrAst): any[];\r\n    /**\r\n     * Execute a query without results\r\n     */\r\n    none(query: QueryOrAst): void;\r\n    /**\r\n     * Execute a query with a single result\r\n     */\r\n    one(query: QueryOrAst): any;\r\n    /**\r\n     * Another way to create tables (equivalent to \"create table\" queries\")\r\n     */\r\n    declareTable(table: Schema): IMemoryTable;\r\n    /**\r\n     * Execute a query\r\n     */\r\n    query(text: QueryOrAst): QueryResult;\r\n\r\n\r\n    /**\r\n     * Progressively executes a query, yielding results until the end of enumeration (or an exception)\r\n     */\r\n    queries(text: QueryOrAst): Iterable<QueryResult>;\r\n\r\n    /**\r\n     * Get a table in this db to inspect it\r\n     */\r\n    getTable(table: string): IMemoryTable;\r\n    getTable(table: string, nullIfNotFound?: boolean): IMemoryTable | null;\r\n\r\n    /** Register a function */\r\n    registerFunction(fn: FunctionDefinition, orReplace?: boolean): this;\r\n\r\n\r\n    /** Register a binary operator */\r\n    registerOperator(fn: OperatorDefinition): this;\r\n\r\n    /** Register a simple type, which is equivalent to another */\r\n    registerEquivalentType(type: IEquivalentType): IType;\r\n\r\n    /** Get an existing type */\r\n    getType(name: DataType): IType;\r\n\r\n    /**\r\n     * Registers an enum type on this schema\r\n     * @param name Enum name\r\n     * @param values Possible values\r\n     */\r\n    registerEnum(name: string, values: string[]): void;\r\n\r\n    /**\r\n     * Database migration, node-sqlite flavor\r\n     *  Only working when runnin nodejs !\r\n     */\r\n    migrate(config?: IMigrate.MigrationParams): Promise<void>;\r\n\r\n\r\n    /**\r\n     * Intecept queries.\r\n     * If your interceptor returns an array, then the query will not be executed.\r\n     * The given result will be returned instead.\r\n     */\r\n    interceptQueries(interceptor: QueryInterceptor): ISubscription;\r\n}\r\n\r\nexport interface FunctionDefinition {\r\n    /** Function name (casing doesnt matter) */\r\n    name: string;\r\n\r\n    /** Expected arguments */\r\n    args?: ArgDef[] | nil;\r\n\r\n    /** Other arguments type (variadic arguments) */\r\n    argsVariadic?: DataType | IType | nil;\r\n\r\n    /** Returned data type */\r\n    returns?: DataType | IType | nil;\r\n\r\n    /**\r\n     * If the function is marked as impure, it will not be simplified\r\n     * (ex: \"select myFn(1) from myTable\" will call myFn() for each row in myTable, even if it does not depend on its result) */\r\n    impure?: boolean;\r\n\r\n    /** If true, the function will also be called when passing null arguments */\r\n    allowNullArguments?: boolean;\r\n\r\n    /** Actual implementation of the function */\r\n    implementation: CompiledFunction;\r\n}\r\n\r\nexport interface OperatorDefinition {\r\n    /** Function name (casing doesnt matter) */\r\n    operator: BinaryOperator;\r\n\r\n    /** Expected left argument */\r\n    left: DataType | IType;\r\n\r\n    /** Expected right argument */\r\n    right: DataType | IType;\r\n\r\n    /** True if the operator is commutative (if left & right can be inverted) */\r\n    commutative?: boolean;\r\n\r\n    /** Returned data type */\r\n    returns: DataType | IType;\r\n\r\n    /**\r\n     * If the function is marked as impure, it will not be simplified\r\n     * (ex: \"select myFn(1) from myTable\" will call myFn() for each row in myTable, even if it does not depend on its result) */\r\n    impure?: boolean;\r\n\r\n    /** If true, the function will also be called when passing null arguments */\r\n    allowNullArguments?: boolean;\r\n\r\n    /** Actual implementation of the function */\r\n    implementation: CompiledFunction;\r\n}\r\n\r\n\r\nexport interface QueryResult {\r\n    /** Last command that has been executed */\r\n    command: string;\r\n    rowCount: number;\r\n    fields: Array<FieldInfo>;\r\n    rows: any[];\r\n\r\n    /** Location of the last \";\" prior to this statement */\r\n    location: NodeLocation;\r\n}\r\n\r\nexport interface FieldInfo {\r\n    name: string;\r\n    type: DataType;\r\n}\r\n\r\n\r\n\r\nexport type TableEvent = 'seq-scan';\r\nexport type GlobalEvent = 'query' | 'query-failed' | 'catastrophic-join-optimization' | 'schema-change' | 'create-extension';\r\n\r\nexport interface IMemoryTable<T = any> {\r\n    /** Subscribe to an event on this table */\r\n    on(event: TableEvent, handler: () => any): ISubscription;\r\n    /** List existing indices defined on this table */\r\n    listIndices(): IndexDef[];\r\n\r\n    /**\r\n     * Inserts a raw item into this table.\r\n     *  Neither the record you provided, nor the returned value are the actual item stored. You wont be able to mutate internal state.\r\n     * @returns A copy of the inserted item (with assigned defaults)\r\n     */\r\n    insert(item: Partial<T>): T;\r\n\r\n    /** Find all items matching a specific template */\r\n    find(template?: Partial<T> | nil, columns?: (keyof T)[]): Iterable<T>;\r\n}\r\n\r\n\r\nexport interface ISubscription {\r\n    unsubscribe(): void;\r\n}\r\n\r\nexport interface IndexDef {\r\n    name: string;\r\n    expressions: string[];\r\n}\r\n\r\nexport class NotSupported extends Error {\r\n    constructor(what?: string) {\r\n        super(' Not supported  ' + (what ? ': ' + what : ''));\r\n    }\r\n\r\n    static never(value: never, msg?: string) {\r\n        return new NotSupported(`${msg ?? ''} ${JSON.stringify(value)}`);\r\n    }\r\n}\r\n\r\n\r\ninterface ErrorData {\r\n    readonly error: string;\r\n    readonly details?: string;\r\n    readonly hint?: string;\r\n    readonly code?: string;\r\n}\r\nexport class QueryError extends Error {\r\n    readonly data: ErrorData;\r\n    constructor(err: string | ErrorData, code?: string) {\r\n        super(typeof err === 'string' ? err : errDataToStr(err));\r\n        this.data = typeof err === 'string'\r\n            ? { error: err, code }\r\n            : err;\r\n    }\r\n}\r\n\r\nfunction errDataToStr(data: ErrorData) {\r\n    const ret = ['ERROR: ' + data.error];\r\n    if (data.details) {\r\n        ret.push('DETAIL: ' + data.details);\r\n    }\r\n    if (data.hint) {\r\n        ret.push('HINT: ' + data.hint)\r\n    }\r\n    return ret.join('\\n');\r\n}\r\n\r\n\r\nexport class CastError extends QueryError {\r\n    constructor(from: string | DataType | IType, to: string | DataType | IType, inWhat?: string) {\r\n        super(`cannot cast type ${typeof from === 'string'\r\n            ? from\r\n            : from.name} to ${typeof to === 'string'\r\n                ? to\r\n                : to.name}`\r\n            + (inWhat ? ' in ' + inWhat : ''));\r\n    }\r\n}\r\n\r\n\r\nexport class ColumnNotFound extends QueryError {\r\n    constructor(col: string) {\r\n        super(`column \"${col}\" does not exist`);\r\n    }\r\n}\r\n\r\nexport class AmbiguousColumn extends QueryError {\r\n    constructor(col: string) {\r\n        super(`column reference \"${col}\" is ambiguous`);\r\n    }\r\n}\r\n\r\nexport class RelationNotFound extends QueryError {\r\n    constructor(tableName: string) {\r\n        super(`relation \"${tableName}\" does not exist`);\r\n    }\r\n}\r\nexport class TypeNotFound extends QueryError {\r\n    constructor(t: string | number | DataTypeDef) {\r\n        super(`type \"${typeof t !== 'object' ? t : typeDefToStr(t)}\" does not exist`);\r\n    }\r\n}\r\n\r\nexport class RecordExists extends QueryError {\r\n    constructor() {\r\n        super('Records already exists');\r\n    }\r\n}\r\n\r\n\r\nexport class PermissionDeniedError extends QueryError {\r\n    constructor(what?: string) {\r\n        super(what\r\n            ? `permission denied: \"${what}\" is a system catalog`\r\n            : 'permission denied');\r\n    }\r\n}\r\n\r\n\r\nexport function typeDefToStr(t: DataTypeDef): string {\r\n    if (t.kind === 'array') {\r\n        return typeDefToStr(t.arrayOf) + '[]';\r\n    }\r\n    let ret = t.name;\r\n    if (t.schema) {\r\n        ret = t.schema + '.' + ret;\r\n    }\r\n    if (t.config?.length) {\r\n        ret = ret + '(' + t.config.join(',') + ')';\r\n    }\r\n    return ret;\r\n}\r\n\r\n/** A type definition that is equivalent to another type */\r\nexport interface IEquivalentType {\r\n    /** Type name */\r\n    readonly name: string;\r\n    /** Which underlying type is it equivalent to ? */\r\n    readonly equivalentTo: DataType | IType;\r\n    /**\r\n     * Is this value valid ?\r\n     */\r\n    isValid(value: any): boolean;\r\n}\r\n","export * from './datatypes';\r\n","import { _ISchema, _ISelection, _IDb, OnStatementExecuted, nil, QueryError, _IStatement, IValue, Parameter } from '../interfaces-private';\r\n\r\n\r\nclass StackOf<T> {\r\n    readonly stack: T[] = [];\r\n    constructor(private name: string) {\r\n    }\r\n    usingValue = <ret>(value: T, act: () => ret): ret => {\r\n        this.stack.push(value);\r\n        try {\r\n            return act();\r\n        } finally {\r\n            this.stack.pop();\r\n        }\r\n    }\r\n    get current(): T {\r\n        if (!this.stack.length) {\r\n            throw new Error(`No ${this.name} available`);\r\n        }\r\n        return this.stack[this.stack.length - 1];\r\n    }\r\n\r\n    get currentOrNil(): T | nil {\r\n        return this.stack[this.stack.length - 1];\r\n    }\r\n}\r\n\r\n\r\nconst _selectionStack = new StackOf<_ISelection>('build context');\r\nconst _statementStack = new StackOf<_IStatement>('execution statement');\r\nconst _tempBindings = new StackOf<Map<string, _ISelection | 'no returning'>>('binding context');\r\nconst _parametersStack = new StackOf<Parameter[]>('parameter context');\r\nconst _nameResolver = new StackOf<INameResolver>('name resolver');\r\n\r\nexport interface INameResolver {\r\n    /** Try to resolve a name */\r\n    resolve(name: string): IValue | nil;\r\n    /** True if is isolated... meaning that one cannot fetch values from its parent */\r\n    readonly isolated: boolean;\r\n}\r\n\r\n\r\ninterface IBuildContext {\r\n    readonly selection: _ISelection;\r\n    readonly db: _IDb;\r\n    readonly schema: _ISchema;\r\n    readonly onFinishExecution: (callback: OnStatementExecuted) => void\r\n    readonly getTempBinding: (name: string) => _ISelection | nil;\r\n    readonly setTempBinding: (name: string, boundTo: _ISelection) => void;\r\n    readonly getParameter: (nameOrPosition: string | number) => IValue | nil;\r\n}\r\n\r\nclass Context implements IBuildContext {\r\n    get selection(): _ISelection {\r\n        return _selectionStack.current;\r\n    }\r\n    get db(): _IDb {\r\n        return _selectionStack.current.db;\r\n    }\r\n    get schema(): _ISchema {\r\n        // remove the concept of selection schema ?\r\n        // (does not make much sens, if you think about it)\r\n        return _selectionStack.current.ownerSchema;\r\n    }\r\n    onFinishExecution = (callback: OnStatementExecuted) => {\r\n        _statementStack.current.onExecuted(callback);\r\n    };\r\n    getTempBinding = (name: string) => {\r\n        const ret = _tempBindings.currentOrNil?.get(name);\r\n        if (ret === 'no returning') {\r\n            throw new QueryError(`WITH query \"${name}\" does not have a RETURNING clause`);\r\n        }\r\n        return ret;\r\n    };\r\n    setTempBinding = (name: string, boundTo: _ISelection) => {\r\n        if (_tempBindings.current.has(name)) {\r\n            throw new QueryError(`WITH query name \"${name}\" specified more than once`);\r\n        }\r\n        _tempBindings.current.set(name, boundTo.isExecutionWithNoResult ? 'no returning' : boundTo);\r\n    };\r\n    getParameter = (nameOrPosition: string | number) => {\r\n        const params = _parametersStack.currentOrNil;\r\n        if (!params) {\r\n            return null;\r\n        }\r\n        if (typeof nameOrPosition === 'number') {\r\n            const ret = params[nameOrPosition]?.value;\r\n            if (!ret) {\r\n                // not ideal... (duplicated error message)\r\n                throw new QueryError(`bind message supplies ${params.length} parameters, but prepared statement \"\" requires ${nameOrPosition}`, '08P01');\r\n            }\r\n            return ret;\r\n        }\r\n        return params.find(p => p.value.id === nameOrPosition)?.value;\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\nconst _buildCtx = new Context();\r\nexport function buildCtx(): IBuildContext {\r\n    return _buildCtx;\r\n}\r\n\r\n\r\nexport const withSelection = _selectionStack.usingValue;\r\nexport const withStatement = _statementStack.usingValue;\r\nexport function withBindingScope<T>(act: () => T): T {\r\n    return _tempBindings.usingValue(new Map(), act);\r\n}\r\nexport const withParameters = _parametersStack.usingValue;\r\nexport const withNameResolver = _nameResolver.usingValue;\r\n\r\nexport function resolveName(name: string): IValue | null {\r\n    for (let i = _nameResolver.stack.length - 1; i >= 0; i--) {\r\n        const resolver = _nameResolver.stack[i];\r\n        const found = resolver.resolve(name);\r\n        if (found) {\r\n            return found;\r\n        }\r\n        if (resolver.isolated) {\r\n            return null;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n","// <== THERE MUST BE NO ACTUAL IMPORTS OTHER THAN IMPORT TYPES (dependency loop)\r\n// ... use 'kind-of' dependency injection below\r\nimport type { _ISelection, IValue, _IIndex, _ISchema, _IDb, _Transaction, _SelectExplanation, _Explainer, Stats, nil, _IAlias } from '../interfaces-private';\r\nimport type { buildSelection } from './selection';\r\nimport type { buildAlias } from './alias';\r\nimport type { buildFilter } from './build-filter';\r\nimport type { buildGroupBy } from './aggregation';\r\nimport type { buildLimit } from './limit';\r\nimport type { buildUnion } from './union';\r\nimport type { buildOrderBy } from './order-by';\r\nimport type { buildDistinct } from './distinct';\r\n\r\nimport { Expr, SelectedColumn, SelectStatement, LimitStatement, OrderByStatement, ExprRef } from 'pgsql-ast-parser';\r\nimport { RestrictiveIndex } from './restrictive-index';\r\n\r\ninterface Fns {\r\n    buildSelection: typeof buildSelection;\r\n    buildAlias: typeof buildAlias;\r\n    buildLimit: typeof buildLimit;\r\n    buildUnion: typeof buildUnion;\r\n    buildFilter: typeof buildFilter;\r\n    buildGroupBy: typeof buildGroupBy;\r\n    buildOrderBy: typeof buildOrderBy;\r\n    buildDistinct: typeof buildDistinct;\r\n}\r\nlet fns: Fns;\r\nexport function initialize(init: Fns) {\r\n    fns = init;\r\n}\r\n\r\nexport abstract class DataSourceBase<T> implements _ISelection<T> {\r\n    abstract enumerate(t: _Transaction): Iterable<T>;\r\n    abstract entropy(t: _Transaction): number;\r\n    abstract readonly columns: ReadonlyArray<IValue<any>>;\r\n    abstract getColumn(column: string, nullIfNotFound?: boolean): IValue<any>;\r\n    abstract hasItem(value: T, t: _Transaction): boolean;\r\n    abstract getIndex(forValue: IValue): _IIndex<any> | null | undefined;\r\n    abstract explain(e: _Explainer): _SelectExplanation;\r\n    abstract isOriginOf(a: IValue<any>): boolean;\r\n    abstract stats(t: _Transaction): Stats | null;\r\n    abstract get isExecutionWithNoResult(): boolean\r\n    isAggregation(): boolean {\r\n        return false;\r\n    }\r\n    // abstract get name(): string;\r\n\r\n\r\n    get db() {\r\n        return this.ownerSchema.db;\r\n    }\r\n\r\n    constructor(readonly ownerSchema: _ISchema) {\r\n    }\r\n\r\n    listColumns(): Iterable<IValue> {\r\n        return this.columns;\r\n    }\r\n\r\n    listSelectableIdentities(): Iterable<IValue> {\r\n        return this.columns;\r\n    }\r\n\r\n    select(select: (string | SelectedColumn)[] | nil): _ISelection<any> {\r\n        let sel: SelectedColumn[] | nil;\r\n        if (select?.some(v => typeof v === 'string')) {\r\n            sel = select.map<SelectedColumn>(v => typeof v !== 'string'\r\n                ? v\r\n                : {\r\n                    expr: { type: 'ref', name: v },\r\n                })\r\n        } else {\r\n            sel = select as SelectedColumn[] | nil;\r\n        }\r\n        return fns.buildSelection(this, sel);\r\n    }\r\n\r\n\r\n    selectAlias(alias: string): _IAlias | nil {\r\n        return null;\r\n    }\r\n\r\n\r\n    filter(filter: Expr | undefined | null): _ISelection {\r\n        if (!filter) {\r\n            return this;\r\n        }\r\n        const plan = fns.buildFilter(this, filter, 'WHERE');\r\n        return plan;\r\n    }\r\n\r\n    groupBy(grouping: Expr[] | nil): _ISelection {\r\n        if (!grouping?.length) {\r\n            return this;\r\n        }\r\n        const plan = fns.buildGroupBy(this, grouping);\r\n        return plan;\r\n    }\r\n\r\n\r\n    setAlias(alias?: string): _ISelection<any> {\r\n        return fns.buildAlias(this, alias);\r\n    }\r\n\r\n    limit(limit: LimitStatement): _ISelection {\r\n        if (!limit?.limit && !limit?.offset) {\r\n            return this;\r\n        }\r\n        return fns.buildLimit(this, limit)\r\n    }\r\n\r\n    orderBy(orderBy: OrderByStatement[] | nil): _ISelection<any> {\r\n        if (!orderBy?.length) {\r\n            return this;\r\n        }\r\n        return fns.buildOrderBy(this, orderBy);\r\n    }\r\n\r\n    distinct(exprs?: Expr[]): _ISelection<any> {\r\n        return fns.buildDistinct(this, exprs);\r\n    }\r\n\r\n    union(right: _ISelection<any>): _ISelection<any> {\r\n        return fns.buildUnion(this, right);\r\n    }\r\n\r\n}\r\n\r\n\r\nexport abstract class TransformBase<T> extends DataSourceBase<T> {\r\n\r\n\r\n    constructor(readonly base: _ISelection) {\r\n        super(base.ownerSchema);\r\n    }\r\n\r\n    get isExecutionWithNoResult(): boolean {\r\n        return false;\r\n    }\r\n\r\n    entropy(t: _Transaction): number {\r\n        return this.base.entropy(t);\r\n    }\r\n\r\n    isOriginOf(a: IValue<any>): boolean {\r\n        return a.origin === this || this.base?.isOriginOf(a);\r\n    }\r\n}\r\n\r\nexport abstract class FilterBase<T> extends TransformBase<T> {\r\n\r\n    isAggregation(): boolean {\r\n        return false;\r\n    }\r\n\r\n    constructor(_base: _ISelection<T>) {\r\n        super(_base);\r\n    }\r\n\r\n    get columns(): ReadonlyArray<IValue<any>> {\r\n        return this.base.columns;\r\n    }\r\n\r\n    selectAlias(alias: string): nil | _IAlias {\r\n        // this is a filter... that the alias returned by the unfiltered datasource will\r\n        // be valid for the filtered datasource (aliases are only listing columns)\r\n        return this.base.selectAlias(alias);\r\n    }\r\n\r\n    /**\r\n    private _columns: IValue[];\r\n    private _columnMappings: Map<IValue, IValue>;\r\n    get columns(): ReadonlyArray<IValue<any>> {\r\n        this.initCols();\r\n        return this._columns;\r\n        // return this.base.columns;\r\n    }\r\n\r\n    private initCols() {\r\n        if (this._columns) {\r\n            return;\r\n        }\r\n        this._columns = [];\r\n        this._columnMappings = new Map();\r\n        for (const c of this.base.columns) {\r\n            const nc = c.setOrigin(this);\r\n            this._columns.push(nc);\r\n            this._columnMappings.set(c, nc);\r\n        }\r\n    }\r\n\r\n    getColumn(column: string, nullIfNotFound?: boolean): IValue<any> {\r\n        if (!this.base) { // istanbul ignore next\r\n            throw new Error('Should not call .getColumn() on join');\r\n        }\r\n        if (!('columns' in this.base)) { // istanbul ignore next\r\n            throw new Error('Should not call getColumn() on table');\r\n        }\r\n        this.initCols();\r\n        const col = this.base.getColumn(column, nullIfNotFound);\r\n        return col && this._columnMappings.get(col);\r\n    }\r\n     */\r\n\r\n    getColumn(column: string | ExprRef): IValue;\r\n    getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue | nil;\r\n    getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue<any> | nil {\r\n        if (!this.base) { // istanbul ignore next\r\n            throw new Error('Should not call .getColumn() on join');\r\n        }\r\n        if (!('columns' in this.base)) { // istanbul ignore next\r\n            throw new Error('Should not call getColumn() on table');\r\n        }\r\n        return this.base.getColumn(column, nullIfNotFound);\r\n    }\r\n\r\n    getIndex(...forValue: IValue<any>[]): _IIndex<any> | null | undefined {\r\n        const index = this.base.getIndex(...forValue);\r\n        if (!index) {\r\n            return null;\r\n        }\r\n        return new RestrictiveIndex(index, this);\r\n    }\r\n}\r\n","import { _ISelection, IValue, _IType, _ISchema, _IAlias } from '../interfaces-private';\r\nimport { buildLikeMatcher, nullIsh, hasNullish, intervalToSec, parseTime, asSingleQName, colToStr } from '../utils';\r\nimport { DataType, CastError, QueryError, NotSupported, nil, ColumnNotFound } from '../interfaces';\r\nimport hash from 'object-hash';\r\nimport { Value, Evaluator } from '../evaluator';\r\nimport { Types, isNumeric, reconciliateTypes, ArrayType, RecordCol } from '../datatypes';\r\nimport { Expr, ExprBinary, UnaryOperator, ExprCase, ExprWhen, ExprMember, ExprArrayIndex, ExprTernary, BinaryOperator, SelectStatement, ExprValueKeyword, ExprExtract, Interval, ExprOverlay, ExprSubstring, ExprCall } from 'pgsql-ast-parser';\r\nimport lru from 'lru-cache';\r\nimport { aggregationFunctions, getAggregator } from '../transforms/aggregation';\r\nimport moment from 'moment';\r\nimport { IS_PARTIAL_INDEXING } from '../execution/clean-results';\r\nimport { buildCtx } from './context';\r\nimport { buildSelect } from '../execution/select';\r\n\r\n\r\nconst builtLru = new lru<_ISelection | null, lru<Expr, IValue>>({\r\n    max: 30,\r\n});\r\nexport function buildValue(val: Expr): IValue {\r\n    const ret = _buildValue(val);\r\n    checkNotUntypedArray(ret);\r\n    return ret;\r\n}\r\n\r\n\r\nfunction checkNotUntypedArray(value: IValue) {\r\n    // A bit ugly: check that this is not a non typed array (empty array)\r\n    // see https://github.com/oguimbal/pg-mem/issues/64\r\n    // + corresponding UTs\r\n    const type = value.type;\r\n    if (type instanceof ArrayType && type.of == Types.null) {\r\n        throw new QueryError(`cannot determine type of empty array`);\r\n    }\r\n}\r\n\r\nexport function uncache(data: _ISelection) {\r\n    builtLru.del(data);\r\n}\r\n\r\nfunction _buildValue(val: Expr): IValue {\r\n    // cache expressions build (they almost are always rebuilt several times in a row)\r\n    const data = buildCtx().selection;\r\n    let selLru = builtLru.get(data ?? null);\r\n    let got: IValue | nil;\r\n    if (selLru) {\r\n        got = selLru.get(val);\r\n        if (got) {\r\n            return got;\r\n        }\r\n    }\r\n    got = _buildValueReal(val);\r\n    if (data.isAggregation()) {\r\n        got = data.checkIfIsKey(got);\r\n    }\r\n    if (!selLru) {\r\n        builtLru.set(data ?? null, selLru = new lru({\r\n            max: 50,\r\n        }));\r\n    }\r\n    selLru.set(val, got);\r\n    return got;\r\n}\r\n\r\nfunction _buildValueReal(val: Expr): IValue {\r\n    const { schema, getParameter, selection } = buildCtx();\r\n    switch (val.type) {\r\n        case 'binary':\r\n            if (val.op === 'IN' || val.op === 'NOT IN') {\r\n                return buildIn(val.left, val.right, val.op === 'IN');\r\n            }\r\n            return buildBinary(val);\r\n        case 'unary':\r\n            return buildUnary(val.op, val.operand);\r\n        case 'ref':\r\n            // try to get a column reference\r\n            // todo refactor getColumn() to NameResolvers\r\n            const found = selection.getColumn(val, true);\r\n            if (found) {\r\n                return found;\r\n            }\r\n            // try to get a parameter reference\r\n            const arg = !val.table && getParameter(val.name);\r\n            if (arg) {\r\n                return arg;\r\n            }\r\n            // try to select an aliased record (= a table)\r\n            const alias = !val.table && selection.selectAlias(val.name);\r\n            if (alias) {\r\n                return buildRecord(alias);\r\n            }\r\n            throw new ColumnNotFound(colToStr(val));\r\n        case 'string':\r\n            return Value.text(val.value);\r\n        case 'null':\r\n            return Value.null();\r\n        case 'list':\r\n        case 'array':\r\n            const vals = val.expressions.map(x => _buildValue(x));\r\n            return val.type === 'list'\r\n                ? Value.list(vals)\r\n                : Value.array(vals);\r\n        case 'numeric':\r\n            return Value.number(val.value);\r\n        case 'integer':\r\n            return Value.number(val.value, Types.integer);\r\n        case 'call':\r\n            return _buildCall(val);\r\n        case 'cast':\r\n            return _buildValue(val.operand)\r\n                .cast(schema.getType(val.to))\r\n        case 'case':\r\n            return buildCase(val);\r\n        case 'member':\r\n            return buildMember(val);\r\n        case 'arrayIndex':\r\n            return buildArrayIndex(val);\r\n        case 'boolean':\r\n            return Value.bool(val.value);\r\n        case 'ternary':\r\n            return buildTernary(val);\r\n        case 'select':\r\n        case 'union':\r\n        case 'union all':\r\n        case 'with':\r\n        case 'with recursive':\r\n        case 'values':\r\n            return buildSelectAsArray(val);\r\n        case 'array select':\r\n            return buildSelectAsArray(val.select);\r\n        case 'constant':\r\n            return Value.constant(val.dataType as any, val.value);\r\n        case 'keyword':\r\n            return buildKeyword(val, []);\r\n        case 'parameter':\r\n            const [_, n] = /^\\$(\\d+)$/.exec(val.name) ?? [];\r\n            if (!n) {\r\n                throw new Error('Unexpected parameter ref shape: ' + val.name);\r\n            }\r\n            return getParameter(parseInt(n) - 1)!;\r\n        case 'extract':\r\n            return buildExtract(val);\r\n        case 'overlay':\r\n            return buildOverlay(val);\r\n        case 'substring':\r\n            return buildSubstring(val);\r\n        case 'default':\r\n            throw new QueryError(`DEFAULT is not allowed in this context`, '42601');\r\n        default:\r\n            throw NotSupported.never(val);\r\n    }\r\n}\r\n\r\nfunction buildRecord(alias: _IAlias): IValue {\r\n    const cols = [...alias.listColumns()];\r\n    return new Evaluator(\r\n        Types.record(cols\r\n            .map<RecordCol>(x => ({\r\n                name: x.id!,\r\n                type: x.type,\r\n            })))\r\n        , null\r\n        , Math.random().toString() // must not be indexable => always different hash\r\n        , []\r\n        , (raw, t) => raw, { forceNotConstant: true });\r\n}\r\n\r\nfunction _buildCall(val: ExprCall): IValue {\r\n    // if (typeof val.function !== 'string') {\r\n    //     return buildKeyword( val.function, val.args);\r\n    // }\r\n    if (val.over) {\r\n        throw new NotSupported('\"OVER\" clause is not implemented in pg-mem yet');\r\n    }\r\n    const nm = asSingleQName(val.function, 'pg_catalog');\r\n    if (nm && aggregationFunctions.has(nm)) {\r\n        const agg = getAggregator();\r\n        if (!agg) {\r\n            throw new QueryError(`aggregate functions are not allowed in WHERE`);\r\n        }\r\n        return agg.getAggregation(nm, val);\r\n    }\r\n    const args = val.args.map(x => _buildValue(x));\r\n    return Value.function(val.function, args);\r\n}\r\n\r\nfunction buildKeyword(kw: ExprValueKeyword, args: Expr[]): IValue {\r\n    if (args.length) {\r\n        throw new NotSupported(`usage of \"${kw.keyword}\" keyword with arguments, please file an issue in https://github.com/oguimbal/pg-mem if you need it !`);\r\n    }\r\n    if (kw.type !== 'keyword') {\r\n        throw new Error('Invalid AST');\r\n    }\r\n    switch (kw.keyword) {\r\n        case 'current_catalog':\r\n        case 'current_role':\r\n        case 'current_user':\r\n        case 'session_user':\r\n        case 'user':\r\n            return Value.constant(Types.text(), 'pg_mem');\r\n        case 'current_schema':\r\n            return Value.constant(Types.text(), 'public');\r\n        case 'current_date':\r\n            return Value.constant(Types.date, new Date());\r\n        case 'current_timestamp':\r\n        case 'localtimestamp':\r\n            return Value.constant(Types.timestamp(), new Date());\r\n        case 'localtime':\r\n        case 'current_time':\r\n            throw new NotSupported('\"date\" data type, please file an issue in https://github.com/oguimbal/pg-mem if you need it !');\r\n        case 'distinct':\r\n            throw new NotSupported(kw.keyword);\r\n        default:\r\n            throw NotSupported.never(kw.keyword);\r\n    }\r\n}\r\n\r\nfunction buildUnary(op: UnaryOperator, operand: Expr) {\r\n    const expr = _buildValue(operand);\r\n\r\n    switch (op) {\r\n        case 'IS NULL':\r\n        case 'IS NOT NULL':\r\n            return Value.isNull(expr, op === 'IS NULL');\r\n        case 'IS TRUE':\r\n        case 'IS NOT TRUE':\r\n            return Value.isTrue(expr, op === 'IS TRUE');\r\n        case 'IS FALSE':\r\n        case 'IS NOT FALSE':\r\n            return Value.isFalse(expr, op === 'IS FALSE');\r\n        case '+':\r\n            if (!isNumeric(expr.type)) {\r\n                throw new CastError(expr.type.primary, DataType.float);\r\n            }\r\n            return expr;\r\n        case 'NOT':\r\n        case '-':\r\n            return Value.negate(expr);\r\n        default:\r\n            throw NotSupported.never(op, 'Unary operator not supported');\r\n    }\r\n}\r\n\r\nfunction buildIn(left: Expr, array: Expr, inclusive: boolean): IValue {\r\n    let leftValue = _buildValue(left);\r\n    let rightValue = _buildValue(array);\r\n    return Value.in(leftValue, rightValue, inclusive);\r\n}\r\n\r\n\r\nfunction buildBinary(val: ExprBinary): IValue {\r\n    let leftValue = _buildValue(val.left);\r\n    let rightValue = _buildValue(val.right);\r\n    return buildBinaryValue(leftValue, val.op, rightValue);\r\n}\r\n\r\nexport function buildBinaryValue(leftValue: IValue, op: BinaryOperator, rightValue: IValue): IValue {\r\n    function expectSame() {\r\n        const ll = leftValue.type.primary === DataType.list;\r\n        const rl = rightValue.type.primary === DataType.list;\r\n        if (ll !== rl) {\r\n            function doMap(v: IValue): IValue {\r\n                return v.map(x => {\r\n                    if (!x) {\r\n                        return x;\r\n                    }\r\n                    if (!Array.isArray(x)) {\r\n                        // not supposed to happen\r\n                        throw new Error(`Was expecting an array. Got instead ${x}`);\r\n                    }\r\n                    if (x.length > 1) {\r\n                        throw new QueryError('more than one row returned by a subquery used as an expression', '21000');\r\n                    }\r\n                    return x[0];\r\n                }, (v.type as ArrayType).of);\r\n            }\r\n            if (ll) {\r\n                leftValue = doMap(leftValue);\r\n            } else {\r\n                rightValue = doMap(rightValue);\r\n            }\r\n        }\r\n        const type: _IType = reconciliateTypes([leftValue, rightValue]);\r\n        leftValue = leftValue.cast(type);\r\n        rightValue = rightValue.cast(type);\r\n        return type;\r\n    }\r\n    function expectBoth(t: _IType) {\r\n        leftValue = leftValue.cast(t);\r\n        rightValue = rightValue.cast(t);\r\n    }\r\n\r\n    let getter: (a: any, b: any) => any;\r\n    let returnType: _IType = Types.bool;\r\n    let commutative = true;\r\n    let forcehash: any = null;\r\n    let rejectNils = true;\r\n    let impure = false;\r\n    switch (op) {\r\n        case '=': {\r\n            const type = expectSame();\r\n            getter = (a, b) => type.equals(a, b);\r\n            break;\r\n        }\r\n        case '!=': {\r\n            const type = expectSame();\r\n            getter = (a, b) => {\r\n                const ret = type.equals(a, b);\r\n                return nullIsh(ret) ? null : !ret;\r\n            };\r\n            break;\r\n        }\r\n        case '>': {\r\n            const type = expectSame();\r\n            getter = (a, b) => type.gt(a, b);\r\n            forcehash = { op: '>', left: leftValue.hash, right: rightValue.hash };\r\n            break;\r\n        }\r\n        case '<': {\r\n            const type = expectSame();\r\n            getter = (a, b) => type.lt(a, b);\r\n            forcehash = { op: '>', left: rightValue.hash, right: leftValue.hash };\r\n            break;\r\n        }\r\n        case '>=': {\r\n            const type = expectSame();\r\n            getter = (a, b) => type.ge(a, b);\r\n            forcehash = { op: '>=', left: leftValue.hash, right: rightValue.hash };\r\n            break;\r\n        }\r\n        case '<=': {\r\n            const type = expectSame();\r\n            getter = (a, b) => type.le(a, b);\r\n            forcehash = { op: '>=', left: rightValue.hash, right: leftValue.hash };\r\n            break;\r\n        }\r\n        case 'AND':\r\n        case 'OR':\r\n            expectBoth(Types.bool);\r\n            rejectNils = false;\r\n            if (op === 'AND') {\r\n                getter = (a, b) => a && b;\r\n            } else {\r\n                getter = (a, b) => a || b;\r\n            }\r\n            break;\r\n        case '&&':\r\n            if (leftValue.type.primary !== DataType.array || !rightValue.canCast(leftValue.type)) {\r\n                throw new QueryError(`Operator does not exist: ${leftValue.type.name} && ${rightValue.type.name}`, '42883');\r\n            }\r\n            rightValue = rightValue.cast(leftValue.type);\r\n            getter = (a, b) => a.some((element: any) => b.includes(element));\r\n            break;\r\n        case 'LIKE':\r\n        case 'ILIKE':\r\n        case 'NOT LIKE':\r\n        case 'NOT ILIKE':\r\n            expectBoth(Types.text());\r\n            const caseSenit = op === 'LIKE' || op === 'NOT LIKE';\r\n            const not = op === 'NOT ILIKE' || op === 'NOT LIKE';\r\n            if (rightValue.isConstant) {\r\n                const pattern = rightValue.get();\r\n                if (nullIsh(pattern)) {\r\n                    return Value.null(Types.bool);\r\n                }\r\n                let matcher: (str: string | number) => boolean | nil;\r\n                if (rightValue.isAny) {\r\n                    // handle LIKE ANY()\r\n                    if (!Array.isArray(pattern)) {\r\n                        throw new QueryError('Unsupported use of ANY()');\r\n                    }\r\n                    const patterns = pattern.map(x => buildLikeMatcher(x, caseSenit));\r\n                    matcher = v => patterns.some(x => x(v));\r\n                } else {\r\n                    matcher = buildLikeMatcher(pattern, caseSenit);\r\n                }\r\n                getter = !not\r\n                    ? a => nullIsh(a) ? null : matcher(a)\r\n                    : a => {\r\n                        if (nullIsh(a)) {\r\n                            return null;\r\n                        }\r\n                        const val = matcher(a);\r\n                        return nullIsh(val) ? null : !val;\r\n                    };\r\n            } else {\r\n                getter = !not\r\n                    ? (a, b) => hasNullish(a, b) ? null : buildLikeMatcher(b, caseSenit)(a)\r\n                    : (a, b) => {\r\n                        if (hasNullish(a, b)) {\r\n                            return null;\r\n                        }\r\n                        const val = buildLikeMatcher(b, caseSenit)(a);\r\n                        return nullIsh(val) ? null : !val;\r\n                    };\r\n            }\r\n            break;\r\n        default: {\r\n            const { schema } = buildCtx();\r\n            const resolved = schema.resolveOperator(op, leftValue, rightValue);\r\n            if (!resolved) {\r\n                throw new QueryError(`operator does not exist: ${leftValue.type.name} ${op} ${rightValue.type.name}`, '42883');\r\n            }\r\n            leftValue = leftValue.cast(resolved.left);\r\n            rightValue = rightValue.cast(resolved.right);\r\n            commutative = resolved.commutative;\r\n            returnType = resolved.returns;\r\n            getter = resolved.implementation;\r\n            rejectNils = !resolved.allowNullArguments;\r\n            impure = !!resolved.impure;\r\n            break;\r\n        }\r\n    }\r\n\r\n    const hashed = hash(forcehash\r\n        ?? (commutative\r\n            ? { op, vals: [leftValue.hash, rightValue.hash].sort() }\r\n            : { left: leftValue.hash, op, right: rightValue.hash }));\r\n\r\n    // handle cases like:  blah = ANY(stuff)\r\n    if (leftValue.isAny || rightValue.isAny) {\r\n        return buildBinaryAny(leftValue, op, rightValue, returnType, getter, hashed);\r\n    }\r\n\r\n    return new Evaluator(\r\n        returnType\r\n        , null\r\n        , hashed\r\n        , [leftValue, rightValue]\r\n        , (raw, t) => {\r\n            const leftRaw = leftValue.get(raw, t);\r\n            const rightRaw = rightValue.get(raw, t);\r\n            if (rejectNils && (nullIsh(leftRaw) || nullIsh(rightRaw))) {\r\n                return null;\r\n            }\r\n            return getter(leftRaw, rightRaw);\r\n        }, impure ? { unpure: impure } : undefined);\r\n\r\n}\r\n\r\nfunction buildBinaryAny(leftValue: IValue, op: BinaryOperator, rightValue: IValue, returnType: _IType, getter: (a: any, b: any) => boolean, hashed: string) {\r\n    if (leftValue.isAny && rightValue.isAny) {\r\n        throw new QueryError('ANY() cannot be compared to ANY()');\r\n    }\r\n    if (returnType !== Types.bool) {\r\n        throw new QueryError('Invalid ANY() usage');\r\n    }\r\n    return new Evaluator(\r\n        returnType\r\n        , null\r\n        , hashed\r\n        , [leftValue, rightValue]\r\n        , leftValue.isAny\r\n            ? (raw, t) => {\r\n                const leftRaw = leftValue.get(raw, t);\r\n                if (nullIsh(leftRaw)) {\r\n                    return null;\r\n                }\r\n                if (!Array.isArray(leftRaw)) {\r\n                    throw new QueryError('Invalid ANY() usage: was expacting an array');\r\n                }\r\n                for (const lr of leftRaw) {\r\n                    const rightRaw = rightValue.get(raw, t);\r\n                    if (getter(lr, rightRaw)) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            }\r\n            : (raw, t) => {\r\n                const rightRaw = rightValue.get(raw, t);\r\n                if (nullIsh(rightRaw)) {\r\n                    return null;\r\n                }\r\n                if (!Array.isArray(rightRaw)) {\r\n                    throw new QueryError('Invalid ANY() usage: was expacting an array');\r\n                }\r\n                for (const rr of rightRaw) {\r\n                    const leftRaw = leftValue.get(raw, t);\r\n                    if (getter(leftRaw, rr)) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            });\r\n}\r\n\r\n\r\nfunction buildCase(op: ExprCase): IValue {\r\n    const whens = !op.value\r\n        ? op.whens\r\n        : op.whens.map<ExprWhen>(v => ({\r\n            when: {\r\n                type: 'binary',\r\n                op: '=',\r\n                left: op.value!,\r\n                right: v.when,\r\n            },\r\n            value: v.value,\r\n        }));\r\n    if (op.else) {\r\n        whens.push({\r\n            when: { type: 'boolean', value: true },\r\n            value: op.else,\r\n        });\r\n    }\r\n\r\n    const whenExprs = whens.map(x => ({\r\n        when: buildValue(x.when).cast(Types.bool),\r\n        then: buildValue(x.value)\r\n    }));\r\n\r\n    const valueType = reconciliateTypes(whenExprs.map(x => x.then));\r\n    for (const v of whenExprs) {\r\n        v.then = v.then.cast(valueType);\r\n    }\r\n\r\n    return new Evaluator(\r\n        valueType\r\n        , null\r\n        , hash({ when: whenExprs.map(x => ({ when: x.when.hash, then: x.then.hash })) })\r\n        , [\r\n            ...whenExprs.map(x => x.when),\r\n            ...whenExprs.map(x => x.then)\r\n        ]\r\n        , (raw, t) => {\r\n            for (const w of whenExprs) {\r\n                const cond = w.when.get(raw, t);\r\n                if (cond) {\r\n                    return w.then.get(raw, t);\r\n                }\r\n            }\r\n            return null;\r\n        });\r\n}\r\n\r\nfunction buildMember(op: ExprMember): IValue {\r\n    const oop = op.op;\r\n    if (oop !== '->>' && oop !== '->') {\r\n        throw NotSupported.never(oop);\r\n    }\r\n    const onExpr = buildValue(op.operand);\r\n    if (onExpr.type !== Types.json && onExpr.type !== Types.jsonb) {\r\n        throw new QueryError(`Cannot use member expression ${op.op} on type ${onExpr.type.primary}`);\r\n    }\r\n\r\n    const conv = op.op === '->'\r\n        ? ((x: any) => x)\r\n        : ((x: any) => {\r\n            if (nullIsh(x)) {\r\n                return null;\r\n            }\r\n            if (typeof x === 'string') {\r\n                return x;\r\n            }\r\n            return JSON.stringify(x);\r\n        });\r\n\r\n    return new Evaluator(\r\n        op.op === '->' ? onExpr.type : Types.text()\r\n        , null\r\n        , hash([onExpr.hash, op.op, op.member])\r\n        , onExpr\r\n        , typeof op.member === 'string'\r\n            ? (raw, t) => {\r\n                const value = onExpr.get(raw, t);\r\n                if (!value || typeof value !== 'object') {\r\n                    return null;\r\n                }\r\n                return conv(value[op.member]);\r\n            }\r\n            : (raw, t) => {\r\n                const value = onExpr.get(raw, t);\r\n                if (!Array.isArray(value)) {\r\n                    return null;\r\n                }\r\n                const i = op.member < 0\r\n                    ? value.length + (op.member as number)\r\n                    : op.member as number;\r\n                return conv(value[i]);\r\n            });\r\n}\r\n\r\n\r\nfunction buildArrayIndex(op: ExprArrayIndex): IValue {\r\n    const onExpr = _buildValue(op.array);\r\n    if (onExpr.type.primary !== DataType.array) {\r\n        throw new QueryError(`Cannot use [] expression on type ${onExpr.type.primary}`);\r\n    }\r\n    const index = _buildValue(op.index).cast(Types.integer);\r\n    return new Evaluator(\r\n        (onExpr.type as ArrayType).of\r\n        , null\r\n        , hash({ array: onExpr.hash, index: index.hash })\r\n        , [onExpr, index]\r\n        , (raw, t) => {\r\n            const value = onExpr.get(raw, t);\r\n            if (!Array.isArray(value)) {\r\n                return null;\r\n            }\r\n            const i = index.get(raw, t);\r\n            if (typeof i !== 'number' || i <= 0 || i > value.length) {\r\n                return null;\r\n            }\r\n            const ret = value[i - 1]; // 1-base !\r\n\r\n            if (Array.isArray(ret)) {\r\n                // ugly hack.. see clean-results.ts\r\n                (ret as any)[IS_PARTIAL_INDEXING] = true;\r\n            }\r\n            return ret;\r\n        });\r\n}\r\n\r\n\r\nfunction buildTernary(op: ExprTernary): IValue {\r\n    const oop = op.op;\r\n    if (oop !== 'NOT BETWEEN' && oop !== 'BETWEEN') {\r\n        throw NotSupported.never(oop);\r\n    }\r\n    let value = _buildValue(op.value);\r\n    let hi = _buildValue(op.hi);\r\n    let lo = _buildValue(op.lo);\r\n    const type = reconciliateTypes([value, hi, lo]);\r\n    value = value.cast(type);\r\n    hi = hi.cast(type);\r\n    lo = lo.cast(type);\r\n    const conv = oop === 'NOT BETWEEN'\r\n        ? (x: boolean) => !x\r\n        : (x: boolean) => x;\r\n\r\n    return new Evaluator(\r\n        Types.bool\r\n        , null\r\n        , hash({ value: value.hash, lo: lo.hash, hi: hi.hash })\r\n        , [value, hi, lo]\r\n        , (raw, t) => {\r\n            const v = value.get(raw, t);\r\n            if (nullIsh(v)) {\r\n                return null;\r\n            }\r\n            const lov = lo.get(raw, t);\r\n            if (!nullIsh(lov) && type.lt(v, lov)) {\r\n                return conv(false);\r\n            }\r\n            const hiv = hi.get(raw, t);\r\n            if (!nullIsh(hiv) && type.gt(v, hiv)) {\r\n                return conv(false);\r\n            }\r\n            if (nullIsh(lov) || nullIsh(hiv)) {\r\n                return null;\r\n            }\r\n            return conv(true);\r\n        }\r\n    );\r\n}\r\n\r\n\r\nfunction buildSelectAsArray(op: SelectStatement): IValue {\r\n    // todo: handle refs to 'data' in op statement.\r\n    //  ... and refactor this. This is way too hacky to be maintainable\r\n    //   (this wont allow the subrequest to access outer context, for instance)\r\n    const onData = buildSelect(op);\r\n    if (onData.columns.length !== 1) {\r\n        throw new QueryError('subquery must return only one column', '42601');\r\n    }\r\n    return new Evaluator(\r\n        onData.columns[0].type.asList()\r\n        , null\r\n        , Math.random().toString() // must not be indexable => always different hash\r\n        , null // , onData.columns[0]\r\n        , (raw, t) => {\r\n            const ret = [];\r\n            for (const v of onData.enumerate(t!)) {\r\n                ret.push(onData.columns[0].get(v, t));\r\n            }\r\n            return ret;\r\n        }, {\r\n        forceNotConstant: true\r\n    });\r\n}\r\n\r\n\r\nfunction buildExtract(op: ExprExtract): IValue {\r\n    const from = _buildValue(op.from);\r\n    function extract(as: _IType, fn: (v: any) => any, result = Types.integer) {\r\n        const conv = from.cast(as);\r\n        return new Evaluator(\r\n            result\r\n            , null\r\n            , hash({ extract: from.hash, field: op.field })\r\n            , [conv]\r\n            , (raw, t) => {\r\n                const got = conv.get(raw, t);\r\n                if (nullIsh(got)) {\r\n                    return null;\r\n                }\r\n                return fn(got);\r\n            }\r\n        )\r\n    }\r\n    switch (op.field.name) {\r\n        case 'millennium':\r\n            return extract(Types.date, x => Math.ceil(moment.utc(x).year() / 1000));\r\n        case 'century':\r\n            return extract(Types.date, x => Math.ceil(moment.utc(x).year() / 100));\r\n        case 'decade':\r\n            return extract(Types.date, x => Math.floor(moment.utc(x).year() / 10));\r\n        case 'day':\r\n            if (from.canCast(Types.date)) {\r\n                return extract(Types.date, x => moment.utc(x).date());\r\n            }\r\n            return extract(Types.interval, (x: Interval) => x.days ?? 0);\r\n        case 'second':\r\n            if (from.canCast(Types.time)) {\r\n                return extract(Types.time, x => {\r\n                    const t = parseTime(x);\r\n                    return t.second() + t.milliseconds() / 1000;\r\n                }, Types.float);\r\n            }\r\n            return extract(Types.interval, (x: Interval) => (x.seconds ?? 0) + (x.milliseconds ?? 0) / 1000, Types.float);\r\n        case 'minute':\r\n            if (from.canCast(Types.time)) {\r\n                return extract(Types.time, x => parseTime(x).minute());\r\n            }\r\n            return extract(Types.interval, (x: Interval) => x.minutes ?? 0);\r\n        case 'milliseconds':\r\n            if (from.canCast(Types.time)) {\r\n                return extract(Types.time, x => {\r\n                    const t = parseTime(x);\r\n                    return t.seconds() * 1000 + t.milliseconds();\r\n                });\r\n            }\r\n            return extract(Types.interval, (x: Interval) => (x.seconds ?? 0) * 1000 + (x.milliseconds ?? 0), Types.float);\r\n        case 'month':\r\n            if (from.canCast(Types.date)) {\r\n                return extract(Types.date, x => moment.utc(x).month() + 1);\r\n            }\r\n            return extract(Types.interval, (x: Interval) => x.months ?? 0);\r\n        case 'year':\r\n            if (from.canCast(Types.date)) {\r\n                return extract(Types.date, x => moment.utc(x).year());\r\n            }\r\n            return extract(Types.interval, (x: Interval) => x.years ?? 0);\r\n        case 'dow':\r\n            return extract(Types.date, x => moment.utc(x).day());\r\n        case 'isodow':\r\n            return extract(Types.date, x => {\r\n                const dow = moment.utc(x).day();\r\n                return dow ? dow : 7;\r\n            });\r\n        case 'doy':\r\n            return extract(Types.date, x => moment.utc(x).dayOfYear());\r\n        case 'epoch':\r\n            if (from.canCast(Types.timestamp())) {\r\n                return extract(Types.timestamp(), x => moment.utc(x).unix(), Types.float);\r\n            }\r\n            return extract(Types.interval, (x: Interval) => intervalToSec(x));\r\n        case 'hour':\r\n            if (from.canCast(Types.timestamp())) {\r\n                return extract(Types.timestamp(), x => moment.utc(x).hour());\r\n            }\r\n            return extract(Types.interval, (x: Interval) => x.hours ?? 0);\r\n        case 'isoyear':\r\n            return extract(Types.date, x => {\r\n                const d = moment.utc(x);\r\n                return d.dayOfYear() <= 1 ? d.year() - 1 : d.year();\r\n            });\r\n        case 'quarter':\r\n            return extract(Types.date, x => moment.utc(x).quarter());\r\n        case 'week':\r\n            return extract(Types.date, x => moment.utc(x).week());\r\n        case 'microseconds':\r\n            if (from.canCast(Types.time)) {\r\n                return extract(Types.time, x => {\r\n                    const t = parseTime(x);\r\n                    return t.seconds() * 1000000 + t.milliseconds() * 1000;\r\n                });\r\n            }\r\n            return extract(Types.interval, (x: Interval) => (x.seconds ?? 0) * 1000000 + (x.milliseconds ?? 0) * 1000);\r\n        default:\r\n            throw new NotSupported('Extract type \"' + op.field + '\"');\r\n    }\r\n}\r\n\r\n\r\nfunction buildOverlay(op: ExprOverlay): IValue {\r\n    const value = _buildValue(op.value).cast(Types.text());\r\n    const placing = _buildValue(op.placing).cast(Types.text());\r\n    const from = _buildValue(op.from).cast(Types.integer);\r\n    const forr = op.for && _buildValue(op.for).cast(Types.integer);\r\n\r\n    return new Evaluator(\r\n        Types.text()\r\n        , null\r\n        , hash({ overlay: value.hash, placing: placing.hash, from: from.hash, for: forr?.hash })\r\n        , forr ? [value, placing, from, forr] : [value, placing, from]\r\n        , (raw, t) => {\r\n            const _value = value.get(raw, t) as string;\r\n            if (nullIsh(_value)) {\r\n                return null;\r\n            }\r\n            const _placing = placing.get(raw, t) as string;\r\n            if (nullIsh(_placing)) {\r\n                return null;\r\n            }\r\n            const _from = from.get(raw, t) as number;\r\n            if (nullIsh(_from)) {\r\n                return null;\r\n            }\r\n            const before = sqlSubstring(_value, 0, _from - 1);\r\n            let after: string | nil;\r\n            if (forr) {\r\n                const _for = forr.get(raw, t) as number;\r\n                if (nullIsh(_for)) {\r\n                    return null;\r\n                }\r\n                after = sqlSubstring(_value, _from + _for);\r\n            } else {\r\n                after = sqlSubstring(_value, _placing.length + _from);\r\n            }\r\n            if (nullIsh(after)) {\r\n                return null;\r\n            }\r\n            return before + _placing + after;\r\n        });\r\n}\r\n\r\nfunction buildSubstring(op: ExprSubstring): IValue {\r\n    const value = _buildValue(op.value).cast(Types.text());\r\n    const vals = [value];\r\n    const from = op.from && _buildValue(op.from).cast(Types.integer);\r\n    const forr = op.for && _buildValue(op.for).cast(Types.integer);\r\n    if (forr) {\r\n        vals.push(forr);\r\n    }\r\n    if (from) {\r\n        vals.push(from);\r\n    }\r\n\r\n    return new Evaluator(\r\n        Types.text()\r\n        , null\r\n        , hash({ substr: value.hash, from: from?.hash, for: forr?.hash })\r\n        , vals\r\n        , (raw, t) => {\r\n            const _value = value.get(raw, t) as string;\r\n            if (nullIsh(_value)) {\r\n                return null;\r\n            }\r\n            let start = 0;\r\n            let len: number | nil;\r\n            if (from) {\r\n                start = from.get(raw, t) as number;\r\n                if (nullIsh(start)) {\r\n                    return null;\r\n                }\r\n            }\r\n            if (forr) {\r\n                len = forr.get(raw, t) as number;\r\n                if (nullIsh(len)) {\r\n                    return null;\r\n                }\r\n            }\r\n            return sqlSubstring(_value, start, len);\r\n        });\r\n}\r\n\r\nexport function sqlSubstring(value: string, from = 0, len?: number | nil): string | null {\r\n    if (nullIsh(from) || nullIsh(value)) {\r\n        return null;\r\n    }\r\n    // sql substring is base-1\r\n    from--;\r\n    if (from < 0) {\r\n        from = 0;\r\n    }\r\n    if (!nullIsh(len)) {\r\n        if (len! < 0) {\r\n            throw new QueryError('negative substring length not allowed');\r\n        }\r\n        return value.substr(from, len!);\r\n    }\r\n    return value.substr(from);\r\n}\r\n","import { QName, Statement, NodeLocation, toSql } from 'pgsql-ast-parser';\r\nimport { _ISchema, QueryError, _Transaction, _IDb } from '../interfaces-private';\r\n\r\nexport function checkExistence(schema: _ISchema, name: QName, ifNotExists: boolean | undefined, act: () => void): boolean {\r\n    // check if object exists\r\n    const exists = schema.getObject(name, {\r\n        skipSearch: true,\r\n        nullIfNotFound: true\r\n    });\r\n    if (exists) {\r\n        if (ifNotExists) {\r\n            return false;\r\n        }\r\n        throw new QueryError(`relation \"${name.name}\" already exists`);\r\n    }\r\n\r\n    // else, perform operation\r\n    act();\r\n    return true;\r\n}\r\n\r\n\r\n\r\nexport function locOf(p: Statement): NodeLocation {\r\n    return p._location ?? { start: 0, end: 0 };\r\n}\r\n\r\nexport abstract class ExecHelper {\r\n    constructor(private statement: Statement) {\r\n    }\r\n\r\n    protected noData(t: _Transaction, name?: string) {\r\n        return {\r\n            result: {\r\n                command: name ?? this.statement.type.toUpperCase(),\r\n                fields: [],\r\n                rowCount: 0,\r\n                rows: [],\r\n                location: locOf(this.statement),\r\n            },\r\n            state: t,\r\n        };\r\n    }\r\n}\r\n","import {\r\n  _ITable,\r\n  _ISelection,\r\n  _ISchema,\r\n  _Transaction,\r\n  _IIndex,\r\n  IValue,\r\n  NotSupported,\r\n  PermissionDeniedError,\r\n  _Column,\r\n  SchemaField,\r\n  IndexDef,\r\n  _Explainer,\r\n  _SelectExplanation,\r\n  _IType,\r\n  ChangeHandler,\r\n  Stats,\r\n  DropHandler,\r\n  IndexHandler,\r\n  RegClass,\r\n  RegType,\r\n  Reg,\r\n  _IConstraint,\r\n  TruncateHandler,\r\n} from \"../interfaces-private\";\r\nimport { CreateColumnDef, ExprRef, TableConstraint } from \"pgsql-ast-parser\";\r\nimport { DataSourceBase } from \"../transforms/transform-base\";\r\nimport { Schema, ColumnNotFound, nil, ISubscription } from \"../interfaces\";\r\nimport { buildAlias } from \"../transforms/alias\";\r\nimport { columnEvaluator } from \"../transforms/selection\";\r\nimport { colByName, findTemplate } from \"../utils\";\r\n\r\nexport abstract class ReadOnlyTable<T = any>\r\n  extends DataSourceBase<T>\r\n  implements _ITable, _ISelection\r\n{\r\n  get isExecutionWithNoResult(): boolean {\r\n    return false;\r\n  }\r\n\r\n  abstract entropy(t: _Transaction): number;\r\n  abstract enumerate(t: _Transaction): Iterable<T>;\r\n  abstract hasItem(value: T, t: _Transaction): boolean;\r\n  abstract readonly _schema: Schema;\r\n\r\n  reg!: Reg;\r\n\r\n  readonly selection: _ISelection = buildAlias(this);\r\n  readonly hidden = true;\r\n\r\n  isOriginOf(v: IValue): boolean {\r\n    return v.origin === this || v.origin === this.selection;\r\n  }\r\n\r\n  get type() {\r\n    return \"table\" as const;\r\n  }\r\n\r\n  constructor(private schema: _ISchema) {\r\n    super(schema);\r\n  }\r\n\r\n  get name(): string {\r\n    return this._schema.name;\r\n  }\r\n\r\n  register() {\r\n    this.reg = this.schema._reg_register(this as _ITable);\r\n  }\r\n\r\n  private columnsById = new Map<string, IValue>();\r\n  private _columns?: IValue[];\r\n\r\n  private build() {\r\n    if (this._columns) {\r\n      return;\r\n    }\r\n    this._columns = [];\r\n    for (const _col of this._schema.fields) {\r\n      const newCol = columnEvaluator(this, _col.name, _col.type as _IType);\r\n      this._columns.push(newCol);\r\n      this.columnsById.set(_col.name, newCol);\r\n    }\r\n  }\r\n\r\n  get columns(): ReadonlyArray<IValue<any>> {\r\n    this.build();\r\n    return this._columns!;\r\n  }\r\n\r\n  getColumn(column: string | ExprRef): IValue;\r\n  getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue | nil;\r\n  getColumn(\r\n    column: string | ExprRef,\r\n    nullIfNotFound?: boolean\r\n  ): IValue<any> | nil {\r\n    this.build();\r\n    if (typeof column !== \"string\" && column.table) {\r\n      if (!column.table.schema && column.table.name !== this.name) {\r\n        return null;\r\n      }\r\n      column = column.name;\r\n    }\r\n    return colByName(this.columnsById, column, nullIfNotFound);\r\n  }\r\n\r\n  explain(e: _Explainer): _SelectExplanation {\r\n    throw new PermissionDeniedError(this.name);\r\n  }\r\n\r\n  listIndices(): IndexDef[] {\r\n    return [];\r\n  }\r\n\r\n  stats(t: _Transaction): Stats | null {\r\n    throw new NotSupported(\"stats (count, ...) on information schema\");\r\n  }\r\n\r\n  rename(to: string): this {\r\n    throw new PermissionDeniedError(this.name);\r\n  }\r\n  update(t: _Transaction, toUpdate: any) {\r\n    throw new PermissionDeniedError(this.name);\r\n  }\r\n  addColumn(column: SchemaField | CreateColumnDef): _Column {\r\n    throw new PermissionDeniedError(this.name);\r\n  }\r\n  getColumnRef(column: string, nullIfNotFound?: boolean): _Column {\r\n    throw new PermissionDeniedError(this.name);\r\n  }\r\n  getConstraint(constraint: string): _IConstraint | nil {\r\n    return null;\r\n  }\r\n  addConstraint(constraint: TableConstraint, t: _Transaction): _IConstraint {\r\n    throw new PermissionDeniedError(this.name);\r\n  }\r\n  insert(item: any) {\r\n    throw new PermissionDeniedError(this.name);\r\n  }\r\n  doInsert(toInsert: any): void {\r\n    throw new PermissionDeniedError(this.name);\r\n  }\r\n  delete(t: _Transaction, toDelete: T): void {\r\n    throw new PermissionDeniedError(this.name);\r\n  }\r\n  truncate(t: _Transaction): void {\r\n    throw new PermissionDeniedError(this.name);\r\n  }\r\n\r\n  createIndex(): _IConstraint {\r\n    throw new PermissionDeniedError(this.name);\r\n  }\r\n  dropIndex(t: _Transaction, name: string): void {\r\n    throw new PermissionDeniedError(this.name);\r\n  }\r\n  setHidden(): this {\r\n    throw new PermissionDeniedError(this.name);\r\n  }\r\n  drop(t: _Transaction): void {\r\n    throw new PermissionDeniedError(this.name);\r\n  }\r\n\r\n  setReadonly(): this {\r\n    return this;\r\n  }\r\n\r\n  getIndex(...forValue: IValue[]): _IIndex<any> | nil {\r\n    return null;\r\n  }\r\n\r\n  on(): any {\r\n    throw new NotSupported(\"subscribing information schema\");\r\n  }\r\n  onBeforeChange(columns: string[], check: ChangeHandler<T>) {\r\n    // nop\r\n    return { unsubscribe() {} };\r\n  }\r\n  onCheckChange(columns: string[], check: ChangeHandler<T>) {\r\n    // nop\r\n    return { unsubscribe() {} };\r\n  }\r\n  onTruncate(sub: TruncateHandler): ISubscription {\r\n    // nop\r\n    return { unsubscribe() {} };\r\n  }\r\n  onDrop(sub: DropHandler): ISubscription {\r\n    // nop\r\n    return { unsubscribe() {} };\r\n  }\r\n  onIndex(sub: IndexHandler): ISubscription {\r\n    // nop\r\n    return { unsubscribe() {} };\r\n  }\r\n\r\n  find(template?: Partial<T>, columns?: (keyof T)[]): Iterable<T> {\r\n    return findTemplate(this.selection, this.db.data, template, columns);\r\n  }\r\n\r\n  make(table: _ITable, i: number, t: IValue<any>): any {\r\n    throw new Error(\"not implemented\");\r\n  }\r\n\r\n  *itemsByTable(\r\n    table: string | _ITable,\r\n    t: _Transaction\r\n  ): IterableIterator<any> {\r\n    if (typeof table === \"string\") {\r\n      for (const s of this.db.listSchemas()) {\r\n        const got = s.getTable(table, true);\r\n        if (got) {\r\n          yield* this.itemsByTable(got, t);\r\n        }\r\n      }\r\n    } else {\r\n      let i = 0;\r\n      for (const f of table.selection.columns) {\r\n        yield this.make(table, ++i, f);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Evaluator } from '../evaluator';\r\nimport { CastError, DataType, IValue, nil, Reg, TR, _ISchema, _IType, _RelationBase, _Transaction } from '../interfaces-private';\r\nimport { ArrayType } from './datatypes';\r\nimport { isType, nullIsh } from '../utils';\r\nimport objectHash from 'object-hash';\r\nimport { QueryError } from '../interfaces';\r\n\r\nlet regCnt = 0;\r\n\r\nexport function regGen(): Reg {\r\n    return {\r\n        classId: ++regCnt,\r\n        typeId: ++regCnt,\r\n    };\r\n}\r\n\r\nexport abstract class TypeBase<TRaw = any> implements _IType<TRaw>, _RelationBase {\r\n    get [isType.TAG]() {\r\n        return true;\r\n    }\r\n\r\n    readonly reg: Reg;\r\n\r\n    get type(): 'type' {\r\n        return 'type';\r\n    }\r\n\r\n    constructor() {\r\n        this.reg = regGen();\r\n    }\r\n\r\n    private _asArray?: _IType<TRaw[]>;\r\n    private _asList?: _IType<TRaw[]>;\r\n\r\n    abstract primary: DataType;\r\n    get name(): string {\r\n        return this.primary;\r\n    }\r\n\r\n\r\n    /** Compute a custom unicty hash for a non null value */\r\n    doGetHash?(value: TRaw): string | number;\r\n\r\n    /** Can be casted to */\r\n    doCanCast?(to: _IType<TRaw>): boolean | nil;\r\n\r\n    /** Can be built to from (inverse of doCanCast()) */\r\n    doCanBuildFrom?(from: _IType): boolean | nil;\r\n\r\n    /**\r\n     * @see this.prefer() doc\r\n      */\r\n    doPrefer?(type: _IType<TRaw>): _IType | null;\r\n\r\n    /**\r\n     * @see this.canConvertImplicit() doc\r\n     */\r\n    doCanConvertImplicit?(to: _IType<TRaw>): boolean;\r\n\r\n    /** Perform conversion from this type to given type */\r\n    doCast?(value: Evaluator<TRaw>, to: _IType<TRaw>): Evaluator<any> | nil;\r\n\r\n    /** Perform conversion  given type to this type (inverse of doCast()) */\r\n    doBuildFrom?(value: Evaluator, from: _IType): Evaluator<TRaw> | nil;\r\n\r\n    doEquals(a: TRaw, b: TRaw): boolean {\r\n        return a === b;\r\n    }\r\n\r\n    doGt(a: TRaw, b: TRaw): boolean {\r\n        return a > b;\r\n    }\r\n\r\n    doLt(a: TRaw, b: TRaw): boolean {\r\n        return a < b;\r\n    }\r\n    toString(): string {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n\r\n    equals(a: TRaw, b: TRaw): boolean | null {\r\n        if (nullIsh(a) || nullIsh(b)) {\r\n            return null;\r\n        }\r\n        return this.doEquals(a, b);\r\n    }\r\n\r\n    gt(a: TRaw, b: TRaw): boolean | null {\r\n        if (nullIsh(a) || nullIsh(b)) {\r\n            return null;\r\n        }\r\n        return this.doGt(a, b);\r\n    }\r\n    lt(a: TRaw, b: TRaw): boolean | null {\r\n        if (nullIsh(a) || nullIsh(b)) {\r\n            return null;\r\n        }\r\n        return this.doLt(a, b);\r\n    }\r\n\r\n    ge(a: TRaw, b: TRaw): boolean | null {\r\n        return this.gt(a, b) || this.equals(a, b);\r\n    }\r\n\r\n    le(a: TRaw, b: TRaw): boolean | null {\r\n        return this.lt(a, b) || this.equals(a, b);\r\n    }\r\n\r\n    /**\r\n     * When performing 'a+b', will be given 'b' type,\r\n     * this returns the prefered resulting type, or null if they are not compatible\r\n      */\r\n    prefer(to: _IType<TRaw>): _IType | nil {\r\n        if (to === this) {\r\n            return this;\r\n        }\r\n        if (this.doPrefer) {\r\n            const ret = this.doPrefer(to);\r\n            if (ret) {\r\n                return ret;\r\n            }\r\n        }\r\n        return (to as TypeBase).doPrefer?.(this);\r\n    }\r\n\r\n    /**\r\n     * Can constant literals be converted implicitely\r\n     * (without a cast... i.e. you can use both values as different values of a case expression, for instance)\r\n     **/\r\n    canConvertImplicit(to: _IType<TRaw>): boolean | nil {\r\n        if (to === this) {\r\n            return true;\r\n        }\r\n        return this.doCanConvertImplicit?.(to);\r\n    }\r\n\r\n    /** Can be explicitely casted to */\r\n    canCast(to: _IType<TRaw>): boolean | nil {\r\n        if (to === this) {\r\n            return true;\r\n        }\r\n\r\n        // ask the target type if it know how to build itself from this\r\n        if ((to as TypeBase).doCanBuildFrom?.(this)) {\r\n            return true;\r\n        }\r\n\r\n        // asks this type if it knows how to convert itself to target\r\n        if (this.doCanConvertImplicit?.(to) || this.doCanCast?.(to)) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /** Perform cast */\r\n    cast(_a: IValue<TRaw>, _to: _IType<any>): IValue<any> {\r\n        return this._convert(_a, _to, (a, to) => {\r\n            if (!this.doCanCast?.(to) || !this.doCast) {\r\n                throw new CastError(this, to);\r\n            }\r\n            return this.doCast(a, to);\r\n        })\r\n    }\r\n\r\n    /** Perform implicit conversion */\r\n    convertImplicit(_a: IValue<TRaw>, _to: _IType<any>): IValue<any> {\r\n        return this._convert(_a, _to, (a, to) => {\r\n            if (!this.doCanConvertImplicit?.(to) || !this.doCast) {\r\n                throw new CastError(this, to);\r\n            }\r\n            return this.doCast(a, to);\r\n        })\r\n    }\r\n\r\n    private _convert(a: IValue<TRaw>, _to: _IType<any>, perform: (a: Evaluator, to: _IType) => Evaluator<any> | nil): IValue<any> {\r\n        const to = _to as TypeBase;\r\n        if (to === this) {\r\n            return a;\r\n        }\r\n        if (!(a instanceof Evaluator)) {\r\n            throw new CastError(this, to);\r\n        }\r\n\r\n        let converted: Evaluator | nil;\r\n        if (to.doCanBuildFrom?.(this)) {\r\n            if (!to.doBuildFrom) {\r\n                throw new CastError(this, to);\r\n            }\r\n            converted = to.doBuildFrom(a, this);\r\n        } else {\r\n            converted = perform(a, to);\r\n        }\r\n\r\n        if (!converted) {\r\n            throw new CastError(this, to);\r\n        }\r\n        return converted.setType(to);\r\n    }\r\n\r\n    asArray(): _IType<TRaw[]> {\r\n        if (this._asArray) {\r\n            return this._asArray;\r\n        }\r\n        return this._asArray = new ArrayType(this, false);\r\n    }\r\n\r\n    asList(): _IType<TRaw[]> {\r\n        if (this._asList) {\r\n            return this._asList;\r\n        }\r\n        return this._asList = new ArrayType(this, true);\r\n    }\r\n\r\n    hash(value: any): string | number | null {\r\n        if (nullIsh(value)) {\r\n            return null;\r\n        }\r\n        if (this.doGetHash) {\r\n            return this.doGetHash(value);\r\n        }\r\n        if (typeof value === 'number') {\r\n            return value;\r\n        }\r\n        return objectHash(value);\r\n    }\r\n\r\n    drop(t: _Transaction): void {\r\n        throw new QueryError('drop type not implemented');\r\n    }\r\n\r\n}\r\n","import { IValue, _IIndex, _ISelection, _IType, _Transaction, _Explainer, _ExprExplanation, _ISchema, Parameter } from './interfaces-private';\r\nimport { DataType, QueryError, CastError, nil, ISchema, IType, ArgDefDetails } from './interfaces';\r\nimport hash from 'object-hash';\r\nimport { Types, ArrayType, isNumeric } from './datatypes';\r\nimport { buildCall } from './parser/function-call';\r\nimport { nullIsh, executionCtx } from './utils';\r\nimport { QName } from 'pgsql-ast-parser';\r\nimport { buildCtx } from './parser/context';\r\n\r\n\r\nexport class Evaluator<T = any> implements IValue<T> {\r\n\r\n    readonly isConstantLiteral: boolean;\r\n    readonly usedColumns = new Set<IValue>();\r\n    readonly forceNotConstant?: boolean;\r\n\r\n    get index(): _IIndex | nil {\r\n        return this.origin?.getIndex(this);\r\n    }\r\n\r\n    get isConstant(): boolean {\r\n        return !this.usedColumns.size && !this.forceNotConstant;\r\n    }\r\n\r\n    get isConstantReal(): boolean {\r\n        return typeof this.val !== 'function';\r\n    }\r\n\r\n    origin: _ISelection | nil;\r\n\r\n    get isAny(): boolean {\r\n        return this.opts?.isAny ?? false;\r\n    }\r\n\r\n    constructor(readonly type: _IType<T>\r\n        , readonly id: string | nil\r\n        , readonly hash: string\r\n        , dependencies: IValue | IValue[] | nil\r\n        , public val: nil | Object | number | string | Date | ((raw: any, transaction: _Transaction | nil) => any)\r\n        , private opts?: {\r\n            isAny?: boolean;\r\n            isColumnOf?: _ISelection;\r\n            forceNotConstant?: boolean;\r\n            unpure?: boolean;\r\n        }) {\r\n        this.isConstantLiteral = typeof val !== 'function';\r\n        if (opts?.forceNotConstant) {\r\n            this.forceNotConstant = true;\r\n        }\r\n\r\n        // fetch columns to depend on\r\n        let depArray: IValue[] | undefined = undefined;\r\n        let hasNotConstant = false;\r\n        if (dependencies) {\r\n            if (!Array.isArray(dependencies)) {\r\n                depArray = [dependencies];\r\n                this.usedColumns = dependencies.usedColumns as Set<IValue>;\r\n                hasNotConstant = !dependencies.isConstant;\r\n                this.origin = dependencies.origin;\r\n            } else {\r\n                this.usedColumns = new Set();\r\n                for (const d of dependencies) {\r\n                    if (d.origin) {\r\n                        if (this.origin && d.origin && this.origin !== d.origin) {\r\n                            throw new Error('You cannot evaluate an expression which is coming from multiple origins');\r\n                        }\r\n                        this.origin = d.origin;\r\n                    }\r\n                    if (!d.isConstant) {\r\n                        hasNotConstant = true;\r\n                    }\r\n                    for (const u of d.usedColumns) {\r\n                        this.usedColumns.add(u);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (opts?.isColumnOf) {\r\n            this.usedColumns.add(this);\r\n            this.origin = opts.isColumnOf;\r\n            delete opts.isColumnOf;\r\n        }\r\n        if (hasNotConstant && !this.usedColumns.size) {\r\n            this.forceNotConstant = true;\r\n        }\r\n\r\n        if (!this.usedColumns.size // no used columns\r\n            && !this.origin\r\n            && !this.opts?.unpure\r\n            && !this.forceNotConstant\r\n            && !depArray?.some(x => !x.isConstantReal)  // all real constant dependencies\r\n        ) {\r\n            // no dependency => this is a real constant => evaluate it.\r\n            if (typeof this.val === 'function') {\r\n                this.val = this.val(null, null);\r\n            }\r\n        }\r\n    }\r\n\r\n    setType(type: _IType) {\r\n        if (this.type === type) {\r\n            return this;\r\n        }\r\n        return new Evaluator<T>(type\r\n            , this.id\r\n            , this.hash\r\n            , this\r\n            , this.val\r\n            , this.opts\r\n        );\r\n    }\r\n\r\n\r\n\r\n    setConversion(converter: (val: T, t: _Transaction | nil) => any\r\n        , hashConv: (hash: string) => any) {\r\n        return new Evaluator<T>(this.type\r\n            , this.id\r\n            , hash(hashConv(this.hash))\r\n            , this\r\n            , (raw, t) => {\r\n                let got = this.get(raw, t);\r\n                if (nullIsh(got)) {\r\n                    return null;\r\n                }\r\n                if (!this.isAny) {\r\n                    return converter(got, t);\r\n                }\r\n                if (!Array.isArray(got)) {\r\n                    throw new QueryError('Unexpected use of ANY()');\r\n                }\r\n                return (got as any[]).map(x => converter(x, t));\r\n            }\r\n            , this.opts\r\n        );\r\n    }\r\n\r\n    setOrigin(origin: _ISelection): IValue<T> {\r\n        const ret = this.clone();\r\n        ret.origin = origin;\r\n        return ret;\r\n    }\r\n\r\n    clone(): Evaluator<T> {\r\n        return new Evaluator<T>(\r\n            this.type\r\n            , this.id\r\n            , this.hash\r\n            , this\r\n            , this.val\r\n            , this.opts\r\n        );\r\n    }\r\n\r\n    map<TNew>(mapper: (val: T) => TNew, newType?: _IType<TNew>): IValue<TNew> {\r\n        if (this.isAny) {\r\n            throw new QueryError('Unexpected use of ANY()');\r\n        }\r\n        const ret = new Evaluator<TNew>(\r\n            (newType ?? this.type) as _IType\r\n            , this.id\r\n            , this.hash\r\n            , this\r\n            , (raw, t) => {\r\n                const got = this.get(raw, t);\r\n                if (nullIsh(got)) {\r\n                    return null;\r\n                }\r\n                return mapper(got);\r\n            }\r\n            , this.opts\r\n        );\r\n        ret.origin = this.origin;\r\n        return ret;\r\n    }\r\n\r\n    setWrapper<TNew>(newOrigin: _ISelection, unwrap: (val: T) => TNew, newType?: _IType<TNew>): IValue<TNew> {\r\n        if (this.isAny) {\r\n            throw new QueryError('Unexpected use of ANY()');\r\n        }\r\n        const ret = new Evaluator<TNew>(\r\n            (newType ?? this.type) as _IType\r\n            , this.id\r\n            , this.hash\r\n            , this\r\n            , (raw, t) => {\r\n                const got = unwrap(raw)\r\n                if (nullIsh(got)) {\r\n                    return null;\r\n                }\r\n                return this.get(got, t);\r\n            }\r\n            , this.opts\r\n        );\r\n        ret.origin = newOrigin;\r\n        return ret;\r\n    }\r\n\r\n    setId(newId: string): IValue {\r\n        if (this.id === newId) {\r\n            return this;\r\n        }\r\n        return new Evaluator<T>(\r\n            this.type\r\n            , newId\r\n            , this.hash\r\n            , this\r\n            , this.val\r\n            , this.opts\r\n        );\r\n    }\r\n\r\n    get(): T;\r\n    get(raw: any, t: _Transaction | nil): T;\r\n    get(raw?: any, t?: _Transaction): T {\r\n        if ((nullIsh(raw) || !t) && !this.isConstant) {\r\n            throw new Error('Cannot be evaluated as constant');\r\n        }\r\n        if (typeof this.val !== 'function') {\r\n            return this.val as any;\r\n        }\r\n        return this.val(raw, t)\r\n    }\r\n\r\n    canCast(to: _IType<T>): boolean {\r\n        return !!this.type.canCast(to);\r\n    }\r\n\r\n    cast<T = any>(to: _IType<T>): IValue<T> {\r\n        return this.type.cast(this, to);\r\n    }\r\n\r\n    convertImplicit<T = any>(to: _IType<T>): IValue<T> {\r\n        return this.type.convertImplicit(this, to);\r\n    }\r\n\r\n\r\n    explain(e: _Explainer): _ExprExplanation {\r\n        if (!this.origin) {\r\n            return {\r\n                constant: true,\r\n            }\r\n        }\r\n        return {\r\n            on: e.idFor(this.origin),\r\n            col: this.id ?? '<complex expression>',\r\n        };\r\n    }\r\n}\r\n\r\n// export class ArrayEvaluator<T> implements IValue {\r\n\r\n//     constructor(\r\n//         readonly type: _IType<T>\r\n//         , readonly id: string\r\n//         , readonly sql: string\r\n//         , readonly hash: string\r\n//         , readonly selection: _ISelection\r\n//         , public val: T | ((raw: any) => T)) {\r\n//     }\r\n\r\n//     get index() {\r\n//         return this.selection?.getIndex(this);\r\n//     }\r\n\r\n//     get isConstant(): boolean {\r\n//         return typeof this.val !== 'function';\r\n//     }\r\n\r\n//     get(raw: any): T {\r\n//         if (typeof this.val !== 'function') {\r\n//             return this.val;\r\n//         }\r\n//         return (this.val as ((raw: any) => T))(raw);\r\n//     }\r\n\r\n//     asConstant(perform = true) {\r\n//         if (!perform || typeof this.val !== 'function') {\r\n//             return this;\r\n//         }\r\n//         return new Evaluator(this.type\r\n//             , this.id\r\n//             , this.sql\r\n//             , this.hash\r\n//             , this.selection\r\n//             , this.get(null));\r\n//     }\r\n\r\n\r\n//     setId(newId: string): IValue {\r\n//         if (this.id === newId) {\r\n//             return this;\r\n//         }\r\n//         return new Evaluator<T>(\r\n//             this.type\r\n//             , newId\r\n//             , this.sql\r\n//             , this.hash\r\n//             , this.selection\r\n//             , this.val\r\n//         );\r\n//     }\r\n\r\n//     canCast(to: DataType | _IType<T>): boolean {\r\n//         return this.type.canCast(to);\r\n//     }\r\n\r\n//     cast<T = any>(to: DataType | _IType<T>): IValue<T> {\r\n//         return this.type.cast(this, to);\r\n//     }\r\n// }\r\n\r\n\r\nexport const Value = {\r\n    null(ofType?: _IType): IValue {\r\n        return new Evaluator(ofType ?? Types.null, null, 'null', null, null, undefined);\r\n    },\r\n    text(value: string, length: number | nil = null): IValue {\r\n        return new Evaluator(\r\n            Types.text(length)\r\n            , null\r\n            , value\r\n            , null\r\n            , value);\r\n    },\r\n    number(value: number, type = Types.float): IValue {\r\n        return new Evaluator(\r\n            type\r\n            , null\r\n            , value.toString(10)\r\n            , null\r\n            , value);\r\n    },\r\n    function(value: string | QName, args: IValue[]): IValue {\r\n        return buildCall(value, args);\r\n    },\r\n    bool(value: boolean): IValue {\r\n        const str = value ? 'true' : 'false';\r\n        return new Evaluator(\r\n            Types.bool\r\n            , null\r\n            , str\r\n            , null\r\n            , value);\r\n    },\r\n    /** @deprecated Use with care */\r\n    constant(_type: _IType, value: any): IValue {\r\n        const type = nullIsh(value)\r\n            ? Types.null\r\n            : _type;\r\n        return new Evaluator(\r\n            type\r\n            , null\r\n            , (null as any)\r\n            , null\r\n            , value);\r\n    },\r\n    /** @deprecated Use with care */\r\n    converter(type: _IType, to: _IType): (val: any, t: _Transaction | nil) => any {\r\n        let last: any = null;\r\n        const evaluator = new Evaluator(\r\n            type\r\n            , null\r\n            , (null as any)\r\n            , null\r\n            , () => last\r\n            , { forceNotConstant: true })\r\n            .cast(to);\r\n        return (val: any, t) => {\r\n            if (nullIsh(val)) {\r\n                return null;\r\n            }\r\n            last = val;\r\n            const ret = evaluator.get(val, t);\r\n            last = null;\r\n            return ret;\r\n        };\r\n    },\r\n    in(value: IValue, array: IValue, inclusive: boolean): IValue {\r\n        if (!value) {\r\n            throw new Error('Argument null');\r\n        }\r\n        if (array.type.primary !== DataType.list && array.type) {\r\n            array = Value.list([array]);\r\n        }\r\n        const of = (array.type as ArrayType).of;\r\n        return new Evaluator(\r\n            Types.bool\r\n            , null\r\n            , hash({ val: value.hash, in: array.hash })\r\n            , [value, array]\r\n            , (raw, t) => {\r\n                const rawValue = value.get(raw, t);\r\n                const rawArray = array.get(raw, t);\r\n                if (!Array.isArray(rawArray)) {\r\n                    return false;\r\n                }\r\n                const has = rawArray.some(x => of.equals(rawValue, x));\r\n                return inclusive ? has : !has;\r\n            });\r\n    },\r\n    isNull(leftValue: IValue, expectNull: boolean): IValue {\r\n        return new Evaluator(\r\n            Types.bool\r\n            , null\r\n            , hash({ isNull: leftValue.hash, expectNull })\r\n            , leftValue\r\n            , (raw, t) => {\r\n                const left = leftValue.get(raw, t);\r\n                // check that result is null (will never return NULL)\r\n                const ret = nullIsh(left);\r\n                return expectNull ? ret : !ret;\r\n            })\r\n    },\r\n    isTrue(leftValue: IValue, expectTrue: boolean): IValue {\r\n        leftValue = leftValue.cast(Types.bool);\r\n        return new Evaluator(\r\n            Types.bool\r\n            , null\r\n            , hash({ isTrue: leftValue.hash, expectTrue })\r\n            , leftValue\r\n            , expectTrue ? ((raw, t) => {\r\n                const left = leftValue.get(raw, t);\r\n                return left === true; // never returns null\r\n            }) : ((raw, t) => {\r\n                const left = leftValue.get(raw, t);\r\n                return !(left === true); //  never returns null\r\n            }));\r\n    },\r\n    isFalse(leftValue: IValue, expectFalse: boolean): IValue {\r\n        leftValue = leftValue.cast(Types.bool);\r\n        return new Evaluator(\r\n            Types.bool\r\n            , null\r\n            , hash({ isFalse: leftValue.hash, expectFalse })\r\n            , leftValue\r\n            , expectFalse ? ((raw, t) => {\r\n                const left = leftValue.get(raw, t);\r\n                return left === false; // never returns null\r\n            }) : ((raw, t) => {\r\n                const left = leftValue.get(raw, t);\r\n                return !(left === false); //  never returns null\r\n            }));\r\n    },\r\n    negate(value: IValue): IValue {\r\n        if (value.type === Types.bool) {\r\n            return (value as Evaluator)\r\n                .setConversion(x => !x, x => ({ not: x }));\r\n        }\r\n        if (!isNumeric(value.type)) {\r\n            throw new QueryError('Can only apply \"-\" unary operator to numeric types');\r\n        }\r\n        return (value as Evaluator)\r\n            .setConversion(x => -x, x => ({ neg: x }));\r\n    },\r\n    array(values: IValue[]): IValue {\r\n        return arrayOrList(values, false);\r\n    },\r\n    list(values: IValue[]): IValue {\r\n        return arrayOrList(values, true);\r\n    }\r\n} as const;\r\n\r\n\r\nfunction arrayOrList(values: IValue[], list: boolean) {\r\n    const type = values.reduce((t, v) => {\r\n        if (v.canCast(t)) {\r\n            return t;\r\n        }\r\n        if (!t.canCast(v.type)) {\r\n            throw new CastError(t.primary, v.type.primary);\r\n        }\r\n        return v.type;\r\n    }, Types.null);\r\n    // const sel = values.find(x => !!x.selection)?.selection;\r\n    const converted = values.map(x => x.cast(type));\r\n    return new Evaluator(\r\n        list ? type.asList() : type.asArray()\r\n        , null\r\n        , hash(converted.map(x => x.hash))\r\n        , converted\r\n        , (raw, t) => {\r\n            const arr = values.map(x => x.get(raw, t));\r\n            return arr;\r\n        });\r\n}\r\n\r\n\r\nexport function buildParameterList(statementName: string | null, args: ArgDefDetails[]) {\r\n    return args.map<Parameter>(({ type, name }, i) => {\r\n        const value = new Evaluator(\r\n            type as _IType\r\n            , name\r\n            , hash({ param: name })\r\n            , null\r\n            , () => {\r\n                const { parametersValues } = executionCtx();\r\n                if (!parametersValues || parametersValues.length <= i) {\r\n                    throw new QueryError(`bind message supplies ${parametersValues?.length ?? 0} parameters, but prepared statement \"${statementName}\" requires ${args.length}`, '08P01');\r\n                }\r\n                return parametersValues[i];\r\n            }, {\r\n            forceNotConstant: true,\r\n        });\r\n        return { value, index: i };\r\n    })\r\n}","import { _ISelection, _IIndex, IValue, setId, getId, _IType, _Transaction, _Column, _ITable, _Explainer, _SelectExplanation, IndexKey, _IndexExplanation, IndexExpression, IndexOp, Stats, _IAlias } from '../interfaces-private';\r\nimport { QueryError, ColumnNotFound, AmbiguousColumn, nil } from '../interfaces';\r\nimport { buildValue } from '../parser/expression-builder';\r\nimport { Evaluator } from '../evaluator';\r\nimport { TransformBase } from './transform-base';\r\nimport { SelectedColumn, Expr, astVisitor, ExprRef } from 'pgsql-ast-parser';\r\nimport { aggregationFunctions, buildGroupBy } from './aggregation';\r\n\r\nimport { asSingleQName, colByName, colToStr, isSelectAllArgList, suggestColumnName } from '../utils';\r\nimport { withSelection } from '../parser/context';\r\n\r\n\r\nexport function buildSelection(on: _ISelection, select: SelectedColumn[] | nil) {\r\n    select = select ?? [];\r\n\r\n    // if this is a \"SELECT *\" => just ignore\r\n    if (isSelectAllArgList(select.map(x => x.expr))) {\r\n        if (!on.columns.length) {\r\n            throw new QueryError('SELECT * with no tables specified is not valid');\r\n        }\r\n        return on;\r\n    }\r\n\r\n    // if there is any aggregation function\r\n    // check if there is any aggregation\r\n    for (const col of select ?? []) {\r\n        if (!on.isAggregation() && 'expr' in col && hasAggreg(col.expr)) {\r\n            // yea, there is an aggregation somewhere in selection\r\n            return buildGroupBy(on, []).select(select);\r\n        }\r\n    }\r\n\r\n    return new Selection(on, select);\r\n}\r\n\r\n\r\nfunction hasAggreg(e: Expr) {\r\n    let has = false;\r\n    astVisitor(visitor => ({\r\n        call: expr => {\r\n            const nm = asSingleQName(expr.function, 'pg_catalog');\r\n            if (nm && aggregationFunctions.has(nm)) {\r\n                // yea, this is an aggregation\r\n                has = true;\r\n                return;\r\n            }\r\n            visitor.super().call(expr);\r\n        }\r\n    })).expr(e);\r\n    return has\r\n}\r\n\r\n\r\n\r\nexport function columnEvaluator(this: void, on: _ISelection, id: string, type: _IType) {\r\n    if (!id) {\r\n        throw new Error('Invalid column id');\r\n    }\r\n    const ret = new Evaluator(\r\n        type\r\n        , id\r\n        , id\r\n        , null\r\n        , raw => raw[id]\r\n        , {\r\n            isColumnOf: on,\r\n        });\r\n    return ret;\r\n}\r\n\r\nfunction* buildCols(this: void, base: _ISelection, columns: (SelectedColumn | CustomAlias)[]): Iterable<CustomAlias> {\r\n    for (const s of columns) {\r\n        if ('val' in s) {\r\n            if (s.val.origin !== base) {\r\n                throw new Error('Corrupted selection');\r\n            }\r\n            yield s;\r\n            continue;\r\n        }\r\n        if (s.expr.type === 'ref' && s.expr.name === '*') {\r\n            // handle select \"*\"\r\n            if (s.alias) {\r\n                throw new QueryError('Cannot alias *');\r\n            }\r\n            let of: _IAlias = base;\r\n            const alias = s.expr.table;\r\n            if (alias) {\r\n                // handle select \"x.*\"\r\n                const sub = base.selectAlias(alias.name);\r\n                if (!sub) {\r\n                    throw new QueryError(`Unknown alias \"${alias.name}\"`);\r\n                }\r\n                of = sub;\r\n            }\r\n\r\n            for (const val of of.listColumns()) {\r\n                yield { val };\r\n            }\r\n\r\n        } else {\r\n            const val = buildValue(s.expr);\r\n            yield { val, as: s.alias?.name, expr: s.expr };\r\n        }\r\n    }\r\n}\r\n\r\nexport interface CustomAlias {\r\n    val: IValue;\r\n    as?: string;\r\n    expr?: Expr\r\n}\r\n\r\nexport class Selection<T = any> extends TransformBase<T> implements _ISelection<T> {\r\n\r\n    private columnIds: string[] = [];\r\n    private columnsOrigin: IValue[] = [];\r\n    private columnMapping = new Map<IValue, IValue>();\r\n    private indexCache = new Map<IValue, _IIndex>();\r\n    private columnsById = new Map<string, IValue[]>();\r\n    private symbol = Symbol();\r\n\r\n    readonly columns: IValue[] = [];\r\n\r\n    isAggregation() {\r\n        return false;\r\n    }\r\n\r\n\r\n    constructor(base: _ISelection, _columns: (SelectedColumn | CustomAlias)[]) {\r\n        super(base);\r\n\r\n        // build non-conflicting column ids based on existing ones\r\n        const columns = withSelection(base, () => [...buildCols(base, _columns)]);\r\n        this.columnIds = columns.map(x => x.as ?? x.val.id!);\r\n\r\n        // build column ids\r\n        let anonymousBases = new Map<string, number>();\r\n        for (let i = 0; i < this.columnIds.length; i++) {\r\n            if (!this.columnIds[i]) {\r\n                let id = suggestColumnName(columns[i].expr) ?? 'column';\r\n\r\n                // check no collision with an existing column\r\n                let cnt = anonymousBases.get(id);\r\n                this.columnIds[i] = id + (cnt ? cnt : '');\r\n                anonymousBases.set(id, (cnt ?? 0) + 1);\r\n            }\r\n        }\r\n\r\n\r\n        // build columns to select\r\n        for (let i = 0; i < columns.length; i++) {\r\n            this.refColumn(columns[i].val, this.columnIds[i]);\r\n        }\r\n\r\n\r\n        // ONLY ONCE COLUMNS HAVE BEEN REFERENCED BY ID,\r\n        // rename ids for columns which have the same id\r\n        // this allows yielding ambiguous columns data\r\n        const has = new Map<string, number>();\r\n        for (let i = 0; i < columns.length; i++) {\r\n            const orig = this.columnIds[i];\r\n            const oi = has.get(orig);\r\n            if (typeof oi !== 'number') {\r\n                has.set(orig, i);\r\n                continue;\r\n            }\r\n            let ret: string = orig;\r\n            let k = 0;\r\n            do {\r\n                ret = orig + (++k);\r\n            } while (this.columnIds.includes(ret));\r\n            this.columnIds[i] = ret;\r\n            has.set(ret, i);\r\n        }\r\n    }\r\n\r\n    private refColumn(fromCol: IValue, alias: string) {\r\n        const col = columnEvaluator(this, alias, fromCol.type);\r\n        this.columns.push(col);\r\n        this.columnMapping.set(col, fromCol);\r\n        this.columnsOrigin.push(fromCol);\r\n        if (!col.id) {\r\n            return;\r\n        }\r\n        let ci = this.columnsById.get(col.id);\r\n        if (!ci) {\r\n            this.columnsById.set(col.id, ci = []);\r\n        }\r\n        ci.push(col);\r\n    }\r\n\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return this.base.stats(t);\r\n    }\r\n\r\n\r\n    *enumerate(t: _Transaction): Iterable<T> {\r\n        for (const item of this.base.enumerate(t)) {\r\n            yield this.build(item, t);\r\n        }\r\n    }\r\n\r\n    build(item: any, t: _Transaction): T {\r\n        const ret: any = {};\r\n        setId(ret, getId(item));\r\n        ret[this.symbol] = this.symbol;\r\n        for (let i = 0; i < this.columns.length; i++) {\r\n            const col = this.columnsOrigin[i];\r\n            ret[this.columnIds[i]] = col.get(item, t) ?? null;\r\n        }\r\n        return ret as any;\r\n    }\r\n\r\n    hasItem(value: T, t: _Transaction): boolean {\r\n        return (value as any)[this.symbol] === this.symbol;\r\n    }\r\n\r\n    getColumn(column: string | ExprRef): IValue;\r\n    getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue | nil;\r\n    getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue | nil {\r\n        const ret = colByName(this.columnsById, column, true);\r\n        if (!ret?.length) {\r\n            if (nullIfNotFound) {\r\n                return null;\r\n            }\r\n            throw new ColumnNotFound(colToStr(column));\r\n        }\r\n        if (ret.length !== 1) {\r\n            throw new AmbiguousColumn(colToStr(column));\r\n        }\r\n        return ret[0];\r\n    }\r\n\r\n    getIndex(val: IValue): _IIndex | nil {\r\n        if (this.indexCache.has(val)) {\r\n            return this.indexCache.get(val);\r\n        }\r\n        const mapped = this.columnMapping.get(val);\r\n        const originIndex = this.base.getIndex(mapped!);\r\n        const ret = originIndex && new SelectionIndex(this, originIndex);\r\n        this.indexCache.set(val, ret!);\r\n        return ret;\r\n    }\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'map',\r\n            of: this.base.explain(e),\r\n            select: this.columnIds.map((x, i) => ({\r\n                what: this.columnsOrigin[i].explain(e),\r\n                as: x\r\n            })),\r\n        };\r\n    }\r\n}\r\n\r\n\r\nexport class SelectionIndex<T> implements _IIndex<T> {\r\n    constructor(readonly owner: Selection<T>, private base: _IIndex) {\r\n    }\r\n\r\n    stats(t: _Transaction, key?: IndexKey) {\r\n        return this.base.stats(t, key);\r\n    }\r\n\r\n    iterateKeys(t: _Transaction) {\r\n        return this.base.iterateKeys(t);\r\n    }\r\n\r\n    get expressions(): IndexExpression[] {\r\n        return this.base.expressions;\r\n    }\r\n\r\n    entropy(op: IndexOp): number {\r\n        // same as source\r\n        return this.base.entropy(op);\r\n    }\r\n\r\n    eqFirst(rawKey: IndexKey, t: _Transaction) {\r\n        return this.base.eqFirst(rawKey, t);\r\n    }\r\n\r\n    *enumerate(op: IndexOp): Iterable<T> {\r\n        for (const i of this.base.enumerate(op)) {\r\n            yield this.owner.build(i, op.t);\r\n        }\r\n    }\r\n\r\n\r\n    explain(e: _Explainer): _IndexExplanation {\r\n        return {\r\n            _: 'indexMap',\r\n            of: this.base.explain(e),\r\n        }\r\n    }\r\n}","module.exports = require(\"pgsql-ast-parser\");","import { _IStatementExecutor, _Transaction, StatementResult, _IStatement, _ISelection, NotSupported, QueryError, asSelectable, nil, OnStatementExecuted, _ISchema } from '../interfaces-private';\r\nimport { WithStatementBinding, SelectStatement, SelectFromUnion, WithStatement, ValuesStatement, SelectFromStatement, QNameMapped, Name, SelectedColumn, Expr, OrderByStatement } from 'pgsql-ast-parser';\r\nimport { Deletion } from './records-mutations/deletion';\r\nimport { Update } from './records-mutations/update';\r\nimport { Insert } from './records-mutations/insert';\r\nimport { ValuesTable } from '../schema/values-table';\r\nimport { ignore, suggestColumnName, notNil, modifyIfNecessary } from '../utils';\r\nimport { JoinSelection } from '../transforms/join';\r\nimport { cleanResults } from './clean-results';\r\nimport { MutationDataSourceBase } from './records-mutations/mutation-base';\r\nimport { locOf } from './exec-utils';\r\nimport { buildCtx, withBindingScope } from '../parser/context';\r\nimport { buildValue } from '../parser/expression-builder';\r\nimport { ArrayType } from '../datatypes';\r\nimport { RecordType } from '../datatypes/t-record';\r\nimport { FunctionCallTable } from '../schema/function-call-table';\r\n\r\n\r\n\r\n\r\nexport function buildValues(p: ValuesStatement, acceptDefault?: boolean): _ISelection {\r\n    const ret = new ValuesTable('', p.values, null, acceptDefault);\r\n    return ret.selection;\r\n}\r\n\r\n\r\nfunction buildWithable(p: WithStatementBinding): _ISelection {\r\n    switch (p.type) {\r\n        case 'select':\r\n        case 'union':\r\n        case 'union all':\r\n        case 'with':\r\n        case 'with recursive':\r\n        case 'values':\r\n            return buildSelect(p);\r\n        case 'delete':\r\n            return new Deletion(p);\r\n        case 'update':\r\n            return new Update(p);\r\n        case 'insert':\r\n            return new Insert(p);\r\n        default:\r\n            throw NotSupported.never(p);\r\n    }\r\n}\r\n\r\nexport function buildSelect(p: SelectStatement): _ISelection {\r\n    switch (p.type) {\r\n        case 'union':\r\n        case 'union all':\r\n            return buildUnion(p);\r\n        case 'with':\r\n            return buildWith(p, false);\r\n        case 'select':\r\n            return buildRawSelect(p);\r\n        case 'values':\r\n            return buildValues(p);\r\n        case 'with recursive':\r\n            throw new NotSupported('recursirve with statements not implemented by pg-mem');\r\n        default:\r\n            throw NotSupported.never(p);\r\n    }\r\n}\r\n\r\n\r\nfunction buildUnion(p: SelectFromUnion): _ISelection {\r\n    const left = buildSelect(p.left);\r\n    const right = buildSelect(p.right);\r\n    const ret = left.union(right);\r\n    if (p.type === 'union all') {\r\n        return ret;\r\n    }\r\n    return ret.distinct();\r\n}\r\n\r\nexport function buildWith(p: WithStatement, topLevel: boolean): _ISelection {\r\n    return withBindingScope(() => {\r\n        const { setTempBinding } = buildCtx();\r\n        // declare temp bindings\r\n        for (const { alias, statement } of p.bind) {\r\n            const prepared = (topLevel ? buildWithable(statement) : buildSelect(checkReadonlyWithable(statement)))\r\n                .setAlias(alias.name);\r\n            setTempBinding(alias.name, prepared);\r\n        }\r\n        return buildSelect(checkReadonlyWithable(p.in));\r\n    })\r\n}\r\n\r\n\r\nfunction buildRawSelectSubject(p: SelectFromStatement): _ISelection | nil {\r\n    // compute data source\r\n    let sel: _ISelection | undefined = undefined;\r\n    for (const from of p.from ?? []) {\r\n        // find what to select\r\n        let newT: _ISelection;\r\n        switch (from.type) {\r\n            case 'table':\r\n                newT = getSelectable(from.name);\r\n                break;\r\n            case 'statement':\r\n                newT = mapColumns(from.alias\r\n                    , buildSelect(from.statement)\r\n                    , from.columnNames\r\n                    , true)\r\n                    .setAlias(from.alias);\r\n                break;\r\n            case 'call':\r\n                const fnName = from.alias?.name ?? from.function?.name;\r\n                const fromValue = buildValue(from);\r\n                if (ArrayType.matches(fromValue.type) && RecordType.matches(fromValue.type.of)) {\r\n                    // if the function returns an array of records (= \"a table\"), then lets use it as a table\r\n                    const cols = fromValue.type.of.columns;\r\n                    newT = new FunctionCallTable(cols, fromValue);\r\n                } else {\r\n                    // if the function returns a single value, then lets transform this into a table\r\n                    // nb: the function call will be re-built in here, but its OK (coz' of build cache)\r\n                    newT = new ValuesTable(fnName, [[from]], [fnName])\r\n                        .setAlias(from.alias?.name ?? suggestColumnName(from) ?? '');\r\n                }\r\n                break;\r\n            default:\r\n                throw NotSupported.never(from);\r\n        }\r\n\r\n        if (!sel) {\r\n            // first table to be selected\r\n            sel = newT;\r\n            continue;\r\n        }\r\n\r\n        switch (from.join?.type) {\r\n            case 'INNER JOIN':\r\n                sel = new JoinSelection(sel, newT, from.join!, true);\r\n                break;\r\n            case 'LEFT JOIN':\r\n                sel = new JoinSelection(sel, newT, from.join!, false);\r\n                break;\r\n            case 'RIGHT JOIN':\r\n                sel = new JoinSelection(newT, sel, from.join!, false);\r\n                break;\r\n            case null:\r\n            case undefined:\r\n                // cross join (equivalent to INNER JOIN ON TRUE)\r\n                sel = new JoinSelection(sel, newT, {\r\n                    type: 'INNER JOIN',\r\n                    on: { type: 'boolean', value: true }\r\n                }, true);\r\n                break;\r\n            default:\r\n                throw new NotSupported('Join type not supported ' + (from.join?.type ?? '<no join specified>'));\r\n        }\r\n    }\r\n    return sel;\r\n}\r\n\r\n\r\nfunction buildRawSelect(p: SelectFromStatement): _ISelection {\r\n    const distinct = !p.distinct || p.distinct === 'all'\r\n        ? null\r\n        : p.distinct;\r\n\r\n    // ignore \"for update\" clause (not useful in non-concurrent environements)\r\n    ignore(p.for);\r\n\r\n    let sel = buildRawSelectSubject(p);\r\n\r\n\r\n    // filter & select\r\n    sel = sel ?? buildCtx().schema.dualTable.selection;\r\n    sel = sel.filter(p.where);\r\n\r\n    // postgres helps users: you can use group-by & order-by on aliases.\r\n    // ... but you cant use aliases in a computation (only in simple order by statements)\r\n    // this hack reproduces this behaviour\r\n    const aliases = new Map(notNil(p.columns?.filter(c => !!c.alias?.name)).map(c => [c.alias!.name, c.expr]));\r\n    const orderBy = modifyIfNecessary(p.orderBy ?? [], o => {\r\n        const by = o.by.type === 'ref' && !o.by.table && aliases.get(o.by.name);\r\n        return by ? { ...o, by } : null;\r\n    });\r\n\r\n\r\n    if (p.groupBy) {\r\n        const groupBy = modifyIfNecessary(p.groupBy ?? [], o => {\r\n            const group = o.type === 'ref' && !o.table && !sel?.getColumn(o.name, true) && aliases.get(o.name);\r\n            return group || null;\r\n        });\r\n        sel = sel.groupBy(groupBy);\r\n    }\r\n\r\n    // order selection\r\n    sel = sel.orderBy(orderBy);\r\n\r\n    // when not grouping by, distinct is handled before\r\n    // selection => can distinct on non selected values\r\n    if (!p.groupBy && Array.isArray(p.distinct)) {\r\n        sel = sel.distinct(p.distinct);\r\n    }\r\n\r\n    // select columns\r\n    sel = sel.select(p.columns!);\r\n\r\n\r\n    // when grouping by, distinct is handled after selection\r\n    //  => can distinct on key, or selected\r\n    if (p.groupBy && Array.isArray(p.distinct)) {\r\n        sel = sel.distinct(p.distinct);\r\n    }\r\n\r\n    // handle 'distinct' on result set\r\n    if (distinct === 'distinct') {\r\n        sel = sel.distinct();\r\n    }\r\n\r\n    if (p.limit) {\r\n        sel = sel.limit(p.limit);\r\n    }\r\n    return sel;\r\n}\r\n\r\nfunction getSelectable(name: QNameMapped): _ISelection {\r\n    const { schema, getTempBinding } = buildCtx();\r\n    const temp = !name.schema\r\n        && getTempBinding(name.name);\r\n\r\n    let ret = temp || asSelectable(schema.getObject(name)).selection;\r\n    ret = mapColumns(name.name, ret, name.columnNames, false);\r\n\r\n    if (name.alias) {\r\n        ret = ret.setAlias(name.alias);\r\n    }\r\n    return ret;\r\n}\r\n\r\nfunction mapColumns(tableName: string, sel: _ISelection, columnNames: Name[] | nil, appendNonMapped: boolean) {\r\n    if (!columnNames?.length) {\r\n        return sel;\r\n    }\r\n    if (columnNames.length > sel.columns.length) {\r\n        throw new QueryError(`table \"${tableName}\" has ${sel.columns.length} columns available but ${columnNames.length} columns specified`, '42P10')\r\n    }\r\n\r\n    const mapped = new Set<string>(columnNames.map(x => x.name));\r\n    const cols = sel.columns.map<SelectedColumn>((col, i) => ({\r\n        expr: {\r\n            type: 'ref',\r\n            name: col.id!,\r\n        },\r\n        // when realiasing table columns, columns which have not been mapped\r\n        //  must not be removed\r\n        // see ut \"can map column names\"\r\n        alias: columnNames[i]\r\n            ?? {\r\n            name: mapped.has(sel.columns[i].id!)\r\n                ? `${sel.columns[i].id!}1`\r\n                : sel.columns[i].id!,\r\n        },\r\n    }));\r\n\r\n    return sel.select(\r\n        cols\r\n    )\r\n}\r\n\r\n\r\nexport class SelectExec implements _IStatementExecutor {\r\n    readonly selection: _ISelection;\r\n\r\n    constructor(private statement: _IStatement, private p: WithStatementBinding) {\r\n        // a bit of a special case for top level withs.\r\n        this.selection = p.type === 'with' ? buildWith(p, true) : buildWithable(p);\r\n    }\r\n\r\n    get schema() {\r\n        return this.statement.schema;\r\n    }\r\n\r\n\r\n\r\n    execute(t: _Transaction): StatementResult {\r\n        const rows = cleanResults([...this.selection.enumerate(t)]);\r\n        let unnamedFields = 0;\r\n        const nextDefaultFieldName = () => {\r\n            const unnamedField = `column${unnamedFields || ''}`;\r\n            unnamedFields += 1;\r\n            return unnamedField;\r\n        }\r\n        return {\r\n            result: {\r\n                rows,\r\n                rowCount: t.getTransient(MutationDataSourceBase.affectedRows) ?? rows.length,\r\n                command: this.p.type.toUpperCase(),\r\n                fields: this.selection.columns.map(\r\n                    c => ({ name: c.id ?? nextDefaultFieldName(), type: c.type.primary })\r\n                ),\r\n                location: locOf(this.p),\r\n            },\r\n            state: t,\r\n        };\r\n    }\r\n}\r\n\r\n\r\n\r\nfunction checkReadonlyWithable(st: WithStatementBinding) {\r\n    switch (st.type) {\r\n        case 'delete':\r\n        case 'insert':\r\n        case 'update':\r\n            throw new NotSupported(`\"WITH\" nested statement with query type '${st.type}'`);\r\n    }\r\n    return st;\r\n}\r\n","import { IValue, _IIndex, _ISelection, _IType, _ISchema } from '../interfaces-private';\r\nimport { DataType, CastError, IType, QueryError, nil } from '../interfaces';\r\nimport { nullIsh } from '../utils';\r\nimport { Evaluator, Value } from '../evaluator';\r\nimport { parseArrayLiteral } from 'pgsql-ast-parser';\r\nimport { parseGeometricLiteral } from 'pgsql-ast-parser';\r\nimport { bufCompare, bufFromString, bufToString, TBuffer } from '../misc/buffer-node';\r\nimport { TypeBase } from './datatype-base';\r\nimport { BoxType, CircleType, LineType, LsegType, PathType, PointType, PolygonType } from './datatypes-geometric';\r\nimport { IntervalType } from './t-interval';\r\nimport { TimeType } from './t-time';\r\nimport { TimestampType } from './t-timestamp';\r\nimport { JSONBType } from './t-jsonb';\r\nimport { RegTypeImpl } from './t-regtype';\r\nimport { RegClassImpl } from './t-regclass';\r\nimport { RecordType } from './t-record';\r\nimport { INetType } from './t-inet';\r\nimport { buildCtx } from '../parser/context';\r\n\r\n\r\nclass UUIDtype extends TypeBase<Date> {\r\n\r\n\r\n    get primary(): DataType {\r\n        return DataType.uuid;\r\n    }\r\n\r\n    doCanCast(to: _IType) {\r\n        switch (to.primary) {\r\n            case DataType.text:\r\n                return true;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    doCast(value: Evaluator, to: _IType) {\r\n        switch (to.primary) {\r\n            case DataType.text:\r\n                return value;\r\n        }\r\n        throw new Error('Unexpected cast error');\r\n    }\r\n}\r\n\r\n\r\n\r\nclass NullType extends TypeBase<null> {\r\n\r\n    get primary(): DataType {\r\n        return DataType.null;\r\n    }\r\n\r\n    doCast(value: Evaluator<any>, to: _IType): Evaluator<any> {\r\n        return new Evaluator(to, null, 'null', null, null);\r\n    }\r\n\r\n    doCanCast(to: _IType): boolean {\r\n        return true;\r\n    }\r\n\r\n    doCanConvertImplicit() {\r\n        return true;\r\n    }\r\n\r\n    doEquals(a: any, b: any): boolean {\r\n        return false;\r\n    }\r\n\r\n    doGt(a: any, b: any): boolean {\r\n        return false;\r\n    }\r\n\r\n    doLt(a: any, b: any): boolean {\r\n        return false;\r\n    }\r\n\r\n    doPrefer(type: _IType) {\r\n        return type; // always prefer notnull types\r\n    }\r\n}\r\n\r\nexport class DefaultType extends NullType {\r\n}\r\n\r\nexport const integers: ReadonlySet<DataType> = new Set([DataType.integer, DataType.bigint]);\r\nexport const floats: ReadonlySet<DataType> = new Set([DataType.decimal, DataType.float]);\r\nexport const numbers: ReadonlySet<DataType> = new Set([...integers, ...floats]);\r\nexport const numberPriorities = [DataType.integer, DataType.bigint, DataType.decimal, DataType.float]\r\n    .reduce<Record<DataType, number>>((a, x, i) => ({\r\n        ...a,\r\n        [x]: i\r\n    }), {} as Record<DataType, number>);\r\n\r\nexport function isNumeric(t: DataType | IType) {\r\n    const type = typeof t === 'string' ? t : t.primary;\r\n    return numbers.has(type);\r\n}\r\nexport function isInteger(t: DataType | IType) {\r\n    const type = typeof t === 'string' ? t : t.primary;\r\n    return integers.has(type);\r\n}\r\n\r\nclass NumberType extends TypeBase<number> {\r\n\r\n    constructor(readonly primary: DataType) {\r\n        super();\r\n    }\r\n\r\n    doCanConvertImplicit(to: _IType) {\r\n        switch (to.primary) {\r\n            case DataType.integer:\r\n            case DataType.bigint:\r\n            case DataType.float:\r\n            case DataType.decimal:\r\n            case DataType.regtype:\r\n            case DataType.regclass:\r\n                return true;\r\n            default:\r\n                return false;\r\n        }\r\n    }\r\n\r\n    doPrefer(type: _IType): _IType | null {\r\n        switch (type.primary) {\r\n            case DataType.integer:\r\n            case DataType.bigint:\r\n                return this;\r\n            case DataType.float:\r\n            case DataType.decimal:\r\n                return type;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    doCanCast(to: _IType) {\r\n        switch (to.primary) {\r\n            case DataType.integer:\r\n            case DataType.bigint:\r\n            case DataType.float:\r\n            case DataType.decimal:\r\n            case DataType.regtype:\r\n            case DataType.regclass:\r\n                return true;\r\n            case DataType.text:\r\n                return true;\r\n            default:\r\n                return false;\r\n        }\r\n    }\r\n    doCast(value: Evaluator<any>, to: _IType): Evaluator<any> {\r\n        if (!integers.has(value.type.primary) && integers.has(to.primary)) {\r\n            return new Evaluator(\r\n                to\r\n                , value.id\r\n                , value.hash\r\n                , value\r\n                , (raw, t) => {\r\n                    const got = value.get(raw, t);\r\n                    return typeof got === 'number'\r\n                        ? Math.round(got)\r\n                        : got;\r\n                }\r\n            );\r\n        }\r\n        const { schema } = buildCtx();\r\n        switch (to.primary) {\r\n            case DataType.regtype:\r\n                return value\r\n                    .setType(Types.regtype)\r\n                    .setConversion((int: number) => {\r\n                        const got = schema.getType(int, { nullIfNotFound: true });\r\n                        if (!got) {\r\n                            throw new CastError(DataType.integer, DataType.regtype);\r\n                        }\r\n                        return got.name;\r\n                    }\r\n                        , intToRegType => ({ intToRegType }));\r\n            case DataType.regclass:\r\n                return value\r\n                    .setType(Types.regclass)\r\n                    .setConversion((int: number) => {\r\n                        // === int -> regclass\r\n                        const obj = schema.getObjectByRegOrName(int, { nullIfNotFound: true });\r\n                        return obj?.reg.classId ?? int;\r\n                    }\r\n                        , intToRegClass => ({ intToRegClass }));\r\n            case DataType.text:\r\n                return value\r\n                    .setType(to)\r\n                    .setConversion((int: number) => int.toString()\r\n                        , toTxt => ({ toTxt }));\r\n        }\r\n        return value.setType(to);\r\n    }\r\n}\r\n\r\n\r\n\r\nclass ByteArrayType extends TypeBase<TBuffer> {\r\n\r\n    get primary(): DataType {\r\n        return DataType.bytea;\r\n    }\r\n\r\n\r\n    doCanCast(to: _IType) {\r\n        switch (to.primary) {\r\n            case DataType.text:\r\n                return true;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    doCast(value: Evaluator, to: _IType) {\r\n        switch (to.primary) {\r\n            case DataType.text:\r\n                return value\r\n                    .setConversion(raw => bufToString(raw)\r\n                        , toStr => ({ toStr }));\r\n        }\r\n        throw new Error('Unexpected cast error');\r\n    }\r\n\r\n    doEquals(a: TBuffer, b: TBuffer): boolean {\r\n        return bufCompare(a, b) === 0;\r\n    }\r\n\r\n    doGt(a: TBuffer, b: TBuffer): boolean {\r\n        return bufCompare(a, b) > 0;\r\n    }\r\n\r\n    doLt(a: TBuffer, b: TBuffer): boolean {\r\n        return bufCompare(a, b) < 0;\r\n    }\r\n}\r\n\r\n\r\nclass TextType extends TypeBase<string> {\r\n\r\n    get name(): string {\r\n        if (this.citext) {\r\n            return 'citext';\r\n        }\r\n        return this.len ? 'character varying' : 'text';\r\n    }\r\n\r\n    get primary(): DataType {\r\n        return this.citext\r\n            ? DataType.citext\r\n            : DataType.text;\r\n    }\r\n\r\n    constructor(readonly len: number | null, private citext?: boolean) {\r\n        super();\r\n    }\r\n\r\n    doPrefer(to: _IType) {\r\n        if (to instanceof TextType) {\r\n            // returns the broader type\r\n            if (!to.len) {\r\n                return to;\r\n            }\r\n            if (!this.len) {\r\n                return this;\r\n            }\r\n            return to.len > this.len ? to : this;\r\n        }\r\n        if (this.canCast(to)) {\r\n            return to;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    doCanConvertImplicit(to: _IType): boolean {\r\n        // text is implicitely convertible to dates\r\n        switch (to.primary) {\r\n            case DataType.text:\r\n            case DataType.bool:\r\n            case DataType.uuid:\r\n            case DataType.bytea:\r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    doCanCast(to: _IType): boolean | nil {\r\n        switch (to.primary) {\r\n            case DataType.text:\r\n            case DataType.citext:\r\n                return true;\r\n            case DataType.text:\r\n            case DataType.uuid:\r\n                return true;\r\n            case DataType.bool:\r\n                return true;\r\n            case DataType.array:\r\n                return this.canCast((to as ArrayType).of);\r\n            case DataType.bytea:\r\n                return true;\r\n        }\r\n        if (numbers.has(to.primary)) {\r\n            return true;\r\n        }\r\n        if (isGeometric(to.primary)) {\r\n            return true;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    doCast(value: Evaluator<string>, to: _IType) {\r\n        switch (to.primary) {\r\n            case DataType.citext:\r\n                return value.setType(to);\r\n            case DataType.bool:\r\n                return value\r\n                    .setConversion(rawStr => {\r\n                        if (nullIsh(rawStr)) {\r\n                            return null;\r\n                        }\r\n                        if (rawStr === '0') {\r\n                            return false;\r\n                        } else if (rawStr === '1') {\r\n                            return true;\r\n                        }\r\n                        const str = (rawStr as string).toLowerCase();\r\n                        if ('true'.startsWith(str)) {\r\n                            return true;\r\n                        } else if ('false'.startsWith(str)) {\r\n                            return false;\r\n                        }\r\n                        if ('yes'.startsWith(str)) {\r\n                            return true;\r\n                        } else if ('no'.startsWith(str)) {\r\n                            return false;\r\n                        }\r\n                        throw new CastError(DataType.text, DataType.bool, 'string ' + rawStr);\r\n                    }\r\n                        , toBool => ({ toBool }));\r\n            case DataType.uuid:\r\n                return value\r\n                    .setConversion((_rawStr: string) => {\r\n                        let rawStr = _rawStr;\r\n                        if (nullIsh(rawStr)) {\r\n                            return null;\r\n                        }\r\n                        // check schema\r\n                        if (rawStr[0] === '{') {\r\n                            if (rawStr[rawStr.length - 1] !== '}') {\r\n                                throw new CastError(DataType.text, DataType.uuid, 'string: ' + JSON.stringify(_rawStr));\r\n                            }\r\n                            rawStr = rawStr.substr(1, rawStr.length - 2);\r\n                        }\r\n                        rawStr = rawStr.toLowerCase();\r\n                        const [full, a, b, c, d, e] = /^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/.exec(rawStr) ?? [];\r\n                        if (!full) {\r\n                            throw new CastError(DataType.text, DataType.uuid, 'string: ' + JSON.stringify(_rawStr));\r\n                        }\r\n                        return `${a}-${b}-${c}-${d}-${e}`;\r\n                    }\r\n                        , toUuid => ({ toUuid }));\r\n            case DataType.text:\r\n                const fromStr = to as TextType;\r\n                const toStr = to as TextType;\r\n                if (toStr.len === null || (fromStr.len ?? -1) < toStr.len) {\r\n                    // no need to truncate\r\n                    return value;\r\n                }\r\n                return value\r\n                    .setConversion(str => {\r\n                        if (str?.length > toStr.len!) {\r\n                            throw new QueryError(`value too long for type character varying(${toStr.len})`);\r\n                        }\r\n                        return str;\r\n                    }\r\n                        , truncate => ({ truncate, len: toStr.len }));\r\n\r\n            case DataType.array:\r\n                return value\r\n                    .setType(to)\r\n                    .setConversion((str: string) => {\r\n                        const array = parseArrayLiteral(str);\r\n                        (to as ArrayType).convertLiteral(array);\r\n                        return array;\r\n                    }\r\n                        , parseArray => ({ parseArray }));\r\n            case DataType.bytea:\r\n                return value\r\n                    .setConversion(str => {\r\n                        return bufFromString(str);\r\n                    }\r\n                        , toBytea => ({ toBytea }));\r\n\r\n        }\r\n        if (numbers.has(to.primary)) {\r\n            const isInt = integers.has(to.primary);\r\n            return value\r\n                .setConversion(str => {\r\n                    const val = Number.parseFloat(str);\r\n                    if (!Number.isFinite(val)) {\r\n                        throw new QueryError(`invalid input syntax for ${to.primary}: ${str}`);\r\n                    }\r\n                    if (isInt && Math.floor(val) !== val) {\r\n                        throw new QueryError(`invalid input syntax for ${to.primary}: ${str}`)\r\n                    }\r\n                    return val;\r\n                }\r\n                    , castNum => ({ castNum, to: to.primary }));\r\n        }\r\n        if (isGeometric(to.primary)) {\r\n            return value\r\n                .setConversion(str => {\r\n                    const ret = parseGeometricLiteral(str, to.primary as any);\r\n                    return ret;\r\n                }\r\n                    , castGeo => ({ castGeo, to: to.primary }));\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    doEquals(a: string, b: string) {\r\n        if (this.citext) {\r\n            return a.localeCompare(b, undefined, { sensitivity: 'accent' }) === 0;\r\n        }\r\n\r\n        return super.doEquals(a, b);\r\n    }\r\n}\r\n\r\n\r\n\r\nclass BoolType extends TypeBase<boolean> {\r\n    get primary(): DataType {\r\n        return DataType.bool;\r\n    }\r\n}\r\n\r\nexport class ArrayType extends TypeBase<any[]> {\r\n\r\n    public static matches(type: IType): type is ArrayType {\r\n        return type.primary === DataType.array;\r\n    }\r\n\r\n    get primary(): DataType {\r\n        if (this.list) {\r\n            return DataType.list;\r\n        }\r\n        return DataType.array;\r\n    }\r\n\r\n    get name(): string {\r\n        return this.of.name + '[]';\r\n    }\r\n\r\n\r\n    constructor(readonly of: _IType, private list: boolean) {\r\n        super();\r\n    }\r\n\r\n    doCanCast(to: _IType) {\r\n        if (to instanceof ArrayType) {\r\n            return this.of.canCast(to.of);\r\n        }\r\n        return this.of.canCast(to);\r\n    }\r\n\r\n    doCast(value: Evaluator, _to: _IType) {\r\n        if (_to instanceof ArrayType) {\r\n\r\n            const to = _to as ArrayType;\r\n            const valueType = value.type as ArrayType;\r\n            return new Evaluator(\r\n                to\r\n                , value.id\r\n                , value.hash!\r\n                , value\r\n                , (raw, t) => {\r\n                    const arr = value.get(raw, t) as any[];\r\n                    return arr.map(x => Value.constant(valueType.of, x).cast(to.of).get(raw, t));\r\n                });\r\n        }\r\n        if (_to.primary === DataType.text) {\r\n            return this.toText(_to, value);\r\n        }\r\n        return this.toSingleColumn(_to, value);\r\n    }\r\n\r\n    toText(to: _IType, value: Evaluator) {\r\n        const valueType = value.type as ArrayType;\r\n        const converter = Value.converter(valueType.of, Types.text());\r\n        return new Evaluator(\r\n            to\r\n            , value.id\r\n            , value.hash!\r\n            , value\r\n            , (raw, t) => {\r\n                const arr = value.get(raw, t) as any[];\r\n                const strs = arr.map(x => converter(x, t));\r\n                const data = strs.join(',');\r\n                return this.list\r\n                    ? '(' + data + ')'\r\n                    : '{' + data + '}';\r\n            }, { forceNotConstant: true });\r\n    }\r\n\r\n    toSingleColumn(to: _IType, value: Evaluator) {\r\n        const valueType = value.type as ArrayType;\r\n        const converter = Value.converter(valueType.of, to);\r\n        return new Evaluator(\r\n            to\r\n            , value.id\r\n            , value.hash!\r\n            , value\r\n            , (raw, t) => {\r\n                const arr = value.get(raw, t) as any[];\r\n                return converter(arr[0], t);\r\n            }, { forceNotConstant: true });\r\n    }\r\n\r\n    doEquals(a: any[], b: any[]): boolean {\r\n        if (a.length !== b.length) {\r\n            return false;\r\n        }\r\n        for (let i = 0; i < a.length; i++) {\r\n            if (!this.of.equals(a[i], b[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    doGt(a: any[], b: any[]): boolean {\r\n        const len = Math.min(a.length, b.length);\r\n        for (let i = 0; i < len; i++) {\r\n            if (this.of.gt(a[i], b[i])) {\r\n                return true;\r\n            }\r\n        }\r\n        return a.length > b.length;\r\n    }\r\n\r\n    doLt(a: any[], b: any[]): boolean {\r\n        const len = Math.min(a.length, b.length);\r\n        for (let i = 0; i < len; i++) {\r\n            if (this.of.lt(a[i], b[i])) {\r\n                return true;\r\n            }\r\n        }\r\n        return a.length < b.length;\r\n    }\r\n\r\n    convertLiteral(elts: any) {\r\n        if (nullIsh(elts)) {\r\n            return;\r\n        }\r\n        if (!Array.isArray(elts)) {\r\n            throw new QueryError('Array depth mismatch: was expecting an array item.');\r\n        }\r\n        if (this.of instanceof ArrayType) {\r\n            for (let i = 0; i < elts.length; i++) {\r\n                this.of.convertLiteral(elts[i]);\r\n            }\r\n        } else {\r\n            for (let i = 0; i < elts.length; i++) {\r\n                if (Array.isArray(elts[i])) {\r\n                    throw new QueryError('Array depth mismatch: was not expecting an array item.');\r\n                }\r\n                elts[i] = Value.text(elts[i])\r\n                    .cast(this.of)\r\n                    .get();\r\n            }\r\n        }\r\n        return elts;\r\n    }\r\n}\r\n\r\nexport interface RecordCol {\r\n    readonly name: string;\r\n    readonly type: _IType;\r\n}\r\n\r\n/** Basic types */\r\nexport const Types = {\r\n    [DataType.record]: (columns: RecordCol[]) => new RecordType(columns) as _IType,\r\n    [DataType.bool]: new BoolType() as _IType,\r\n    [DataType.text]: (len: number | nil = null) => makeText(len) as _IType,\r\n    [DataType.citext]: new TextType(null, true),\r\n    [DataType.timestamp]: (len: number | nil = null) => makeTimestamp(DataType.timestamp, len) as _IType,\r\n    [DataType.timestamptz]: (len: number | nil = null) => makeTimestamp(DataType.timestamptz, len) as _IType,\r\n    [DataType.uuid]: new UUIDtype() as _IType,\r\n    [DataType.date]: new TimestampType(DataType.date) as _IType,\r\n    [DataType.interval]: new IntervalType() as _IType,\r\n    [DataType.time]: new TimeType(DataType.time) as _IType,\r\n    [DataType.timetz]: new TimeType(DataType.timetz) as _IType,\r\n    [DataType.jsonb]: new JSONBType(DataType.jsonb) as _IType,\r\n    [DataType.regtype]: new RegTypeImpl() as _IType,\r\n    [DataType.regclass]: new RegClassImpl() as _IType,\r\n    [DataType.json]: new JSONBType(DataType.json) as _IType,\r\n    [DataType.null]: new NullType() as _IType,\r\n    [DataType.float]: new NumberType(DataType.float) as _IType,\r\n    [DataType.integer]: new NumberType(DataType.integer) as _IType,\r\n    [DataType.bigint]: new NumberType(DataType.bigint) as _IType,\r\n    [DataType.bytea]: new ByteArrayType() as _IType,\r\n    [DataType.point]: new PointType() as _IType,\r\n    [DataType.line]: new LineType() as _IType,\r\n    [DataType.lseg]: new LsegType() as _IType,\r\n    [DataType.box]: new BoxType() as _IType,\r\n    [DataType.inet]: new INetType() as _IType,\r\n    [DataType.path]: new PathType() as _IType,\r\n    [DataType.polygon]: new PolygonType() as _IType,\r\n    [DataType.circle]: new CircleType() as _IType,\r\n    default: new DefaultType() as _IType,\r\n}\r\n\r\nexport const dateTypes: ReadonlySet<DataType> = new Set([\r\n    DataType.timestamp\r\n    , DataType.timestamptz\r\n    , DataType.date\r\n    , DataType.time\r\n]);\r\n\r\nexport function isDateType(_type: _IType | DataType) {\r\n    const t = typeof _type === 'string' ? _type : _type.primary;\r\n    return dateTypes.has(t);\r\n}\r\n\r\nexport function isGeometric(dt: DataType) {\r\n    switch (dt) {\r\n        case DataType.point:\r\n        case DataType.line:\r\n        case DataType.lseg:\r\n        case DataType.box:\r\n        case DataType.path:\r\n        case DataType.polygon:\r\n        case DataType.circle:\r\n            return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nconst texts = new Map<number | null, _IType>();\r\nfunction makeText(len: number | nil = null) {\r\n    len = len ?? null;\r\n    let got = texts.get(len);\r\n    if (!got) {\r\n        texts.set(len, got = new TextType(len));\r\n    }\r\n    return got;\r\n}\r\n\r\nconst timestamps = new Map<string, _IType>();\r\nfunction makeTimestamp(primary: DataType, len: number | nil = null) {\r\n    len = len ?? null;\r\n    const key = primary + '/' + len;\r\n    let got = timestamps.get(key);\r\n    if (!got) {\r\n        timestamps.set(key, got = new TimestampType(primary, len));\r\n    }\r\n    return got;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport const typeSynonyms: { [key: string]: DataType } = {\r\n    'varchar': DataType.text,\r\n    'char': DataType.text,\r\n    'character': DataType.text,\r\n    'character varying': DataType.text,\r\n\r\n    'int': DataType.integer,\r\n    'int4': DataType.integer,\r\n    'serial': DataType.integer,\r\n    'bigserial': DataType.integer,\r\n    'smallserial': DataType.integer,\r\n    'smallint': DataType.integer,\r\n    'bigint': DataType.integer,\r\n    'oid': DataType.integer,\r\n\r\n    'decimal': DataType.float,\r\n    'float': DataType.float,\r\n    'double precision': DataType.float,\r\n    'numeric': DataType.float,\r\n    'real': DataType.float,\r\n    'money': DataType.float,\r\n\r\n    'timestamp with time zone': DataType.timestamptz,\r\n    'timestamp without time zone': DataType.timestamp,\r\n\r\n    'boolean': DataType.bool,\r\n\r\n    'time with time zone': DataType.timetz,\r\n    'time without time zone': DataType.time,\r\n}\r\n\r\n\r\n/** Finds a common type by implicit conversion */\r\nexport function reconciliateTypes(values: IValue[], nullIfNoMatch?: false): _IType;\r\nexport function reconciliateTypes(values: IValue[], nullIfNoMatch: true): _IType | nil;\r\nexport function reconciliateTypes(values: IValue[], nullIfNoMatch?: boolean): _IType | nil\r\nexport function reconciliateTypes(values: IValue[], nullIfNoMatch?: boolean): _IType | nil {\r\n    // FROM  https://www.postgresql.org/docs/current/typeconv-union-case.html\r\n\r\n    const nonNull = values\r\n        .filter(x => x.type.primary !== DataType.null);\r\n\r\n    if (!nonNull.length) {\r\n        // If all inputs are of type unknown, resolve as type text (the preferred type of the string category). Otherwise, unknown inputs are ignored for the purposes of the remaining rules.\r\n        return Types.text();\r\n    }\r\n\r\n    // If all inputs are of the same type, and it is not unknown, resolve as that type.\r\n    const single = new Set(nonNull\r\n        .map(v => v.type.reg.typeId));\r\n    if (single.size === 1) {\r\n        return nonNull[0].type;\r\n    }\r\n\r\n    return reconciliateTypesRaw(nonNull, nullIfNoMatch);\r\n}\r\n\r\n\r\n\r\n/** Finds a common type by implicit conversion */\r\nfunction reconciliateTypesRaw(values: IValue[], nullIfNoMatch?: false): _IType;\r\nfunction reconciliateTypesRaw(values: IValue[], nullIfNoMatch: true): _IType | nil;\r\nfunction reconciliateTypesRaw(values: IValue[], nullIfNoMatch?: boolean): _IType | nil\r\nfunction reconciliateTypesRaw(values: IValue[], nullIfNoMatch?: boolean): _IType | nil {\r\n    // find the matching type among non constants\r\n    const foundType = values\r\n        .reduce((final, c) => {\r\n            if (c.type === Types.null) {\r\n                return final;\r\n            }\r\n            const pref = final.prefer(c.type);\r\n            if (!pref) {\r\n                throw new CastError(c.type.primary, final.primary, c.id ?? undefined);\r\n            }\r\n            return pref;\r\n        }, Types.null);\r\n\r\n    // check that all constant literals are matching this.\r\n    for (const x of values) {\r\n        if (!x.isConstantLiteral && !x.type.canConvertImplicit(foundType)) {\r\n            if (nullIfNoMatch) {\r\n                return null;\r\n            }\r\n            throw new CastError(x.type.primary, foundType.primary);\r\n        }\r\n    }\r\n\r\n    return foundType;\r\n}\r\n","module.exports = require(\"object-hash\");","module.exports = require(\"immutable\");","module.exports = require(\"moment\");","import { nullIsh } from '../utils';\r\n\r\nexport const JSON_NIL = Symbol('null');\r\nexport const IS_PARTIAL_INDEXING = Symbol('partial_indexing');\r\nexport const SELECT_ALL = Symbol('select *');\r\n\r\n\r\nexport function cleanResults(results: any[]): any {\r\n    // ugly hack to turn jsonb nulls & partial indexed results into actual nulls\r\n    // This will bite me someday ... but please dont judge me, I too try to have a life outside here \r\n    // The sane thing to do would be to refactor things & introduce a DBNULL value in pgmem\r\n    //   since the need of such DBNULL value could arise somehow on another type\r\n    //   see:\r\n    //   - `can select jsonb null` test in nulls.spec.ts\r\n    //   - `executes array multiple index incomplete indexing` test in operators.queries.spec.ts\r\n\r\n    function cleanObj(obj: any) {\r\n        if (!obj || typeof obj !== 'object') {\r\n            return;\r\n        }\r\n        for (const [k, v] of Object.entries(obj)) {\r\n            if (v === JSON_NIL) {\r\n                obj[k] = null;\r\n            } else if (Array.isArray(v)) {\r\n                if ((v as any)[IS_PARTIAL_INDEXING]) {\r\n                    obj[k] = null;\r\n                } else {\r\n                    for (let i = 0; i < v.length; i++) {\r\n                        if (obj[i] === JSON_NIL) {\r\n                            obj[i] = null;\r\n                        } else {\r\n                            cleanObj(v);\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                cleanObj(v);\r\n            }\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < results.length; i++) {\r\n        const sel = results[i][SELECT_ALL];\r\n        if (sel) {\r\n            results[i] = sel();\r\n        }\r\n        cleanObj(results[i]);\r\n    }\r\n    return results;\r\n}","import { DataType, getId, nil, QueryError, _IType, _ISelection, _Transaction, setId } from '../interfaces-private';\r\nimport { TypeBase } from './datatype-base';\r\nimport { RecordCol } from './datatypes';\r\nimport { Evaluator } from '../evaluator';\r\n\r\nexport class RecordType extends TypeBase<any> {\r\n\r\n\r\n    public static matches(type: _IType): type is RecordType {\r\n        return type.primary === DataType.record;\r\n    }\r\n\r\n    constructor(readonly columns: readonly RecordCol[]) {\r\n        super();\r\n    }\r\n\r\n    get primary(): DataType {\r\n        return DataType.record;\r\n    }\r\n\r\n    doEquals(a: any, b: any): boolean {\r\n        return getId(a) === getId(b);\r\n    }\r\n\r\n    public static from(selection: _ISelection): RecordType {\r\n        const recordCols = selection.columns\r\n            .filter(c => !!c.id)\r\n            .map<RecordCol>(x => ({ name: x.id!, type: x.type }));\r\n        return new RecordType(recordCols);\r\n    }\r\n\r\n    /** Build a function that will transform a record of this type to a record of the target type  */\r\n    transformItemFrom(source: _ISelection): ((raw: any, t: _Transaction, execId: string) => any) | null {\r\n        if (source.columns.length !== this.columns.length) {\r\n            return null;\r\n        }\r\n        const setters: ((oldItem: any, newItem: any, t: _Transaction) => any)[] = [];\r\n        for (let i = 0; i < this.columns.length; i++) {\r\n            const to = this.columns[i];\r\n            const from = source.columns[i];\r\n            if (!from.type.canConvertImplicit(to.type)) {\r\n                return null;\r\n            }\r\n            const casted = from.cast(to.type);\r\n            setters.push((old, neu, t) => neu[to.name] = casted.get(old, t));\r\n        }\r\n\r\n        return (raw: any, t, execId) => {\r\n            const ret = {};\r\n            // alter the items id, so each execution will have a different id\r\n            setId(ret, execId + getId(raw));\r\n            for (const s of setters) {\r\n                s(raw, ret, t);\r\n            }\r\n            return ret;\r\n        };\r\n    }\r\n\r\n    doCanCast(to: _IType): boolean | nil {\r\n        // lets say that any type can cast to a record with no columns\r\n        // this is a hack ... see row_to_json() UT\r\n        return to instanceof RecordType && !to.columns.length;\r\n    }\r\n\r\n    doCast(value: Evaluator<any>, to: _IType): Evaluator<any> | nil {\r\n        return value;\r\n    }\r\n}\r\n","import { DataSourceBase } from '../../transforms/transform-base';\r\nimport { ArrayFilter } from '../../transforms/array-filter';\r\nimport { cleanResults } from '../clean-results';\r\nimport { _ISelection, _ISchema, _ITable, _Transaction, IValue, _IIndex, _Explainer, _IStatement } from '../../interfaces-private';\r\nimport { InsertStatement, UpdateStatement, DeleteStatement, SetStatement, ExprRef } from 'pgsql-ast-parser';\r\nimport { buildSelection } from '../../transforms/selection';\r\nimport { MemoryTable } from '../../table';\r\nimport { buildValue } from '../../parser/expression-builder';\r\nimport { withSelection, buildCtx } from '../../parser/context';\r\nimport { colToStr } from '../../utils';\r\n\r\ntype MutationStatement = InsertStatement | UpdateStatement | DeleteStatement;\r\n\r\n\r\nexport abstract class MutationDataSourceBase<T> extends DataSourceBase<T> {\r\n    public static readonly affectedRows = Symbol('affectedRows');\r\n\r\n    /** Perform the mutation, and returns the affected elements */\r\n    protected abstract performMutation(t: _Transaction): T[];\r\n\r\n    private returningRows?: ArrayFilter;\r\n    private returning?: _ISelection;\r\n    private mutationResult = Symbol('mutationResult');\r\n\r\n    get isExecutionWithNoResult(): boolean {\r\n        return !this.returning;\r\n    }\r\n\r\n    isAggregation() {\r\n        return false;\r\n    }\r\n\r\n    get columns() {\r\n        return this.returning?.columns ?? [];\r\n    }\r\n\r\n    constructor(protected table: _ITable, protected mutatedSel: _ISelection, p: MutationStatement) {\r\n        super(table.ownerSchema);\r\n\r\n        // prepare \"returning\" statement\r\n        if (p.returning) {\r\n            this.returningRows = new ArrayFilter(this.mutatedSel, [])\r\n            this.returning = buildSelection(this.returningRows, p.returning);\r\n        }\r\n\r\n        const { onFinishExecution } = buildCtx();\r\n        // force execution if it has not yet been executed once the current statement finishes its execution.\r\n        // see \"only inserts once with statement is executed\" test\r\n        onFinishExecution(t => {\r\n            this._doExecuteOnce(t);\r\n        });\r\n    }\r\n\r\n    private _doExecuteOnce(t: _Transaction): any[] {\r\n        // check if this mutation has already been executed in the statement being executed\r\n        // and get the result from cache to avoid re-excuting it\r\n        // see unit test \"can use delete result multiple times in select\"\r\n        let affected = t.getTransient<T[]>(this.mutationResult);\r\n        if (!affected) {\r\n            // execute mutation if nescessary\r\n            affected = this.performMutation(t);\r\n            t.setTransient(this.mutationResult, affected);\r\n        }\r\n\r\n\r\n        // set the result count\r\n        t.setTransient(MutationDataSourceBase.affectedRows, affected.length);\r\n        return affected;\r\n    }\r\n\r\n    *enumerate(t: _Transaction): Iterable<any> {\r\n\r\n        const affected = this._doExecuteOnce(t);\r\n\r\n        if (!this.returning) {\r\n            return;\r\n        }\r\n\r\n        // handle \"returning\" statement\r\n        try {\r\n            cleanResults(affected);\r\n            this.returningRows!.rows = affected;\r\n            yield* this.returning.enumerate(t);\r\n        } finally {\r\n            this.returningRows!.rows = []\r\n        }\r\n    }\r\n\r\n    entropy(t: _Transaction): number {\r\n        // To ensure that a muation will always be prioritary\r\n        //  on a join, then just return 0.\r\n        return 0;\r\n    }\r\n\r\n    getColumn(column: string | ExprRef, nullIfNotFound?: boolean | undefined): IValue<any> {\r\n        if (!this.returning) {\r\n            throw new Error(`Cannot get column \"${colToStr(column)}\" from a mutation that has no returning statement`);\r\n        }\r\n        return this.returning.getColumn(column, nullIfNotFound)!;\r\n    }\r\n\r\n    hasItem(value: any, t: _Transaction): boolean {\r\n        throw new Error('To fix: Joins cannot call hasItem on a mutation');\r\n    }\r\n\r\n    getIndex(forValue: IValue<any>): _IIndex<any> | null | undefined {\r\n        return null;\r\n    }\r\n\r\n    explain(e: _Explainer): never {\r\n        throw new Error('not implemented');\r\n    }\r\n\r\n    isOriginOf(a: IValue<any>): boolean {\r\n        return !!this.returning && a.origin === this.returning;\r\n    }\r\n\r\n    stats(t: _Transaction): null {\r\n        return null;\r\n    }\r\n}\r\n\r\n\r\nexport type Setter = (t: _Transaction, target: any, source: any) => void;\r\nexport function createSetter(this: void, setTable: _ITable, setSelection: _ISelection, _sets: SetStatement[]): Setter {\r\n    return withSelection(setSelection, () => {\r\n        const sets = _sets.map(x => {\r\n            const col = (setTable as MemoryTable).getColumnRef(x.column.name);\r\n            return {\r\n                col,\r\n                value: x.value,\r\n                getter: x.value.type !== 'default'\r\n                    ? buildValue(x.value).cast(col.expression.type)\r\n                    : null,\r\n            };\r\n        });\r\n\r\n        return (t: _Transaction, target: any, source: any) => {\r\n            for (const s of sets) {\r\n                if (s.value.type === 'default') {\r\n                    target[s.col.expression.id!] = s.col.default?.get() ?? undefined;\r\n                } else {\r\n                    target[s.col.expression.id!] = s.getter?.get(source, t) ?? null;\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n","export type TBuffer = Buffer;\r\n\r\n\r\nexport function bufToString(buf: TBuffer): string {\r\n    return buf?.toString('utf-8');\r\n}\r\n\r\nexport function bufCompare(a: TBuffer, b: TBuffer) {\r\n    return Buffer.compare(a, b);\r\n}\r\n\r\nexport function bufFromString(str: string) {\r\n    return Buffer.from(str);\r\n}\r\n\r\nexport function isBuf(v: any): v is TBuffer {\r\n    return Buffer.isBuffer(v);\r\n}\r\n\r\nexport function bufClone(buf: TBuffer): TBuffer {\r\n    const bufcopy = Buffer.alloc(buf.length);\r\n    buf.copy(bufcopy);\r\n    return bufcopy;\r\n}","module.exports = require(\"lru-cache\");","import { TransformBase } from './transform-base';\r\nimport { _ISelection, _Transaction, IValue, _IIndex, _Explainer, _SelectExplanation, _IType, IndexKey, _ITable, Stats, AggregationComputer, AggregationGroupComputer, setId, _IAggregation } from '../interfaces-private';\r\nimport { Expr, ExprRef, ExprCall } from 'pgsql-ast-parser';\r\nimport { buildValue } from '../parser/expression-builder';\r\nimport { nil, NotSupported } from '../interfaces';\r\nimport hash from 'object-hash';\r\nimport { Evaluator } from '../evaluator';\r\nimport { buildCount } from './aggregations/count';\r\nimport { buildMinMax } from './aggregations/max-min';\r\nimport { buildSum } from './aggregations/sum';\r\nimport { buildArrayAgg } from './aggregations/array_agg';\r\nimport { buildAvg } from './aggregations/avg';\r\nimport { Selection } from './selection';\r\nimport { buildCtx, withSelection } from '../parser/context';\r\nimport { buildJsonAgg } from './aggregations/json_aggs';\r\nimport { nullIsh } from '../utils';\r\nimport { buildBoolAgg } from './aggregations/bool-aggregs';\r\n\r\nexport const aggregationFunctions = new Set([\r\n    'array_agg',\r\n    'avg',\r\n    'bit_and',\r\n    'bit_or',\r\n    'bool_and',\r\n    'bool_or',\r\n    'count',\r\n    'every',\r\n    'json_agg',\r\n    'jsonb_agg',\r\n    'json_object_agg',\r\n    'jsonb_object_agg',\r\n    'max',\r\n    'min',\r\n    'string_agg',\r\n    'sum',\r\n    'xmlagg',\r\n])\r\n\r\nexport function buildGroupBy(on: _ISelection, groupBy: Expr[]) {\r\n    const agg = new Aggregation(on, groupBy);\r\n    return agg;\r\n}\r\n\r\nlet idCnt = 0;\r\n\r\nexport function getAggregator(): _IAggregation | null {\r\n    const on = buildCtx().selection;\r\n    if (!on) {\r\n        return null;\r\n    }\r\n    if (on.isAggregation()) {\r\n        return on;\r\n    }\r\n    if (!(on instanceof Selection)) {\r\n        return null;\r\n    }\r\n    if (!(on.base.isAggregation())) {\r\n        return null;\r\n    }\r\n    return on.base;\r\n}\r\n\r\ntype AggregItem = any;\r\n\r\ninterface AggregationInstance {\r\n    getter: IValue;\r\n    id: symbol;\r\n    computer: AggregationComputer;\r\n    distinct: IValue[] | nil;\r\n}\r\n\r\nfunction isIntegralType(value: any): boolean {\r\n    return typeof value === 'number' || typeof value === 'string' || value instanceof Date;\r\n}\r\n\r\nexport class Aggregation<T> extends TransformBase<T> implements _ISelection<T>, _IAggregation {\r\n\r\n    columns: readonly IValue<any>[];\r\n    /**\r\n     * Group-by values\r\n     * - key: column in source hash\r\n     * - value: column in this, evaluated against temporary entity.\r\n     **/\r\n    private readonly symbol = Symbol();\r\n    private readonly aggId = idCnt++;\r\n    private readonly groupIndex?: _IIndex<any> | nil;\r\n    private aggregations = new Map<string, AggregationInstance>();\r\n\r\n    /** How to get grouping values on the base table raw items (not on \"this.enumerate()\" raw items)  */\r\n    private groupingValuesOnbase: IValue[];\r\n\r\n    /** How to get the grouped values on \"this.enumerate()\" raw items output */\r\n    private groupByMapping = new Map<string, IValue>();\r\n\r\n    isAggregation() {\r\n        return true;\r\n    }\r\n\r\n    constructor(on: _ISelection, _groupedBy: Expr[]) {\r\n        super(on);\r\n\r\n\r\n        // === preassign columns that are reachable (grouped by)\r\n        this.groupingValuesOnbase = withSelection(on, () => _groupedBy.map(x => buildValue(x)));\r\n        for (let _i = 0; _i < this.groupingValuesOnbase.length; _i++) {\r\n            const i = _i;\r\n            const g = this.groupingValuesOnbase[i];\r\n            this.groupByMapping.set(g.hash!, new Evaluator(\r\n                g.type\r\n                , g.id\r\n                , g.hash!\r\n                , [g]\r\n                // keys are stored wrapped in a symbol (because not necessarily selected)\r\n                , v => v[this.symbol][i]\r\n            ));\r\n        }\r\n\r\n        // try to find an index matching our groupby clause\r\n        this.groupIndex = on.getIndex(...this.groupingValuesOnbase);\r\n        this.columns = [];\r\n    }\r\n\r\n    getColumn(column: string | ExprRef): IValue;\r\n    getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue | nil;\r\n    getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue<any> | nil {\r\n        return this.base.getColumn(column, nullIfNotFound);\r\n    }\r\n\r\n    checkIfIsKey(got: IValue<any>): IValue<any> {\r\n        return this.groupByMapping.get(got.hash!) ?? got;\r\n    }\r\n\r\n\r\n    entropy(t: _Transaction): number {\r\n        return this.groupByMapping.size || 1;\r\n    }\r\n\r\n    stats(): Stats | null {\r\n        // cannot be computed without iterating\r\n        return null;\r\n    }\r\n\r\n    *enumerate(t: _Transaction): Iterable<T> {\r\n        for (const item of this._enumerateAggregationKeys(t)) {\r\n            const sym = item[this.symbol];\r\n            setId(item, `agg_${this.aggId}_${hash(sym)}`)\r\n            yield item as any;\r\n        }\r\n    }\r\n\r\n    private _enumerateAggregationKeys(t: _Transaction): Iterable<AggregItem> {\r\n        // ===== try to compute directly (will only succeed when no grouping, and simple statements like count(*))\r\n        const ret = this.computeDirect(t);\r\n        if (ret) {\r\n            return [ret];\r\n        }\r\n\r\n        // ===== try to compute base on index\r\n        const fromIndex = this.iterateFromIndex(t);\r\n        if (fromIndex) {\r\n            return fromIndex;\r\n        }\r\n\r\n        // ==== seq-scan computation\r\n        return this.seqScan(t);\r\n    }\r\n\r\n    private iterateFromIndex(t: _Transaction): AggregItem[] | null {\r\n        if (!this.groupIndex) {\r\n            return null;\r\n        }\r\n        const aggs = [...this.aggregations.values()];\r\n        const allByGroup = !aggs.some(x => !x.computer.computeFromIndex);\r\n\r\n        if (!allByGroup) {\r\n            return null;\r\n        }\r\n\r\n        const indexKeys = this.groupIndex.iterateKeys(t);\r\n        if (!indexKeys) {\r\n            return null;\r\n        }\r\n\r\n        // iterate all index keys\r\n        const computed: AggregItem[] = []\r\n        for (const k of indexKeys) {\r\n            const ret: any = { [this.symbol]: k };\r\n            // try to compute from index\r\n            for (const agg of aggs) {\r\n                const val = agg.computer.computeFromIndex?.(k, this.groupIndex, t);\r\n                if (typeof val === 'undefined') {\r\n                    if (computed.length) {\r\n                        throw new Error('Compute from index has succeeded on an index key, but failed on another (which must not happen)');\r\n                    }\r\n                    return null;\r\n                }\r\n                ret[agg.id] = val;\r\n            }\r\n            computed.push(ret);\r\n        }\r\n        return computed;\r\n    }\r\n\r\n\r\n    private *seqScan(t: _Transaction): Iterable<AggregItem> {\r\n        const aggs = [...this.aggregations.values()];\r\n        const groups = new Map<string, {\r\n            key: IndexKey;\r\n            aggs: {\r\n                computer: AggregationGroupComputer;\r\n                distinctHash: Set<any>;\r\n                instance: AggregationInstance,\r\n            }[];\r\n        }>();\r\n\r\n        // === feed all items\r\n        for (const item of this.base.enumerate(t)) {\r\n            // get group-by values\r\n            const key: IndexKey = this.groupingValuesOnbase.map(g => g.get(item, t));\r\n\r\n            // add group if necessary\r\n            const groupingKey = hash(key);\r\n            let group = groups.get(groupingKey);\r\n            if (!group) {\r\n                groups.set(groupingKey, group = {\r\n                    key,\r\n                    aggs: aggs.map(x => ({\r\n                        computer: x.computer.createGroup(t),\r\n                        instance: x,\r\n                        distinctHash: new Set(),\r\n                    })),\r\n                });\r\n            }\r\n\r\n            // process aggregators in group\r\n            for (const g of group.aggs) {\r\n                if (!g.computer) {\r\n                    continue;\r\n                }\r\n                if (g.instance.distinct) {\r\n                    const distinctValues = g.instance.distinct.map(x => x.get(item, t));\r\n                    if (distinctValues.length === 1 && nullIsh(distinctValues[0])) {\r\n                        // ignore single nulls.\r\n                        continue;\r\n                    }\r\n                    let valuesHash: any;\r\n                    if (distinctValues.length === 1 && isIntegralType(distinctValues[0])) {\r\n                        // optimization to avoid hashing on objects supported by \"Set\"\r\n                        valuesHash = distinctValues[0];\r\n                    } else {\r\n                        valuesHash = hash(distinctValues);\r\n                    }\r\n                    if (g.distinctHash.has(valuesHash)) {\r\n                        continue;\r\n                    }\r\n                    g.distinctHash.add(valuesHash);\r\n                }\r\n                g.computer.feedItem(item);\r\n            }\r\n        }\r\n\r\n        // if this.base is empty, and this is not a group by...\r\n        //   Must return a result.\r\n        //   ex:\r\n        //      - select max(a) from empty               [{max: null}]\r\n        //      - select max(a) from empty group by id   []\r\n        if (groups.size === 0 && !this.groupingValuesOnbase.length) {\r\n            const key: IndexKey = [];\r\n            const groupingKey = hash(key);\r\n            groups.set(groupingKey, {\r\n                key,\r\n                aggs: aggs.map(x => ({\r\n                    computer: x.computer.createGroup(t),\r\n                    instance: x,\r\n                    distinctHash: new Set(),\r\n                })),\r\n            });\r\n        }\r\n\r\n        // === return results\r\n        for (const g of groups.values()) {\r\n            const ret: AggregItem = {\r\n                // specify the grouping key\r\n                [this.symbol]: g.key\r\n            };\r\n\r\n            // fill aggregations values\r\n            for (const { instance: { id }, computer } of g.aggs) {\r\n                ret[id] = computer.finish() ?? null;\r\n            }\r\n            yield ret;\r\n        }\r\n    }\r\n\r\n    private computeDirect(t: _Transaction): AggregItem | null {\r\n        // When there is no grouping...\r\n        if (this.groupByMapping.size) {\r\n            return null;\r\n        }\r\n        // check if all selected aggregations can be computed directly (typically: count(*))\r\n        const aggs = [...this.aggregations.values()];\r\n        const allNoGroup = !aggs.some(x => !x.computer.computeNoGroup);\r\n        if (!allNoGroup) {\r\n            return null;\r\n        }\r\n        const ret: AggregItem = {\r\n            [this.symbol]: [],\r\n        };\r\n        for (const agg of this.aggregations.values()) {\r\n            const val = agg.computer.computeNoGroup?.(t);\r\n            if (typeof val === 'undefined') {\r\n                return null;\r\n            }\r\n            ret[agg.id] = val;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    getAggregation(name: string, call: ExprCall): IValue {\r\n        const hashed = hash(call);\r\n        const agg = this.aggregations.get(hashed);\r\n        if (agg) {\r\n            return agg.getter;\r\n        }\r\n        const got = this._getAggregation(name, call);\r\n\r\n        const id = Symbol(name);\r\n        const getter = new Evaluator(\r\n            got.type\r\n            , null\r\n            , hashed\r\n            , []\r\n            , raw => raw[id]\r\n            , {\r\n                forceNotConstant: true,\r\n            });\r\n\r\n        let distinct: IValue[] | null = null;\r\n        if (call.distinct === 'distinct') {\r\n            if (call.args.length === 1 && call.args[0].type === 'list') {\r\n                // hack in case we get a record-like thing - ex: select count(distinct (a,b))\r\n                // cf UT behaves nicely with nulls on multiple count\r\n                distinct = call.args[0].expressions.map(x => buildValue(x));\r\n            } else {\r\n                distinct = call.args.map(x => buildValue(x));\r\n            }\r\n        }\r\n\r\n        this.aggregations.set(hashed, {\r\n            id,\r\n            getter,\r\n            computer: got,\r\n            distinct,\r\n        });\r\n        return getter;\r\n    }\r\n\r\n    private _getAggregation(name: string, call: ExprCall): AggregationComputer {\r\n        switch (name) {\r\n            case 'count':\r\n                return buildCount(this.base, call);\r\n            case 'max':\r\n            case 'min':\r\n                return buildMinMax(this.base, call.args, name);\r\n            case 'sum':\r\n                return buildSum(this.base, call);\r\n            case 'array_agg':\r\n                return buildArrayAgg(this.base, call);\r\n            case 'avg':\r\n                return buildAvg(this.base, call);\r\n            case 'jsonb_agg':\r\n            case 'json_agg':\r\n                return buildJsonAgg(this.base, call, name);\r\n            case 'bool_and':\r\n            case 'bool_or':\r\n                return buildBoolAgg(this.base, call, name);\r\n            default:\r\n                throw new NotSupported('aggregation function ' + name);\r\n        }\r\n    }\r\n\r\n\r\n    hasItem(value: T, t: _Transaction): boolean {\r\n        return !!(value as any)[this.symbol];\r\n    }\r\n\r\n    getIndex(forValue: IValue<any>): _IIndex<any> | nil {\r\n        // there is no index on aggregations\r\n        return null;\r\n    }\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            _: 'aggregate',\r\n            id: e.idFor(this),\r\n            aggregator: null as any,\r\n        }\r\n    }\r\n\r\n}\r\n","import { _ISelection, IValue, _IIndex, _IDb, setId, getId, _Transaction, _ISchema, _SelectExplanation, _Explainer, IndexExpression, IndexOp, IndexKey, _IndexExplanation, Stats, _IAlias, TR, _IStatement } from '../interfaces-private';\r\nimport { buildBinaryValue, buildValue, uncache } from '../parser/expression-builder';\r\nimport { QueryError, ColumnNotFound, NotSupported, nil, DataType } from '../interfaces';\r\nimport { DataSourceBase, TransformBase } from './transform-base';\r\nimport { Expr, ExprRef, JoinClause, Name, SelectedColumn } from 'pgsql-ast-parser';\r\nimport { colToStr, nullIsh, SRecord } from '../utils';\r\nimport { Types } from '../datatypes';\r\nimport { SELECT_ALL } from '../execution/clean-results';\r\nimport { CustomAlias, Selection } from './selection';\r\nimport { withSelection, buildCtx } from '../parser/context';\r\n\r\nlet jCnt = 0;\r\n\r\ninterface JoinRaw<TLeft, TRight> {\r\n    '>restrictive': TLeft;\r\n    '>joined': TRight;\r\n}\r\ninterface JoinStrategy {\r\n    iterate: _ISelection;\r\n    iterateSide: 'joined' | 'restrictive';\r\n    joinIndex: _IIndex<any>;\r\n    onValue: IValue;\r\n    othersPredicate?: IValue<any>;\r\n}\r\n\r\ninterface Equality {\r\n    left: IValue;\r\n    right: IValue;\r\n    eq: IValue;\r\n}\r\n\r\nfunction* extractAnds(this: void, on: Expr): Iterable<Expr> {\r\n    if (on.type === 'binary' && on.op === 'AND') {\r\n        yield* extractAnds(on.left);\r\n        yield* extractAnds(on.right);\r\n        return;\r\n    }\r\n    yield on;\r\n}\r\n\r\nfunction chooseStrategy(this: void, t: _Transaction, strategies: JoinStrategy[]) {\r\n    strategies.sort((a, b) => a.iterate.entropy(t) > b.iterate.entropy(t) ? 1 : -1);\r\n    return strategies[0];\r\n}\r\n\r\nexport class JoinSelection<TLeft = any, TRight = any> extends DataSourceBase<JoinRaw<TLeft, TRight>> {\r\n\r\n    get isExecutionWithNoResult(): boolean {\r\n        return false;\r\n    }\r\n\r\n    private _columns: IValue<any>[] = [];\r\n    private seqScanExpression!: IValue<any>;\r\n    private joinId: number;\r\n    private columnsMappingParentToThis = new Map<IValue, IValue>();\r\n    private columnsMappingThisToParent = new Map<IValue, {\r\n        side: 'joined' | 'restrictive';\r\n        col: IValue;\r\n    }>();\r\n    private indexCache = new Map<IValue, _IIndex>();\r\n    strategies: JoinStrategy[] = [];\r\n    private building = false;\r\n    private ignoreDupes?: Set<IValue>;\r\n    private mergeSelect?: Selection;\r\n\r\n\r\n    isOriginOf(a: IValue<any>): boolean {\r\n        return this.joined.isOriginOf(a) || this.restrictive.isOriginOf(a);\r\n    }\r\n\r\n    get columns(): IValue<any>[] {\r\n        return this._columns;\r\n    }\r\n\r\n    entropy(t: _Transaction): number {\r\n        const strategy = chooseStrategy(t, this.strategies);\r\n        if (!strategy) {\r\n            // catastophic join... very high entropy...\r\n            return this.restrictive.entropy(t) * this.joined.entropy(t);\r\n        }\r\n\r\n        // todo: multiply that by the mean count per keys in strategy.joinIndex ?\r\n        const ret = strategy.iterate.entropy(t);\r\n        return ret;\r\n    }\r\n\r\n    constructor(readonly restrictive: _ISelection<TLeft>\r\n        , readonly joined: _ISelection<TRight>\r\n        , on: JoinClause\r\n        , private innerJoin: boolean) {\r\n        super(buildCtx().schema);\r\n\r\n\r\n        this.joinId = jCnt++;\r\n        for (const c of this.restrictive.listSelectableIdentities()) {\r\n            const nc = c.setWrapper(this, x => (x as any)['>restrictive']);\r\n            this.columnsMappingParentToThis.set(c, nc);\r\n            if (c.type.primary === DataType.record) {\r\n                continue;\r\n            }\r\n            this._columns.push(nc);\r\n            this.columnsMappingThisToParent.set(nc, {\r\n                col: c,\r\n                side: 'restrictive'\r\n            });\r\n        }\r\n        for (const c of this.joined.listSelectableIdentities()) {\r\n            const nc = c.setWrapper(this, x => (x as any)['>joined']);\r\n            this.columnsMappingParentToThis.set(c, nc);\r\n            if (c.type.primary === DataType.record) {\r\n                continue;\r\n            }\r\n            this._columns.push(nc);\r\n            this.columnsMappingThisToParent.set(nc, {\r\n                col: c,\r\n                side: 'joined',\r\n            });\r\n        }\r\n\r\n        withSelection(this, () => {\r\n            if (on.on) {\r\n                this.fetchOnStrategies(on.on);\r\n            } else if (on.using?.length) {\r\n                this.fetchUsingStrategies(on.using);\r\n            } else {\r\n                throw new Error('Unspecified join ON clause');\r\n            }\r\n        });\r\n    }\r\n\r\n    private wrap(v: IValue) {\r\n        const ret = this.columnsMappingParentToThis.get(v);\r\n        if (!ret) {\r\n            throw new Error('Corrupted join (unknown column)');\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    listSelectableIdentities(): Iterable<IValue> {\r\n        return this.columnsMappingParentToThis.values();\r\n    }\r\n\r\n    private fetchOnStrategies(_on: Expr) {\r\n        // build equalities eligible to a strategy\r\n        const ands: Equality[] = [];\r\n        const others: IValue[] = [];\r\n        for (const on of extractAnds(_on)) {\r\n            if (on.type !== 'binary' || on.op !== '=') {\r\n                // join 'ON' clause not compatible with an indexed strategy\r\n                others.push(buildValue(on));\r\n                continue;\r\n            }\r\n            this.building = true;\r\n            const left = buildValue(on.left);\r\n            const right = buildValue(on.right);\r\n            this.building = false;\r\n            // necessary because of the 'this.building' hack\r\n            uncache(this);\r\n            ands.push({\r\n                left,\r\n                right,\r\n                eq: buildValue(on),\r\n            });\r\n        }\r\n\r\n        // compute strategies\r\n        this.fetchAndStrategies(ands, others);\r\n\r\n\r\n        // build seq-scan expression\r\n        this.seqScanExpression = buildValue(_on).cast(Types.bool);\r\n    }\r\n\r\n    private fetchUsingStrategies(_using: Name[]) {\r\n        // build equalities eligible to a strategy\r\n        const ands = _using.map<Equality>(n => {\r\n            const left = this.restrictive.getColumn(n.name);\r\n            const right = this.joined.getColumn(n.name);\r\n            return {\r\n                left,\r\n                right,\r\n                eq: buildBinaryValue(\r\n                    this.wrap(left)\r\n                    , '='\r\n                    , this.wrap(right))\r\n            }\r\n        });\r\n        this.ignoreDupes = new Set(ands.map(x => this.wrap(x.left)));\r\n\r\n        // compute strategies\r\n        this.fetchAndStrategies(ands, []);\r\n\r\n        // build seq-scan expression\r\n        this.seqScanExpression = ands.slice(1)\r\n            .reduce((a, b) => buildBinaryValue(a, 'AND', b.eq), ands[0].eq);\r\n    }\r\n\r\n    private fetchAndStrategies(ands: Equality[], otherPredicates: IValue[]) {\r\n\r\n        for (let i = 0; i < ands.length; i++) {\r\n            const { left, right } = ands[i];\r\n            const strats = [...this.fetchEqStrategyOn(left, right)];\r\n            if (!strats.length) {\r\n                continue;\r\n            }\r\n            const others = [\r\n                ...ands.slice(0, i).map(x => x.eq),\r\n                ...ands.slice(i + 1).map(x => x.eq),\r\n                ...otherPredicates\r\n            ];\r\n            if (others.length) {\r\n                const and = others.slice(1)\r\n                    .reduce<IValue>((v, c) => buildBinaryValue(c, 'AND', v)\r\n                        , others[0]);\r\n                for (const s of strats) {\r\n                    s.othersPredicate = and;\r\n                }\r\n            }\r\n            this.strategies.push(...strats);\r\n        }\r\n    }\r\n\r\n    private *fetchEqStrategyOn(a: IValue, b: IValue): Iterable<JoinStrategy> {\r\n        let restrictedVal: IValue | undefined = undefined;\r\n        let joinedVal: IValue | undefined = undefined;\r\n\r\n        // const aIndex = a.wrappedOrigin?.getIndex()\r\n        if (this.restrictive.isOriginOf(a) && this.joined.isOriginOf(b)) {\r\n            restrictedVal = a;\r\n            joinedVal = b;\r\n        } else if (this.restrictive.isOriginOf(b) && this.joined.isOriginOf(a)) {\r\n            restrictedVal = b;\r\n            joinedVal = a;\r\n        }\r\n\r\n        let processInner = this.innerJoin;\r\n        let iterateSide: 'restrictive' | 'joined' = 'restrictive'\r\n        while (restrictedVal && joinedVal) {\r\n            // can always iterat on restricted value & use joined table foreign index\r\n            const jindex = joinedVal.index;\r\n            if (jindex && jindex.expressions.length === 1) {\r\n                yield {\r\n                    iterate: iterateSide === 'restrictive' ? this.restrictive : this.joined,\r\n                    iterateSide,\r\n                    onValue: restrictedVal,\r\n                    joinIndex: jindex,\r\n                }\r\n            }\r\n            if (!processInner) {\r\n                break;\r\n            }\r\n            // if is an inner join, then both sides can be interverted\r\n            processInner = false;\r\n            const t = restrictedVal;\r\n            restrictedVal = joinedVal;\r\n            joinedVal = t;\r\n            iterateSide = 'joined';\r\n        }\r\n    }\r\n\r\n    getColumn(column: string | ExprRef): IValue;\r\n    getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue | nil;\r\n    getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue<any> | nil {\r\n        let onLeft = this.restrictive.getColumn(column, true);\r\n        let onRight = this.joined.getColumn(column, true);\r\n        if (!onLeft && !onRight) {\r\n            if (nullIfNotFound) {\r\n                return null;\r\n            }\r\n            throw new ColumnNotFound(colToStr(column));\r\n        }\r\n        if (!!onLeft && !!onRight) {\r\n            throw new QueryError(`column reference \"${colToStr(column)}\" is ambiguous`);\r\n        }\r\n        const on = onLeft ?? onRight;\r\n        if (this.building) {\r\n            return on;\r\n        }\r\n        const mapped = this.columnsMappingParentToThis.get(on!);\r\n        if (mapped) {\r\n            return mapped;\r\n        }\r\n        throw new Error('Corrupted join');\r\n    }\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return null;\r\n    }\r\n\r\n    *enumerate(t: _Transaction): Iterable<any> {\r\n        const strategy = chooseStrategy(t, this.strategies);\r\n        if (strategy) {\r\n            // choose the iterator that has less values\r\n            // find the right value using index\r\n            for (const l of strategy.iterate.enumerate(t)) {\r\n                yield* this.iterateStrategyItem(l, strategy, t);\r\n            }\r\n        } else {\r\n            // perform a seq scan\r\n            this.db.raiseGlobal('catastrophic-join-optimization');\r\n            const others = [...this.joined.enumerate(t)];\r\n            for (const l of this.restrictive.enumerate(t)) {\r\n                yield* this.iterateCatastrophicItem(l, others, 'restrictive', t);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    selectAlias(alias: string): _IAlias | nil {\r\n        let onLeft = this.restrictive.selectAlias(alias);\r\n        let onRight = this.joined.selectAlias(alias);\r\n        if (!onLeft && !onRight) {\r\n            return null;\r\n        }\r\n        if (!!onLeft && !!onRight) {\r\n            throw new QueryError(`alias \"${alias}\" is ambiguous`);\r\n        }\r\n        return new JoinMapAlias(this, onLeft ?? onRight!, onLeft ? '>restrictive' : '>joined');\r\n    }\r\n\r\n    *iterateCatastrophicItem(item: any, others: any[], side: 'joined' | 'restrictive', t: _Transaction) {\r\n        const { template, buildItem } = this.builder(item, side);\r\n        let yielded = false;\r\n        for (const cr of others) {\r\n            const combined = buildItem(cr);\r\n            const result = this.seqScanExpression.get(combined, t);\r\n            if (result) {\r\n                yielded = true;\r\n                yield combined;\r\n            }\r\n        }\r\n        if (!this.innerJoin && !yielded) {\r\n            yield template;\r\n        }\r\n    }\r\n\r\n    private builder(item: any, side: 'joined' | 'restrictive') {\r\n\r\n        // if we're in an inner join, and the chosen strategy\r\n        // has inverted join order, then invert built items\r\n        let template: any;\r\n        let buildItem: (x: any) => any;\r\n        if (side === 'joined') {\r\n            buildItem = x => this.buildItem(x, item);\r\n            template = this.buildItem(null as any, item);\r\n        } else {\r\n            buildItem = x => this.buildItem(item, x);\r\n            template = this.buildItem(item, null as any);\r\n        }\r\n        return { buildItem, template };\r\n    }\r\n\r\n    *iterateStrategyItem(item: any, strategy: JoinStrategy, t: _Transaction) {\r\n\r\n        const { template, buildItem } = this.builder(item, strategy.iterateSide);\r\n\r\n        const joinValue = strategy.onValue.get(item, t);\r\n        let yielded = false;\r\n        if (!nullIsh(joinValue)) {\r\n            // get corresponding right value(s)\r\n            for (const o of strategy.joinIndex.enumerate({\r\n                type: 'eq',\r\n                key: [joinValue],\r\n                t,\r\n            })) {\r\n\r\n                // build item\r\n                const item = buildItem(o);\r\n\r\n                // check othre predicates (in case the join has an AND statement)\r\n                if (strategy.othersPredicate) {\r\n                    const others = strategy.othersPredicate.get(item, t);\r\n                    if (!others) {\r\n                        continue;\r\n                    }\r\n                }\r\n\r\n                // finally, yieldvalue\r\n                yielded = true;\r\n                yield item;\r\n            }\r\n        }\r\n\r\n        if (!this.innerJoin && !yielded) {\r\n            yield template;\r\n        }\r\n    }\r\n\r\n    buildItem(l: TLeft, r: TRight) {\r\n        const ret = {\r\n            '>joined': r,\r\n            '>restrictive': l,\r\n            [SELECT_ALL]: () => this.merge(ret),\r\n        }\r\n        setId(ret, `join${this.joinId}-${getId(l)}-${getId(r)}`);\r\n        return ret;\r\n    }\r\n\r\n    private merge(item: any) {\r\n        if (!this.mergeSelect) {\r\n            let sel = this.columns.map<CustomAlias>(val => ({ val }));\r\n            if (this.ignoreDupes) {\r\n                sel = sel.filter(t => !this.ignoreDupes?.has(t.val));\r\n            }\r\n            this.mergeSelect = new Selection(this, sel);\r\n        }\r\n\r\n        // nb: second argument is null... this is a hack : we KNOW it wont use the transaction.\r\n        const ret = this.mergeSelect.build(item, Symbol('hack') as any);\r\n        return ret;\r\n    }\r\n\r\n    hasItem(value: JoinRaw<TLeft, TRight>): boolean {\r\n        throw new NotSupported('lookups on joins');\r\n    }\r\n\r\n    getIndex(forValue: IValue<any>): _IIndex<any> | nil {\r\n        if (this.indexCache.has(forValue)) {\r\n            return this.indexCache.get(forValue);\r\n        }\r\n        // todo: filter using indexes of tables (index propagation)'\r\n        const mapped = this.columnsMappingThisToParent.get(forValue);\r\n        if (!mapped) {\r\n            return null;\r\n        }\r\n        const originIndex = mapped.col.index;\r\n        if (!originIndex) {\r\n            return null;\r\n        }\r\n        const ret = new JoinIndex(this, originIndex, mapped.side);\r\n        this.indexCache.set(forValue, ret);\r\n        return ret;\r\n    }\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        const strategy = chooseStrategy(e.transaction, this.strategies);\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'join',\r\n            restrictive: this.restrictive.explain(e),\r\n            joined: this.joined.explain(e),\r\n            inner: this.innerJoin,\r\n            on: strategy ? {\r\n                iterate: e.idFor(strategy.iterate),\r\n                iterateSide: strategy.iterateSide,\r\n                joinIndex: strategy.joinIndex.explain(e),\r\n                matches: strategy.onValue.explain(e),\r\n                ...strategy.othersPredicate ? { filtered: true } : {},\r\n            } : {\r\n                seqScan: this.seqScanExpression.explain(e),\r\n            },\r\n        };\r\n    }\r\n}\r\n\r\n\r\nclass JoinMapAlias implements _IAlias {\r\n\r\n\r\n    constructor(private owner: JoinSelection, private target: _IAlias, private map: string) {\r\n    }\r\n\r\n    *listColumns(): Iterable<IValue<any>> {\r\n        for (const c of this.target.listColumns()) {\r\n            yield c.setWrapper(this.owner, x => (x as any)[this.map]);\r\n        }\r\n    }\r\n}\r\n\r\nexport class JoinIndex<T> implements _IIndex<T> {\r\n    constructor(readonly owner: JoinSelection<T>, private base: _IIndex, private side: 'restrictive' | 'joined') {\r\n    }\r\n\r\n    get expressions(): IndexExpression[] {\r\n        return this.base.expressions;\r\n    }\r\n\r\n    stats(t: _Transaction, key?: IndexKey): Stats | null {\r\n        return null;\r\n    }\r\n\r\n    iterateKeys() {\r\n        return null;\r\n    }\r\n\r\n    entropy(op: IndexOp): number {\r\n        const strategy = this.chooseStrategy(op.t);\r\n        if (!strategy) {\r\n            // very high entropy (catastophic join)\r\n            return this.base.entropy(op) * this.other.entropy(op.t);\r\n        }\r\n        // todo: multiply that by the mean count per keys in strategy.joinIndex ?\r\n        return this.base.entropy(op);\r\n    }\r\n\r\n    eqFirst(rawKey: IndexKey, t: _Transaction): T | null {\r\n        for (const i of this.enumerate({\r\n            type: 'eq',\r\n            key: rawKey,\r\n            t,\r\n        })) {\r\n            return i;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private chooseStrategy(t: _Transaction) {\r\n        const strats = this.owner.strategies.filter(x => x.iterateSide === this.side);\r\n        if (!strats.length) {\r\n            return null;\r\n        }\r\n        return chooseStrategy(t, strats);\r\n    }\r\n\r\n    private get other() {\r\n        return this.side === 'joined'\r\n            ? this.owner.restrictive\r\n            : this.owner.joined;\r\n    }\r\n\r\n    *enumerate(op: IndexOp): Iterable<T> {\r\n        const strategy = this.chooseStrategy(op.t);\r\n        if (strategy) {\r\n            for (const i of this.base.enumerate(op)) {\r\n                yield* this.owner.iterateStrategyItem(i, strategy, op.t);\r\n            }\r\n        } else {\r\n            this.owner.db.raiseGlobal('catastrophic-join-optimization');\r\n            const all = [...this.other.enumerate(op.t)];\r\n\r\n            for (const i of this.base.enumerate(op)) {\r\n                yield* this.owner.iterateCatastrophicItem(i, all, this.side, op.t);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    explain(e: _Explainer): _IndexExplanation {\r\n        const strat = this.chooseStrategy(e.transaction);\r\n        return {\r\n            _: 'indexOnJoin',\r\n            index: this.base.explain(e),\r\n            strategy: strat?.joinIndex?.explain(e) ?? 'catastrophic',\r\n        }\r\n    }\r\n}","import { TransformBase, FilterBase } from './transform-base';\r\nimport { _Transaction, IValue, _Explainer, _ISelection, _SelectExplanation, QueryError, Stats, nil, _IAlias } from '../interfaces-private';\r\nimport { Evaluator } from '../evaluator';\r\nimport { Types, RecordCol } from '../datatypes';\r\nimport { ExprRef } from 'pgsql-ast-parser';\r\nimport { asSingleName, colToStr } from '../utils';\r\nimport { ColumnNotFound } from '../interfaces';\r\nimport { RecordType } from '../datatypes/t-record';\r\n\r\nexport function buildAlias(on: _ISelection, alias?: string): _ISelection {\r\n    if (!alias) {\r\n        return on as any;\r\n    }\r\n    if (on instanceof Alias && on.name === alias) {\r\n        return on;\r\n    }\r\n    return new Alias(on, alias);\r\n}\r\n\r\nexport class Alias<T> extends TransformBase<T> implements _IAlias {\r\n\r\n    private oldToThis = new Map<IValue, IValue>();\r\n    private thisToOld = new Map<IValue, IValue>();\r\n    private _columns: IValue<any>[] | null = null;\r\n    private asRecord!: IValue;\r\n\r\n    get isExecutionWithNoResult(): boolean {\r\n        return this.base.isExecutionWithNoResult;\r\n    }\r\n\r\n    constructor(sel: _ISelection, public name: string) {\r\n        super(sel);\r\n    }\r\n\r\n    *listSelectableIdentities(): Iterable<IValue> {\r\n        this.init();\r\n        yield* super.listSelectableIdentities();\r\n        yield this.asRecord;\r\n    }\r\n\r\n\r\n    rebuild() {\r\n        this._columns = null;\r\n        this.oldToThis.clear();\r\n        this.thisToOld.clear();\r\n    }\r\n\r\n    selectAlias(alias: string): _IAlias | nil {\r\n        if (this.name === alias) {\r\n            return this;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    listColumns(): Iterable<IValue> {\r\n        return this.columns;\r\n    }\r\n\r\n\r\n    get debugId() {\r\n        return this.base.debugId;\r\n    }\r\n\r\n    get columns(): ReadonlyArray<IValue<any>> {\r\n        this.init();\r\n        return this._columns!;\r\n    }\r\n    init() {\r\n        if (this._columns) {\r\n            return;\r\n        }\r\n        this._columns = this.base.columns.map(x => {\r\n            const ret = x.setOrigin(this);\r\n            this.oldToThis.set(x, ret);\r\n            this.thisToOld.set(ret, x);\r\n            return ret;\r\n        });\r\n\r\n        // how to build a record out of this alias?\r\n        this.asRecord = new Evaluator(\r\n            RecordType.from(this)\r\n            , this.name\r\n            , Math.random().toString()\r\n            , this._columns\r\n            , v => ({ ...v })\r\n            , { forceNotConstant: true });\r\n    }\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return this.base.stats(t);\r\n    }\r\n\r\n    enumerate(t: _Transaction): Iterable<T> {\r\n        return this.base.enumerate(t);\r\n    }\r\n\r\n    hasItem(value: T, t: _Transaction): boolean {\r\n        return this.base.hasItem(value, t);\r\n    }\r\n\r\n    getColumn(column: string | ExprRef): IValue;\r\n    getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue | nil;\r\n    getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue | nil {\r\n        const col = this._getColumn(column);\r\n        if (col) {\r\n            return col;\r\n        }\r\n\r\n        if (asSingleName(column) === this.name) {\r\n            return this.asRecord;\r\n        }\r\n\r\n        if (nullIfNotFound) {\r\n            return null;\r\n        }\r\n        throw new ColumnNotFound(colToStr(column));\r\n    }\r\n\r\n    private _getColumn(column: string | ExprRef): IValue | nil {\r\n        if (typeof column !== 'string'\r\n            && column.table) {\r\n            if (!column.table.schema\r\n                && column.table.name !== this.name) {\r\n                return null;\r\n            }\r\n            column = column.name;\r\n        }\r\n        const got = this.base.getColumn(column, true);\r\n        if (!got) {\r\n            return got;\r\n        }\r\n        this.init();\r\n        const ret = this.oldToThis.get(got);\r\n        if (!ret) {\r\n            throw new Error('Corrupted alias');\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        // no need to explain an alias... it does nothing.\r\n        return this.base.explain(e);\r\n        // return {\r\n        //     id: e.idFor(this),\r\n        //     type: 'alias',\r\n        //     alias: this.as,\r\n        //     of: this.base.explain(e),\r\n        // };\r\n    }\r\n\r\n    getIndex(...forValue: IValue[]) {\r\n        return this.base.getIndex(...forValue.map(v => this.thisToOld.get(v) ?? v));\r\n    }\r\n\r\n}","\r\nimport { QueryError } from '../interfaces';\r\nimport LRUCache from 'lru-cache';\r\nimport hash from 'object-hash';\r\nimport { Expr, parse, Statement } from 'pgsql-ast-parser';\r\nimport { errorMessage } from '../utils';\r\n\r\n\r\nconst astCache: LRUCache<any, any> = new LRUCache({\r\n    max: 1000,\r\n});\r\n\r\nlet locationTracking = false;\r\nexport function enableStatementLocationTracking() {\r\n    locationTracking = true;\r\n    astCache.reset();\r\n}\r\n\r\n\r\n/** Parse an AST from SQL */\r\nexport function parseSql(sql: string): Statement[];\r\nexport function parseSql(sql: string, entry: 'expr'): Expr;\r\nexport function parseSql(sql: string, entry?: string): any {\r\n    // when 'entry' is not specified, lets cache parsings\r\n    // => better perf on repetitive requests\r\n    const key = !entry && hash(sql);\r\n    if (!entry) {\r\n        const cached = astCache.get(key);\r\n        if (cached) {\r\n            return cached;\r\n        }\r\n    }\r\n\r\n    try {\r\n\r\n        let ret = parse(sql, {\r\n            entry,\r\n            locationTracking,\r\n        });\r\n\r\n        // cache result\r\n        if (!entry) {\r\n            astCache.set(key, ret);\r\n        }\r\n        return ret;\r\n\r\n    } catch (e) {\r\n        const msg = errorMessage(e);\r\n        if (!/Syntax error/.test(msg)) {\r\n            throw e;\r\n        }\r\n\r\n\r\n        // throw a nice parsing error.\r\n        throw new QueryError(` Your query failed to parse.\r\nThis is most likely due to a SQL syntax error. However, you might also have hit a bug, or an unimplemented feature of pg-mem.\r\nIf this is the case, please file an issue at https://github.com/oguimbal/pg-mem along with a query that reproduces this syntax error.\r\n\r\n Failed query:\r\n\r\n    ${sql}\r\n\r\n ${msg}`);\r\n    }\r\n\r\n}\r\n","import { _IIndex, IValue, _ITable, _IDb, _Transaction, _Explainer, _IndexExplanation, IndexOp, IndexKey, Stats } from '../interfaces-private';\r\nimport { PermissionDeniedError, NotSupported } from '../interfaces';\r\n\r\nexport class TableIndex implements _IIndex {\r\n    readonly expressions: IValue<any>[];\r\n\r\n    get hash(): string {\r\n        throw new Error('not implemented');\r\n    }\r\n    explain(e: _Explainer): _IndexExplanation {\r\n        throw new Error('not implemented');\r\n    }\r\n\r\n    stats(t: _Transaction, key?: IndexKey): Stats | null {\r\n        return null;\r\n    }\r\n\r\n    iterateKeys() {\r\n        return null;\r\n    }\r\n\r\n    constructor(readonly onTable: _ITable & { itemsByTable(table: string, t: _Transaction): Iterable<any>; ownSymbol: any }, private col: IValue) {\r\n        this.expressions = [col];\r\n    }\r\n\r\n    get indexName(): string {\r\n        return 'index_table_name_name';\r\n    }\r\n\r\n    entropy(op: IndexOp): number {\r\n        return this.onTable.db.listSchemas()\r\n            .reduce((tot, s) => tot + s.tablesCount(op.t) * 10 * 3, 0);\r\n    }\r\n\r\n\r\n    add(raw: any): void {\r\n        throw new PermissionDeniedError('tables');\r\n    }\r\n\r\n    eqFirst([key]: any, t: _Transaction) {\r\n        for (const its of this.onTable.itemsByTable(key, t)) {\r\n            return its;\r\n        }\r\n    }\r\n    *eq([rawKey]: any, t: _Transaction): Iterable<any> {\r\n        for (const its of this.onTable.itemsByTable(rawKey, t)) {\r\n            yield its;\r\n        }\r\n    }\r\n\r\n    *nin(keys: any[][], t: _Transaction) {\r\n        const raws = keys.map(x => x[0]) as any[];\r\n        for (const i of this.onTable.selection.enumerate(t)) {\r\n            if (raws.includes(i.table_name)) {\r\n                continue;\r\n            }\r\n            yield i;\r\n        }\r\n    }\r\n\r\n    *neq([rawKey]: any, t: _Transaction) {\r\n        for (const i of this.onTable.selection.enumerate(t)) {\r\n            if (i.table_name !== rawKey) {\r\n                yield i;\r\n            }\r\n        }\r\n    }\r\n    *gt(rawKey: any, t: _Transaction): Iterable<any> {\r\n        for (const i of this.onTable.selection.enumerate(t)) {\r\n            if (i.table_name > rawKey) {\r\n                yield i;\r\n            }\r\n        }\r\n    }\r\n    *lt(rawKey: any, t: _Transaction): Iterable<any> {\r\n        for (const i of this.onTable.selection.enumerate(t)) {\r\n            if (i.table_name < rawKey) {\r\n                yield i;\r\n            }\r\n        }\r\n    }\r\n    *ge(rawKey: any, t: _Transaction): Iterable<any> {\r\n        for (const i of this.onTable.selection.enumerate(t)) {\r\n            if (i.table_name >= rawKey) {\r\n                yield i;\r\n            }\r\n        }\r\n    }\r\n    *le(rawKey: any, t: _Transaction): Iterable<any> {\r\n        for (const i of this.onTable.selection.enumerate(t)) {\r\n            if (i.table_name <= rawKey) {\r\n                yield i;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    enumerate(op: IndexOp): Iterable<any> {\r\n        switch (op.type) {\r\n            case 'eq':\r\n                return this.eq(op.key, op.t);\r\n            case 'neq':\r\n                return this.neq(op.key, op.t);\r\n            case 'ge':\r\n                return this.ge(op.key, op.t);\r\n            case 'le':\r\n                return this.le(op.key, op.t);\r\n            case 'gt':\r\n                return this.gt(op.key, op.t);\r\n            case 'lt':\r\n                return this.lt(op.key, op.t);\r\n            case 'outside':\r\n                return this.outside(op.lo, op.hi, op.t);\r\n            case 'inside':\r\n                return this.inside(op.lo, op.hi, op.t);\r\n            case 'nin':\r\n                return this.nin(op.keys, op.t);\r\n            default:\r\n                throw NotSupported.never(op['type']);\r\n        }\r\n    }\r\n\r\n    *outside(lo: IndexKey, hi: IndexKey, t: _Transaction): Iterable<any> {\r\n        yield* this.lt(lo, t);\r\n        yield* this.gt(hi, t);\r\n    }\r\n\r\n    *inside(lo: IndexKey, hi: IndexKey, t: _Transaction): Iterable<any> {\r\n        throw new Error('Not implemented');\r\n    }\r\n}","module.exports = require(\"json-stable-stringify\");","import { FilterBase } from './transform-base';\r\nimport { _ISelection, _Explainer, _SelectExplanation, _Transaction, Stats } from '../interfaces-private';\r\n\r\nexport class ArrayFilter<T = any> extends FilterBase<T> {\r\n\r\n    get index() {\r\n        return null;\r\n    }\r\n\r\n    entropy() {\r\n        return this.rows.length;\r\n    }\r\n\r\n    hasItem(raw: T): boolean {\r\n        return this.rows.includes(raw);\r\n    }\r\n\r\n    getIndex() {\r\n        return null;\r\n    }\r\n\r\n    constructor(fromTable: _ISelection<T>, public rows: T[]) {\r\n        super(fromTable);\r\n    }\r\n\r\n    enumerate(): Iterable<T> {\r\n        return this.rows;\r\n    }\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return {\r\n            count: this.rows.length,\r\n        };\r\n    }\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'constantSet',\r\n            rawArrayLen: this.rows.length,\r\n        }\r\n    }\r\n}","// stolen from https://github.com/segmentio/pg-escape/blob/master/index.js\r\n\r\nexport function literal(val: any) {\r\n    if (null == val) return 'NULL';\r\n    if (Array.isArray(val)) {\r\n        var vals: any[] = val.map(literal)\r\n        return \"(\" + vals.join(\", \") + \")\"\r\n    }\r\n    var backslash = ~val.indexOf('\\\\');\r\n    var prefix = backslash ? 'E' : '';\r\n    val = val.replace(/'/g, \"''\");\r\n    val = val.replace(/\\\\/g, '\\\\\\\\');\r\n    return prefix + \"'\" + val + \"'\";\r\n};\r\n","import { _ISchema, _Transaction, NotSupported, _ISequence, _IStatementExecutor } from '../../interfaces-private';\r\nimport { QName, CreateSequenceStatement } from 'pgsql-ast-parser';\r\nimport { Sequence } from '../../schema/sequence';\r\nimport { checkExistence, ExecHelper } from '../exec-utils';\r\n\r\nexport class ExecuteCreateSequence extends ExecHelper implements _IStatementExecutor {\r\n    schema: _ISchema;\r\n    constructor(inSchema: _ISchema, private p: CreateSequenceStatement, private acceptTempSequences: boolean) {\r\n        super(p);\r\n        const name: QName = p.name;\r\n        this.schema = inSchema.getThisOrSiblingFor(name);\r\n    }\r\n\r\n    execute(t: _Transaction) {\r\n        // commit pending data before making changes\r\n        //  (because the index sequence creation does support further rollbacks)\r\n        t = t.fullCommit();\r\n\r\n        // create the sequence\r\n        this.createSeq(t);\r\n\r\n        // new implicit transaction\r\n        t = t.fork();\r\n        return this.noData(t, 'CREATE');\r\n    }\r\n\r\n    createSeq(t: _Transaction) {\r\n        const p = this.p;\r\n        const name: QName = p.name;\r\n        // const ret = this.simple('CREATE', p);\r\n\r\n        let ret: _ISequence | null = null;\r\n        checkExistence(this.schema, name, p.ifNotExists, () => {\r\n            if (p.temp && !this.acceptTempSequences) {\r\n                throw new NotSupported('temp sequences');\r\n            }\r\n            ret = new Sequence(name.name, this.schema)\r\n                .alter(t, p.options);\r\n            this.schema.db.onSchemaChange();\r\n        });\r\n        return ret;\r\n    }\r\n}\r\n","import { watchUse, ignore, errorMessage, pushExecutionCtx, fromEntries } from '../utils';\r\nimport { _ISchema, _Transaction, _FunctionDefinition, _ArgDefDetails, _IType, _ISelection, _IStatement, NotSupported, QueryError, nil, OnStatementExecuted, _IStatementExecutor, StatementResult, Parameter, IValue } from '../interfaces-private';\r\nimport { toSql, Statement } from 'pgsql-ast-parser';\r\nimport { ExecuteCreateTable } from './schema-amends/create-table';\r\nimport { ExecuteCreateSequence } from './schema-amends/create-sequence';\r\nimport { locOf, ExecHelper } from './exec-utils';\r\nimport { CreateIndexExec } from './schema-amends/create-index';\r\nimport { Alter } from './schema-amends/alter';\r\nimport { AlterSequence } from './schema-amends/alter-sequence';\r\nimport { DropIndex } from './schema-amends/drop-index';\r\nimport { DropTable } from './schema-amends/drop-table';\r\nimport { DropSequence } from './schema-amends/drop-sequence';\r\nimport { CommitExecutor, RollbackExecutor, BeginStatementExec } from './transaction-statements';\r\nimport { TruncateTable } from './records-mutations/truncate-table';\r\nimport { ShowExecutor } from './show';\r\nimport { SetExecutor } from './set';\r\nimport { CreateEnum } from './schema-amends/create-enum';\r\nimport { CreateView } from './schema-amends/create-view';\r\nimport { CreateMaterializedView } from './schema-amends/create-materialized-view';\r\nimport { CreateSchema } from './schema-amends/create-schema';\r\nimport { CreateFunction } from './schema-amends/create-function';\r\nimport { DoStatementExec } from './schema-amends/do';\r\nimport { SelectExec } from './select';\r\nimport { withSelection, withStatement, withNameResolver, INameResolver } from '../parser/context';\r\nimport { DropType } from './schema-amends/drop-type';\r\n\r\nconst detailsIncluded = Symbol('errorDetailsIncluded');\r\n\r\nexport class SimpleExecutor extends ExecHelper implements _IStatementExecutor {\r\n    constructor(st: Statement, private exec: (t: _Transaction) => void, private opName?: string) {\r\n        super(st);\r\n    }\r\n    execute(t: _Transaction): StatementResult {\r\n        this.exec(t);\r\n        return this.noData(t, this.opName);\r\n    }\r\n}\r\n\r\nclass MapNameResolver implements INameResolver {\r\n    constructor(private map: Map<string, any>, readonly isolated: boolean) {\r\n    }\r\n    resolve(name: string): IValue | nil {\r\n        return this.map.get(name);\r\n    }\r\n}\r\n\r\nexport class StatementExec implements _IStatement {\r\n    private onExecutedCallbacks: OnStatementExecuted[] = []\r\n    private executor?: _IStatementExecutor;\r\n    private checkAstCoverage?: (() => void);\r\n\r\n    constructor(readonly schema: _ISchema, private statement: Statement, private pAsSql: string | nil, private parameters?: Parameter[]) {\r\n    }\r\n\r\n    onExecuted(callback: OnStatementExecuted): void {\r\n        this.onExecutedCallbacks.push(callback);\r\n    }\r\n\r\n    private get db() {\r\n        return this.schema.db;\r\n    }\r\n\r\n\r\n    private _getExecutor(p: Statement): _IStatementExecutor {\r\n        switch (p.type) {\r\n            case 'start transaction':\r\n            case 'begin':\r\n                return new BeginStatementExec(p);\r\n            case 'commit':\r\n                return new CommitExecutor(p);\r\n            case 'rollback':\r\n                return new RollbackExecutor(p);\r\n            case 'select':\r\n            case 'delete':\r\n            case 'update':\r\n            case 'insert':\r\n            case 'union':\r\n            case 'union all':\r\n            case 'values':\r\n            case 'with recursive':\r\n            case 'with':\r\n                return new SelectExec(this, p);\r\n            case 'truncate table':\r\n                return new TruncateTable(p);\r\n            case 'create table':\r\n                return new ExecuteCreateTable(p);\r\n            case 'create index':\r\n                return new CreateIndexExec(this, p);\r\n            case 'alter table':\r\n                return new Alter(this, p);\r\n            case 'create extension':\r\n                return new SimpleExecutor(p, () => this.schema.executeCreateExtension(p));\r\n            case 'create sequence':\r\n                return new ExecuteCreateSequence(this.schema, p, false);\r\n            case 'alter sequence':\r\n                return new AlterSequence(this, p);\r\n            case 'drop index':\r\n                return new DropIndex(this, p);\r\n            case 'drop table':\r\n                return new DropTable(this, p);\r\n            case 'drop sequence':\r\n                return new DropSequence(this, p);\r\n            case 'drop type':\r\n                return new DropType(this, p);\r\n            case 'show':\r\n                return new ShowExecutor(p);\r\n            case 'set':\r\n            case 'set timezone':\r\n                return new SetExecutor(p);\r\n            case 'create enum':\r\n                return new CreateEnum(this, p);\r\n            case 'create view':\r\n                return new CreateView(this, p);\r\n            case 'create materialized view':\r\n                return new CreateMaterializedView(this, p);\r\n            case 'create schema':\r\n                return new CreateSchema(this, p);\r\n            case 'create function':\r\n                return new CreateFunction(this, p);\r\n            case 'drop function':\r\n                return new SimpleExecutor(p, () => this.schema.dropFunction(p), 'DROP');\r\n            case 'do':\r\n                return new DoStatementExec(this, p);\r\n            case 'comment':\r\n            case 'raise':\r\n            case 'deallocate':\r\n                ignore(p);\r\n                return new SimpleExecutor(p, () => { });\r\n\r\n            case 'refresh materialized view':\r\n                // todo: a decent materialized view implementation\r\n                ignore(p);\r\n                return new SimpleExecutor(p, () => { });\r\n\r\n            case 'tablespace':\r\n                throw new NotSupported('\"TABLESPACE\" statement');\r\n            case 'prepare':\r\n                throw new NotSupported('\"PREPARE\" statement');\r\n            case 'create composite type':\r\n                throw new NotSupported('create composite type');\r\n            default:\r\n                throw NotSupported.never(p, 'statement type');\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    compile(): _IStatementExecutor {\r\n        return this.niceErrors(() => {\r\n\r\n            if (this.executor) {\r\n                return this.executor!;\r\n            }\r\n            // build the AST coverage checker\r\n            let p = this.statement;\r\n            if (!this.db.options.noAstCoverageCheck) {\r\n                const watched = watchUse(p);\r\n                p = watched.checked;\r\n                this.checkAstCoverage = () => {\r\n                    const err = watched.check?.();\r\n                    if (err) {\r\n                        throw new NotSupported(err);\r\n                    }\r\n                };\r\n            }\r\n\r\n            // build parameters context\r\n            const namedParams = fromEntries(this.parameters?.filter(p => !!p.value.id).map(x => [x.value.id!, x]) ?? []);\r\n            const nameResolver = new MapNameResolver(namedParams, true);\r\n\r\n\r\n            // parse the AST\r\n            withNameResolver(nameResolver,\r\n                () => withStatement(this,\r\n                    () => withSelection(this.schema.dualTable.selection,\r\n                        () => this.executor = this._getExecutor(p)\r\n                    )\r\n                )\r\n            );\r\n\r\n            return this.executor!;\r\n        });\r\n    }\r\n\r\n\r\n    executeStatement(t: _Transaction): StatementResult {\r\n        return this.niceErrors(() => pushExecutionCtx({\r\n            transaction: t,\r\n            schema: this.schema,\r\n        }, () => {\r\n\r\n            t.clearTransientData();\r\n\r\n            // actual execution\r\n            if (!this.executor) {\r\n                throw new Error('Statement not prepared')\r\n            }\r\n            const result = this.executor.execute(t);\r\n\r\n            // post-execution\r\n            for (const s of this.onExecutedCallbacks) {\r\n                s(t);\r\n            }\r\n\r\n\r\n            // check AST coverage if necessary\r\n            this.checkAstCoverage?.();\r\n\r\n\r\n            return result;\r\n        }));\r\n    }\r\n\r\n    private niceErrors<T>(act: () => T): T {\r\n        try {\r\n            return act();\r\n        } catch (e) {\r\n            // handle reeantrant calls (avoids including error tips twice)\r\n            if (e && typeof e === 'object' && (e as any)[detailsIncluded]) {\r\n                throw e;\r\n            }\r\n\r\n            // include error tips\r\n            if (!this.db.options.noErrorDiagnostic && (e instanceof Error) || e instanceof NotSupported) {\r\n\r\n                // compute SQL\r\n                const msgs = [e.message];\r\n\r\n\r\n                if (e instanceof QueryError) {\r\n                    msgs.push(` This seems to be an execution error, which means that your request syntax seems okay,\r\n    but the resulting statement cannot be executed  Probably not a pg-mem error.`);\r\n                } else if (e instanceof NotSupported) {\r\n                    msgs.push(` pg-mem is work-in-progress, and it would seem that you've hit one of its limits.`);\r\n                } else {\r\n                    msgs.push(' This is a nasty error, which was unexpected by pg-mem. Also known \"a bug\"  Please file an issue !')\r\n                }\r\n\r\n                if (!this.db.options.noErrorDiagnostic) {\r\n                    if (this.pAsSql) {\r\n                        msgs.push(`* Failed SQL statement: ${this.pAsSql}`);\r\n                    } else {\r\n                        try {\r\n                            msgs.push(`* Reconsituted failed SQL statement: ${toSql.statement(this.statement)}`);\r\n                        } catch (f) {\r\n                            msgs.push(`* <Failed to reconsitute SQL - ${errorMessage(f)}>`);\r\n                        }\r\n                    }\r\n                }\r\n                msgs.push(' You can file an issue at https://github.com/oguimbal/pg-mem along with a way to reproduce this error (if you can), and  the stacktrace:')\r\n                e.message = msgs.join('\\n\\n') + '\\n\\n';\r\n            }\r\n\r\n            // set error location\r\n            if (e && typeof e === 'object') {\r\n                (e as any).location = locOf(this.statement);\r\n                (e as any)[detailsIncluded] = true;\r\n            }\r\n            throw e;\r\n        }\r\n    }\r\n\r\n}\r\n","import { QueryError, Reg, _Explainer, _ISchema, _ISelection, _IView, _Transaction } from '../interfaces-private';\r\nimport { DataSourceBase, FilterBase } from '../transforms/transform-base';\r\n\r\nexport class View extends FilterBase<any> implements _IView {\r\n    get type(): 'view' {\r\n        return 'view';\r\n    }\r\n\r\n    private _reg?: Reg;\r\n    get reg(): Reg {\r\n        if (!this._reg) {\r\n            throw new QueryError(`relation \"${this.name}\" does not exist`);\r\n        }\r\n        return this._reg;\r\n    }\r\n\r\n    constructor(readonly ownerSchema: _ISchema, readonly name: string, readonly selection: _ISelection) {\r\n        super(selection);\r\n    }\r\n\r\n\r\n    enumerate(t: _Transaction): Iterable<any> {\r\n        return this.selection.enumerate(t);\r\n    }\r\n\r\n    hasItem(value: any, t: _Transaction): boolean {\r\n        return this.selection.hasItem(value, t);\r\n    }\r\n\r\n    explain(e: _Explainer) {\r\n        return this.selection.explain(e);\r\n    }\r\n\r\n    stats(t: _Transaction) {\r\n        return this.selection.stats(t);\r\n    }\r\n\r\n\r\n    register() {\r\n        // once fields registered,\r\n        //  then register the table\r\n        //  (column registrations need it not to be registered yet)\r\n        this._reg = this.ownerSchema._reg_register(this);\r\n        return this;\r\n    }\r\n\r\n    drop(t: _Transaction): void {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n}","import { IValue, _ISelection, _Transaction, _Explainer, _SelectExplanation, Stats } from '../interfaces-private';\r\nimport { FilterBase } from './transform-base';\r\nimport { Types } from '../datatypes';\r\n\r\nexport class SeqScanFilter<T = any> extends FilterBase<T> {\r\n\r\n    get index() {\r\n        return null;\r\n    }\r\n\r\n    entropy(t: _Transaction) {\r\n        // boost source entropy (in case an index has the same items count)\r\n        return this.selection.entropy(t) * 1.5;\r\n    }\r\n\r\n    hasItem(raw: T, t: _Transaction): boolean {\r\n        return !!this.getter.get(raw, t);\r\n    }\r\n\r\n    constructor(private selection: _ISelection<T>, private getter: IValue<T>) {\r\n        super(selection);\r\n        this.getter = getter.cast(Types.bool);\r\n    }\r\n\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return null;\r\n    }\r\n\r\n    *enumerate(t: _Transaction): Iterable<T> {\r\n        for (const raw of this.selection.enumerate(t)) {\r\n            const cond = this.getter.get(raw, t);\r\n            if (cond) {\r\n                yield raw;\r\n            }\r\n        }\r\n    }\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'seqFilter',\r\n            filtered: this.selection.explain(e),\r\n        };\r\n    }\r\n}","export { newDb } from './db';\r\nexport { enableStatementLocationTracking } from './parser/parse-cache';\r\nexport * from './interfaces';\r\n","import { Schema, IMemoryDb, ISchema, TableEvent, GlobalEvent, QueryError, IBackup, MemoryDbOptions, ISubscription, LanguageCompiler, nil } from './interfaces';\r\nimport { _IDb, _ISelection, _ITable, _Transaction, _ISchema, _FunctionDefinition, GLOBAL_VARS, _IType, _OperatorDefinition, IValue } from './interfaces-private';\r\nimport { DbSchema } from './schema/schema';\r\nimport { initialize } from './transforms/transform-base';\r\nimport { buildSelection } from './transforms/selection';\r\nimport { buildAlias } from './transforms/alias';\r\nimport { buildFilter } from './transforms/build-filter';\r\nimport { Adapters } from './adapters';\r\nimport { Transaction } from './transaction';\r\nimport { buildGroupBy } from './transforms/aggregation';\r\nimport { buildLimit } from './transforms/limit';\r\nimport { buildUnion } from './transforms/union';\r\nimport { buildDistinct } from './transforms/distinct';\r\nimport { buildOrderBy } from './transforms/order-by';\r\nimport { setupPgCatalog } from './schema/pg-catalog';\r\nimport { setupInformationSchema } from './schema/information-schema';\r\nimport { QName, BinaryOperator } from 'pgsql-ast-parser';\r\nimport { asSingleQName } from './utils';\r\n\r\nexport function newDb(opts?: MemoryDbOptions): IMemoryDb {\r\n    initialize({\r\n        buildSelection,\r\n        buildAlias,\r\n        buildFilter,\r\n        buildGroupBy,\r\n        buildLimit,\r\n        buildUnion,\r\n        buildOrderBy,\r\n        buildDistinct,\r\n    });\r\n    // root transaction\r\n    const root = Transaction.root();\r\n    const globals = root.getMap(GLOBAL_VARS)\r\n        .set('server_version', '12.2 (pg-mem)');\r\n    root.set(GLOBAL_VARS, globals);\r\n\r\n    // create db\r\n    return new MemoryDb(root, undefined, opts ?? {});\r\n}\r\n\r\nclass MemoryDb implements _IDb {\r\n\r\n    private handlers = new Map<TableEvent | GlobalEvent, Set<(...args: any[]) => any>>();\r\n    private schemas = new Map<string, _ISchema>();\r\n\r\n    schemaVersion = 1;\r\n\r\n    readonly adapters: Adapters = new Adapters(this);\r\n    private extensions: { [name: string]: (schema: ISchema) => void } = {};\r\n    private languages: { [name: string]: LanguageCompiler } = {};\r\n    readonly searchPath = ['pg_catalog', 'public'];\r\n\r\n    get public() {\r\n        return this.getSchema(null)\r\n    }\r\n\r\n    onSchemaChange() {\r\n        this.schemaVersion++;\r\n        this.raiseGlobal('schema-change', this);\r\n    }\r\n\r\n    constructor(public data: Transaction, schemas?: Map<string, _ISchema>, readonly options: MemoryDbOptions = {}) {\r\n        if (!schemas) {\r\n            this.createSchema('public');\r\n        } else {\r\n            this.schemas = schemas;\r\n        }\r\n        setupPgCatalog(this);\r\n        setupInformationSchema(this);\r\n    }\r\n\r\n    backup(): IBackup {\r\n        return new Backup(this);\r\n    }\r\n\r\n    registerExtension(name: string, install: (schema: ISchema) => void): this {\r\n        this.extensions[name] = install;\r\n        return this;\r\n    }\r\n\r\n    registerLanguage(languageName: string, compiler: LanguageCompiler): this {\r\n        this.languages[languageName.toLowerCase()] = compiler;\r\n        return this;\r\n    }\r\n\r\n    getLanguage(name: string): LanguageCompiler {\r\n        const ret = this.languages[name.toLowerCase()];\r\n        if (!ret) {\r\n            throw new QueryError(`Unkonwn language \"${name}\". If you plan to use a script language, you must declare it to pg-mem via \".registerLanguage()\"`);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n\r\n    getExtension(name: string): (schema: ISchema) => void {\r\n        const ret = this.extensions[name];\r\n        if (!ret) {\r\n            throw new Error('Extension does not exist: ' + name);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n\r\n    createSchema(name: string): DbSchema {\r\n        if (this.schemas.has(name)) {\r\n            throw new Error('Schema exists: ' + name);\r\n        }\r\n        this.onSchemaChange();\r\n        const ret = new DbSchema(name, this);\r\n        this.schemas.set(name, ret);\r\n        return ret;\r\n    }\r\n\r\n    getTable(name: string): _ITable;\r\n    getTable(name: string, nullIfNotExists?: boolean): _ITable | null {\r\n        return this.public.getTable(name, nullIfNotExists);\r\n    }\r\n\r\n    resolveFunction(name: string | QName, types: IValue[]): _FunctionDefinition | nil {\r\n        const asSingle = asSingleQName(name);\r\n        if (asSingle) {\r\n            for (const sp of this.searchPath) {\r\n                const found = this.getSchema(sp).resolveFunction(name, types, true);\r\n                if (found) {\r\n                    return found;\r\n                }\r\n            }\r\n            return null;\r\n        } else {\r\n            const q = name as QName;\r\n            return this.getSchema(q.schema!).resolveFunction(q.name, types, true);\r\n        }\r\n    }\r\n\r\n    resolveOperator(name: BinaryOperator, left: IValue, right: IValue): _OperatorDefinition | nil {\r\n        for (const sp of this.searchPath) {\r\n            const found = this.getSchema(sp).resolveOperator(name, left, right, true);\r\n            if (found) {\r\n                return found;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n\r\n    on(event: GlobalEvent | TableEvent, handler: (...args: any[]) => any): ISubscription {\r\n        let lst = this.handlers.get(event);\r\n        if (!lst) {\r\n            this.handlers.set(event, lst = new Set());\r\n        }\r\n        lst.add(handler);\r\n        return {\r\n            unsubscribe: () => lst?.delete(handler),\r\n        };\r\n    }\r\n\r\n    raiseTable(table: string, event: TableEvent): void {\r\n        const got = this.handlers.get(event);\r\n        for (const h of got ?? []) {\r\n            h(table);\r\n        }\r\n    }\r\n\r\n    raiseGlobal(event: GlobalEvent, ...data: any[]): void {\r\n        const got = this.handlers.get(event);\r\n        for (const h of got ?? []) {\r\n            h(...data);\r\n        }\r\n    }\r\n\r\n\r\n    getSchema(db?: string | null, nullIfNotFound?: false): _ISchema;\r\n    getSchema(db: string, nullIfNotFound: true): _ISchema | null;\r\n    getSchema(db?: string | null, nullIfNotFound?: boolean): _ISchema | null {\r\n        db = db ?? 'public';\r\n        const got = this.schemas.get(db);\r\n        if (!got) {\r\n            if (nullIfNotFound) {\r\n                return null;\r\n            }\r\n            throw new QueryError('schema not found: ' + db);\r\n        }\r\n        return got;\r\n    }\r\n\r\n    listSchemas() {\r\n        return [...this.schemas.values()];\r\n    }\r\n\r\n}\r\n\r\nclass Backup implements IBackup {\r\n    private readonly data: Transaction;\r\n    private readonly schemaVersion: number;\r\n    constructor(private db: MemoryDb) {\r\n        this.data = db.data.clone();\r\n        this.schemaVersion = db.schemaVersion;\r\n    }\r\n\r\n    restore() {\r\n        if (this.schemaVersion !== this.db.schemaVersion) {\r\n            throw new Error('You cannot restore this backup: schema has been changed since this backup has been created => prefer .clone() in this kind of cases.');\r\n        }\r\n        this.db.data = this.data.clone();\r\n    }\r\n}","import { ISchema, DataType, IType, RelationNotFound, Schema, QueryResult, SchemaField, nil, FunctionDefinition, PermissionDeniedError, TypeNotFound, ArgDefDetails, IEquivalentType, QueryInterceptor, ISubscription, QueryError, typeDefToStr, OperatorDefinition, QueryOrAst } from '../interfaces';\r\nimport { _IDb, _ISelection, _ISchema, _Transaction, _ITable, _SelectExplanation, _Explainer, IValue, _IIndex, _IType, _IRelation, QueryObjOpts, _ISequence, _INamedIndex, RegClass, Reg, TypeQuery, asType, _ArgDefDetails, BeingCreated, _FunctionDefinition, _OperatorDefinition } from '../interfaces-private';\r\nimport { asSingleQName, isType, parseRegClass, randomString, schemaOf } from '../utils';\r\nimport { typeSynonyms } from '../datatypes';\r\nimport { DropFunctionStatement, BinaryOperator, QName, DataTypeDef, CreateSequenceOptions, CreateExtensionStatement, Statement } from 'pgsql-ast-parser';\r\nimport { MemoryTable } from '../table';\r\nimport { parseSql } from '../parser/parse-cache';\r\nimport { IMigrate } from '../migrate/migrate-interfaces';\r\nimport { migrate } from '../migrate/migrate';\r\nimport { CustomEnumType } from '../datatypes/t-custom-enum';\r\nimport { regGen } from '../datatypes/datatype-base';\r\nimport { EquivalentType } from '../datatypes/t-equivalent';\r\nimport { OverloadResolver } from './overload-resolver';\r\nimport { ExecuteCreateSequence } from '../execution/schema-amends/create-sequence';\r\nimport { StatementExec } from '../execution/statement-exec';\r\nimport { SelectExec } from '../execution/select';\r\n\r\nexport class DbSchema implements _ISchema, ISchema {\r\n\r\n    readonly dualTable: _ITable;\r\n    private relsByNameCas = new Map<string, _IRelation>();\r\n    private relsByCls = new Map<number, _IRelation>();\r\n    private relsByTyp = new Map<number, _IRelation>();\r\n    private _tables = new Set<_ITable>();\r\n\r\n    private fns = new OverloadResolver<_FunctionDefinition>(false);\r\n    private ops = new OverloadResolver<_OperatorDefinition>(false);\r\n    private installedExtensions = new Set<string>();\r\n    private readonly: any;\r\n    private interceptors = new Set<{ readonly intercept: QueryInterceptor }>();\r\n    private lastSelect?: _ISelection;\r\n\r\n    constructor(readonly name: string, readonly db: _IDb) {\r\n        this.dualTable = new MemoryTable(this, this.db.data, { fields: [], name: 'dual' }).register();\r\n        this.dualTable.insert({});\r\n        this.dualTable.setReadonly();\r\n        this._reg_unregister(this.dualTable);\r\n    }\r\n\r\n    setReadonly() {\r\n        this.readonly = true;\r\n        return this;\r\n    }\r\n\r\n\r\n    none(query: QueryOrAst): void {\r\n        this.query(query);\r\n    }\r\n\r\n    one(query: QueryOrAst): any {\r\n        const [result] = this.many(query);\r\n        return result;\r\n    }\r\n\r\n    many(query: QueryOrAst): any[] {\r\n        return this.query(query).rows;\r\n    }\r\n\r\n\r\n    query(text: QueryOrAst): QueryResult {\r\n        // intercept ?\r\n        if (typeof text === 'string') {\r\n            for (const { intercept } of this.interceptors) {\r\n                const ret = intercept(text);\r\n                if (ret) {\r\n                    return {\r\n                        command: text,\r\n                        fields: [],\r\n                        location: { start: 0, end: text.length },\r\n                        rowCount: 0,\r\n                        rows: ret,\r\n                    };\r\n                }\r\n            }\r\n        }\r\n\r\n        // execute.\r\n        let last: QueryResult | undefined;\r\n        for (const r of this.queries(text)) {\r\n            last = r;\r\n        }\r\n        return last ?? {\r\n            command: typeof text === 'string' ? text : '<custom ast>',\r\n            fields: [],\r\n            location: { start: 0, end: typeof text === 'string' ? text.length : 0 },\r\n            rowCount: 0,\r\n            rows: [],\r\n        };\r\n    }\r\n\r\n    private parse(query: QueryOrAst): Statement[] {\r\n        if (typeof query === 'string') {\r\n            return parseSql(query);\r\n        }\r\n        return Array.isArray(query) ? query : [query];\r\n    }\r\n\r\n    *queries(query: QueryOrAst): Iterable<QueryResult> {\r\n        query = typeof query === 'string' ? query + ';' : query;\r\n        try {\r\n\r\n            // Parse statements\r\n            let parsed = this.parse(query);\r\n            if (!Array.isArray(parsed)) {\r\n                parsed = [parsed];\r\n            }\r\n            const singleSql = typeof query === 'string' && parsed.length === 1 ? query : undefined;\r\n\r\n            // Prepare statements\r\n            const prepared = parsed\r\n                .filter(s => !!s)\r\n                .map(x => new StatementExec(this, x, singleSql));\r\n\r\n            // Start an implicit transaction\r\n            //  (to avoid messing global data if an operation fails mid-write)\r\n            let t = this.db.data.fork();\r\n\r\n            // Execute statements\r\n            for (const p of prepared) {\r\n\r\n                // Prepare statement\r\n                const executor = p.compile();\r\n\r\n                // store last select for debug purposes\r\n                if (executor instanceof SelectExec) {\r\n                    this.lastSelect = executor.selection;\r\n                }\r\n\r\n                // Execute statement\r\n                const { state, result } = p.executeStatement(t);\r\n                yield result;\r\n                t = state;\r\n            }\r\n\r\n            // implicit final commit\r\n            t.fullCommit();\r\n            this.db.raiseGlobal('query', query);\r\n        } catch (e) {\r\n            this.db.raiseGlobal('query-failed', query);\r\n            throw e;\r\n        }\r\n    }\r\n\r\n\r\n\r\n    registerEnum(name: string, values: string[]) {\r\n        new CustomEnumType(this, name, values).install();\r\n    }\r\n\r\n    getThisOrSiblingFor(name: QName): _ISchema {\r\n        if (!name?.schema || name.schema === this.name) {\r\n            return this;\r\n        }\r\n        return this.db.getSchema(name.schema);\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    private simpleTypes: { [key: string]: _IType } = {};\r\n    private sizeableTypes: {\r\n        [key: string]: {\r\n            ctor: (...sz: number[]) => _IType;\r\n            regs: Map<number | string | undefined, _IType>;\r\n        };\r\n    } = {};\r\n\r\n\r\n    parseType(native: string): _IType {\r\n        if (/\\[\\]$/.test(native)) {\r\n            const inner = this.parseType(native.substr(0, native.length - 2));\r\n            return inner.asArray();\r\n        }\r\n        return this.getType({ name: native });\r\n    }\r\n\r\n\r\n    getOwnType(t: DataTypeDef): _IType | null {\r\n        if (t.kind === 'array') {\r\n            const $of = this.getOwnType(t.arrayOf);\r\n            if (!$of) {\r\n                return null;\r\n            }\r\n            return $of.asArray();\r\n        }\r\n        const name = (t.doubleQuoted ? null : typeSynonyms[t.name]) ?? t.name;\r\n        const sizeable = this.sizeableTypes[name];\r\n        if (sizeable) {\r\n            const key = t.config?.length === 1\r\n                ? t.config[0]\r\n                : t.config?.join(',') ?? undefined;\r\n            let ret = sizeable.regs.get(key);\r\n            if (!ret) {\r\n                sizeable.regs.set(key, ret = sizeable.ctor(...t.config ?? []));\r\n            }\r\n            return ret;\r\n        }\r\n\r\n        return this.simpleTypes[name] ?? null;\r\n    }\r\n\r\n\r\n    getTypePub(t: DataType | IType): _IType {\r\n        return this.getType(t as TypeQuery);\r\n    }\r\n\r\n    getType(t: TypeQuery): _IType;\r\n    getType(_t: TypeQuery, opts?: QueryObjOpts): _IType | null {\r\n        if (typeof _t === 'number') {\r\n            const byOid = this.relsByTyp.get(_t);\r\n            if (byOid) {\r\n                return asType(byOid);\r\n            }\r\n            throw new TypeNotFound(_t);\r\n        }\r\n        if (typeof _t === 'string') {\r\n            return this.getType({ name: _t });\r\n        }\r\n        if (isType(_t)) {\r\n            return _t;\r\n        }\r\n        const t = _t;\r\n        function chk<T>(ret: T): T {\r\n            if (!ret && !opts?.nullIfNotFound) {\r\n                throw new TypeNotFound(t);\r\n            }\r\n            return ret;\r\n        }\r\n        const schema = schemaOf(t);\r\n        if (schema) {\r\n            if (schema === this.name) {\r\n                return chk(this.getOwnType(t));\r\n            } else {\r\n                return chk(this.db.getSchema(schema)\r\n                    .getType(t, opts));\r\n            }\r\n        }\r\n        if (opts?.skipSearch) {\r\n            return chk(this.getOwnType(t));\r\n        }\r\n        for (const sp of this.db.searchPath) {\r\n            const rel = this.db.getSchema(sp).getOwnType(t);\r\n            if (rel) {\r\n                return rel;\r\n            }\r\n        }\r\n        return chk(this.getOwnType(t));\r\n    }\r\n\r\n\r\n    getObject(p: QName): _IRelation;\r\n    getObject(p: QName, opts: BeingCreated): _IRelation;\r\n    getObject(p: QName, opts?: QueryObjOpts): _IRelation | null;\r\n    getObject(p: QName, opts?: QueryObjOpts): _IRelation | null {\r\n        function chk(ret: _IRelation | null): _IRelation | null {\r\n            const bc = opts?.beingCreated;\r\n            if (!ret && bc && (\r\n                !p.schema || p.schema === bc.ownerSchema?.name\r\n            ) && bc.name === p.name) {\r\n                ret = bc;\r\n            }\r\n            if (!ret && !opts?.nullIfNotFound) {\r\n                throw new RelationNotFound(p.name);\r\n            }\r\n            return ret;\r\n        }\r\n        if (p.schema) {\r\n            if (p.schema === this.name) {\r\n                return chk(this.getOwnObject(p.name));\r\n            } else {\r\n                return chk(this.db.getSchema(p.schema)\r\n                    .getObject(p, opts));\r\n            }\r\n        }\r\n\r\n        if (opts?.skipSearch) {\r\n            return chk(this.getOwnObject(p.name));\r\n        }\r\n        for (const sp of this.db.searchPath) {\r\n            const rel = this.db.getSchema(sp).getOwnObject(p.name);\r\n            if (rel) {\r\n                return rel;\r\n            }\r\n        }\r\n        return chk(this.getOwnObject(p.name));\r\n    }\r\n\r\n    getOwnObject(name: string): _IRelation | null {\r\n        return this.relsByNameCas.get(name)\r\n            ?? null;\r\n    }\r\n\r\n    getObjectByRegOrName(reg: RegClass): _IRelation;\r\n    getObjectByRegOrName(reg: RegClass, opts?: QueryObjOpts): _IRelation | null;\r\n    getObjectByRegOrName(_reg: RegClass, opts?: QueryObjOpts): _IRelation | null {\r\n        const reg = parseRegClass(_reg);\r\n\r\n        if (typeof reg === 'number') {\r\n            return this.getObjectByRegClassId(reg, opts);\r\n        }\r\n\r\n        return this.getObject(reg, opts);\r\n    }\r\n\r\n    getObjectByRegClassId(reg: number): _IRelation;\r\n    getObjectByRegClassId(reg: number, opts?: QueryObjOpts): _IRelation | null;\r\n    getObjectByRegClassId(reg: number, opts?: QueryObjOpts) {\r\n        function chk<T>(ret: T): T {\r\n            if (!ret && !opts?.nullIfNotFound) {\r\n                throw new RelationNotFound(reg.toString());\r\n            }\r\n            return ret;\r\n        }\r\n        if (opts?.skipSearch) {\r\n            return chk(this.getOwnObjectByRegClassId(reg));\r\n        }\r\n        for (const sp of this.db.searchPath) {\r\n            const rel = this.db.getSchema(sp).getOwnObjectByRegClassId(reg);\r\n            if (rel) {\r\n                return rel;\r\n            }\r\n        }\r\n        return chk(this.getOwnObjectByRegClassId(reg));\r\n    }\r\n\r\n    getOwnObjectByRegClassId(reg: number): _IRelation | null {\r\n        return this.relsByCls.get(reg)\r\n            ?? null;\r\n    }\r\n\r\n    createSequence(t: _Transaction, opts: CreateSequenceOptions | nil, _name: QName | nil): _ISequence {\r\n        _name = _name ?? {\r\n            name: randomString(),\r\n        };\r\n        return new ExecuteCreateSequence(this, {\r\n            type: 'create sequence',\r\n            name: _name,\r\n            options: opts ?? {},\r\n        }, true).createSeq(t)!;\r\n    }\r\n\r\n    explainLastSelect(): _SelectExplanation | undefined {\r\n        return this.lastSelect?.explain(new Explainer(this.db.data));\r\n    }\r\n\r\n    explainSelect(sql: string): _SelectExplanation {\r\n        let parsed = this.parse(sql);\r\n        if (parsed.length !== 1) {\r\n            throw new Error('Expecting a single statement');\r\n        }\r\n        if (parsed[0].type !== 'select') {\r\n            throw new Error('Expecting a select statement');\r\n        }\r\n        const prepared = new StatementExec(this, parsed[0], sql)\r\n            .compile();\r\n        if (!(prepared instanceof SelectExec)) {\r\n            throw new Error('Can only explain selection executors');\r\n        }\r\n        return prepared\r\n            .selection\r\n            .explain(new Explainer(this.db.data))\r\n    }\r\n\r\n    executeCreateExtension(p: CreateExtensionStatement) {\r\n        const ext = this.db.getExtension(p.extension.name);\r\n        const schema = p.schema\r\n            ? this.db.getSchema(p.schema.name)\r\n            : this;\r\n        this.db.raiseGlobal('create-extension', p.extension, schema, p.version, p.from);\r\n        const ne = p.ifNotExists; // evaluate outside\r\n        if (this.installedExtensions.has(p.extension.name)) {\r\n            if (ne) {\r\n                return;\r\n            }\r\n            throw new QueryError('Extension already created !');\r\n        }\r\n\r\n        ext(schema);\r\n        this.installedExtensions.add(p.extension.name);\r\n    }\r\n\r\n    getTable(name: string): _ITable;\r\n    getTable(name: string, nullIfNotFound?: boolean): _ITable | null;\r\n    getTable(name: string, nullIfNotFound?: boolean): _ITable | null {\r\n        const ret = this.getOwnObject(name);\r\n        if ((!ret || ret.type !== 'table')) {\r\n            if (nullIfNotFound) {\r\n                return null;\r\n            }\r\n            throw new RelationNotFound(name);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n\r\n\r\n    declareTable(table: Schema, noSchemaChange?: boolean): MemoryTable {\r\n        const trans = this.db.data.fork();\r\n        const ret = new MemoryTable(this, trans, table).register();\r\n        trans.commit();\r\n        if (!noSchemaChange) {\r\n            this.db.onSchemaChange();\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    registerEquivalentType(type: IEquivalentType): IType {\r\n        const ret = new EquivalentType(type);\r\n        this._registerType(ret);\r\n        return ret;\r\n    }\r\n\r\n    _registerTypeSizeable(name: string, ctor: (sz?: number) => _IType): this {\r\n        if (this.simpleTypes[name] || this.sizeableTypes[name]) {\r\n            throw new QueryError(`type \"${name}\" already exists`);\r\n        }\r\n        this.sizeableTypes[name] = {\r\n            ctor,\r\n            regs: new Map(),\r\n        };\r\n        return this;\r\n    }\r\n\r\n    _registerType(type: _IType): this {\r\n        if (this.simpleTypes[type.primary] || this.sizeableTypes[type.primary] || this.getOwnObject(type.primary)) {\r\n            throw new QueryError(`type \"${type.primary}\" already exists`);\r\n        }\r\n        this.simpleTypes[type.primary] = type;\r\n        this._reg_register(type);\r\n        return this;\r\n    }\r\n\r\n    _unregisterType(type: _IType): this {\r\n        delete this.simpleTypes[type.primary];\r\n        this._reg_unregister(type);\r\n        return this;\r\n    }\r\n\r\n\r\n    _reg_register(rel: _IRelation): Reg {\r\n        if (this.readonly) {\r\n            throw new PermissionDeniedError()\r\n        }\r\n        if (this.relsByNameCas.has(rel.name)) {\r\n            throw new Error(`relation \"${rel.name}\" already exists`);\r\n        }\r\n        const ret: Reg = regGen();\r\n        this.relsByNameCas.set(rel.name, rel);\r\n        this.relsByCls.set(ret.classId, rel);\r\n        this.relsByTyp.set(ret.typeId, rel);\r\n        if (rel.type === 'table') {\r\n            this._tables.add(rel);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    _reg_unregister(rel: _IRelation): void {\r\n        if (this.readonly) {\r\n            throw new PermissionDeniedError()\r\n        }\r\n        this.relsByNameCas.delete(rel.name);\r\n        this.relsByCls.delete(rel.reg.classId);\r\n        this.relsByTyp.delete(rel.reg.typeId);\r\n        if (rel.type === 'table') {\r\n            this._tables.delete(rel);\r\n        }\r\n    }\r\n\r\n    _reg_rename(rel: _IRelation, oldName: string, newName: string): void {\r\n        if (this.readonly) {\r\n            throw new PermissionDeniedError()\r\n        }\r\n        if (this.relsByNameCas.has(newName)) {\r\n            throw new Error('relation exists: ' + newName);\r\n        }\r\n        if (this.relsByNameCas.get(oldName) !== rel) {\r\n            throw new Error('consistency error while renaming relation');\r\n        }\r\n        this.relsByNameCas.delete(oldName);\r\n        this.relsByNameCas.set(newName, rel);\r\n    }\r\n\r\n\r\n\r\n    tablesCount(t: _Transaction): number {\r\n        return this._tables.size;\r\n    }\r\n\r\n\r\n    *listTables(): Iterable<_ITable> {\r\n        for (const t of this._tables.values()) {\r\n            if (!t.hidden) {\r\n                yield t;\r\n            }\r\n        }\r\n    }\r\n\r\n    registerFunction(fn: FunctionDefinition, replace?: boolean): this {\r\n        const def: _FunctionDefinition = {\r\n            name: fn.name,\r\n            args: (fn.args?.map<ArgDefDetails>(x => {\r\n                if (typeof x === 'string' || isType(x)) {\r\n                    return {\r\n                        type: this.getTypePub(x),\r\n                    };\r\n                }\r\n                return x;\r\n            }) ?? []) as _ArgDefDetails[],\r\n            argsVariadic: fn.argsVariadic && this.getTypePub(fn.argsVariadic),\r\n            returns: fn.returns && this.getTypePub(fn.returns),\r\n            impure: !!fn.impure,\r\n            implementation: fn.implementation,\r\n            allowNullArguments: fn.allowNullArguments,\r\n        };\r\n\r\n        this.fns.add(def, replace ?? true);\r\n        return this;\r\n    }\r\n\r\n    registerOperator(op: OperatorDefinition, replace?: boolean): this {\r\n        this._registerOperator(op, replace ?? true);\r\n        if (op.commutative && op.left !== op.right) {\r\n            this._registerOperator({\r\n                ...op,\r\n                left: op.right,\r\n                right: op.left,\r\n                implementation: (a, b) => op.implementation(b, a),\r\n            }, replace ?? true);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    private _registerOperator(fn: OperatorDefinition, replace: boolean): this {\r\n        const args = [fn.left, fn.right].map<ArgDefDetails>(x => {\r\n            if (typeof x === 'string' || isType(x)) {\r\n                return {\r\n                    type: this.getTypePub(x),\r\n                };\r\n            }\r\n            return x;\r\n        }) as _ArgDefDetails[];\r\n        const def: _OperatorDefinition = {\r\n            name: fn.operator,\r\n            args,\r\n            left: args[0].type,\r\n            right: args[1].type,\r\n            returns: fn.returns && this.getTypePub(fn.returns),\r\n            impure: !!fn.impure,\r\n            implementation: fn.implementation,\r\n            allowNullArguments: fn.allowNullArguments,\r\n            commutative: fn.commutative ?? false,\r\n        };\r\n\r\n        this.ops.add(def, replace);\r\n        return this;\r\n    }\r\n\r\n\r\n    resolveFunction(name: string | QName, args: IValue[], forceOwn?: boolean): _FunctionDefinition | nil {\r\n        const asSingle = asSingleQName(name, this.name);\r\n        if (!asSingle || !forceOwn) {\r\n            return this.db.resolveFunction(name, args);\r\n        }\r\n        return this.fns.resolve(asSingle, args);\r\n    }\r\n\r\n    getFunction(name: string, args: _IType[]): _FunctionDefinition | nil {\r\n        return this.fns.getExact(name, args);\r\n    }\r\n\r\n\r\n    dropFunction(fn: DropFunctionStatement): void {\r\n        if (fn.name.schema && fn.name.schema !== this.name) {\r\n            return (this.db.getSchema(fn.name.schema) as DbSchema).dropFunction(fn);\r\n        }\r\n        const fns = this.fns.getOverloads(fn.name.name);\r\n\r\n        // === determine which function to delete\r\n        let toRemove: _FunctionDefinition;\r\n        if (fn.arguments) {\r\n            const targetArgs = fn.arguments;\r\n            const match = fns?.filter(x => x.args.length === targetArgs.length\r\n                && !x.args.some((a, i) => a.type !== this.getType(targetArgs[i].type)));\r\n            if (!match?.length) {\r\n                if (fn.ifExists) {\r\n                    return;\r\n                }\r\n                throw new QueryError(`function ${fn.name.name}(${targetArgs.map(t => typeDefToStr(t.type)).join(',')}) does not exist`, '42883');\r\n            }\r\n            if (match.length > 1) {\r\n                throw new QueryError(`function name \"${fn.name.name}\" is ambiguous`, '42725');\r\n            }\r\n            toRemove = match[0];\r\n        } else {\r\n            if (!fns?.length) {\r\n                if (fn.ifExists) {\r\n                    return;\r\n                }\r\n                throw new QueryError(`could not find a function named \"${fn.name.name}\"`, '42883');\r\n            }\r\n            if (fns?.length !== 1) {\r\n                throw new QueryError(`function name \"${fn.name.name}\" is not unique`, '42725');\r\n            }\r\n            toRemove = fns[0];\r\n        }\r\n\r\n\r\n        this.fns.remove(toRemove);\r\n    }\r\n\r\n    resolveOperator(name: BinaryOperator, left: IValue, right: IValue, forceOwn?: boolean): _OperatorDefinition | nil {\r\n        if (!forceOwn) {\r\n            return this.db.resolveOperator(name, left, right);\r\n        }\r\n        return this.ops.resolve(name, [left, right]);\r\n    }\r\n\r\n\r\n    async migrate(config?: IMigrate.MigrationParams) {\r\n        await migrate(this, config);\r\n    }\r\n\r\n\r\n\r\n    interceptQueries(intercept: QueryInterceptor): ISubscription {\r\n        const qi = { intercept } as const;\r\n        this.interceptors.add(qi);\r\n        return {\r\n            unsubscribe: () => {\r\n                this.interceptors.delete(qi);\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\nclass Explainer implements _Explainer {\r\n    private sels = new Map<_ISelection, number>();\r\n    constructor(readonly transaction: _Transaction) {\r\n    }\r\n\r\n    idFor(sel: _ISelection): string | number {\r\n        if (sel.debugId) {\r\n            return sel.debugId;\r\n        }\r\n        if (this.sels.has(sel)) {\r\n            return this.sels.get(sel)!;\r\n        }\r\n        const id = this.sels.size + 1;\r\n        this.sels.set(sel, id);\r\n        return id;\r\n    }\r\n\r\n}\r\n","import { IValue, _IType, _ISelection, _ISchema, _IDb, _Transaction } from '../interfaces-private';\r\nimport { Types, ArrayType } from '../datatypes';\r\nimport { QueryError, NotSupported, nil } from '../interfaces';\r\nimport { Evaluator } from '../evaluator';\r\nimport hash from 'object-hash';\r\nimport { parseArrayLiteral, QName } from 'pgsql-ast-parser';\r\nimport { asSingleQName, nullIsh, qnameToStr } from '../utils';\r\nimport { buildCtx } from './context';\r\n\r\n\r\nexport function buildCall(name: string | QName, args: IValue[]): IValue {\r\n    let type: _IType | nil = null;\r\n    let get: (...args: any[]) => any;\r\n\r\n    let impure = false;\r\n    let acceptNulls = false;\r\n    const { schema } = buildCtx();\r\n\r\n    // put your ugly hack here   ...\r\n    switch (asSingleQName(name)) {\r\n        case 'any':\r\n            return buildAnyCall(args);\r\n        case 'current_schema':\r\n            type = Types.text();\r\n            get = () => 'public';\r\n            break;\r\n        // a set of functions that are calledby Tyopeorm, but we dont needto support them yet\r\n        // since there is not result (function never actually called)\r\n        case 'pg_get_constraintdef':\r\n        case 'pg_get_expr':\r\n            type = Types.text();\r\n            get = () => {\r\n                throw new NotSupported(qnameToStr(name) + ' is not supported');\r\n            };\r\n            break;\r\n        case 'unnest':\r\n            if (args.length !== 1) {\r\n                throw new QueryError('unnest expects 1 arguments, given ' + args.length);\r\n            }\r\n            const utype = args[0].type;\r\n            if (!(utype instanceof ArrayType)) {\r\n                throw new QueryError('unnest expects enumerable argument ' + utype.primary);\r\n            }\r\n            type = utype.of;\r\n            get = () => {\r\n                throw new NotSupported(qnameToStr(name) + ' is not supported');\r\n            };\r\n            break;\r\n        case 'coalesce':\r\n            acceptNulls = true;\r\n            if (!args.length) {\r\n                throw new QueryError('coalesce expects at least 1 argument');\r\n            }\r\n            type = args.reduce<_IType>((a, b) => {\r\n                if (a === b.type) {\r\n                    return a;\r\n                }\r\n                if (b.type.canCast(a)) {\r\n                    return a;\r\n                }\r\n                if (a.canCast(b.type)) {\r\n                    return b.type;\r\n                }\r\n                throw new QueryError(`COALESCE types ${a.name} and ${b.type.name} cannot be matched`, '42804');\r\n            }, args[0].type);\r\n            args = args.map(x => x.cast(type!));\r\n            get = (...args: any[]) => args.find(x => !nullIsh(x));\r\n            break;\r\n        default:\r\n            // try to find a matching custom function overloads\r\n            acceptNulls = true;\r\n            const resolved = schema.resolveFunction(name, args);\r\n            if (resolved) {\r\n                args = args.map((x, i) => x.cast(resolved.args[i]?.type ?? resolved.argsVariadic));\r\n                type = resolved.returns;\r\n                get = resolved.implementation;\r\n                impure = !!resolved.impure;\r\n                acceptNulls = !!resolved.allowNullArguments;\r\n            }\r\n            break;\r\n\r\n    }\r\n    if (!get!) {\r\n        throw new QueryError({\r\n            error: `function ${qnameToStr(name)}(${args.map(a => a.type.name).join(',')}) does not exist`,\r\n            hint: ` Please note that pg-mem implements very few native functions.\r\n\r\n             You can specify the functions you would like to use via \"db.public.registerFunction(...)\"`\r\n        })\r\n    }\r\n    return new Evaluator(\r\n        type ?? Types.null\r\n        , null\r\n        , hash({ call: name, args: args.map(x => x.hash) })\r\n        , args\r\n        , (raw, t) => {\r\n            const argRaw = args.map(x => x.get(raw, t));\r\n            if (!acceptNulls && argRaw.some(nullIsh)) {\r\n                return null;\r\n            }\r\n            return get(...argRaw);\r\n        }, impure ? { unpure: impure } : undefined);\r\n}\r\n\r\n\r\nfunction buildAnyCall(args: IValue[]) {\r\n    if (args.length !== 1) {\r\n        throw new QueryError('ANY() expects 1 argument, given ' + args.length);\r\n    }\r\n    const array = args[0];\r\n\r\n    // == if ANY(select something) ... get the element type\r\n    if (array.type instanceof ArrayType) {\r\n        return new Evaluator(\r\n            array.type.of\r\n            , null\r\n            , hash({ any: array.hash })\r\n            , args\r\n            , (raw, t) => {\r\n                return array.get(raw, t);\r\n            }\r\n            , { isAny: true } // <== isAny !\r\n        );\r\n    }\r\n\r\n    // == if ANY('{elements}') ... will be an array of text => keep text\r\n\r\n    if (array.type !== Types.text() || !array.isConstantLiteral) {\r\n        throw new QueryError('ANY() expects either a selection, or an array literal');\r\n    }\r\n    // parse ANY() array literal\r\n    const arrayValue = parseArrayLiteral(array.get());\r\n    return new Evaluator(\r\n        Types.text()\r\n        , null\r\n        , hash({ any: array.hash })\r\n        , args\r\n        , arrayValue\r\n        , { isAny: true } // <== isAny !\r\n    );\r\n}","import { DataType, QueryError } from '../interfaces';\r\nimport { _IType } from '../interfaces-private';\r\nimport { Box, Circle, Line, Path, Point, Polygon, Segment } from 'pgsql-ast-parser';\r\nimport { Evaluator } from '../evaluator';\r\nimport { TypeBase } from './datatype-base';\r\n\r\nexport function pointToStr(p: Point) {\r\n    return `(${p.x},${p.y})`;\r\n}\r\n\r\nexport function pointEq(a: Point, b: Point) {\r\n    return a.x === b.x && a.y === b.y;\r\n}\r\n\r\nexport class PointType extends TypeBase<Point> {\r\n    get primary(): DataType {\r\n        return DataType.point;\r\n    }\r\n    get name() {\r\n        return 'point';\r\n    }\r\n    doCanCast(t: _IType) {\r\n        return t.primary === DataType.text;\r\n    }\r\n\r\n    doCast(value: Evaluator<Point>, to: _IType) {\r\n        if (to.primary !== DataType.text) {\r\n            throw new QueryError(`Invalid cast to: ` + to.primary);\r\n        }\r\n        return value\r\n            .setConversion((p: Point) => {\r\n                return pointToStr(p);\r\n            }\r\n                , pointToTxt => ({ pointToTxt }));\r\n    }\r\n\r\n    doEquals(a: Point, b: Point) {\r\n        return pointEq(a, b);\r\n    }\r\n\r\n    doGt(a: Point, b: Point) {\r\n        if (a.x !== b.x) {\r\n            return a.x > b.x;\r\n        }\r\n        return a.y > b.y;\r\n    }\r\n\r\n    doLt(a: Point, b: Point) {\r\n        if (a.x !== b.x) {\r\n            return a.x < b.x;\r\n        }\r\n        return a.y < b.y;\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class LineType extends TypeBase<Line> {\r\n\r\n    get primary(): DataType {\r\n        return DataType.line;\r\n    }\r\n    get name() {\r\n        return 'line';\r\n    }\r\n    doCanCast(t: _IType) {\r\n        return t.primary === DataType.text;\r\n    }\r\n\r\n    doCast(value: Evaluator<Line>, to: _IType) {\r\n        if (to.primary !== DataType.text) {\r\n            throw new QueryError(`Invalid cast to: ` + to.primary);\r\n        }\r\n        return value\r\n            .setConversion((l: Line) => {\r\n                return `{${l.a},${l.b},${l.c}}`;\r\n            }\r\n                , lineToTxt => ({ lineToTxt }));\r\n    }\r\n\r\n    doEquals(a: Line, b: Line) {\r\n        return a.a === b.a && a.b === b.b && a.c === b.c;\r\n    }\r\n}\r\n\r\nexport class LsegType extends TypeBase<Segment> {\r\n\r\n    get primary(): DataType {\r\n        return DataType.lseg;\r\n    }\r\n    get name() {\r\n        return 'lseg';\r\n    }\r\n    doCanCast(t: _IType) {\r\n        return t.primary === DataType.text;\r\n    }\r\n\r\n    doCast(value: Evaluator<Segment>, to: _IType) {\r\n        if (to.primary !== DataType.text) {\r\n            throw new QueryError(`Invalid cast to: ` + to.primary);\r\n        }\r\n        return value\r\n            .setConversion(([a, b]: Segment) => {\r\n                return `[${pointToStr(a)},${pointToStr(b)}]`;\r\n            }\r\n                , SegmentToTxt => ({ SegmentToTxt }));\r\n    }\r\n\r\n    doEquals([as, ae]: Segment, [bs, be]: Segment) {\r\n        return pointEq(as, bs) && pointEq(ae, be);\r\n    }\r\n}\r\n\r\nexport class BoxType extends TypeBase<Box> {\r\n\r\n    get primary(): DataType {\r\n        return DataType.box;\r\n    }\r\n    get name() {\r\n        return 'box';\r\n    }\r\n    doCanCast(t: _IType) {\r\n        return t.primary === DataType.text;\r\n    }\r\n\r\n    doCast(value: Evaluator<Box>, to: _IType) {\r\n        if (to.primary !== DataType.text) {\r\n            throw new QueryError(`Invalid cast to: ` + to.primary);\r\n        }\r\n        return value\r\n            .setConversion(([a, b]: Box) => {\r\n                return `${pointToStr(a)},${pointToStr(b)}`;\r\n            }\r\n                , BoxToTxt => ({ BoxToTxt }));\r\n    }\r\n\r\n    doEquals([as, ae]: Box, [bs, be]: Box) {\r\n        return pointEq(as, bs) && pointEq(ae, be);\r\n    }\r\n}\r\n\r\nexport class PathType extends TypeBase<Path> {\r\n\r\n    get primary(): DataType {\r\n        return DataType.path;\r\n    }\r\n    get name() {\r\n        return 'path';\r\n    }\r\n    doCanCast(t: _IType) {\r\n        return t.primary === DataType.text;\r\n    }\r\n\r\n    doCast(value: Evaluator<Path>, to: _IType) {\r\n        if (to.primary !== DataType.text) {\r\n            throw new QueryError(`Invalid cast to: ` + to.primary);\r\n        }\r\n        return value\r\n            .setConversion((p: Path) => {\r\n                const vals = p.path.map(pointToStr).join(',');\r\n                return p.closed\r\n                    ? '(' + vals + ')'\r\n                    : '[' + vals + ']';\r\n            }\r\n                , PathToTxt => ({ PathToTxt }));\r\n    }\r\n\r\n    doEquals(a: Path, b: Path) {\r\n        // Yup, you read that right ...\r\n        //  Try it... path equality always returns true (???)\r\n        return true;\r\n        // return !!a.closed === !!b.closed\r\n        //     && a.path.length === b.path.length\r\n        //     && a.path.every((x, i) => pointEq(x, b.path[i]));\r\n    }\r\n}\r\n\r\nexport class PolygonType extends TypeBase<Polygon> {\r\n\r\n    get primary(): DataType {\r\n        return DataType.polygon;\r\n    }\r\n    get name() {\r\n        return 'polygon';\r\n    }\r\n    doCanCast(t: _IType) {\r\n        return t.primary === DataType.text;\r\n    }\r\n\r\n    doCast(value: Evaluator<Polygon>, to: _IType) {\r\n        if (to.primary !== DataType.text) {\r\n            throw new QueryError(`Invalid cast to: ` + to.primary);\r\n        }\r\n        return value\r\n            .setConversion((p: Polygon) => {\r\n                const vals = p.map(pointToStr).join(',');\r\n                return '(' + vals + ')';\r\n            }\r\n                , PolygonToTxt => ({ PolygonToTxt }));\r\n    }\r\n\r\n    doEquals(a: Polygon, b: Polygon) {\r\n        return a.length === b.length\r\n            && a.every((x, i) => pointEq(x, b[i]));\r\n    }\r\n}\r\n\r\n\r\nexport class CircleType extends TypeBase<Circle> {\r\n\r\n    get primary(): DataType {\r\n        return DataType.circle;\r\n    }\r\n    get name() {\r\n        return 'circle';\r\n    }\r\n    doCanCast(t: _IType) {\r\n        return t.primary === DataType.text;\r\n    }\r\n\r\n    doCast(value: Evaluator<Circle>, to: _IType) {\r\n        if (to.primary !== DataType.text) {\r\n            throw new QueryError(`Invalid cast to: ` + to.primary);\r\n        }\r\n        return value\r\n            .setConversion((p: Circle) => {\r\n                return `<${pointToStr(p.c)},${p.r}>`\r\n            }\r\n                , CircleToTxt => ({ CircleToTxt }));\r\n    }\r\n\r\n    doEquals(a: Circle, b: Circle) {\r\n        return pointEq(a.c, b.c) && a.r === b.r;\r\n    }\r\n}\r\n","import { DataType, nil, _IType } from '../interfaces-private';\r\nimport { Interval, normalizeInterval, parseIntervalLiteral } from 'pgsql-ast-parser';\r\nimport { TypeBase } from './datatype-base';\r\nimport { Evaluator } from '../evaluator';\r\nimport { intervalToSec } from '../utils';\r\n\r\nexport class IntervalType extends TypeBase<Interval> {\r\n\r\n    get primary(): DataType {\r\n        return DataType.interval;\r\n    }\r\n\r\n    doCanBuildFrom(from: _IType) {\r\n        switch (from.primary) {\r\n            case DataType.text:\r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    doBuildFrom(value: Evaluator, from: _IType): Evaluator<Interval> | nil {\r\n        switch (from.primary) {\r\n            case DataType.text:\r\n                return value\r\n                    .setConversion(str => {\r\n                        const conv = normalizeInterval(parseIntervalLiteral(str));\r\n                        return conv;\r\n                    }\r\n                        , toInterval => ({ toInterval }));\r\n        }\r\n        return null;\r\n    }\r\n\r\n    doEquals(a: Interval, b: Interval): boolean {\r\n        return intervalToSec(a) === intervalToSec(b);\r\n    }\r\n    doGt(a: Interval, b: Interval): boolean {\r\n        return intervalToSec(a) > intervalToSec(b);\r\n    }\r\n    doLt(a: Interval, b: Interval): boolean {\r\n        return intervalToSec(a) < intervalToSec(b);\r\n    }\r\n}\r\n","import { DataType, nil, _IType } from '../interfaces-private';\r\nimport { TypeBase } from './datatype-base';\r\nimport { Evaluator } from '../evaluator';\r\nimport { parseTime } from '../utils';\r\n\r\n\r\nexport class TimeType extends TypeBase<string> {\r\n\r\n\r\n    constructor(readonly primary: DataType.time | DataType.timetz) {\r\n        super();\r\n    }\r\n\r\n\r\n    get name(): string {\r\n        return this.primary === DataType.timetz\r\n            ? 'time with time zone'\r\n            : 'time without time zone';\r\n    }\r\n\r\n\r\n    doCanCast(to: _IType) {\r\n        switch (to.primary) {\r\n            case DataType.text:\r\n            case DataType.timetz:\r\n            case DataType.time:\r\n                return true;\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    doCanConvertImplicit(to: _IType) {\r\n        switch (to.primary) {\r\n            case DataType.timetz:\r\n                return true;\r\n            case DataType.time:\r\n                return this.primary === DataType.time;\r\n        }\r\n        return false;\r\n    }\r\n\r\n\r\n    doCast(value: Evaluator, to: _IType) {\r\n        switch (to.primary) {\r\n            case DataType.text:\r\n            case DataType.time:\r\n            case DataType.timetz:\r\n                return value\r\n                    .setType(to);\r\n        }\r\n        throw new Error('Unexpected cast error');\r\n    }\r\n\r\n\r\n    doCanBuildFrom(from: _IType) {\r\n        switch (from.primary) {\r\n            case DataType.text:\r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    doBuildFrom(value: Evaluator, from: _IType): Evaluator<string> | nil {\r\n        switch (from.primary) {\r\n            case DataType.text:\r\n                return value\r\n                    .setConversion(str => {\r\n                        const conv = parseTime(str);\r\n                        const ret = conv.format('HH:mm:ss');\r\n                        const ms = conv.milliseconds();\r\n                        return ms\r\n                            ? ret + (ms / 1000).toString(10).substr(1)\r\n                            : ret;\r\n                    }\r\n                        , toTime => ({ toTime }));\r\n        }\r\n        return null;\r\n    }\r\n\r\n}\r\n","import { DataType, nil, QueryError, _IType } from '../interfaces-private';\r\nimport { TypeBase } from './datatype-base';\r\nimport { Evaluator } from '../evaluator';\r\nimport moment from 'moment';\r\nimport { parseTime, nullIsh } from '../utils';\r\n\r\nexport class TimestampType extends TypeBase<Date> {\r\n\r\n\r\n    constructor(readonly primary: DataType, readonly precision: number | null = null) {\r\n        super();\r\n    }\r\n\r\n    get name(): string {\r\n        if (!nullIsh(this.precision)) {\r\n            return `${this.primary}(${this.precision})`;\r\n        }\r\n        switch (this.primary) {\r\n            case DataType.timestamp:\r\n                return 'timestamp without time zone';\r\n            case DataType.timestamptz:\r\n                return 'timestamp with time zone';\r\n            case DataType.date:\r\n                return 'date';\r\n            case DataType.time:\r\n                return 'time without time zone';\r\n            case DataType.timetz:\r\n                return 'time with time zone';\r\n        }\r\n        return this.primary;\r\n    }\r\n\r\n    doCanCast(to: _IType) {\r\n        switch (to.primary) {\r\n            case DataType.timestamp:\r\n            case DataType.timestamptz:\r\n            case DataType.date:\r\n                return this.primary !== DataType.time && this.primary !== DataType.timetz;\r\n            case DataType.time:\r\n                return this.primary !== DataType.date;\r\n            case DataType.timetz:\r\n                return this.primary !== DataType.date && this.primary !== DataType.timestamp;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    doCanConvertImplicit(to: _IType) {\r\n        switch (to.primary) {\r\n            case DataType.timestamp:\r\n                return this.primary === DataType.timestamp\r\n                    || this.primary === DataType.date;\r\n            case DataType.timestamptz:\r\n                return this.primary !== DataType.time;\r\n            case DataType.date:\r\n                return this.primary === DataType.date;\r\n            case DataType.time:\r\n                return this.primary === DataType.time; // nothing can implicitly cast to time\r\n        }\r\n        return false;\r\n    }\r\n\r\n    doCast(value: Evaluator, to: _IType) {\r\n        switch (to.primary) {\r\n            case DataType.timestamp:\r\n            case DataType.timestamptz:\r\n                return value;\r\n            case DataType.date:\r\n                return value\r\n                    .setConversion(raw => moment.utc(raw).startOf('day').toDate()\r\n                        , toDate => ({ toDate }));\r\n            case DataType.time:\r\n            case DataType.timetz:\r\n                return value\r\n                    .setConversion(raw => moment.utc(raw).format('HH:mm:ss') + '.000000'\r\n                        , toDate => ({ toDate }));\r\n        }\r\n        throw new Error('Unexpected cast error');\r\n    }\r\n\r\n\r\n    doCanBuildFrom(from: _IType) {\r\n        switch (from.primary) {\r\n            case DataType.text:\r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    doBuildFrom(value: Evaluator, from: _IType): Evaluator<Date> | nil {\r\n        switch (from.primary) {\r\n            case DataType.text:\r\n                switch (this.primary) {\r\n                    case DataType.timestamp:\r\n                    case DataType.timestamptz:\r\n                        return value\r\n                            .setConversion(str => {\r\n                                const conv = moment.utc(str);\r\n                                if (!conv.isValid()) {\r\n                                    throw new QueryError(`Invalid timestamp format: ` + str);\r\n                                }\r\n                                return conv.toDate()\r\n                            }\r\n                                , toTs => ({ toTs, t: this.primary }));\r\n                    case DataType.date:\r\n                        return value\r\n                            .setConversion(str => {\r\n                                const conv = moment.utc(str);\r\n                                if (!conv.isValid()) {\r\n                                    throw new QueryError(`Invalid timestamp format: ` + str);\r\n                                }\r\n                                return conv.startOf('day').toDate();\r\n                            }\r\n                                , toDate => ({ toDate }));\r\n                    case DataType.time:\r\n                    case DataType.timetz:\r\n                        return value\r\n                            .setConversion(str => {\r\n                                parseTime(str); // will throw an error if invalid format\r\n                                return str;\r\n                            }\r\n                                , toTime => ({ toTime, t: this.primary }));\r\n                }\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n\r\n    doEquals(a: any, b: any): boolean {\r\n        return Math.abs(moment(a).diff(moment(b))) < 0.1;\r\n    }\r\n    doGt(a: any, b: any): boolean {\r\n        return moment(a).diff(moment(b)) > 0;\r\n    }\r\n    doLt(a: any, b: any): boolean {\r\n        return moment(a).diff(moment(b)) < 0;\r\n    }\r\n}","import { DataType, nil, _IType } from '../interfaces-private';\r\nimport { TypeBase } from './datatype-base';\r\nimport { Evaluator } from '../evaluator';\r\nimport { deepCompare, deepEqual, errorMessage } from '../utils';\r\nimport { Types } from './datatypes';\r\nimport { JSON_NIL } from '../execution/clean-results';\r\nimport { QueryError } from '../interfaces';\r\nimport stringify from 'json-stable-stringify';\r\n\r\nexport class JSONBType extends TypeBase<any> {\r\n\r\n\r\n    constructor(readonly primary: DataType) {\r\n        super();\r\n    }\r\n\r\n    doCanCast(_to: _IType): boolean | nil {\r\n        switch (_to.primary) {\r\n            case DataType.text:\r\n            case DataType.json:\r\n            case DataType.jsonb:\r\n            case DataType.float:\r\n            case DataType.bool:\r\n            case DataType.integer:\r\n                return true;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    doCast(a: Evaluator, to: _IType): Evaluator {\r\n        switch (to.primary) {\r\n            case DataType.text:\r\n                return a\r\n                    .setType(Types.text())\r\n                    .setConversion(json => stringify(this.toResult(json))\r\n                        , toJsonB => ({ toJsonB }))\r\n                    .cast(to) as Evaluator; // <== might need truncation\r\n            case DataType.jsonb:\r\n            case DataType.json:\r\n                return a.setType(to);\r\n            case DataType.float:\r\n            case DataType.integer:\r\n                const isInt = to.primary === DataType.integer;\r\n                return a\r\n                    .setType(to)\r\n                    .setConversion(json => {\r\n                        if (json === JSON_NIL) {\r\n                            throw new QueryError('cannot cast jsonb null to type ' + (isInt ? 'integer' : 'double precision'), '22023');\r\n                        }\r\n                        if (typeof json !== 'number') {\r\n                            throw new QueryError('cannot cast jsonb string to type ' + (isInt ? 'integer' : 'double precision'), '22023');\r\n                        }\r\n                        return isInt ? Math.round(json) : json;\r\n                    }, toFloat => ({ toFloat }));\r\n            case DataType.bool:\r\n                return a\r\n                    .setType(to)\r\n                    .setConversion(json => {\r\n                        if (typeof json !== 'boolean') {\r\n                            throw new QueryError('cannot cast jsonb string to type boolean', '22023');\r\n                        }\r\n                        return json;\r\n                    }, toFloat => ({ toFloat }));\r\n            default:\r\n                return a.setType(to);\r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n    doCanBuildFrom(from: _IType) {\r\n        switch (from.primary) {\r\n            case DataType.text:\r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    doBuildFrom(value: Evaluator, from: _IType): Evaluator<Date> | nil {\r\n        switch (from.primary) {\r\n            case DataType.text:\r\n                return value\r\n                    .setConversion(raw => {\r\n                        try {\r\n                            return JSON.parse(raw, (_, x) => x ?? JSON_NIL) ?? JSON_NIL\r\n                        } catch (e) {\r\n                            throw new QueryError({\r\n                                error: `invalid input syntax for type json`,\r\n                                details: errorMessage(e),\r\n                                code: '22P02',\r\n                            });\r\n                        }\r\n                    }\r\n                        , toJsonb => ({ toJsonb }));\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n\r\n    doEquals(a: any, b: any): boolean {\r\n        return deepEqual(this.toResult(a), this.toResult(b), false);\r\n    }\r\n\r\n    doGt(a: any, b: any): boolean {\r\n        return deepCompare(this.toResult(a), this.toResult(b)) > 0;\r\n    }\r\n\r\n    doLt(a: any, b: any): boolean {\r\n        return deepCompare(this.toResult(a), this.toResult(b)) < 0;\r\n    }\r\n\r\n    toResult(result: any): any {\r\n        return result === JSON_NIL\r\n            ? null\r\n            : result;\r\n    }\r\n\r\n}\r\n","import { DataType, nil, QueryError, RegClass, RegType, _IType } from '../interfaces-private';\r\nimport { TypeBase } from './datatype-base';\r\nimport { Evaluator } from '../evaluator';\r\nimport { Types } from './datatypes';\r\nimport { buildCtx } from '../parser/context';\r\n\r\nexport class RegTypeImpl extends TypeBase<RegType> {\r\n\r\n\r\n    get primary(): DataType {\r\n        return DataType.regtype;\r\n    }\r\n\r\n    doCanCast(_to: _IType): boolean | nil {\r\n        switch (_to.primary) {\r\n            case DataType.text:\r\n            case DataType.integer:\r\n                return true;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    doCast(a: Evaluator<RegType>, to: _IType): Evaluator {\r\n        switch (to.primary) {\r\n            case DataType.text:\r\n                return a\r\n                    .setType(to)\r\n                    .setConversion(raw => raw.toString(10)\r\n                        , toText => ({ toText }))\r\n            case DataType.integer:\r\n                const { schema } = buildCtx();\r\n                return a\r\n                    .setType(to)\r\n                    .setConversion((raw: RegType) => {\r\n                        if (typeof raw === 'number') {\r\n                            return raw;\r\n                        }\r\n                        const t = schema.parseType(raw);\r\n                        return t.reg.typeId;\r\n                    }\r\n                        , toText => ({ toText }))\r\n        }\r\n        throw new Error('failed to cast');\r\n    }\r\n\r\n\r\n    doCanBuildFrom(from: _IType) {\r\n        switch (from.primary) {\r\n            case DataType.text:\r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    doBuildFrom(value: Evaluator, from: _IType): Evaluator<RegClass> | nil {\r\n        switch (from.primary) {\r\n            case DataType.text:\r\n                const { schema } = buildCtx();\r\n                return value\r\n                    .setType(Types.regtype)\r\n                    .setConversion((str: string) => {\r\n                        let repl = str.replace(/[\"\\s]+/g, '');\r\n                        if (repl.startsWith('pg_catalog.')) {\r\n                            repl = repl.substr('pg_catalog.'.length);\r\n                        }\r\n                        return schema.parseType(repl).name;\r\n                    }\r\n                        , strToRegType => ({ strToRegType }));\r\n        }\r\n        return null;\r\n    }\r\n\r\n}\r\n","import { DataType, nil, QueryError, RegClass, _IType } from '../interfaces-private';\r\nimport { TypeBase } from './datatype-base';\r\nimport { Evaluator } from '../evaluator';\r\nimport { parseRegClass } from '../utils';\r\nimport { Types } from './datatypes';\r\nimport { buildCtx } from '../parser/context';\r\n\r\nexport class RegClassImpl extends TypeBase<RegClass> {\r\n\r\n\r\n\r\n    get primary(): DataType {\r\n        return DataType.regclass;\r\n    }\r\n\r\n    doCanCast(_to: _IType): boolean | nil {\r\n        switch (_to.primary) {\r\n            case DataType.text:\r\n            case DataType.integer:\r\n                return true;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    doCast(a: Evaluator, to: _IType): Evaluator {\r\n        const { schema } = buildCtx();\r\n        switch (to.primary) {\r\n            case DataType.text:\r\n                return a\r\n                    .setType(Types.text())\r\n                    .setConversion((raw: RegClass) => {\r\n                        return raw?.toString();\r\n                    }\r\n                        , toText => ({ toText }))\r\n            case DataType.integer:\r\n                return a\r\n                    .setType(Types.text())\r\n                    .setConversion((raw: RegClass) => {\r\n\r\n                        // === regclass -> int\r\n\r\n                        const cls = parseRegClass(raw);\r\n\r\n                        // if its a number, then try to get it.\r\n                        if (typeof cls === 'number') {\r\n                            return schema.getObjectByRegOrName(cls)\r\n                                ?.reg.classId\r\n                                ?? cls;\r\n                        }\r\n\r\n                        // get the object or throw\r\n                        return schema.getObjectByRegOrName(raw)\r\n                            .reg.classId;\r\n                    }\r\n                        , toText => ({ toText }))\r\n        }\r\n        throw new Error('failed to cast');\r\n    }\r\n\r\n\r\n\r\n    doCanBuildFrom(from: _IType) {\r\n        switch (from.primary) {\r\n            case DataType.text:\r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    doBuildFrom(value: Evaluator, from: _IType): Evaluator<RegClass> | nil {\r\n        const { schema } = buildCtx();\r\n        switch (from.primary) {\r\n            case DataType.text:\r\n                return value\r\n                    .setConversion((str: string) => {\r\n                        // === text -> regclass\r\n\r\n                        const cls = parseRegClass(str);\r\n\r\n                        // if its a number, then try to get it.\r\n                        if (typeof cls === 'number') {\r\n                            return schema.getObjectByRegOrName(cls)\r\n                                ?.name\r\n                                ?? cls;\r\n                        }\r\n\r\n                        // else, get or throw.\r\n                        return schema.getObject(cls)\r\n                            .name;\r\n                    }\r\n                        , strToRegClass => ({ strToRegClass }));\r\n        }\r\n        return null;\r\n    }\r\n\r\n}\r\n","import { Evaluator } from '../evaluator';\r\nimport { TypeBase } from './datatype-base';\r\nimport { DataType, nil, QueryError } from '../interfaces';\r\nimport { _ISchema, _IType } from '../interfaces-private';\r\n\r\n// https://www.postgresql.org/docs/13/datatype-net-types.html#DATATYPE-INET\r\n\r\nexport class INetType extends TypeBase<string> {\r\n\r\n    get primary(): DataType {\r\n        return DataType.inet\r\n    }\r\n\r\n    doCanCast(to: _IType) {\r\n        return to.primary === DataType.text;\r\n    }\r\n\r\n    doCast(value: Evaluator<string>, to: _IType<string>): Evaluator<any> | nil {\r\n        return value;\r\n    }\r\n\r\n    prefer(type: _IType<any>): _IType | nil {\r\n        return this;\r\n    }\r\n\r\n    doCanBuildFrom(from: _IType): boolean | nil {\r\n        return from.primary === DataType.text;\r\n    }\r\n\r\n    doBuildFrom(value: Evaluator<string>, from: _IType<string>): Evaluator<string> | nil {\r\n        return value\r\n            .setConversion(x => {\r\n                const [_, a, b, c, d, __, m] = /^(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)(\\/(\\d+))?$/.exec(x) ?? []\r\n                if ([a, b, c, d].some(notByte) || notMask(m)) {\r\n                    throw new QueryError(`invalid input syntax for type inet: ${x}`);\r\n                }\r\n                return x;\r\n            }, toInet => ({ toInet }));\r\n    }\r\n}\r\n\r\nfunction notByte(b: string) {\r\n    return !b\r\n        || b.length > 1 && b[0] === '0'\r\n        || parseInt(b, 10) > 255;\r\n}\r\n\r\nfunction notMask(b: string) {\r\n    return b\r\n        && (b.length > 1 && b[0] === '0'\r\n            || parseInt(b, 10) > 32);\r\n}","import {\r\n  IMemoryTable,\r\n  Schema,\r\n  QueryError,\r\n  TableEvent,\r\n  PermissionDeniedError,\r\n  NotSupported,\r\n  IndexDef,\r\n  ColumnNotFound,\r\n  ISubscription,\r\n  nil,\r\n  DataType,\r\n} from \"./interfaces\";\r\nimport {\r\n  _ISelection,\r\n  IValue,\r\n  _ITable,\r\n  setId,\r\n  getId,\r\n  CreateIndexDef,\r\n  CreateIndexColDef,\r\n  _IDb,\r\n  _Transaction,\r\n  _ISchema,\r\n  _Column,\r\n  _IType,\r\n  SchemaField,\r\n  _IIndex,\r\n  _Explainer,\r\n  _SelectExplanation,\r\n  ChangeHandler,\r\n  Stats,\r\n  OnConflictHandler,\r\n  DropHandler,\r\n  IndexHandler,\r\n  asIndex,\r\n  RegClass,\r\n  RegType,\r\n  Reg,\r\n  ChangeOpts,\r\n  _IConstraint,\r\n  TruncateHandler,\r\n  TruncateOpts,\r\n} from \"./interfaces-private\";\r\nimport { buildValue } from \"./parser/expression-builder\";\r\nimport { BIndex } from \"./schema/btree-index\";\r\nimport { columnEvaluator } from \"./transforms/selection\";\r\nimport {\r\n  nullIsh,\r\n  deepCloneSimple,\r\n  Optional,\r\n  indexHash,\r\n  findTemplate,\r\n  colByName,\r\n} from \"./utils\";\r\nimport { Map as ImMap } from \"immutable\";\r\nimport {\r\n  CreateColumnDef,\r\n  TableConstraintForeignKey,\r\n  TableConstraint,\r\n  Expr,\r\n  Name,\r\n  ExprRef,\r\n  ExprBinary,\r\n} from \"pgsql-ast-parser\";\r\nimport { ColRef } from \"./column\";\r\nimport { buildAlias, Alias } from \"./transforms/alias\";\r\nimport { DataSourceBase } from \"./transforms/transform-base\";\r\nimport { ForeignKey } from \"./constraints/foreign-key\";\r\nimport { Types } from \"./datatypes\";\r\nimport { withSelection } from \"./parser/context\";\r\nimport { Value } from \"./evaluator\";\r\n\r\ntype Raw<T> = ImMap<string, T>;\r\n\r\ninterface ChangeSub<T> {\r\n  before: Set<ChangeHandler<T>>;\r\n  after: Set<ChangeHandler<T>>;\r\n}\r\n\r\ninterface ChangePlan<T> {\r\n  before(): void;\r\n  after(): void;\r\n}\r\n\r\nclass ColumnManager {\r\n  private _columns?: readonly IValue[];\r\n  readonly map = new Map<string, ColRef>();\r\n\r\n  get columns(): readonly IValue[] {\r\n    if (!this._columns) {\r\n      this._columns = Object.freeze(\r\n        Array.from(this.map.values(), (c) => c.expression)\r\n      );\r\n    }\r\n    return this._columns!;\r\n  }\r\n  invalidateColumns() {\r\n    this._columns = undefined;\r\n  }\r\n\r\n  // Pass-through methods\r\n  get = this.map.get.bind(this.map);\r\n  has = this.map.has.bind(this.map);\r\n  values = this.map.values.bind(this.map);\r\n\r\n  set(name: string, colDef: ColRef) {\r\n    this.invalidateColumns();\r\n    return this.map.set(name, colDef);\r\n  }\r\n\r\n  delete(name: string) {\r\n    this.invalidateColumns();\r\n    return this.map.delete(name);\r\n  }\r\n}\r\n\r\nexport class MemoryTable<T = any>\r\n  extends DataSourceBase<T>\r\n  implements IMemoryTable, _ITable<T>\r\n{\r\n  get isExecutionWithNoResult(): boolean {\r\n    return false;\r\n  }\r\n  private handlers = new Map<TableEvent, Set<() => void>>();\r\n  readonly selection: Alias<T>;\r\n  private _reg?: Reg;\r\n  get reg(): Reg {\r\n    if (!this._reg) {\r\n      throw new QueryError(`relation \"${this.name}\" does not exist`);\r\n    }\r\n    return this._reg;\r\n  }\r\n  get columns() {\r\n    return this.columnMgr.columns;\r\n  }\r\n  private it = 0;\r\n  private cstGen = 0;\r\n  hasPrimary = false;\r\n  private readonly = false;\r\n  hidden = false;\r\n  private dataId = Symbol();\r\n  private serialsId: symbol = Symbol();\r\n  private constraintsByName = new Map<string, _IConstraint>();\r\n  private indexByHash = new Map<\r\n    string,\r\n    {\r\n      index: BIndex<T>;\r\n      expressions: IValue[];\r\n    }\r\n  >();\r\n  readonly columnMgr = new ColumnManager();\r\n  name: string;\r\n\r\n  private changeHandlers = new Map<_Column | null, ChangeSub<T>>();\r\n  private truncateHandlers = new Set<TruncateHandler>();\r\n  private drophandlers = new Set<DropHandler>();\r\n  private indexHandlers = new Set<IndexHandler>();\r\n\r\n  get type() {\r\n    return \"table\" as const;\r\n  }\r\n\r\n  get debugId() {\r\n    return this.name;\r\n  }\r\n\r\n  entropy(t: _Transaction) {\r\n    return this.bin(t).size;\r\n  }\r\n\r\n  isOriginOf(a: IValue<any>): boolean {\r\n    return a.origin === this.selection;\r\n  }\r\n\r\n  constructor(schema: _ISchema, t: _Transaction, _schema: Schema) {\r\n    super(schema);\r\n    this.name = _schema.name;\r\n    this.selection = buildAlias(this, this.name) as Alias<T>;\r\n\r\n    // fields\r\n    for (const s of _schema.fields) {\r\n      this.addColumn(s, t);\r\n    }\r\n\r\n    // other table constraints\r\n    for (const c of _schema.constraints ?? []) {\r\n      this.addConstraint(c, t);\r\n    }\r\n  }\r\n\r\n  register() {\r\n    // once fields registered,\r\n    //  then register the table\r\n    //  (column registrations need it not to be registered yet)\r\n    this._reg = this.ownerSchema._reg_register(this as _ITable);\r\n    return this;\r\n  }\r\n\r\n  stats(t: _Transaction): Stats | null {\r\n    return {\r\n      count: this.bin(t).size,\r\n    };\r\n  }\r\n\r\n  rename(name: string) {\r\n    const on = this.name;\r\n    if (on === name) {\r\n      return this;\r\n    }\r\n    this.name = name;\r\n    this.ownerSchema._reg_rename(this as _ITable<T>, on, name);\r\n    (this.selection as Alias<T>).name = this.name;\r\n    this.db.onSchemaChange();\r\n    return this;\r\n  }\r\n\r\n  getColumn(column: string | ExprRef): IValue;\r\n  getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue | nil;\r\n  getColumn(\r\n    column: string | ExprRef,\r\n    nullIfNotFound?: boolean\r\n  ): IValue<any> | nil {\r\n    return colByName(this.columnMgr.map, column, nullIfNotFound)?.expression;\r\n  }\r\n\r\n  explain(e: _Explainer): _SelectExplanation {\r\n    return {\r\n      _: \"table\",\r\n      table: this.name,\r\n    };\r\n  }\r\n\r\n  addColumn(column: SchemaField | CreateColumnDef, t: _Transaction): _Column {\r\n    if (\"dataType\" in column) {\r\n      const tp: SchemaField = {\r\n        ...column,\r\n        name: column.name.name,\r\n        type: this.ownerSchema.getType(column.dataType),\r\n      };\r\n      delete (tp as any as Optional<CreateColumnDef>).dataType;\r\n      return this.addColumn(tp, t);\r\n    }\r\n\r\n    if (this.columnMgr.has(column.name)) {\r\n      throw new QueryError(`Column \"${column.name}\" already exists`);\r\n    }\r\n    const type =\r\n      typeof column.type === \"string\"\r\n        ? this.ownerSchema.getType(column.type)\r\n        : column.type;\r\n    const cref = new ColRef(\r\n      this,\r\n      columnEvaluator(this.selection, column.name, type as _IType),\r\n      column,\r\n      column.name\r\n    );\r\n\r\n    // auto increments\r\n    if (column.serial) {\r\n      t.set(this.serialsId, t.getMap(this.serialsId).set(column.name, 0));\r\n    }\r\n\r\n    this.columnMgr.set(column.name, cref);\r\n\r\n    try {\r\n      if (column.constraints?.length) {\r\n        cref.addConstraints(column.constraints, t);\r\n      }\r\n      const hasDefault = column.constraints?.some((x) => x.type === \"default\");\r\n      if (!hasDefault) {\r\n        this.remapData(\r\n          t,\r\n          (x) => ((x as any)[column.name] = (x as any)[column.name] ?? null)\r\n        );\r\n      }\r\n    } catch (e) {\r\n      this.columnMgr.delete(column.name);\r\n      throw e;\r\n    }\r\n\r\n    // once constraints created, reference them. (constraint creation might have thrown)m\r\n    this.db.onSchemaChange();\r\n    this.selection.rebuild();\r\n    return cref;\r\n  }\r\n\r\n  getColumnRef(column: string): ColRef;\r\n  getColumnRef(column: string, nullIfNotFound?: boolean): ColRef | nil;\r\n  getColumnRef(column: string, nullIfNotFound?: boolean): ColRef | nil {\r\n    const got = this.columnMgr.get(column);\r\n    if (!got) {\r\n      if (nullIfNotFound) {\r\n        return null;\r\n      }\r\n      throw new QueryError(`Column \"${column}\" not found`);\r\n    }\r\n    return got;\r\n  }\r\n\r\n  bin(t: _Transaction) {\r\n    return t.getMap<Raw<T>>(this.dataId);\r\n  }\r\n\r\n  setBin(t: _Transaction, val: Raw<T>) {\r\n    return t.set(this.dataId, val);\r\n  }\r\n\r\n  on(event: TableEvent, handler: () => any): ISubscription {\r\n    let lst = this.handlers.get(event);\r\n    if (!lst) {\r\n      this.handlers.set(event, (lst = new Set()));\r\n    }\r\n    lst.add(handler);\r\n    return {\r\n      unsubscribe: () => lst!.delete(handler),\r\n    };\r\n  }\r\n\r\n  raise(event: TableEvent) {\r\n    const got = this.handlers.get(event);\r\n    for (const h of got ?? []) {\r\n      h();\r\n    }\r\n    this.db.raiseTable(this.name, event);\r\n  }\r\n\r\n  setReadonly() {\r\n    this.readonly = true;\r\n    return this;\r\n  }\r\n  setHidden() {\r\n    this.hidden = true;\r\n    return this;\r\n  }\r\n\r\n  *enumerate(t: _Transaction): Iterable<T> {\r\n    this.raise(\"seq-scan\");\r\n    for (const v of this.bin(t).values()) {\r\n      yield deepCloneSimple(v); // copy the original data to prevent it from being mutated.\r\n    }\r\n  }\r\n\r\n  find(template?: Partial<T>, columns?: (keyof T)[]): Iterable<T> {\r\n    return findTemplate(this.selection, this.db.data, template, columns);\r\n  }\r\n\r\n  remapData(t: _Transaction, modify: (newCopy: T) => any) {\r\n    // convert raw data ( must copy the whole thing,\r\n    // because it can throw in the middle of this process !)\r\n    //  => this would result in partially converted tables.\r\n    const converted = this.bin(t).map((x) => {\r\n      const copy = { ...x };\r\n      modify(copy);\r\n      return copy;\r\n    });\r\n    this.setBin(t, converted);\r\n  }\r\n\r\n  insert(toInsert: Partial<T>): T {\r\n    const ret = this.doInsert(this.db.data, deepCloneSimple(toInsert));\r\n    return deepCloneSimple(ret);\r\n  }\r\n\r\n  doInsert(t: _Transaction, toInsert: T, opts?: ChangeOpts): T {\r\n    if (this.readonly) {\r\n      throw new PermissionDeniedError(this.name);\r\n    }\r\n\r\n    // get ID of this item\r\n    const newId = this.name + \"_\" + this.it++;\r\n    setId(toInsert, newId);\r\n\r\n    // serial (auto increments) columns\r\n    let serials = t.getMap(this.serialsId);\r\n    for (const [k, v] of serials.entries()) {\r\n      if (!nullIsh((toInsert as any)[k])) {\r\n        continue;\r\n      }\r\n      (toInsert as any)[k] = v + 1;\r\n      serials = serials.set(k, v + 1);\r\n    }\r\n    t.set(this.serialsId, serials);\r\n\r\n    // set default values\r\n    for (const c of this.columnMgr.values()) {\r\n      c.setDefaults(toInsert, t);\r\n    }\r\n\r\n    // check change handlers (foreign keys)\r\n    const changePlan = this.changePlan(t, null, toInsert, opts);\r\n    changePlan.before();\r\n\r\n    // check \"on conflict\"\r\n    const onConflict = opts?.onConflict;\r\n    if (onConflict) {\r\n      if (\"ignore\" in onConflict) {\r\n        if (onConflict.ignore === \"all\") {\r\n          for (const k of this.indexByHash.values()) {\r\n            if (!k.index.unique) {\r\n              continue;\r\n            }\r\n            const key = k.index.buildKey(toInsert, t);\r\n            const found = k.index.eqFirst(key, t);\r\n            if (found) {\r\n              return found; // ignore.\r\n            }\r\n          }\r\n        } else {\r\n          const index = onConflict.ignore as BIndex;\r\n          const key = index.buildKey(toInsert, t);\r\n          const found = index.eqFirst(key, t);\r\n          if (found) {\r\n            return found; // ignore.\r\n          }\r\n        }\r\n      } else {\r\n        const index = onConflict.onIndex as BIndex;\r\n        const key = index.buildKey(toInsert, t);\r\n        const got = index.eqFirst(key, t);\r\n        if (got) {\r\n          // update !\r\n          onConflict.update(got, toInsert, t);\r\n          return this.update(t, got);\r\n        }\r\n      }\r\n    }\r\n\r\n    // check constraints\r\n    for (const c of this.columnMgr.values()) {\r\n      c.checkConstraints(toInsert, t);\r\n    }\r\n\r\n    // check change handlers (foreign keys)\r\n    changePlan.after();\r\n\r\n    // index & check indx contrainsts\r\n    this.indexElt(t, toInsert);\r\n    this.setBin(t, this.bin(t).set(newId, toInsert));\r\n    return toInsert;\r\n  }\r\n\r\n  private changePlan(\r\n    t: _Transaction,\r\n    old: T | null,\r\n    neu: T | null,\r\n    _opts: ChangeOpts | nil\r\n  ): ChangePlan<T> {\r\n    const opts = _opts ?? {};\r\n    let iter: () => IterableIterator<ChangeSub<T>>;\r\n    if (!old || !neu) {\r\n      iter = () => this.changeHandlers.values();\r\n    } else {\r\n      const ret: ChangeSub<T>[] = [];\r\n      const global = this.changeHandlers.get(null);\r\n      if (global) {\r\n        ret.push(global);\r\n      }\r\n      for (const def of this.columnMgr.values()) {\r\n        const h = this.changeHandlers.get(def);\r\n        if (!h) {\r\n          continue;\r\n        }\r\n        const oldVal = (old as any)[def.expression.id!];\r\n        const neuVal = (neu as any)[def.expression.id!];\r\n        if (def.expression.type.equals(oldVal, neuVal)) {\r\n          continue;\r\n        }\r\n        ret.push(h);\r\n      }\r\n      iter = ret[Symbol.iterator].bind(ret);\r\n    }\r\n    return {\r\n      before: () => {\r\n        const ran = new Set();\r\n        for (const { before } of iter()) {\r\n          for (const b of before) {\r\n            if (!b || ran.has(b)) {\r\n              continue;\r\n            }\r\n            b(old, neu, t, opts);\r\n            ran.add(b);\r\n          }\r\n        }\r\n      },\r\n      after: () => {\r\n        const ran = new Set();\r\n        for (const { after } of iter()) {\r\n          for (const a of after) {\r\n            if (!a || ran.has(a)) {\r\n              continue;\r\n            }\r\n            a(old, neu, t, opts);\r\n            ran.add(a);\r\n          }\r\n        }\r\n      },\r\n    };\r\n  }\r\n\r\n  update(t: _Transaction, toUpdate: T): T {\r\n    if (this.readonly) {\r\n      throw new PermissionDeniedError(this.name);\r\n    }\r\n    const bin = this.bin(t);\r\n    const id = getId(toUpdate);\r\n    const exists = bin.get(id) ?? null;\r\n\r\n    // set default values\r\n    for (const c of this.columnMgr.values()) {\r\n      c.setDefaults(toUpdate, t);\r\n    }\r\n\r\n    // check change handlers (foreign keys)\r\n    const changePlan = this.changePlan(t, exists, toUpdate, null);\r\n    changePlan.before();\r\n    changePlan.after();\r\n\r\n    // check constraints\r\n    for (const c of this.columnMgr.values()) {\r\n      c.checkConstraints(toUpdate, t);\r\n    }\r\n\r\n    // remove old version from index\r\n    if (exists) {\r\n      for (const k of this.indexByHash.values()) {\r\n        k.index.delete(exists, t);\r\n      }\r\n    }\r\n\r\n    // add new version to index\r\n    this.indexElt(t, toUpdate);\r\n\r\n    // store raw\r\n    this.setBin(t, bin.delete(id).set(id, toUpdate));\r\n    return toUpdate;\r\n  }\r\n\r\n  delete(t: _Transaction, toDelete: T) {\r\n    const id = getId(toDelete);\r\n    const bin = this.bin(t);\r\n    const got = bin.get(id);\r\n    if (!id || !got) {\r\n      throw new Error(\r\n        \"Unexpected error: an operation has been asked on an item which does not belong to this table\"\r\n      );\r\n    }\r\n\r\n    // check change handlers (foreign keys)\r\n    const changePlan = this.changePlan(t, toDelete, null, null);\r\n    changePlan.before();\r\n    changePlan.after();\r\n\r\n    // remove from indices\r\n    for (const k of this.indexByHash.values()) {\r\n      k.index.delete(got, t);\r\n    }\r\n    this.setBin(t, bin.delete(id));\r\n\r\n    return got;\r\n  }\r\n\r\n  truncate(t: _Transaction, _opts?: TruncateOpts): void {\r\n    const opts: TruncateOpts = _opts ?? {};\r\n    // call truncate handlers\r\n    for (const h of this.truncateHandlers) {\r\n      h(t, opts);\r\n    }\r\n    // truncate indices\r\n    for (const k of this.indexByHash.values()) {\r\n      k.index.truncate(t);\r\n    }\r\n    this.setBin(t, ImMap());\r\n  }\r\n\r\n  private indexElt(t: _Transaction, toInsert: T) {\r\n    for (const k of this.indexByHash.values()) {\r\n      k.index.add(toInsert, t);\r\n    }\r\n  }\r\n\r\n  hasItem(item: T, t: _Transaction) {\r\n    const id = getId(item);\r\n    return this.bin(t).has(id);\r\n  }\r\n\r\n  getIndex(...forValues: IValue[]): _IIndex | nil {\r\n    if (!forValues.length || forValues.some((x) => !x || !this.isOriginOf(x))) {\r\n      return null;\r\n    }\r\n    const ihash = indexHash(forValues);\r\n    const got = this.indexByHash.get(ihash);\r\n    return got?.index ?? null;\r\n  }\r\n\r\n  constraintNameGen(constraintName?: string) {\r\n    return constraintName ?? this.name + \"_constraint_\" + ++this.cstGen;\r\n  }\r\n\r\n  addCheck(\r\n    _t: _Transaction,\r\n    check: Expr,\r\n    constraintName?: string,\r\n    notNull?: boolean\r\n  ): _IConstraint {\r\n    constraintName = this.constraintNameGen(constraintName);\r\n    this.checkNoConstraint(constraintName);\r\n    const nullGetter = withSelection(this.selection, () => {\r\n      if (!notNull && check.type == \"binary\") {\r\n        return buildValue(check.left);\r\n      }\r\n      return Value.bool(false);\r\n    });\r\n    const getter = withSelection(this.selection, () => {\r\n      return buildValue(check).cast(Types.bool);\r\n    });\r\n\r\n    const checkVal = (t: _Transaction, v: any) => {\r\n      const isNull = nullGetter.get(v, t) === null;\r\n      if (!isNull) {\r\n        const value = getter.get(v, t);\r\n        if (value === false) {\r\n          throw new QueryError(\r\n            `check constraint \"${constraintName}\" is violated by some row`\r\n          );\r\n        }\r\n      }\r\n    };\r\n\r\n    // check that everything matches (before adding check)\r\n    for (const v of this.enumerate(_t)) {\r\n      checkVal(_t, v);\r\n    }\r\n\r\n    // add a check for future updates\r\n    const sub = this.onBeforeChange(\"all\", (old, neu, ct) => {\r\n      if (!neu) {\r\n        return;\r\n      }\r\n      checkVal(ct, neu);\r\n    });\r\n\r\n    const ret = new SubscriptionConstraint(constraintName, () =>\r\n      sub.unsubscribe()\r\n    );\r\n    return new ConstraintWrapper(this.constraintsByName, ret);\r\n  }\r\n\r\n  createIndex(t: _Transaction, expressions: CreateIndexDef): _IConstraint | nil;\r\n  createIndex(\r\n    t: _Transaction,\r\n    expressions: Name[],\r\n    type: \"primary\" | \"unique\",\r\n    indexName?: string\r\n  ): _IConstraint;\r\n  createIndex(\r\n    t: _Transaction,\r\n    expressions: Name[] | CreateIndexDef,\r\n    _type?: \"primary\" | \"unique\",\r\n    _indexName?: string\r\n  ): _IConstraint | nil {\r\n    if (this.readonly) {\r\n      throw new PermissionDeniedError(this.name);\r\n    }\r\n    if (Array.isArray(expressions)) {\r\n      const keys: CreateIndexColDef[] = [];\r\n      for (const e of expressions) {\r\n        const getter = this.selection.getColumn(e.name);\r\n        keys.push({\r\n          value: getter,\r\n        });\r\n      }\r\n      return this.createIndex(t, {\r\n        columns: keys,\r\n        primary: _type === \"primary\",\r\n        notNull: _type === \"primary\",\r\n        unique: !!_type,\r\n        indexName: _indexName,\r\n      });\r\n    }\r\n\r\n    if (!expressions?.columns?.length) {\r\n      throw new QueryError(\"Empty index\");\r\n    }\r\n\r\n    if (expressions.primary && this.hasPrimary) {\r\n      throw new QueryError(\"Table \" + this.name + \" already has a primary key\");\r\n    }\r\n    if (expressions.primary) {\r\n      expressions.notNull = true;\r\n      expressions.unique = true;\r\n    }\r\n\r\n    const ihash = indexHash(expressions.columns.map((x) => x.value));\r\n\r\n    const indexName = this.determineIndexRelName(\r\n      expressions.indexName,\r\n      ihash,\r\n      expressions.ifNotExists,\r\n      \"idx\"\r\n    );\r\n    if (!indexName) {\r\n      return null;\r\n    }\r\n    this.checkNoConstraint(indexName);\r\n\r\n    const index = new BIndex(\r\n      t,\r\n      indexName,\r\n      expressions.columns,\r\n      this as _ITable,\r\n      ihash,\r\n      !!expressions.unique,\r\n      !!expressions.notNull,\r\n      expressions.predicate\r\n    );\r\n\r\n    // fill index (might throw if constraint not respected)\r\n    const bin = this.bin(t);\r\n    for (const e of bin.values()) {\r\n      index.add(e, t);\r\n    }\r\n\r\n    // =========== reference index ============\r\n    this.indexHandlers.forEach((h) => h(\"create\", index));\r\n    //  This must be done LAST, to avoid throwing an execption if index population failed\r\n    for (const col of index.expressions) {\r\n      for (const used of col.usedColumns) {\r\n        this.getColumnRef(used.id!).usedInIndexes.add(index);\r\n      }\r\n    }\r\n    this.indexByHash.set(ihash, { index, expressions: index.expressions });\r\n    if (expressions.primary) {\r\n      this.hasPrimary = true;\r\n    }\r\n    const ret = new SubscriptionConstraint(indexName, (t) =>\r\n      this.dropIndex(t, indexName)\r\n    );\r\n    return new ConstraintWrapper(this.constraintsByName, ret);\r\n  }\r\n\r\n  private determineIndexRelName(\r\n    indexName: string | nil,\r\n    ihash: string,\r\n    ifNotExists: boolean | nil,\r\n    sufix: string\r\n  ): string | nil {\r\n    if (indexName) {\r\n      if (this.ownerSchema.getOwnObject(indexName)) {\r\n        if (ifNotExists) {\r\n          return null;\r\n        }\r\n        throw new QueryError(`relation \"${indexName}\" already exists`);\r\n      }\r\n      return indexName;\r\n    } else {\r\n      const baseName = (indexName = `${this.name}_${ihash}_${sufix}`);\r\n      let i = 1;\r\n      while (this.ownerSchema.getOwnObject(indexName)) {\r\n        indexName = baseName + i++;\r\n      }\r\n      return indexName!;\r\n    }\r\n  }\r\n\r\n  dropIndex(t: _Transaction, uName: string) {\r\n    const u = asIndex(this.ownerSchema.getOwnObject(uName)) as BIndex;\r\n    if (!u || !this.indexByHash.has(u.hash)) {\r\n      throw new QueryError(\r\n        \"Cannot drop index that does not belong to this table: \" + uName\r\n      );\r\n    }\r\n    this.indexHandlers.forEach((h) => h(\"drop\", u));\r\n    this.indexByHash.delete(u.hash);\r\n    u.dropFromData(t);\r\n    this.ownerSchema._reg_unregister(u);\r\n    this.constraintsByName.delete(uName);\r\n  }\r\n\r\n  onIndex(sub: IndexHandler): ISubscription {\r\n    this.indexHandlers.add(sub);\r\n    return {\r\n      unsubscribe: () => this.indexHandlers.delete(sub),\r\n    };\r\n  }\r\n\r\n  listIndices(): IndexDef[] {\r\n    return [...this.indexByHash.values()].map<IndexDef>((x) => ({\r\n      name: x.index.name!,\r\n      expressions: x.expressions.map((x) => x.id!),\r\n    }));\r\n  }\r\n\r\n  addForeignKey(\r\n    cst: TableConstraintForeignKey,\r\n    t: _Transaction\r\n  ): _IConstraint | nil {\r\n    const ihash = indexHash(cst.localColumns.map((x) => x.name));\r\n    const constraintName = this.determineIndexRelName(\r\n      cst.constraintName?.name,\r\n      ihash,\r\n      false,\r\n      \"fk\"\r\n    );\r\n    if (!constraintName) {\r\n      return null;\r\n    }\r\n    const ret = new ForeignKey(constraintName).install(t, cst, this as _ITable);\r\n    return new ConstraintWrapper(this.constraintsByName, ret);\r\n  }\r\n\r\n  getConstraint(constraint: string): _IConstraint | nil {\r\n    return this.constraintsByName.get(constraint);\r\n  }\r\n\r\n  addConstraint(cst: TableConstraint, t: _Transaction): _IConstraint | nil {\r\n    switch (cst.type) {\r\n      case \"foreign key\":\r\n        return this.addForeignKey(cst, t);\r\n      case \"primary key\":\r\n        return this.createIndex(\r\n          t,\r\n          cst.columns,\r\n          \"primary\",\r\n          cst.constraintName?.name\r\n        );\r\n      case \"unique\":\r\n        return this.createIndex(\r\n          t,\r\n          cst.columns,\r\n          \"unique\",\r\n          cst.constraintName?.name\r\n        );\r\n      case \"check\":\r\n        return this.addCheck(t, cst.expr, cst.constraintName?.name);\r\n      default:\r\n        throw NotSupported.never(cst, \"constraint type\");\r\n    }\r\n  }\r\n\r\n  private checkNoConstraint(name: string) {\r\n    if (this.constraintsByName.has(name)) {\r\n      throw new QueryError(`relation \"${name}\" already exists`, \"42P07\");\r\n    }\r\n  }\r\n\r\n  onBeforeChange(\r\n    columns: \"all\" | (string | _Column)[],\r\n    check: ChangeHandler<T>\r\n  ): ISubscription {\r\n    return this._subChange(\"before\", columns, check);\r\n  }\r\n  onCheckChange(columns: string[], check: ChangeHandler<T>): ISubscription {\r\n    return this._subChange(\"before\", columns, check);\r\n  }\r\n\r\n  private _subChange(\r\n    key: keyof ChangeSub<T>,\r\n    columns: \"all\" | (string | _Column)[],\r\n    check: ChangeHandler<T>\r\n  ): ISubscription {\r\n    const unsubs: (() => void)[] = [];\r\n\r\n    const add = (ref: _Column | ColRef | null) => {\r\n      let ch = this.changeHandlers.get(ref);\r\n      if (!ch) {\r\n        this.changeHandlers.set(\r\n          ref,\r\n          (ch = {\r\n            after: new Set(),\r\n            before: new Set(),\r\n          })\r\n        );\r\n      }\r\n      ch[key].add(check);\r\n      unsubs.push(() => ch![key].delete(check));\r\n    };\r\n    if (columns === \"all\") {\r\n      add(null);\r\n    } else {\r\n      for (const c of columns) {\r\n        const ref = typeof c === \"string\" ? this.getColumnRef(c) : c;\r\n        add(ref);\r\n      }\r\n    }\r\n    return {\r\n      unsubscribe: () => {\r\n        for (const u of unsubs) {\r\n          u();\r\n        }\r\n      },\r\n    };\r\n  }\r\n\r\n  drop(t: _Transaction, cascade: boolean) {\r\n    this.drophandlers.forEach((d) => d(t, cascade));\r\n    t.delete(this.dataId);\r\n    for (const i of this.indexByHash.values()) {\r\n      i.index.dropFromData(t);\r\n    }\r\n    // todo should also check foreign keys, cascade, ...\r\n    return this.ownerSchema._reg_unregister(this as _ITable);\r\n  }\r\n\r\n  onDrop(sub: DropHandler): ISubscription {\r\n    this.drophandlers.add(sub);\r\n    return {\r\n      unsubscribe: () => {\r\n        this.drophandlers.delete(sub);\r\n      },\r\n    };\r\n  }\r\n\r\n  onTruncate(sub: TruncateHandler): ISubscription {\r\n    this.truncateHandlers.add(sub);\r\n    return {\r\n      unsubscribe: () => {\r\n        this.truncateHandlers.delete(sub);\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nclass SubscriptionConstraint implements _IConstraint {\r\n  constructor(\r\n    readonly name: string,\r\n    readonly uninstall: (t: _Transaction) => void\r\n  ) {}\r\n}\r\n\r\nclass ConstraintWrapper implements _IConstraint {\r\n  constructor(\r\n    private refs: Map<string, _IConstraint>,\r\n    private inner: _IConstraint\r\n  ) {\r\n    if (inner.name) {\r\n      refs.set(inner.name, this);\r\n    }\r\n  }\r\n  get name() {\r\n    return this.inner.name;\r\n  }\r\n  uninstall(t: _Transaction): void {\r\n    this.inner.uninstall(t);\r\n    if (this.name) {\r\n      this.refs.delete(this.name);\r\n    }\r\n  }\r\n}\r\n","import { _IIndex, IValue, IndexExpression, _Transaction, IndexKey, _Explainer, _IndexExplanation, IndexOp, _ISelection, Stats } from '../interfaces-private';\r\n\r\nexport class RestrictiveIndex<T> implements _IIndex<T> {\r\n    constructor(private base: _IIndex<T>, readonly filter: _ISelection<T>) {\r\n    }\r\n\r\n    private match(raw: T, t: _Transaction) {\r\n        return this.filter.hasItem(raw, t);\r\n    }\r\n\r\n    get expressions(): IndexExpression[] {\r\n        return this.base.expressions;\r\n    }\r\n\r\n    stats(t: _Transaction, key?: IndexKey): Stats | null {\r\n        // cannot comput without iterating\r\n        return null;\r\n    }\r\n\r\n    iterateKeys() {\r\n        // cannot comput without iterating\r\n        // (we know underlying keys, but we dont know which have items that match our filter)\r\n        return null;\r\n    }\r\n\r\n    eqFirst(rawKey: IndexKey, t: _Transaction) {\r\n        for (const i of this.base.enumerate({\r\n            key: rawKey,\r\n            t: t,\r\n            type: 'eq',\r\n        })) {\r\n            if (this.match(i, t)) {\r\n                return i;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    entropy(t: IndexOp): number {\r\n        return this.base.entropy(t);\r\n    }\r\n\r\n    *enumerate(op: IndexOp): Iterable<T> {\r\n        for (const i of this.base.enumerate(op)) {\r\n            if (this.match(i, op.t)) {\r\n                yield i;\r\n            }\r\n        }\r\n    }\r\n\r\n    explain(e: _Explainer): _IndexExplanation {\r\n        return {\r\n            _: 'indexRestriction',\r\n            lookup: this.base.explain(e),\r\n            for: this.filter.explain(e),\r\n            // criteria: this.restrict.explain(e),\r\n        }\r\n    }\r\n}","import { AggregationComputer, AggregationGroupComputer, IndexKey, IValue, QueryError, _IIndex, _ISelection, _IType, _Transaction } from '../../interfaces-private';\r\nimport { ExprCall } from 'pgsql-ast-parser';\r\nimport { isSelectAllArgList, nullIsh } from '../../utils';\r\nimport { buildValue } from '../../parser/expression-builder';\r\nimport { Types } from '../../datatypes';\r\nimport { withSelection } from '../../parser/context';\r\n\r\nexport function buildCount(this: void, base: _ISelection, call: ExprCall) {\r\n    return withSelection(base, () => {\r\n        const args = call.args;\r\n        if (isSelectAllArgList(args)) {\r\n            return new CountStar(base);\r\n        }\r\n        if (args.length !== 1) {\r\n            throw new QueryError('COUNT expects one argument, given ' + args.length);\r\n        }\r\n        const what = buildValue(args[0]);\r\n        return new CountExpr(what);\r\n    });\r\n}\r\n\r\nclass CountStar implements AggregationComputer<number> {\r\n\r\n    constructor(private on: _ISelection) {\r\n    }\r\n\r\n    get type(): _IType<any> {\r\n        return Types.bigint;\r\n    }\r\n\r\n    computeFromIndex(key: IndexKey, index: _IIndex<any>, t: _Transaction) {\r\n        const stats = index.stats(t, key);\r\n        return stats?.count;\r\n    }\r\n\r\n    computeNoGroup(t: _Transaction) {\r\n        return this.on.stats(t)?.count;\r\n    }\r\n\r\n    createGroup(): AggregationGroupComputer<number> {\r\n        let cnt = 0;\r\n        return {\r\n            feedItem: () => cnt++,\r\n            finish: () => cnt,\r\n        };\r\n    }\r\n\r\n}\r\n\r\nclass CountExpr implements AggregationComputer<number> {\r\n\r\n    constructor(private exp: IValue) {\r\n    }\r\n\r\n    get type(): _IType<any> {\r\n        return Types.bigint;\r\n    }\r\n\r\n    createGroup(t: _Transaction): AggregationGroupComputer<number> {\r\n        let cnt = 0;\r\n        return {\r\n            feedItem: (item) => {\r\n                const value = this.exp.get(item, t);\r\n                if (!nullIsh(value)) {\r\n                    cnt++;\r\n                }\r\n            },\r\n            finish: () => cnt,\r\n        };\r\n    }\r\n}\r\n","import { AggregationComputer, AggregationGroupComputer, IValue, nil, QueryError, _ISelection, _IType, _Transaction } from '../../interfaces-private';\r\nimport { Expr } from 'pgsql-ast-parser';\r\nimport { buildValue } from '../../parser/expression-builder';\r\nimport { nullIsh } from '../../utils';\r\nimport { DataType } from '../../interfaces';\r\nimport { withSelection } from '../../parser/context';\r\n\r\n\r\nclass MinMax implements AggregationComputer<number> {\r\n\r\n    constructor(private exp: IValue, private isMax: boolean) {\r\n    }\r\n\r\n    get type(): _IType<any> {\r\n        return this.exp.type;\r\n    }\r\n\r\n    createGroup(t: _Transaction): AggregationGroupComputer<number> {\r\n        let val: number | nil = null;\r\n        return {\r\n            feedItem: (item) => {\r\n                const value = this.exp.get(item, t);\r\n                if (!nullIsh(value) && (nullIsh(val) || (\r\n                    this.isMax\r\n                        ? val! < value\r\n                        : val! > value\r\n                ))) {\r\n                    val = value;\r\n                }\r\n            },\r\n            finish: () => val,\r\n        };\r\n    }\r\n}\r\n\r\n\r\nexport function buildMinMax(this: void, base: _ISelection, args: Expr[], op: 'max' | 'min') {\r\n    return withSelection(base, () => {\r\n        if (args.length !== 1) {\r\n            throw new QueryError(op.toUpperCase() + ' expects one argument, given ' + args.length);\r\n        }\r\n\r\n        const what = buildValue(args[0]);\r\n\r\n        switch (what.type.primary) {\r\n            case DataType.bigint:\r\n            case DataType.integer:\r\n            case DataType.decimal:\r\n            case DataType.date:\r\n            case DataType.float:\r\n            case DataType.text:\r\n            case DataType.time:\r\n            case DataType.timetz:\r\n            case DataType.timestamp:\r\n            case DataType.timestamptz:\r\n                break;\r\n            default:\r\n                throw new QueryError(`function min(${what.type.primary}) does not exist`, '42883');\r\n        }\r\n        return new MinMax(what, op === 'max');\r\n    });\r\n}\r\n","import { AggregationComputer, AggregationGroupComputer, IValue, nil, QueryError, _ISelection, _IType, _Transaction } from '../../interfaces-private';\r\nimport { ExprCall } from 'pgsql-ast-parser';\r\nimport { buildValue } from '../../parser/expression-builder';\r\nimport { Types } from '../../datatypes';\r\nimport { nullIsh } from '../../utils';\r\nimport { withSelection } from '../../parser/context';\r\n\r\nclass SumExpr implements AggregationComputer<number> {\r\n\r\n    constructor(private exp: IValue) {\r\n    }\r\n\r\n    get type(): _IType<any> {\r\n        return Types.bigint;\r\n    }\r\n\r\n    createGroup(t: _Transaction): AggregationGroupComputer<number> {\r\n        let val: number | nil = null;\r\n        return {\r\n            feedItem: (item) => {\r\n                const value = this.exp.get(item, t);\r\n                if (!nullIsh(value)) {\r\n                    val = nullIsh(val) ? value : val + value;\r\n                }\r\n            },\r\n            finish: () => val,\r\n        }\r\n    }\r\n}\r\n\r\nexport function buildSum(this: void, base: _ISelection, call: ExprCall) {\r\n    return withSelection(base, () => {\r\n        const args = call.args;\r\n        if (args.length !== 1) {\r\n            throw new QueryError('SUM expects one argument, given ' + args.length);\r\n        }\r\n\r\n        const what = buildValue(args[0]);\r\n        return new SumExpr(what);\r\n\r\n    });\r\n}\r\n","import { AggregationComputer, AggregationGroupComputer, IValue, nil, QueryError, _ISelection, _IType, _Transaction } from '../../interfaces-private';\r\nimport { ExprCall } from 'pgsql-ast-parser';\r\nimport { buildValue } from '../../parser/expression-builder';\r\nimport { Types } from '../../datatypes';\r\nimport { withSelection } from '../../parser/context';\r\n\r\n\r\nclass ArrayAggExpr implements AggregationComputer<any[]> {\r\n\r\n    constructor(private exp: IValue) {\r\n    }\r\n\r\n    get type(): _IType<any> {\r\n        return Types.integer.asArray();\r\n    }\r\n\r\n    createGroup(t: _Transaction): AggregationGroupComputer<any[]> {\r\n        let val: any[] = [];\r\n        return {\r\n            feedItem: (item) => {\r\n                const value = this.exp.get(item, t);\r\n                val = [...val, value];\r\n            },\r\n            finish: () => val,\r\n        }\r\n    }\r\n}\r\n\r\nexport function buildArrayAgg(this: void, base: _ISelection, call: ExprCall) {\r\n    return withSelection(base, () => {\r\n        const args = call.args;\r\n        if (args.length !== 1) {\r\n            throw new QueryError('ARRAY_AGG expects one argument, given ' + args.length);\r\n        }\r\n\r\n        const what = buildValue(args[0]);\r\n        return new ArrayAggExpr(what);\r\n    })\r\n}\r\n","import { AggregationComputer, AggregationGroupComputer, IValue, nil, QueryError, _ISelection, _IType, _Transaction } from '../../interfaces-private';\r\nimport { ExprCall } from 'pgsql-ast-parser';\r\nimport { buildValue } from '../../parser/expression-builder';\r\nimport { Types } from '../../datatypes';\r\nimport { nullIsh, sum } from '../../utils';\r\nimport { withSelection } from '../../parser/context';\r\n\r\n\r\nclass AvgExpr implements AggregationComputer<number> {\r\n\r\n    constructor(private exp: IValue) {\r\n    }\r\n\r\n    get type(): _IType<any> {\r\n        return Types.bigint;\r\n    }\r\n\r\n    createGroup(t: _Transaction): AggregationGroupComputer<number> {\r\n        let full: number[] = [];\r\n        return {\r\n            feedItem: (item) => {\r\n                const value = this.exp.get(item, t);\r\n                if (!nullIsh(value)) {\r\n                    full.push(value);\r\n                }\r\n            },\r\n            finish: () => full.length === 0 ? null : sum(full) / full.length,\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport function buildAvg(this: void, base: _ISelection, call: ExprCall) {\r\n    return withSelection(base, () => {\r\n        const args = call.args;\r\n        if (args.length !== 1) {\r\n            throw new QueryError('AVG expects one argument, given ' + args.length);\r\n        }\r\n\r\n        const what = buildValue(args[0]);\r\n        return new AvgExpr(what);\r\n    });\r\n}\r\n","import { _ISelection, QueryError, AggregationComputer, IValue, _IType, _Transaction, AggregationGroupComputer } from '../../interfaces-private';\r\nimport { ExprCall } from 'pgsql-ast-parser';\r\nimport { withSelection } from '../../parser/context';\r\nimport { buildValue } from '../../parser/expression-builder';\r\nimport { nullIsh } from '../../utils';\r\nimport { Types } from '../../datatypes';\r\n\r\n\r\nclass JsonAggExpr implements AggregationComputer<any[]> {\r\n\r\n    constructor(private exp: IValue, readonly type: _IType) {\r\n    }\r\n\r\n    createGroup(t: _Transaction): AggregationGroupComputer<any[]> {\r\n        let full: any[][] = [];\r\n        return {\r\n            feedItem: (item) => {\r\n                const value = this.exp.get(item, t);\r\n                if (!nullIsh(value)) {\r\n                    full.push(value);\r\n                }\r\n            },\r\n            finish: () => full.length === 0 ? null : full,\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport function buildJsonAgg(this: void, base: _ISelection, call: ExprCall, fn: 'json_agg' | 'jsonb_agg') {\r\n    return withSelection(base, () => {\r\n        const args = call.args;\r\n        if (args.length !== 1) {\r\n            throw new QueryError(fn + ' expects one argument, given ' + args.length);\r\n        }\r\n        const type = fn === 'json_agg' ? Types.json : Types.jsonb;\r\n        const what = buildValue(args[0]);\r\n        return new JsonAggExpr(what, type);\r\n    });\r\n}\r\n","import { _ISelection, QueryError, AggregationComputer, IValue, _IType, _Transaction, AggregationGroupComputer } from '../../interfaces-private';\r\nimport { ExprCall } from 'pgsql-ast-parser';\r\nimport { withSelection } from '../../parser/context';\r\nimport { buildValue } from '../../parser/expression-builder';\r\nimport { nullIsh } from '../../utils';\r\nimport { Types } from '../../datatypes';\r\n\r\n\r\nclass BoolAgg implements AggregationComputer<boolean> {\r\n\r\n    constructor(private exp: IValue, private isOr: boolean) {\r\n    }\r\n\r\n    get type() {\r\n        return Types.bool;\r\n    }\r\n\r\n    createGroup(t: _Transaction): AggregationGroupComputer<boolean> {\r\n        let result: boolean | null = null;\r\n        return {\r\n            feedItem: (item) => {\r\n                if (result === this.isOr) {\r\n                    // no need to compute it further\r\n                    return;\r\n                }\r\n                const value = this.exp.get(item, t);\r\n                if (nullIsh(value)) {\r\n                    return;\r\n                }\r\n                result = !!value;\r\n            },\r\n            finish: () => result,\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nexport function buildBoolAgg(this: void, base: _ISelection, call: ExprCall, fn: 'bool_and' | 'bool_or') {\r\n    return withSelection(base, () => {\r\n        const args = call.args;\r\n        if (args.length !== 1) {\r\n            throw new QueryError(fn + ' expects one argument, given ' + args.length);\r\n        }\r\n        const what = buildValue(args[0]).cast(Types.bool);\r\n        return new BoolAgg(what, fn === 'bool_or');\r\n    });\r\n}\r\n","import { _ITable, _Transaction, IValue, _Explainer, _ISchema, asTable, _ISelection, _IIndex, _IStatement } from '../../interfaces-private';\r\nimport { DeleteStatement } from 'pgsql-ast-parser';\r\nimport { MutationDataSourceBase } from './mutation-base';\r\nimport { buildCtx } from '../../parser/context';\r\n\r\nexport class Deletion extends MutationDataSourceBase<any> {\r\n\r\n\r\n    constructor(ast: DeleteStatement) {\r\n        const { schema } = buildCtx();\r\n        const table = asTable(schema.getObject(ast.from));\r\n        const mutatedSel = table\r\n            .selection\r\n            .filter(ast.where);\r\n\r\n        super(table, mutatedSel, ast);\r\n    }\r\n\r\n    protected performMutation(t: _Transaction): any[] {\r\n        // perform deletion\r\n        const rows = [];\r\n        for (const item of this.mutatedSel.enumerate(t)) {\r\n            this.table.delete(t, item);\r\n            rows.push(item);\r\n        }\r\n        return rows;\r\n    }\r\n}\r\n","import { _ITable, _Transaction, _Explainer, _ISchema, asTable, _ISelection, _IIndex, _IStatement } from '../../interfaces-private';\r\nimport { UpdateStatement } from 'pgsql-ast-parser';\r\nimport { MutationDataSourceBase, Setter, createSetter } from './mutation-base';\r\nimport { buildCtx } from '../../parser/context';\r\nimport { buildSelect } from '../select';\r\nimport { Selection } from '../../transforms/selection';\r\nimport { JoinSelection } from '../../transforms/join';\r\n\r\nexport class Update extends MutationDataSourceBase<any> {\r\n\r\n    private setter: Setter;\r\n    private fetchObjectToUpdate?: ((x: any) => any);\r\n\r\n    constructor(ast: UpdateStatement) {\r\n        const { schema } = buildCtx();\r\n        const into = asTable(schema.getObject(ast.table));\r\n        let mutatedSel: _ISelection;\r\n        let fetchObjectToUpdate: ((x: any) => any) | undefined;\r\n        if (ast.from) {\r\n\r\n            //  => UPDATE-FROM-SELECT\r\n\r\n            // build a join that selects the full record to update,\r\n            // based on the data from the original selection\r\n            mutatedSel = buildSelect({\r\n                type: 'select',\r\n                // join from:\r\n                from: [\r\n                    ast.from,\r\n                    {\r\n                        type: 'table',\r\n                        name: ast.table,\r\n                        join: {\r\n                            type: 'INNER JOIN',\r\n                            on: ast.where,\r\n                        }\r\n                    }],\r\n                // // select the whole updated record\r\n                columns: [{\r\n                    expr: {\r\n                        type: 'ref',\r\n                        table: ast.table,\r\n                        name: '*',\r\n                    }\r\n                }]\r\n            });\r\n\r\n            // this should have built a selection on a join statement\r\n            if (!(mutatedSel instanceof Selection)) {\r\n                throw new Error('Invalid select-from statement');\r\n            }\r\n            mutatedSel = mutatedSel.base;\r\n            if (!(mutatedSel instanceof JoinSelection)) {\r\n                // should not happen\r\n                throw new Error('Invalid select-from statement');\r\n            }\r\n            // use hack to get the full joined source in the selection\r\n            fetchObjectToUpdate = x => x['>joined'];\r\n        } else {\r\n\r\n            //  => REGULAR UPDATE\r\n            mutatedSel = into\r\n                .selection\r\n                .filter(ast.where);\r\n        }\r\n\r\n\r\n        super(into, mutatedSel, ast);\r\n\r\n        this.setter = createSetter(this.table, this.mutatedSel, ast.sets);\r\n        this.fetchObjectToUpdate = fetchObjectToUpdate;\r\n\r\n    }\r\n\r\n    protected performMutation(t: _Transaction): any[] {\r\n        // perform update\r\n        const rows: any[] = [];\r\n        for (const i of this.mutatedSel.enumerate(t)) {\r\n            const data = this.fetchObjectToUpdate\r\n                ? this.fetchObjectToUpdate(i)\r\n                : i;\r\n            this.setter(t, data, i);\r\n            rows.push(this.table.update(t, data));\r\n        }\r\n        return rows;\r\n    }\r\n}\r\n","import { _ITable, _Transaction, IValue, _Explainer, nil, _ISchema, asTable, _ISelection, _IIndex, QueryError, OnConflictHandler, ChangeOpts, _IStatement } from '../../interfaces-private';\r\nimport { InsertStatement } from 'pgsql-ast-parser';\r\nimport { buildValue } from '../../parser/expression-builder';\r\nimport { Types } from '../../datatypes';\r\nimport { JoinSelection } from '../../transforms/join';\r\nimport { MutationDataSourceBase, createSetter } from './mutation-base';\r\nimport { ArrayFilter } from '../../transforms/array-filter';\r\nimport { withSelection, buildCtx } from '../../parser/context';\r\nimport { buildValues, buildSelect } from '../../execution/select';\r\n\r\nexport class Insert extends MutationDataSourceBase<any> {\r\n\r\n    private valueRawSource: _ISelection;\r\n    private insertColumns!: string[];\r\n    private valueConvertedSource!: IValue<any>[];\r\n    private opts!: ChangeOpts;\r\n\r\n\r\n    constructor(ast: InsertStatement) {\r\n        const { schema } = buildCtx();\r\n        // get table to insert into\r\n        const table = asTable(schema.getObject(ast.into));\r\n        const selection = table\r\n            .selection\r\n            .setAlias(ast.into.alias);\r\n\r\n        // init super\r\n        super(table, selection, ast);\r\n\r\n        // get data to insert\r\n        this.valueRawSource = ast.insert.type === 'values'\r\n            ? buildValues(ast.insert, true)\r\n            : buildSelect(ast.insert);\r\n\r\n\r\n        withSelection(this, () => this.visit(ast));\r\n    }\r\n\r\n    private visit(ast: InsertStatement) {\r\n\r\n        // check not inserting too many values\r\n        this.insertColumns = ast.columns?.map(x => x.name)\r\n            ?? this.table.selection.columns.map(x => x.id!)\r\n                .slice(0, this.valueRawSource.columns.length);\r\n        if (this.valueRawSource.columns.length > this.insertColumns.length) {\r\n            throw new QueryError(`INSERT has more expressions than target columns`);\r\n        }\r\n\r\n        // check insert types\r\n        this.valueConvertedSource = this.insertColumns.map((col, i) => {\r\n            const value = this.valueRawSource.columns[i];\r\n            const insertInto = this.table.selection.getColumn(col);\r\n            // It seems that the explicit conversion is only performed when inserting values.\r\n            const canConvert = ast.insert.type === 'values'\r\n                ? value.type.canCast(insertInto.type)\r\n                : value.type.canConvertImplicit(insertInto.type);\r\n            if (!canConvert) {\r\n                throw new QueryError(`column \"${col}\" is of type ${insertInto.type.name} but expression is of type ${value.type.name}`);\r\n            }\r\n            return value.type === Types.default\r\n                ? value  // handle \"DEFAULT\" values\r\n                : value.cast(insertInto.type);\r\n        });\r\n\r\n\r\n        // build 'on conflict' strategy\r\n        let ignoreConflicts: OnConflictHandler | nil = undefined;\r\n        if (ast.onConflict) {\r\n            // find the targeted index\r\n            const _on = ast.onConflict.on;\r\n            const on = _on && withSelection(this.table.selection, () => _on?.map(x => buildValue(x)));\r\n            let onIndex: _IIndex | nil = null;\r\n            if (on) {\r\n                onIndex = this.table.getIndex(...on);\r\n                if (!onIndex?.unique) {\r\n                    throw new QueryError(`There is no unique or exclusion constraint matching the ON CONFLICT specification`);\r\n                }\r\n            }\r\n\r\n            // check if 'do nothing'\r\n            if (ast.onConflict.do === 'do nothing') {\r\n                ignoreConflicts = { ignore: onIndex ?? 'all' };\r\n            } else {\r\n                if (!onIndex) {\r\n                    throw new QueryError(`ON CONFLICT DO UPDATE requires inference specification or constraint name`);\r\n                }\r\n                const subject = new JoinSelection(\r\n                    this.mutatedSel\r\n                    // fake data... we're only using this to get the multi table column resolution:\r\n                    , new ArrayFilter(this.table.selection, []).setAlias('excluded')\r\n                    , {\r\n                        type: 'LEFT JOIN',\r\n                        on: { type: 'boolean', value: false }\r\n                    }\r\n                    , false\r\n                );\r\n                const setter = createSetter(this.table, subject, ast.onConflict.do.sets,);\r\n                const _where = ast.onConflict.where;\r\n                const where = _where && withSelection(subject, () => buildValue(_where));\r\n                ignoreConflicts = {\r\n                    onIndex,\r\n                    update: (item, excluded, t) => {\r\n                        // build setter context\r\n                        const jitem = subject.buildItem(item, excluded);\r\n\r\n                        // check \"WHERE\" clause on conflict\r\n                        if (where) {\r\n                            const whereClause = where.get(jitem, t);\r\n                            if (whereClause !== true) {\r\n                                return;\r\n                            }\r\n                        }\r\n\r\n                        // execute set\r\n                        setter(t, item, jitem);\r\n                    },\r\n                }\r\n            }\r\n        }\r\n\r\n        this.opts = {\r\n            onConflict: ignoreConflicts,\r\n            overriding: ast.overriding\r\n        };\r\n    }\r\n\r\n    protected performMutation(t: _Transaction): any[] {\r\n\r\n        // enumerate & get\r\n        const values: any[][] = [];\r\n        for (const o of this.valueRawSource.enumerate(t)) {\r\n            const nv = [];\r\n            for (let i = 0; i < this.insertColumns.length; i++) {\r\n                const _custom = this.valueConvertedSource[i].get(o, t);\r\n                nv.push(_custom);\r\n            }\r\n            values.push(nv);\r\n        }\r\n\r\n\r\n        // insert values\r\n        const ret: any[] = [];\r\n\r\n        for (const val of values) {\r\n            if (val.length !== this.insertColumns.length) {\r\n                throw new QueryError('Insert columns / values count mismatch');\r\n            }\r\n            const toInsert: any = {};\r\n            for (let i = 0; i < val.length; i++) {\r\n                const v = val[i];\r\n                const col = this.valueConvertedSource[i];\r\n                if (col.type === Types.default) {\r\n                    continue; // insert a 'DEFAULT' value\r\n                }\r\n                toInsert[this.insertColumns[i]] = v;\r\n                // if ('_custom' in v) {\r\n                //      toInsert[columns[i]] = v._custom;\r\n                // } else {\r\n                //     const notConv = buildValue(table.selection, v);\r\n                //     const converted = notConv.cast(col.type);\r\n                //     if (!converted.isConstant) {\r\n                //         throw new QueryError('Cannot insert non constant expression');\r\n                //     }\r\n                //     toInsert[columns[i]] = converted.get();\r\n                // }\r\n            }\r\n            ret.push(this.table.doInsert(t, toInsert, this.opts));\r\n        }\r\n\r\n        return ret;\r\n    }\r\n}\r\n","import { nil, QueryError, Schema, SchemaField } from '../interfaces';\r\nimport { IValue, setId, _ISchema, _IType, _Transaction } from '../interfaces-private';\r\nimport { Expr } from 'pgsql-ast-parser';\r\nimport { ReadOnlyTable } from './readonly-table';\r\nimport { buildValue } from '../parser/expression-builder';\r\nimport { Types } from '../datatypes';\r\nimport { withSelection, buildCtx } from '../parser/context';\r\n\r\nlet cnt = 0;\r\nexport class ValuesTable extends ReadOnlyTable {\r\n    private symbol = Symbol();\r\n    _schema!: Schema;\r\n    private assignments!: (IValue<any> | \"default\")[][];\r\n\r\n    entropy(t: _Transaction): number {\r\n        return 0;\r\n    }\r\n\r\n    enumerate(t: _Transaction): Iterable<any> {\r\n        const ret = this.assignments.map(vals => {\r\n            const ret = { [this.symbol]: true } as any;\r\n            setId(ret, 'vtbl' + (++cnt));\r\n            for (let i = 0; i < vals.length; i++) {\r\n                const v = vals[i];\r\n                ret[this._schema.fields[i].name] = v === 'default'\r\n                    ? null\r\n                    : v.get({}, t);\r\n            }\r\n            return ret;\r\n        });\r\n        return ret;\r\n    }\r\n\r\n    hasItem(value: any, t: _Transaction): boolean {\r\n        return !!value[this.symbol];\r\n    }\r\n\r\n    constructor(alias: string, items: Expr[][], columnNames: string[] | nil, acceptDefault?: boolean) {\r\n        super(buildCtx().schema);\r\n        withSelection(buildCtx().schema.dualTable.selection, () => {\r\n            const len = new Set(items.map(x => x.length));\r\n            if (len.size !== 1) {\r\n                throw new QueryError('VALUES lists must all be the same length');\r\n            }\r\n            if (columnNames && columnNames.length > items[0].length) {\r\n                throw new QueryError(`table \"${alias}\" has ${items[0].length} columns available but ${columnNames.length} columns specified`);\r\n            }\r\n            type V = IValue | 'default';\r\n            let builtVals: V[][] = items.map(vals => vals.map(e => {\r\n                if (acceptDefault && e.type === 'default') {\r\n                    return 'default';\r\n                }\r\n                return buildValue(e);\r\n            }));\r\n            const types = items[0].map((_, i) => {\r\n                return preferedType(builtVals.map(x => {\r\n                    const v = x[i];\r\n                    return v === 'default'\r\n                        ? null\r\n                        : v.type;\r\n                }))\r\n            });\r\n            this._schema = {\r\n                name: alias,\r\n                fields: types.map<SchemaField>((type, i) => {\r\n                    return {\r\n                        type: type ?? Types.default,\r\n                        name: columnNames?.[i] ?? `column${i + 1}`,\r\n                    }\r\n                })\r\n            };\r\n            this.assignments = builtVals.map(vals => vals.map((v, i) => v === 'default' ? v : v.cast(types[i]!)))\r\n        });\r\n    }\r\n}\r\n\r\nfunction preferedType(types: (_IType | null)[]) {\r\n    return types.reduce((a, b) => {\r\n        if (!a) {\r\n            return b;\r\n        }\r\n        if (!b) {\r\n            return a;\r\n        }\r\n        const ret = a.prefer(b);\r\n        if (!ret) {\r\n            throw new QueryError('Incompatible value types');\r\n        }\r\n        return ret;\r\n    }, types[0]);\r\n}","import { _Transaction, IValue, _Explainer, _IIndex, _SelectExplanation, Stats } from '../interfaces-private';\r\nimport { RecordCol } from '../datatypes';\r\nimport { buildCtx } from '../parser/context';\r\nimport { DataSourceBase } from '../transforms/transform-base';\r\nimport { columnEvaluator } from '../transforms/selection';\r\nimport { colByName, fromEntries } from '../utils';\r\n\r\nexport class FunctionCallTable extends DataSourceBase<any> {\r\n    readonly columns: readonly IValue<any>[];\r\n    private readonly colsByName: Map<string, IValue<any>>;\r\n    private symbol = Symbol();\r\n\r\n    get isExecutionWithNoResult(): boolean {\r\n        return false;\r\n    }\r\n\r\n    constructor(cols: readonly RecordCol[], private evaluator: IValue) {\r\n        super(buildCtx().schema);\r\n        this.columns = cols.map(c => columnEvaluator(this, c.name, c.type).setOrigin(this));\r\n        this.colsByName = fromEntries(this.columns.map(c => [c.id!, c]));\r\n    }\r\n\r\n    entropy(t: _Transaction): number {\r\n        return 0;\r\n    }\r\n\r\n    enumerate(t: _Transaction): Iterable<any> {\r\n        const results = this.evaluator.get(null, t);\r\n        for (const result of results ?? []) {\r\n            result[this.symbol] = true;\r\n        }\r\n        return results;\r\n    }\r\n\r\n    hasItem(value: any, t: _Transaction): boolean {\r\n        return !!(value as any)[this.symbol];\r\n    }\r\n\r\n    getColumn(column: string, nullIfNotFound?: boolean | undefined): IValue<any> {\r\n        return colByName(this.colsByName, column, nullIfNotFound)!;\r\n    }\r\n\r\n    getIndex(forValue: IValue<any>): _IIndex<any> | null | undefined {\r\n        return null;\r\n    }\r\n\r\n    isOriginOf(value: IValue<any>): boolean {\r\n        return value.origin === this;\r\n    }\r\n\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n}\r\n","import {\r\n  IValue,\r\n  _IIndex,\r\n  _ITable,\r\n  getId,\r\n  IndexKey,\r\n  CreateIndexColDef,\r\n  _Transaction,\r\n  _Explainer,\r\n  _IndexExplanation,\r\n  IndexExpression,\r\n  IndexOp,\r\n  Stats,\r\n  _INamedIndex,\r\n  Reg,\r\n  _ISchema,\r\n} from \"../interfaces-private\";\r\n// @ts-ignore\r\nimport createTree from \"functional-red-black-tree\";\r\nimport { QueryError, NotSupported, nil } from \"../interfaces\";\r\nimport { Set as ImSet, Map as ImMap } from \"immutable\";\r\nimport { deepCloneSimple, nullIsh, hasNullish } from \"../utils\";\r\n\r\n// https://www.npmjs.com/package/functional-red-black-tree\r\ninterface BTree<T> {\r\n  readonly keys: Iterable<IndexKey>;\r\n  readonly values: Iterable<IndexKey>;\r\n  readonly length: number;\r\n  get(key: IndexKey): T;\r\n  insert(key: IndexKey, value: T): BTree<T>;\r\n  remove(key: IndexKey): BTree<T>;\r\n  find(key: IndexKey): BIterator<T>;\r\n  /** Find the first item in the tree whose key is >= key */\r\n  ge(key: IndexKey): BIterator<T>;\r\n  /** Finds the first item in the tree whose key is > key */\r\n  gt(key: IndexKey): BIterator<T>;\r\n  /** Finds the last item in the tree whose key is < key */\r\n  lt(key: IndexKey): BIterator<T>;\r\n  /** Finds the last item in the tree whose key is <= key */\r\n  le(key: IndexKey): BIterator<T>;\r\n\r\n  at(pos: number): BIterator<T>;\r\n\r\n  readonly begin: BIterator<T>;\r\n  readonly end: BIterator<T>;\r\n  /**  If a truthy value is returned from the visitor, then iteration is stopped. */\r\n  forEach(\r\n    fn: (key: IndexKey, value: T) => boolean,\r\n    low?: number,\r\n    high?: number\r\n  ): void;\r\n  // root;\r\n}\r\n\r\ninterface BIterator<T> {\r\n  readonly key: IndexKey;\r\n  readonly value: T;\r\n  // tree;\r\n  readonly index: any;\r\n  readonly valid: boolean;\r\n  clone(): BIterator<T>;\r\n  remove(): BTree<T>;\r\n  update(value: T): BTree<T>;\r\n  next(): void;\r\n  prev(): void;\r\n  readonly hasNext: boolean;\r\n  readonly hasPrev: boolean;\r\n}\r\n\r\ntype RawTree<T> = BTree<ImMap<string, T>>;\r\n\r\nexport class BIndex<T = any> implements _INamedIndex<T> {\r\n  get type(): \"index\" {\r\n    return \"index\";\r\n  }\r\n\r\n  readonly reg: Reg;\r\n\r\n  // private asBinary: RawTree;\r\n  expressions: (IndexExpression & IValue)[];\r\n  private treeBinId = Symbol();\r\n  private treeCountId = Symbol();\r\n\r\n  get ownerSchema(): _ISchema {\r\n    return this.onTable.ownerSchema;\r\n  }\r\n\r\n  constructor(\r\n    t: _Transaction,\r\n    readonly name: string,\r\n    private cols: CreateIndexColDef[],\r\n    readonly onTable: _ITable<T>,\r\n    readonly hash: string,\r\n    readonly unique: boolean,\r\n    readonly notNull: boolean,\r\n    readonly predicate: IValue | nil\r\n  ) {\r\n    this.reg = onTable.ownerSchema._reg_register(this);\r\n    this.truncate(t);\r\n    this.expressions = cols.map((x) => x.value);\r\n  }\r\n\r\n  drop(t: _Transaction): void {\r\n    this.onTable.dropIndex(t, this.name);\r\n  }\r\n\r\n  compare(_a: any, _b: any) {\r\n    for (let i = 0; i < this.expressions.length; i++) {\r\n      const k = this.cols[i];\r\n      const a = _a[i];\r\n      const b = _b[i];\r\n      const an = nullIsh(a);\r\n      const bn = nullIsh(b);\r\n      if (an || bn) {\r\n        if (an === bn) {\r\n          continue;\r\n        }\r\n        return (an ? -1 : 1) * (k.nullsLast ? 1 : -1);\r\n      }\r\n      if (k.value.type.equals(a, b)) {\r\n        continue;\r\n      }\r\n      return k.value.type.gt(a, b) ? 1 : -1; // * (k.desc ? -1 : 1);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  buildKey(raw: any, t: _Transaction): any[] {\r\n    return this.expressions.map((k) => k.get(raw, t));\r\n  }\r\n\r\n  truncate(t: _Transaction) {\r\n    const asBinary = createTree((a: any, b: any) => {\r\n      return this.compare(a, b);\r\n    });\r\n    this.setBin(t, asBinary);\r\n  }\r\n\r\n  dropFromData(t: _Transaction) {\r\n    t.delete(this.treeBinId);\r\n  }\r\n\r\n  private bin(t: _Transaction) {\r\n    return t.get<RawTree<T>>(this.treeBinId);\r\n  }\r\n  private setBin(t: _Transaction, val: RawTree<T>) {\r\n    return t.set(this.treeBinId, val);\r\n  }\r\n\r\n  private setCount(t: _Transaction, val: number) {\r\n    return t.set(this.treeCountId, val);\r\n  }\r\n  private getCount(t: _Transaction): number {\r\n    return t.get<number>(this.treeCountId) ?? 0;\r\n  }\r\n\r\n  hasKey(key: IndexKey[], t: _Transaction): boolean {\r\n    const it = this.bin(t).find(key);\r\n    return it.valid;\r\n  }\r\n\r\n  add(raw: T, t: _Transaction) {\r\n    // check that predicate is OK\r\n    if (this.predicate) {\r\n      const val = this.predicate.get(raw, t);\r\n      if (nullIsh(val) || val === false) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    // build key and object id\r\n    const id = getId(raw);\r\n    const key = this.buildKey(raw, t);\r\n    const hasNil = hasNullish(...key);\r\n    if (this.notNull && hasNil) {\r\n      throw new QueryError(\"Cannot add a null record in index \" + this.name);\r\n    }\r\n    if (this.unique && !hasNil && this.hasKey(key, t)) {\r\n      const idCols = this.cols.map((it) => it.value.id);\r\n      throw new QueryError({\r\n        error:\r\n          `insert into \"${this.onTable.name}\" (${Object.keys(\r\n            raw as Object\r\n          ).join(\", \")}) ` +\r\n          `values (${Object.keys(raw as Object)\r\n            .map((_, i) => `$${i + 1}`)\r\n            .join(\", \")}) returning \"${idCols}\" ` +\r\n          `- duplicate key value violates unique constraint \"${this.onTable.name}_pkey\"`,\r\n        details: `Key (${idCols})=(${key}) already exists.`,\r\n        code: \"23505\",\r\n      });\r\n    }\r\n    // get tree\r\n    let tree = this.bin(t);\r\n    // get key in tree\r\n    let keyValues = tree.find(key);\r\n    if (keyValues.valid) {\r\n      if (keyValues.value.has(id)) {\r\n        return; // already exists\r\n      }\r\n      tree = keyValues.update(keyValues.value.set(id, raw));\r\n    } else {\r\n      tree = tree.insert(key, ImMap<string, T>().set(id, raw));\r\n    }\r\n    this.setBin(t, tree);\r\n    this.setCount(t, this.getCount(t) + 1);\r\n  }\r\n\r\n  delete(raw: any, t: _Transaction) {\r\n    const key = this.buildKey(raw, t);\r\n    let tree = this.bin(t);\r\n    let keyValues = tree.find(key);\r\n    if (!keyValues.valid) {\r\n      return; // key does not exists\r\n    }\r\n    const id = getId(raw);\r\n    if (!keyValues.value.has(id)) {\r\n      return; // element does not exists\r\n    }\r\n    const newKeyValues = keyValues.value.delete(id);\r\n    if (!newKeyValues.size) {\r\n      tree = keyValues.remove();\r\n    } else {\r\n      tree = keyValues.update(newKeyValues);\r\n    }\r\n    this.setBin(t, tree);\r\n    this.setCount(t, this.getCount(t) - 1);\r\n  }\r\n\r\n  eqFirst(rawKey: IndexKey, t: _Transaction): T | null {\r\n    for (const r of this.eq(rawKey, t, false)) {\r\n      return deepCloneSimple(r);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  *nin(rawKey: IndexKey[], t: _Transaction): Iterable<T> {\r\n    rawKey.sort((a, b) => this.compare(a, b));\r\n    const kit = rawKey[Symbol.iterator]();\r\n    let cur = kit.next();\r\n    const bin = this.bin(t);\r\n    let it = bin.begin;\r\n    while (!cur.done) {\r\n      // yield previous\r\n      while (it.valid && this.compare(it.key, cur.value) < 0) {\r\n        yield* it.value.values();\r\n        it.next();\r\n      }\r\n      // skip equals\r\n      if (this.compare(it.key, cur.value) === 0) {\r\n        it = bin.gt(cur.value);\r\n      }\r\n      cur = kit.next();\r\n    }\r\n\r\n    // finish\r\n    while (it.valid) {\r\n      yield* it.value.values();\r\n      it.next();\r\n    }\r\n  }\r\n\r\n  entropy(op: IndexOp) {\r\n    const bin = this.bin(op.t);\r\n    if (!bin.length) {\r\n      return 0;\r\n    }\r\n    const all = op.t.get<number>(this.treeCountId) ?? 0;\r\n    // evaluate number of keys included in this operation\r\n    const e = this._keyCount(op);\r\n    // multiply by average values per key\r\n    return (e * all) / bin.length;\r\n  }\r\n\r\n  stats(t: _Transaction, key?: IndexKey): Stats {\r\n    if (!key) {\r\n      return {\r\n        count: t.get<number>(this.treeCountId) ?? 0,\r\n      };\r\n    }\r\n    const found = this.bin(t).get(key);\r\n    return {\r\n      count: found?.size ?? 0,\r\n    };\r\n  }\r\n\r\n  iterateKeys(t: _Transaction): Iterable<IndexKey> {\r\n    const bin = this.bin(t);\r\n    return bin.keys;\r\n  }\r\n\r\n  private _keyCount(op: IndexOp) {\r\n    const bin = this.bin(op.t);\r\n    switch (op.type) {\r\n      case \"eq\": {\r\n        const begin = bin.find(op.key);\r\n        if (!begin.valid) {\r\n          return 0;\r\n        }\r\n        const end = bin.gt(op.key);\r\n        if (!end.valid) {\r\n          return bin.length - begin.index;\r\n        }\r\n        return end.index - begin.index + 1;\r\n      }\r\n      case \"neq\": {\r\n        let cnt = 0;\r\n        const first = bin.find(op.key);\r\n        if (!first.valid) {\r\n          return bin.length;\r\n        }\r\n        cnt += first.valid ? first.index : 0;\r\n        const end = bin.gt(op.key);\r\n        cnt += end.valid ? bin.length - end.index : 0;\r\n        return cnt;\r\n      }\r\n      case \"ge\": {\r\n        const found = bin.ge(op.key);\r\n        return found.valid ? bin.length - found.index : 0;\r\n      }\r\n      case \"gt\": {\r\n        const found = bin.gt(op.key);\r\n        return found.valid ? bin.length - found.index : 0;\r\n      }\r\n      case \"le\": {\r\n        const found = bin.gt(op.key);\r\n        return found.valid ? found.index : bin.length;\r\n      }\r\n      case \"lt\": {\r\n        const found = bin.ge(op.key);\r\n        return found.valid ? found.index : bin.length;\r\n      }\r\n      case \"inside\": {\r\n        const begin = bin.ge(op.lo);\r\n        if (!begin.valid) {\r\n          return 0;\r\n        }\r\n        const end = bin.gt(op.hi);\r\n        if (!end.valid) {\r\n          return bin.length - begin.index;\r\n        }\r\n        return end.index - begin.index;\r\n      }\r\n      case \"outside\": {\r\n        let cnt = 0;\r\n        const first = bin.lt(op.lo);\r\n        cnt += first.valid ? first.index + 1 : 0;\r\n        const end = bin.gt(op.hi);\r\n        cnt += end.valid ? bin.length - end.index : 0;\r\n        return cnt;\r\n      }\r\n      case \"nin\": {\r\n        let cnt = bin.length;\r\n        for (const e of op.keys) {\r\n          const f = bin.find(e);\r\n          if (f.valid) {\r\n            cnt--;\r\n          }\r\n        }\r\n        return cnt;\r\n      }\r\n      default:\r\n        throw NotSupported.never(op[\"type\"]);\r\n    }\r\n  }\r\n\r\n  *enumerate(op: IndexOp): Iterable<T> {\r\n    for (const x of this._enumerate(op)) {\r\n      yield deepCloneSimple(x);\r\n    }\r\n  }\r\n  private _enumerate(op: IndexOp): Iterable<T> {\r\n    switch (op.type) {\r\n      case \"eq\":\r\n        return this.eq(op.key, op.t, op.matchNull!);\r\n      case \"neq\":\r\n        return this.neq(op.key, op.t, op.matchNull!);\r\n      case \"ge\":\r\n        return this.ge(op.key, op.t);\r\n      case \"le\":\r\n        return this.le(op.key, op.t);\r\n      case \"gt\":\r\n        return this.gt(op.key, op.t);\r\n      case \"lt\":\r\n        return this.lt(op.key, op.t);\r\n      case \"outside\":\r\n        return this.outside(op.lo, op.hi, op.t);\r\n      case \"inside\":\r\n        return this.inside(op.lo, op.hi, op.t);\r\n      case \"nin\":\r\n        return this.nin(op.keys, op.t);\r\n      default:\r\n        throw NotSupported.never(op[\"type\"]);\r\n    }\r\n  }\r\n\r\n  *eq(key: IndexKey, t: _Transaction, matchNull: boolean): Iterable<T> {\r\n    if (!matchNull && key.some(nullIsh)) {\r\n      return;\r\n    }\r\n    const it = this.bin(t).find(key);\r\n    while (it.valid && this.compare(it.key, key) === 0) {\r\n      yield* it.value.values();\r\n      it.next();\r\n    }\r\n  }\r\n\r\n  *neq(key: IndexKey, t: _Transaction, matchNull: boolean): Iterable<T> {\r\n    if (!matchNull && key.some(nullIsh)) {\r\n      return;\r\n    }\r\n    // yield before\r\n    const bin = this.bin(t);\r\n    let it = bin.begin;\r\n    while (it.valid && this.compare(it.key, key) < 0) {\r\n      yield* it.value.values();\r\n      it.next();\r\n    }\r\n    // yield after\r\n    it = bin.gt(key);\r\n    while (it.valid) {\r\n      yield* it.value.values();\r\n      it.next();\r\n    }\r\n  }\r\n\r\n  *gt(key: IndexKey, t: _Transaction): Iterable<T> {\r\n    const it = this.bin(t).gt(key);\r\n    while (it.valid) {\r\n      yield* it.value.values();\r\n      it.next();\r\n    }\r\n  }\r\n\r\n  *ge(key: IndexKey, t: _Transaction): Iterable<T> {\r\n    const it = this.bin(t).ge(key);\r\n    while (it.valid) {\r\n      yield* it.value.values();\r\n      it.next();\r\n    }\r\n  }\r\n\r\n  *lt(key: IndexKey, t: _Transaction): Iterable<T> {\r\n    const bin = this.bin(t);\r\n    const limit = bin.lt(key);\r\n    const it = bin.begin;\r\n    if (!limit.valid) {\r\n      // yield all\r\n      while (it.valid) {\r\n        yield* it.value.values();\r\n        it.next();\r\n      }\r\n      return;\r\n    }\r\n    while (it.valid && limit.index >= it.index) {\r\n      yield* it.value.values();\r\n      it.next();\r\n    }\r\n    // const it = this.asBinary.lt(key);\r\n    // while (it.valid) {\r\n    //     yield* it.value.values();\r\n    //     it.prev();\r\n    // }\r\n  }\r\n\r\n  *le(key: IndexKey, t: _Transaction): Iterable<T> {\r\n    const bin = this.bin(t);\r\n    const limit = bin.le(key);\r\n    const it = bin.begin;\r\n    if (!limit.valid) {\r\n      // yield all\r\n      while (it.valid) {\r\n        yield* it.value.values();\r\n        it.next();\r\n      }\r\n      return;\r\n    }\r\n    while (it.valid && limit.index >= it.index) {\r\n      yield* it.value.values();\r\n      it.next();\r\n    }\r\n    // const it = this.asBinary.le(key);\r\n    // while (it.valid) {\r\n    //     yield* it.value.values();\r\n    //     it.prev();\r\n    // }\r\n  }\r\n\r\n  *outside(lo: IndexKey, hi: IndexKey, t: _Transaction): Iterable<T> {\r\n    yield* this.lt(lo, t);\r\n    yield* this.gt(hi, t);\r\n  }\r\n\r\n  *inside(lo: IndexKey, hi: IndexKey, t: _Transaction): Iterable<T> {\r\n    const it = this.bin(t).ge(lo);\r\n    while (it.valid && this.compare(it.key, hi) <= 0) {\r\n      yield* it.value.values();\r\n      it.next();\r\n    }\r\n  }\r\n\r\n  explain(e: _Explainer): _IndexExplanation {\r\n    return {\r\n      _: \"btree\",\r\n      onTable: this.onTable.name,\r\n      btree: this.expressions.map((x) => x.id!),\r\n    };\r\n  }\r\n}\r\n","module.exports = require(\"functional-red-black-tree\");","import {\r\n  _Column,\r\n  IValue,\r\n  _IIndex,\r\n  NotSupported,\r\n  _Transaction,\r\n  QueryError,\r\n  _IType,\r\n  SchemaField,\r\n  ChangeHandler,\r\n  nil,\r\n  ISubscription,\r\n  DropHandler,\r\n} from \"./interfaces-private\";\r\nimport type { MemoryTable } from \"./table\";\r\nimport { Evaluator } from \"./evaluator\";\r\nimport { ColumnConstraint, AlterColumn } from \"pgsql-ast-parser\";\r\nimport { nullIsh } from \"./utils\";\r\nimport { columnEvaluator } from \"./transforms/selection\";\r\nimport { BIndex } from \"./schema/btree-index\";\r\nimport { GeneratedIdentityConstraint } from \"./constraints/generated\";\r\nimport { buildValue } from \"./parser/expression-builder\";\r\nimport { withSelection } from \"./parser/context\";\r\n\r\nexport class ColRef implements _Column {\r\n  default: IValue | nil;\r\n  notNull = false;\r\n  usedInIndexes = new Set<BIndex>();\r\n  private drophandlers = new Set<DropHandler>();\r\n\r\n  constructor(\r\n    readonly table: MemoryTable,\r\n    public expression: Evaluator,\r\n    _schema: SchemaField,\r\n    public name: string\r\n  ) {}\r\n\r\n  addConstraints(clist: ColumnConstraint[], t: _Transaction): this {\r\n    const notNull = clist.some((x) => x.type === \"not null\");\r\n    const acceptNil = clist.some((x) => x.type === \"null\");\r\n    if (notNull && acceptNil) {\r\n      throw new QueryError(\r\n        `conflicting NULL/NOT NULL declarations for column \"${this.name}\" of table \"${this.table.name}\"`\r\n      );\r\n    }\r\n    for (const c of clist) {\r\n      const cname = c.constraintName;\r\n      switch (c.type) {\r\n        case \"not null\":\r\n        case \"null\":\r\n          // dealt with that above.\r\n          break;\r\n        case \"primary key\":\r\n          this.table.createIndex(t, {\r\n            columns: [{ value: this.expression }],\r\n            primary: true,\r\n            indexName: cname?.name,\r\n          });\r\n          break;\r\n        case \"unique\":\r\n          this.table.createIndex(t, {\r\n            columns: [{ value: this.expression }],\r\n            notNull: notNull,\r\n            unique: true,\r\n            indexName: cname?.name,\r\n          });\r\n          break;\r\n        case \"default\":\r\n          this.alter(\r\n            {\r\n              type: \"set default\",\r\n              default: c.default,\r\n              updateExisting: true,\r\n            },\r\n            t\r\n          );\r\n          break;\r\n        case \"check\":\r\n          this.table.addCheck(t, c.expr, cname?.name, this.notNull);\r\n          break;\r\n        case \"add generated\":\r\n          new GeneratedIdentityConstraint(c.constraintName?.name, this).install(\r\n            t,\r\n            c\r\n          );\r\n          break;\r\n        case \"reference\":\r\n          this.table.addForeignKey(\r\n            {\r\n              ...c,\r\n              type: \"foreign key\",\r\n              localColumns: [{ name: this.name }],\r\n            },\r\n            t\r\n          );\r\n          break;\r\n        default:\r\n          throw NotSupported.never(c, \"add constraint type\");\r\n      }\r\n    }\r\n    if (notNull) {\r\n      this.addNotNullConstraint(t);\r\n    }\r\n    this.table.db.onSchemaChange();\r\n    return this;\r\n  }\r\n\r\n  private addNotNullConstraint(t: _Transaction) {\r\n    // check has no null value\r\n    const bin = this.table.bin(t);\r\n    for (const e of bin.values()) {\r\n      const val = this.expression.get(e, t);\r\n      if (nullIsh(val)) {\r\n        throw new QueryError(\r\n          `Cannot add not null constraint on column \"${this.expression.id}\": it contains null values`\r\n        );\r\n      }\r\n    }\r\n    this.notNull = true;\r\n\r\n    // just amend schema (for cloning)\r\n    this.table.db.onSchemaChange();\r\n  }\r\n\r\n  rename(to: string, t: _Transaction): this {\r\n    if (this.table.getColumnRef(to, true)) {\r\n      throw new QueryError(`Column \"${to}\" already exists`);\r\n    }\r\n\r\n    // first, move data (this cannot throw => OK to modify mutable data)\r\n    this.table.remapData(t, (v) => {\r\n      const ov = v[this.expression.id!];\r\n      delete v[this.expression.id!];\r\n      v[to] = ov;\r\n    });\r\n    // for (const v of this.table.bin(t)) {\r\n    //     const ov = v[this.expression.id];\r\n    //     delete v[this.expression.id];\r\n    //     v[to] = ov;\r\n    // }\r\n\r\n    // === do nasty things to rename column\r\n    this.replaceExpression(to, this.expression.type);\r\n    this.table.db.onSchemaChange();\r\n    this.name = to;\r\n    return this;\r\n  }\r\n\r\n  alter(alter: AlterColumn, t: _Transaction): this {\r\n    switch (alter.type) {\r\n      case \"drop default\":\r\n        this.default = null;\r\n        break;\r\n      case \"set default\":\r\n        if (alter.default.type === \"null\") {\r\n          this.default = null;\r\n          break;\r\n        }\r\n        const df = withSelection(this.table.selection, () =>\r\n          buildValue(alter.default)\r\n        );\r\n        if (!df.isConstant) {\r\n          throw new QueryError(\r\n            \"cannot use column references in default expression\"\r\n          );\r\n        }\r\n        if (alter.updateExisting) {\r\n          const defVal = df.get();\r\n          this.table.remapData(t, (x) => (x[this.expression.id!] = defVal));\r\n        }\r\n        this.default = df;\r\n        break;\r\n      case \"set not null\":\r\n        this.addNotNullConstraint(t);\r\n        break;\r\n      case \"drop not null\":\r\n        this.notNull = false;\r\n        break;\r\n      case \"set type\":\r\n        const newType = this.table.ownerSchema.getType(alter.dataType);\r\n        const conv = this.expression.cast(newType);\r\n        const eid = this.expression.id;\r\n\r\n        this.table.remapData(\r\n          t,\r\n          (x) => (x[this.expression.id!] = conv.get(x, t))\r\n        );\r\n\r\n        // once converted, do nasty things to change expression\r\n        this.replaceExpression(eid!, newType);\r\n        break;\r\n      case \"add generated\":\r\n        new GeneratedIdentityConstraint(\r\n          alter.constraintName?.name,\r\n          this\r\n        ).install(t, alter);\r\n        break;\r\n      default:\r\n        throw NotSupported.never(alter, \"alter column type\");\r\n    }\r\n    this.table.db.onSchemaChange();\r\n    this.table.selection.rebuild();\r\n    return this;\r\n  }\r\n\r\n  private replaceExpression(newId: string, newType: _IType) {\r\n    const on = this.expression.id!;\r\n    const nn = newId;\r\n    this.expression = columnEvaluator(this.table, newId, newType);\r\n\r\n    // replace in table\r\n    this.table.columnMgr.delete(on);\r\n    this.table.columnMgr.set(nn, this);\r\n  }\r\n\r\n  drop(t: _Transaction): void {\r\n    const on = this.expression.id!;\r\n    if (!this.table.columnMgr.has(on)) {\r\n      throw new Error(\"Corrupted table\");\r\n    }\r\n\r\n    // remove indices\r\n    for (const u of this.usedInIndexes) {\r\n      this.table.dropIndex(t, u.name);\r\n    }\r\n\r\n    // remove associated data\r\n    this.table.remapData(t, (x) => delete x[this.expression.id!]);\r\n\r\n    // nasty business to remove columns\r\n    this.table.columnMgr.delete(on);\r\n    this.table.selection.rebuild();\r\n    this.drophandlers.forEach((d) => d(t, false));\r\n    this.table.db.onSchemaChange();\r\n  }\r\n\r\n  checkConstraints(toInsert: any, t: _Transaction) {\r\n    if (!this.notNull) {\r\n      return;\r\n    }\r\n    const col = this.expression.get(toInsert, t);\r\n    if (nullIsh(col)) {\r\n      throw new QueryError(\r\n        `null value in column \"${this.expression.id}\" violates not-null constraint`\r\n      );\r\n    }\r\n  }\r\n\r\n  setDefaults(toInsert: any, t: _Transaction) {\r\n    const col = this.expression.get(toInsert, t);\r\n    if (col !== undefined) {\r\n      return;\r\n    }\r\n    if (!this.default) {\r\n      toInsert[this.expression.id!] = null;\r\n    } else {\r\n      toInsert[this.expression.id!] = this.default.get();\r\n    }\r\n  }\r\n\r\n  onDrop(sub: DropHandler): ISubscription {\r\n    this.drophandlers.add(sub);\r\n    return {\r\n      unsubscribe: () => {\r\n        this.drophandlers.delete(sub);\r\n      },\r\n    };\r\n  }\r\n}\r\n","import { ISubscription, NotSupported, QueryError } from '../interfaces';\r\nimport { AlterColumnAddGenerated, nil } from 'pgsql-ast-parser';\r\nimport { _Column, _IConstraint, _ITable, _Transaction } from '../interfaces-private';\r\nimport { nullIsh } from '../utils';\r\n\r\nexport class GeneratedIdentityConstraint implements _IConstraint {\r\n    private subs: ISubscription[] = [];\r\n\r\n    private get table() {\r\n        return this.column.table;\r\n    }\r\n    private get schema() {\r\n        return this.table.ownerSchema;\r\n    }\r\n    constructor(readonly name: string | nil, private column: _Column) {\r\n    }\r\n\r\n    uninstall(t: _Transaction): void {\r\n        for (const s of this.subs) {\r\n            s.unsubscribe();\r\n        };\r\n        this.subs = [];\r\n    }\r\n\r\n\r\n    install(ct: _Transaction, _c: AlterColumnAddGenerated) {\r\n        if (!this.column.notNull) {\r\n            // if it's a table creation, then force 'not null'\r\n            const tableCreation = !this.schema.getTable(this.table.name, true);\r\n            if (tableCreation) {\r\n                this.column.alter({\r\n                    type: 'set not null',\r\n                }, ct);\r\n            } else {\r\n                // else, throw an error\r\n                throw new QueryError(`column \"${this.column.name}\" of relation \"${this.table.name}\" must be declared NOT NULL before identity can be added`);\r\n            }\r\n        }\r\n\r\n        const seq = this.schema.createSequence(ct, _c.sequence, _c.sequence?.name);\r\n\r\n        // todo : Review this... it's a complete bluff (dont have time to check spec)\r\n        const mode = _c.always ?? 'always';\r\n        this.subs.push(this.table.onBeforeChange([this.column], (old, neu, dt, opts) => {\r\n            // only act on new things\r\n            if (old) {\r\n                return;\r\n            }\r\n            const gen = () => neu[this.column.name] = seq.nextValue(dt);\r\n\r\n            if (nullIsh(neu[this.column.name])) {\r\n                // no value has been provided => generate one.\r\n                gen();\r\n                return;\r\n            }\r\n\r\n            // a value has been provided => check if must be overriden.\r\n            switch (mode) {\r\n                case 'by default':\r\n                    switch (opts.overriding ?? 'system') {\r\n                        case 'system':\r\n                            break;\r\n                        default:\r\n                            gen();\r\n                            break;\r\n\r\n                    }\r\n                    break;\r\n                case 'always':\r\n                    // column is 'GENREATED ALWAYS'\r\n                    // => must specify 'overriding system value'\r\n                    if (opts.overriding !== 'system') {\r\n                        throw new QueryError({\r\n                            error: `cannot insert into column \"${this.column.name}\"`,\r\n                            details: ` Column \"${this.column.name}\" is an identity column defined as GENERATED ALWAYS.`,\r\n                            hint: 'Use OVERRIDING SYSTEM VALUE to override.',\r\n                        })\r\n                    }\r\n                    break;\r\n                default:\r\n                    throw NotSupported.never(mode);\r\n            }\r\n\r\n        }));\r\n\r\n        this.subs.push(this.table.onTruncate((t, { restartIdentity }) => {\r\n            if (!restartIdentity) {\r\n                return;\r\n            }\r\n            seq.restart(t);\r\n        }))\r\n    }\r\n\r\n}","import { ISubscription, NotSupported, QueryError } from '../interfaces';\r\nimport { Expr, ExprBinary, TableConstraintForeignKey } from 'pgsql-ast-parser';\r\nimport { asTable, CreateIndexColDef, _IConstraint, _ITable, _Transaction } from '../interfaces-private';\r\nimport { nullIsh } from '../utils';\r\n\r\nexport class ForeignKey implements _IConstraint {\r\n\r\n    private unsubs: ISubscription[] = [];\r\n\r\n    private table!: _ITable;\r\n    private foreignTable!: _ITable;\r\n\r\n\r\n\r\n    get db() {\r\n        return this.table.ownerSchema.db;\r\n    }\r\n\r\n    get schema() {\r\n        return this.table.ownerSchema;\r\n    }\r\n\r\n\r\n    constructor(readonly name: string) {\r\n    }\r\n\r\n    install(_t: _Transaction, cst: TableConstraintForeignKey, table: _ITable) {\r\n        const ftable = asTable(table.ownerSchema.getObject(cst.foreignTable, { beingCreated: table }));\r\n        const cols = cst.localColumns.map(x => table.getColumnRef(x.name));\r\n        const fcols = cst.foreignColumns.map(x => ftable.getColumnRef(x.name));\r\n        this.table = table;\r\n        this.foreignTable = ftable;\r\n        if (cols.length !== fcols.length) {\r\n            throw new QueryError('Foreign key count mismatch');\r\n        }\r\n        cols.forEach((c, i) => {\r\n            if (fcols[i].expression.type !== c.expression.type) {\r\n                throw new QueryError(`Foreign key column type mismatch`);\r\n            }\r\n        });\r\n\r\n        if ((cst.match ?? 'simple') !== 'simple' && cols.length !== 1) {\r\n            throw new NotSupported(`matching mode '${cst.match}' on mutliple columns foreign keys`);\r\n        }\r\n\r\n        // check that there is an unique index on this table for the given expressions\r\n        const findex = ftable.getIndex(...fcols.map(x => x.expression));\r\n        if (!findex?.unique) {\r\n            throw new QueryError(`there is no unique constraint matching given keys for referenced table \"${ftable.name}\"`);\r\n        }\r\n\r\n\r\n        // auto-create indices\r\n        if (this.db.options.autoCreateForeignKeyIndices) {\r\n            table.createIndex(_t, {\r\n                ifNotExists: true,\r\n                columns: cols.map<CreateIndexColDef>(x => ({\r\n                    value: x.expression,\r\n                })),\r\n            });\r\n        }\r\n\r\n        // ========================\r\n        // when changing the foreign table key, check correspondances in this table\r\n        // ========================\r\n        const onUpdate = cst.onUpdate ?? 'no action';\r\n        const onDelete = cst.onDelete ?? 'no action';\r\n        this.unsubs.push(ftable.onBeforeChange(cst.foreignColumns.map(x => x.name), (old, neu, dt) => {\r\n            if (!old) {\r\n                return;\r\n            }\r\n            const oVals = fcols.map(x => old[x.expression.id!]);\r\n            if (oVals.some(nullIsh)) {\r\n                return;\r\n            }\r\n            // build foreign key equality expression\r\n            const equals = cst.localColumns.map<ExprBinary>((x, i) => ({\r\n                type: 'binary',\r\n                op: '=',\r\n                left: { type: 'ref', name: x.name, table: { name: table.name } },\r\n                // hack, see #fkcheck\r\n                right: {\r\n                    type: 'constant',\r\n                    value: oVals[i],\r\n                    dataType: fcols[i].expression.type as any, // hack\r\n                },\r\n            }));\r\n            const expr = equals.slice(1).reduce<Expr>((a, b) => ({\r\n                type: 'binary',\r\n                op: 'AND',\r\n                left: a,\r\n                right: b,\r\n            }), equals[0]);\r\n\r\n            // check nothing matches\r\n            for (const local of table.selection.filter(expr).enumerate(dt)) {\r\n                // ====== ON DELETE\r\n                switch (neu ? onUpdate : onDelete) {\r\n                    case 'no action':\r\n                    case 'restrict':\r\n                        throw new QueryError(`update or delete on table \"${ftable.name}\" violates foreign key constraint on table \"${this.name}\"`);\r\n                    case 'cascade':\r\n                        if (neu) {\r\n                            for (let i = 0; i < fcols.length; i++) {\r\n                                local[cst.localColumns[i].name] = neu[cst.foreignColumns[i].name];\r\n                            }\r\n                            table.update(dt, local);\r\n                        } else {\r\n                            table.delete(dt, local);\r\n                        }\r\n                        break;\r\n                    case 'set default':\r\n                    case 'set null':\r\n                        for (const c of cst.localColumns) {\r\n                            local[c.name] = null;\r\n                        }\r\n                        table.update(dt, local);\r\n                        break;\r\n                }\r\n            }\r\n        }));\r\n\r\n        // =====================\r\n        //  when changing something in this table,\r\n        //  then there must be a key match in the foreign table\r\n        // =====================\r\n        this.unsubs.push(table.onBeforeChange(cst.localColumns.map(x => x.name), (_, neu, dt) => {\r\n            if (!neu) {\r\n                return;\r\n            }\r\n            const vals = cols.map(x => (neu as any)[x.expression.id!]);\r\n            if (vals.some(nullIsh)) {\r\n                return;\r\n            }\r\n            // build foreign key equality expression\r\n            const equals = cst.foreignColumns.map<ExprBinary>((x, i) => ({\r\n                type: 'binary',\r\n                op: '=',\r\n                left: { type: 'ref', name: x.name, table: { name: ftable.name } },\r\n                // hack, see #fkcheck\r\n                right: {\r\n                    type: 'constant',\r\n                    value: vals[i],\r\n                    dataType: cols[i].expression.type as any, // hack\r\n                },\r\n            }));\r\n            const expr = equals.slice(1).reduce<Expr>((a, b) => ({\r\n                type: 'binary',\r\n                op: 'AND',\r\n                left: a,\r\n                right: b,\r\n            }), equals[0]);\r\n\r\n            // check there is a match\r\n            let yielded = false;\r\n            for (const _ of ftable.selection.filter(expr).enumerate(dt)) {\r\n                yielded = true;\r\n            }\r\n            if (!yielded) {\r\n                throw new QueryError(`insert or update on table \"${ftable.name}\" violates foreign key constraint on table \"${this.name}\"`);\r\n            }\r\n        }));\r\n\r\n\r\n        // =====================\r\n        //  prevent foreign table from being dropped\r\n        // =====================\r\n        this.unsubs.push(ftable.onDrop((t, cascade) => {\r\n            //  (todo implement multiple drops)\r\n            if (cascade) {\r\n                this.uninstall(t);\r\n            } else {\r\n                throw new QueryError({\r\n                    error: `cannot drop table \"${ftable.name}\" because other objects depend on it`,\r\n                    details: `constraint ${this.name} on table ${table.name} depends on table \"${ftable.name}\"`,\r\n                    hint: `Use DROP ... CASCADE to drop the dependent objects too.`,\r\n                });\r\n            }\r\n        }));\r\n\r\n        // =====================\r\n        //  prevent foreign table truncation\r\n        // =====================\r\n        this.unsubs.push(ftable.onTruncate((t, { cascade }) => {\r\n            if (cascade) {\r\n                this.table.truncate(t, { cascade: true });\r\n                return;\r\n            }\r\n            throw new QueryError({\r\n                error: `cannot truncate a table referenced in a foreign key constraint`,\r\n                details: `Table \"${table.name}\" references \"${ftable.name}\".`,\r\n                hint: `HINT:  Truncate table \"${table.name}\" at the same time, or use TRUNCATE ... CASCADE.`,\r\n            })\r\n        }));\r\n\r\n        // =====================\r\n        //  when this table is dropped => remove hooks on foreign table\r\n        // =====================\r\n        table.onDrop(dt => {\r\n            this.uninstall(dt);\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    uninstall(t: _Transaction): void {\r\n        this.unsubs.forEach(x => x.unsubscribe());\r\n        this.unsubs = [];\r\n    }\r\n}","\r\nimport { _ISchema } from '../interfaces-private'\r\nimport { IMigrate } from './migrate-interfaces'\r\n\r\nimport MigrationFile = IMigrate.MigrationFile\r\nimport MigrationParams = IMigrate.MigrationParams\r\nimport MigrationData = IMigrate.MigrationData\r\nimport { literal } from '../misc/pg-escape'\r\n\r\ndeclare var __non_webpack_require__: any;\r\ndeclare var process: any;\r\n\r\nexport async function readMigrations(migrationPath?: string) {\r\n  const path = __non_webpack_require__('path');\r\n  const fs = __non_webpack_require__('fs');\r\n  const migrationsPath = migrationPath || path.join(process.cwd(), 'migrations')\r\n  const location = path.resolve(migrationsPath)\r\n\r\n  // Get the list of migration files, for example:\r\n  //   { id: 1, name: 'initial', filename: '001-initial.sql' }\r\n  //   { id: 2, name: 'feature', filename: '002-feature.sql' }\r\n  const migrationFiles = await new Promise<MigrationFile[]>(\r\n    (resolve, reject) => {\r\n      fs.readdir(location, (err: any, files: string[]) => {\r\n        if (err) {\r\n          return reject(err)\r\n        }\r\n\r\n        resolve(\r\n          files\r\n            .map(x => x.match(/^(\\d+).(.*?)\\.sql$/))\r\n            .filter(x => x !== null)\r\n            .map(x => ({ id: Number(x![1]), name: x![2], filename: x![0] }))\r\n            .sort((a, b) => Math.sign(a.id - b.id))\r\n        )\r\n      })\r\n    }\r\n  )\r\n\r\n  if (!migrationFiles.length) {\r\n    throw new Error(`No migration files found in '${location}'.`)\r\n  }\r\n\r\n  // Get the list of migrations, for example:\r\n  //   { id: 1, name: 'initial', filename: '001-initial.sql', up: ..., down: ... }\r\n  //   { id: 2, name: 'feature', filename: '002-feature.sql', up: ..., down: ... }\r\n  return Promise.all(\r\n    migrationFiles.map(\r\n      migration =>\r\n        new Promise<MigrationData>((resolve, reject) => {\r\n          const filename = path.join(location, migration.filename)\r\n          fs.readFile(filename, 'utf-8', (err: any, data: string) => {\r\n            if (err) {\r\n              return reject(err)\r\n            }\r\n\r\n            const [up, down] = data.split(/^--\\s+?down\\b/im)\r\n\r\n            const migrationData = migration as Partial<MigrationData>\r\n            migrationData.up = up.replace(/^-- .*?$/gm, '').trim() // Remove comments\r\n            migrationData.down = down ? down.trim() : '' // and trim whitespaces\r\n            resolve(migrationData as MigrationData)\r\n          })\r\n        })\r\n    )\r\n  )\r\n}\r\n\r\n/**\r\n * Migrates database schema to the latest version\r\n */\r\nexport async function migrate(db: _ISchema, config: MigrationParams = {}) {\r\n  config.force = config.force || false\r\n  config.table = config.table || 'migrations'\r\n\r\n  const { force, table } = config\r\n  const migrations = config.migrations\r\n    ? config.migrations\r\n    : await readMigrations(config.migrationsPath)\r\n\r\n  // Create a database table for migrations meta data if it doesn't exist\r\n  await db.none(`CREATE TABLE IF NOT EXISTS \"${table}\" (\r\n  id   INTEGER PRIMARY KEY,\r\n  name TEXT    NOT NULL,\r\n  up   TEXT    NOT NULL,\r\n  down TEXT    NOT NULL\r\n)`)\r\n\r\n  // Get the list of already applied migrations\r\n  let dbMigrations = await db.many(\r\n    `SELECT id, name, up, down FROM \"${table}\" ORDER BY id ASC`\r\n  )\r\n\r\n  // Undo migrations that exist only in the database but not in files,\r\n  // also undo the last migration if the `force` option is enabled.\r\n  const lastMigration = migrations[migrations.length - 1]\r\n  for (const migration of dbMigrations\r\n    .slice()\r\n    .sort((a, b) => Math.sign(b.id - a.id))) {\r\n    if (\r\n      !migrations.some(x => x.id === migration.id) ||\r\n      (force && migration.id === lastMigration.id)\r\n    ) {\r\n      // await db.run('BEGIN')\r\n      try {\r\n        await db.none(migration.down)\r\n        await db.none(`DELETE FROM \"${table}\" WHERE id = ${migration.id}`)\r\n        // await db.run('COMMIT')\r\n        dbMigrations = dbMigrations.filter(x => x.id !== migration.id)\r\n      } catch (err) {\r\n        // await db.run('ROLLBACK')\r\n        throw err\r\n      }\r\n    } else {\r\n      break\r\n    }\r\n  }\r\n\r\n  // Apply pending migrations\r\n  const lastMigrationId = dbMigrations.length\r\n    ? dbMigrations[dbMigrations.length - 1].id\r\n    : 0\r\n  for (const migration of migrations) {\r\n    if (migration.id > lastMigrationId) {\r\n      // await db.run('BEGIN')\r\n      try {\r\n        await db.none(migration.up)\r\n        await db.none(\r\n          `INSERT INTO \"${table}\" (id, name, up, down) VALUES (\r\n          ${migration.id},\r\n          ${literal(migration.name)},\r\n          ${literal(migration.up)},\r\n          ${literal(migration.down)})`\r\n        )\r\n        // await db.run('COMMIT')\r\n      } catch (err) {\r\n        // await db.run('ROLLBACK')\r\n        throw err\r\n      }\r\n    }\r\n  }\r\n}","import { Evaluator } from '../evaluator';\r\nimport { TypeBase } from './datatype-base';\r\nimport { CastError, DataType, nil, QueryError } from '../interfaces';\r\nimport { _ISchema, _IType, _Transaction } from '../interfaces-private';\r\n\r\nexport class CustomEnumType extends TypeBase<string> {\r\n\r\n    get primary(): DataType {\r\n        return this.name as any;\r\n    }\r\n\r\n    get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n    constructor(readonly schema: _ISchema\r\n        , private readonly _name: string\r\n        , readonly values: string[]) {\r\n        super();\r\n    }\r\n\r\n    install() {\r\n        this.schema._registerType(this);\r\n    }\r\n\r\n    doCanCast(to: _IType) {\r\n        return to.primary === DataType.text;\r\n    }\r\n\r\n    doCast(value: Evaluator<string>, to: _IType<string>): Evaluator<any> | nil {\r\n        return value;\r\n    }\r\n\r\n    prefer(type: _IType<any>): _IType | nil {\r\n        return this;\r\n    }\r\n\r\n    doCanBuildFrom(from: _IType): boolean | nil {\r\n        return from.primary === DataType.text;\r\n    }\r\n\r\n    doBuildFrom(value: Evaluator<string>, from: _IType<string>): Evaluator<string> | nil {\r\n        return value\r\n            .setConversion((raw: string) => {\r\n                if (!this.values.includes(raw)) {\r\n                    throw new QueryError(`invalid input value for enum ${this.name}: \"${raw}\"`);\r\n                }\r\n                return raw;\r\n            }\r\n                , conv => ({ conv, toCenum: this.name }))\r\n    }\r\n\r\n\r\n    drop(t: _Transaction): void {\r\n        this.schema._unregisterType(this);\r\n    }\r\n}\r\n","import { Evaluator } from '../evaluator';\r\nimport { TypeBase } from './datatype-base';\r\nimport { CastError, DataType, IEquivalentType, IType, nil, QueryError, typeDefToStr } from '../interfaces';\r\nimport { _ISchema, _IType } from '../interfaces-private';\r\nimport { Types } from './datatypes';\r\n\r\nexport class EquivalentType extends TypeBase<string> {\r\n\r\n    private equiv: IType;\r\n\r\n    constructor(private def: IEquivalentType) {\r\n        super();\r\n        if (typeof def.equivalentTo === 'string') {\r\n            let eq = (Types as any)[def.equivalentTo];\r\n            if (typeof eq === 'function') {\r\n                eq = eq();\r\n            }\r\n            this.equiv = eq;\r\n        } else {\r\n            this.equiv = def.equivalentTo;\r\n        }\r\n\r\n        if (!this.equiv) {\r\n            throw new Error(`Invalid equilvalent type`);\r\n        }\r\n    }\r\n\r\n    get primary(): DataType {\r\n        return this.def.name as any;\r\n    }\r\n\r\n    doCanCast(to: _IType) {\r\n        return to.primary === this.equiv.primary;\r\n    }\r\n\r\n    doCast(value: Evaluator<string>, to: _IType<string>): Evaluator<any> | nil {\r\n        return value;\r\n    }\r\n\r\n    prefer(type: _IType<any>): _IType | nil {\r\n        return this;\r\n    }\r\n\r\n    doCanBuildFrom(from: _IType): boolean | nil {\r\n        return from.primary === this.equiv.primary;\r\n    }\r\n\r\n    doBuildFrom(value: Evaluator<string>, from: _IType<string>): Evaluator<string> | nil {\r\n        return value\r\n            .setConversion(x => {\r\n                if (!this.def.isValid(x)) {\r\n                    throw new QueryError(`invalid input syntax for type ${typeDefToStr(this)}: ${x}`);\r\n                }\r\n                return x;\r\n            }, val => ({ val, to: this.equiv.primary }));\r\n    }\r\n}\r\n","import { _IType, _ArgDefDetails, nil, DataType, IValue } from '../interfaces-private';\r\nimport { Types } from '../datatypes';\r\nimport { it } from '../utils';\r\nimport { QueryError } from '../interfaces';\r\n\r\nexport interface HasSig {\r\n    name: string;\r\n    args: _ArgDefDetails[];\r\n    argsVariadic?: _IType | nil;\r\n}\r\n\r\nexport class OverloadResolver<T extends HasSig> {\r\n\r\n    private byName = new Map<string, OverloadNode<T>>();\r\n\r\n    constructor(private implicitCastOnly: boolean) { }\r\n\r\n    add(value: T, replaceIfExists: boolean) {\r\n        let ret = this.byName.get(value.name);\r\n        if (!ret) {\r\n            this.byName.set(value.name, ret = new OverloadNode<T>(Types.null, this.implicitCastOnly, 0));\r\n        }\r\n        ret.index(value, replaceIfExists);\r\n    }\r\n\r\n    getOverloads(name: string) {\r\n        const ovr = this.byName.get(name);\r\n        if (!ovr) {\r\n            return [];\r\n        }\r\n        return [...ovr.all()];\r\n    }\r\n\r\n    remove(value: T) {\r\n        this.byName.get(value.name)?.unindex(value);\r\n    }\r\n\r\n    resolve(name: string, args: IValue[]) {\r\n        return this.byName.get(name)?.resolve(args);\r\n    }\r\n\r\n    getExact(name: string, types: _IType[]): T | nil {\r\n        return this.byName.get(name)?.getExact(types);\r\n    }\r\n}\r\n\r\n\r\nclass OverloadNode<T extends HasSig> {\r\n\r\n    private nexts = new Map<DataType, OverloadNode<T>[]>();\r\n    private leaf: T | nil;\r\n\r\n    constructor(readonly type: _IType, private implicitCastOnly: boolean, private at: number) {\r\n    }\r\n\r\n    *all(): IterableIterator<T> {\r\n        if (this.leaf) {\r\n            yield this.leaf;\r\n        }\r\n        for (const children of this.nexts.values()) {\r\n            for (const child of children) {\r\n                yield* child.all();\r\n            }\r\n        }\r\n    }\r\n\r\n    index(value: T, replaceIfExists: boolean) {\r\n        if (this.at >= value.args.length) {\r\n            if (this.leaf && !replaceIfExists) {\r\n                throw new QueryError('Function already exists: ' + value.name);\r\n            }\r\n            this.leaf = value;\r\n            return;\r\n        }\r\n        const arg = value.args[this.at];\r\n        const primary = arg.type.primary;\r\n        let lst = this.nexts.get(primary);\r\n        if (!lst) {\r\n            this.nexts.set(primary, lst = []);\r\n        }\r\n        // get or add corresponding node\r\n        let node = lst.find(x => x.type === arg.type);\r\n        if (!node) {\r\n            lst.push(node = new OverloadNode(arg.type, this.implicitCastOnly, this.at + 1));\r\n        }\r\n\r\n        // process arg list\r\n        node.index(value, replaceIfExists);\r\n    }\r\n\r\n    unindex(value: T) {\r\n        if (this.leaf === value) {\r\n            this.leaf = null;\r\n            return;\r\n        }\r\n        for (const children of this.nexts.values()) {\r\n            for (const child of children) {\r\n                child.unindex(value);\r\n            }\r\n        }\r\n    }\r\n\r\n    getExact(types: _IType[]): T | nil {\r\n        if (this.at >= types.length) {\r\n            return this.leaf;\r\n        }\r\n        const target = types[this.at];\r\n        const found = this.nexts.get(target.primary)\r\n            ?.find(x => x.type == target);\r\n        return found?.getExact(types);\r\n    }\r\n\r\n    resolve(args: IValue[]): T | nil {\r\n        if (this.at >= args.length) {\r\n            return this.leaf;\r\n        }\r\n\r\n        // gets the child which type matches the current arg better\r\n        const arg = args[this.at];\r\n        const sigsToCheck = it(\r\n            this.nexts // perf tweak: search by primary type\r\n                .get(arg.type.primary)\r\n            ?? it(this.nexts.values()).flatten() // else, search all registered overloads\r\n        );\r\n\r\n        const match = sigsToCheck.reduce<OverloadNode<T> | nil>((acc, x) => {\r\n            // check that arg can be converted to the target type\r\n            if (!this.compatible(arg, x.type)) {\r\n                return acc;\r\n            }\r\n            // first match\r\n            if (!acc) {\r\n                return x;\r\n            }\r\n            // returns the prefered type\r\n            return acc.type.prefer(x.type) === x.type ? x : acc;\r\n        }, null);\r\n\r\n        if (match) {\r\n            return match.resolve(args);\r\n        }\r\n\r\n        // handle variadic args\r\n        if (this.leaf && this.leaf.argsVariadic && this.compatible(arg, this.leaf.argsVariadic)) {\r\n            return this.leaf;\r\n        }\r\n\r\n        // not found\r\n        return null;\r\n    }\r\n\r\n    private compatible(givenArg: IValue, expectedArg: _IType) {\r\n        if (givenArg.type === expectedArg) {\r\n            return true;\r\n        }\r\n        return givenArg.isConstantLiteral\r\n            ? givenArg.type.canCast(expectedArg)\r\n            : givenArg.type.canConvertImplicit(expectedArg) ?? givenArg.type.canCast(expectedArg);\r\n    }\r\n}","import { AlterSequenceChange, CreateSequenceOptions } from 'pgsql-ast-parser';\r\nimport { combineSubs, ignore, nullIsh } from '../utils';\r\nimport { NotSupported, asTable, _ISchema, _ISequence, _IType, _Transaction, RegClass, Reg } from '../interfaces-private';\r\nimport { ISubscription, nil, QueryError } from '../interfaces';\r\nimport { Types } from '../datatypes';\r\n\r\ninterface SeqData {\r\n    currval: number | undefined;\r\n    nextval: number;\r\n}\r\n\r\nexport class Sequence implements _ISequence {\r\n\r\n    get type(): 'sequence' {\r\n        return 'sequence';\r\n    }\r\n\r\n    private symbol = Symbol();\r\n    private owner?: ISubscription;\r\n    private cfg: {\r\n        start?: number;\r\n        max?: number;\r\n        min?: number;\r\n        cycle?: boolean;\r\n        inc?: number;\r\n        dataType?: _IType;\r\n    } = {};\r\n\r\n    readonly reg: Reg;\r\n\r\n\r\n    get cycle() {\r\n        return this.cfg.cycle ?? false;\r\n    }\r\n\r\n    get dataType() {\r\n        return this.cfg.dataType ?? Types.integer;\r\n    }\r\n\r\n    get inc() {\r\n        return this.cfg.inc ?? 1;\r\n    }\r\n\r\n\r\n    constructor(public name: string, readonly ownerSchema: _ISchema) {\r\n        this.reg = ownerSchema._reg_register(this);\r\n    }\r\n\r\n\r\n    get start() {\r\n        return this.cfg.start ?? (this.inc > 0\r\n            ? this.min\r\n            : this.max);\r\n    }\r\n\r\n    get max() {\r\n        return this.cfg.max\r\n            ?? (this.inc > 0\r\n                ? Number.MAX_SAFE_INTEGER - 1\r\n                : -1);\r\n    }\r\n\r\n    get min() {\r\n        return this.cfg.min\r\n            ?? (this.inc > 0\r\n                ? 1\r\n                : Number.MIN_SAFE_INTEGER + 1);\r\n    }\r\n\r\n    alter(t: _Transaction, opts: CreateSequenceOptions | AlterSequenceChange | nil): this {\r\n        if (!opts) {\r\n            return this;\r\n        }\r\n        const oldCfg = { ...this.cfg };\r\n        try {\r\n            if (!('type' in opts)) {\r\n                return this.alterOpts(t, opts);\r\n            }\r\n            switch (opts.type) {\r\n                case 'set options':\r\n                    this.alterOpts(t, opts);\r\n                    if (opts.restart === true || typeof opts.restart === 'number') {\r\n                        if (typeof opts.restart === 'number') {\r\n                            if (opts.restart < this.min) {\r\n                                throw new QueryError(`RESTART value (${opts.restart}) cannot be less than MINVALUE (${this.min})`, '22023');\r\n                            }\r\n                            this.cfg.start = opts.restart;\r\n                        }\r\n                        const data: SeqData = {\r\n                            currval: t.get<SeqData>(this.symbol)?.currval,\r\n                            nextval: this.start,\r\n                        }\r\n                        t.set(this.symbol, data);\r\n                    }\r\n                    return this;\r\n                case 'set schema':\r\n                    if (opts.newSchema.name === this.ownerSchema.name) {\r\n                        return this;\r\n                    }\r\n                    throw new NotSupported('Sequence schema change');\r\n                case 'rename':\r\n                    const to = opts.newName.name.toLowerCase();\r\n                    this.ownerSchema._reg_rename(this, this.name, to);\r\n                    this.name = to;\r\n                    return this;\r\n                case 'owner to':\r\n                    // todo: implement sequence owners ? ...ignored to support pg_dump exports.\r\n                    ignore(opts);\r\n                    return this;\r\n                default:\r\n                    throw NotSupported.never(opts);\r\n            }\r\n        } catch (e) {\r\n            this.cfg = oldCfg;\r\n            throw e;\r\n        }\r\n    }\r\n\r\n    nextValue(t: _Transaction): number {\r\n        let v = t.get<SeqData>(this.symbol)?.nextval;\r\n        if (v === undefined) {\r\n            v = this.start;\r\n        }\r\n        this.setValue(t, v);\r\n        return v;\r\n    }\r\n\r\n    setValue(t: _Transaction, value: number) {\r\n        if (value > this.max) {\r\n            throw new QueryError(`reached maximum value of sequence \"${this.name}\"`);\r\n        }\r\n        if (value < this.min) {\r\n            throw new QueryError(`reached minimum value of sequence \"${this.name}\"`);\r\n        }\r\n        const data: SeqData = {\r\n            currval: value,\r\n            nextval: value + this.inc,\r\n        };\r\n        t.set(this.symbol, data);\r\n    }\r\n\r\n    restart(t: _Transaction) {\r\n        t.delete(this.symbol);\r\n    }\r\n\r\n    currentValue(t: _Transaction): number {\r\n        const v = t.get<SeqData>(this.symbol)?.currval;\r\n        if (v === undefined) {\r\n            throw new QueryError(`currval of sequence \"${this.name}\" is not yet defined in this session`, '55000');\r\n        }\r\n        return v;\r\n    }\r\n\r\n\r\n    private alterOpts(t: _Transaction, opts: CreateSequenceOptions) {\r\n        if (opts.as) {\r\n            ignore(opts.as);\r\n            this.cfg.dataType = this.ownerSchema.getType(opts.as);\r\n        }\r\n        ignore(opts.cache);\r\n        if (opts.cycle) {\r\n            this.cfg.cycle = opts.cycle === 'cycle';\r\n        }\r\n\r\n        if (typeof opts.incrementBy === 'number') {\r\n            this.cfg.inc = opts.incrementBy;\r\n        }\r\n\r\n        if (typeof opts.maxValue === 'number') {\r\n            this.cfg.max = opts.maxValue;\r\n        } else if (opts.maxValue) {\r\n            this.cfg.max = undefined;\r\n        }\r\n\r\n        if (typeof opts.minValue === 'number') {\r\n            this.cfg.min = opts.minValue;\r\n        } else if (opts.maxValue) {\r\n            this.cfg.min = undefined;\r\n        }\r\n\r\n        if (typeof opts.startWith === 'number') {\r\n            this.cfg.start = opts.startWith;\r\n        }\r\n\r\n\r\n        if (opts.ownedBy === 'none') {\r\n            this.owner?.unsubscribe();\r\n        } else if (opts.ownedBy) {\r\n            this.owner?.unsubscribe();\r\n\r\n            const tbl = asTable(this.ownerSchema.getObject({\r\n                name: opts.ownedBy.table,\r\n                schema: opts.ownedBy.schema\r\n            }));\r\n\r\n            const owner = tbl.getColumnRef(opts.ownedBy.column);\r\n\r\n            this.owner = combineSubs(\r\n                owner.onDrop(dt => this.drop(dt)),\r\n                tbl.onDrop(dt => this.drop(dt)),\r\n            );\r\n        }\r\n\r\n        // === validate\r\n        if (this.max < this.min) {\r\n            throw new QueryError('Invalid squeuence min-max');\r\n        }\r\n\r\n        if (!this.inc) {\r\n            throw new QueryError('Invalid increment');\r\n        }\r\n\r\n        if (this.start > this.max || this.start < this.min) {\r\n            throw new QueryError('Invalid sequence starting value');\r\n        }\r\n        return this;\r\n    }\r\n\r\n    drop(t: _Transaction) {\r\n        this.owner?.unsubscribe();\r\n        this.owner = undefined;\r\n        t.delete(this.symbol);\r\n        this.ownerSchema._reg_unregister(this);\r\n    }\r\n}","import { _ISchema, _Transaction, SchemaField, NotSupported, _ITable, _IStatementExecutor, Schema, DataType, QueryError } from '../../interfaces-private';\r\nimport { CreateTableStatement, QName } from 'pgsql-ast-parser';\r\nimport { ignore, Optional } from '../../utils';\r\nimport { checkExistence, ExecHelper } from '../exec-utils';\r\nimport { buildCtx } from '../../parser/context';\r\n\r\nexport class ExecuteCreateTable extends ExecHelper implements _IStatementExecutor {\r\n    private toDeclare: Schema;\r\n    private ifNotExists: boolean;\r\n    private name: QName;\r\n    private schema: _ISchema;\r\n\r\n    constructor(p: CreateTableStatement) {\r\n        super(p);\r\n        const { db } = buildCtx();\r\n        this.schema = db.getSchema(p.name.schema);\r\n        let fields: SchemaField[] = [];\r\n        for (const f of p.columns) {\r\n            switch (f.kind) {\r\n                case 'column':\r\n                    if (!f.dataType.kind && f.dataType.name === DataType.record) {\r\n                        throw new QueryError(`column \"${f.name.name}\" has pseudo-type record`, '42P16');\r\n                    }\r\n                    // TODO: #collation\r\n                    ignore(f.collate);\r\n                    const nf = {\r\n                        ...f,\r\n                        name: f.name.name,\r\n                        type: this.schema.getType(f.dataType),\r\n                        serial: !f.dataType.kind && (f.dataType.name === 'serial' || f.dataType.name === 'bigserial'),\r\n                    };\r\n                    delete (nf as Optional<typeof nf>).dataType;\r\n                    fields.push(nf);\r\n                    break;\r\n                case 'like table':\r\n                    throw new NotSupported('\"like table\" statement');\r\n                default:\r\n                    throw NotSupported.never(f);\r\n            }\r\n        }\r\n        this.ifNotExists = !!p.ifNotExists;\r\n        this.name = p.name;\r\n        this.toDeclare = {\r\n            name: p.name.name,\r\n            constraints: p.constraints,\r\n            fields,\r\n        };\r\n    }\r\n\r\n    execute(t: _Transaction) {\r\n\r\n        // commit pending data before making changes\r\n        //  (because the creation does not support further rollbacks)\r\n        t = t.fullCommit();\r\n\r\n        // perform creation\r\n        checkExistence(this.schema, this.name, this.ifNotExists, () => {\r\n            this.schema.declareTable(this.toDeclare);\r\n        });\r\n\r\n\r\n        // new implicit transaction\r\n        t = t.fork();\r\n        return this.noData(t, 'CREATE');\r\n    }\r\n}","import { _Transaction, asTable, _ISchema, NotSupported, CreateIndexColDef, _ITable, CreateIndexDef, _IStatement, _IStatementExecutor } from '../../interfaces-private';\r\nimport { CreateIndexStatement } from 'pgsql-ast-parser';\r\nimport { ignore } from '../../utils';\r\nimport { ExecHelper } from '../exec-utils';\r\nimport { buildValue } from '../../parser/expression-builder';\r\nimport { withSelection } from '../../parser/context';\r\n\r\nexport class CreateIndexExec extends ExecHelper implements _IStatementExecutor {\r\n    private onTable: _ITable;\r\n    private indexDef: CreateIndexDef;\r\n\r\n    constructor({ schema }: _IStatement, p: CreateIndexStatement) {\r\n        super(p);\r\n        const indexName = p.indexName?.name;\r\n        this.onTable = asTable(schema.getObject(p.table));\r\n        // check that index algorithm is supported\r\n        if (p.using && p.using.name.toLowerCase() !== 'btree') {\r\n            if (schema.db.options.noIgnoreUnsupportedIndices) {\r\n                throw new NotSupported('index type: ' + p.using);\r\n            }\r\n            ignore(p);\r\n        }\r\n\r\n        this.indexDef = withSelection(this.onTable.selection, () => {\r\n\r\n            // index columns\r\n            const columns = p.expressions\r\n                .map<CreateIndexColDef>(x => {\r\n                    return {\r\n                        value: buildValue(x.expression),\r\n                        nullsLast: x.nulls === 'last', // nulls are first by default\r\n                        desc: x.order === 'desc',\r\n                    }\r\n                });\r\n\r\n            // compile predicate (if any)\r\n            const predicate = p.where && buildValue(p.where);\r\n\r\n            return {\r\n                columns,\r\n                indexName,\r\n                unique: p.unique,\r\n                ifNotExists: p.ifNotExists,\r\n                predicate,\r\n            };\r\n        });\r\n    }\r\n\r\n    execute(t: _Transaction) {\r\n        // commit pending data before making changes\r\n        //  (because the index creation does not support further rollbacks)\r\n        t = t.fullCommit();\r\n\r\n        // create index\r\n        this.onTable\r\n            .createIndex(t, this.indexDef);\r\n\r\n        // new implicit transaction\r\n        t = t.fork();\r\n        return this.noData(t, 'CREATE');\r\n    }\r\n}\r\n","import { _ISchema, _Transaction, SchemaField, NotSupported, _ITable, _IStatementExecutor, asTable, QueryError, _IStatement } from '../../interfaces-private';\r\nimport { AlterTableStatement } from 'pgsql-ast-parser';\r\nimport { ignore } from '../../utils';\r\nimport { ExecHelper } from '../exec-utils';\r\n\r\nexport class Alter extends ExecHelper implements _IStatementExecutor {\r\n\r\n    private table: _ITable;\r\n\r\n    constructor({ schema }: _IStatement, private p: AlterTableStatement) {\r\n        super(p);\r\n        this.table = asTable(schema.getObject(p.table));\r\n        ignore(p.only);\r\n    }\r\n\r\n    execute(t: _Transaction) {\r\n\r\n        let ignored = 0;\r\n\r\n        // commit pending data before making changes\r\n        //  (because  does not support further rollbacks)\r\n        t = t.fullCommit();\r\n\r\n\r\n        for (const change of this.p.changes) {\r\n            function ignoreChange() {\r\n                ignore(change);\r\n                ignored++;\r\n            }\r\n            switch (change.type) {\r\n                case 'rename':\r\n                    this.table.rename(change.to.name);\r\n                    break;\r\n                case 'add column': {\r\n                    const col = this.table.selection.getColumn(change.column.name.name, true);\r\n                    if (col) {\r\n                        if (change.ifNotExists) {\r\n                            ignoreChange();\r\n                            break;\r\n                        } else {\r\n                            throw new QueryError('Column already exists: ' + col.id);\r\n                        }\r\n                    } else {\r\n                        ignore(change.ifNotExists);\r\n                    }\r\n                    this.table.addColumn(change.column, t);\r\n                    break;\r\n                }\r\n                case 'drop column':\r\n                    const col = this.table.getColumnRef(change.column.name, change.ifExists);\r\n                    if (!col) {\r\n                        ignoreChange();\r\n                    } else {\r\n                        col.drop(t);\r\n                    }\r\n                    break;\r\n                case 'drop constraint':\r\n                    const cst = this.table.getConstraint(change.constraint.name);\r\n                    if (change.ifExists && !cst) {\r\n                        ignoreChange();\r\n                        break;\r\n                    }\r\n                    if (!cst) {\r\n                        throw new QueryError(`constraint \"${change.constraint.name}\" of relation \"${this.table.name}\" does not exist`, '42704')\r\n                    }\r\n                    cst.uninstall(t);\r\n                    break;\r\n                case 'rename column':\r\n                    this.table.getColumnRef(change.column.name)\r\n                        .rename(change.to.name, t);\r\n                    break;\r\n                case 'alter column':\r\n                    this.table.getColumnRef(change.column.name)\r\n                        .alter(change.alter, t);\r\n                    break;\r\n                case 'rename constraint':\r\n                    throw new NotSupported('rename constraint');\r\n                case 'add constraint':\r\n                    this; this.table.addConstraint(change.constraint, t);\r\n                    break;\r\n                case 'owner':\r\n                    // owner change statements are not supported.\r\n                    // however, in order to support, pg_dump, we're just ignoring them.\r\n                    ignoreChange();\r\n                    break;\r\n                default:\r\n                    throw NotSupported.never(change, 'alter request');\r\n\r\n            }\r\n        }\r\n\r\n\r\n        // new implicit transaction\r\n        t = t.fork();\r\n        return this.noData(t, 'ALTER');\r\n    }\r\n}\r\n","import { _ISchema, _Transaction, _ISequence, _IStatementExecutor, _IStatement, asSeq } from '../../interfaces-private';\r\nimport { AlterSequenceStatement } from 'pgsql-ast-parser';\r\nimport { ExecHelper } from '../exec-utils';\r\nimport { ignore } from '../../utils';\r\n\r\nexport class AlterSequence extends ExecHelper implements _IStatementExecutor {\r\n    private seq: _ISequence | null;\r\n\r\n\r\n    constructor({ schema }: _IStatement, private p: AlterSequenceStatement) {\r\n        super(p);\r\n\r\n        this.seq = asSeq(schema.getObject(p.name, {\r\n            nullIfNotFound: p.ifExists,\r\n        }));\r\n        if (!this.seq) {\r\n            ignore(this.p);\r\n        }\r\n    }\r\n\r\n    execute(t: _Transaction) {\r\n        // commit pending data before making changes\r\n        //  (because the index sequence creation does support further rollbacks)\r\n        t = t.fullCommit();\r\n\r\n        // alter the sequence\r\n        this.seq?.alter(t, this.p.change);\r\n\r\n        // new implicit transaction\r\n        t = t.fork();\r\n\r\n        return this.noData(t, 'ALTER');\r\n    }\r\n}\r\n","import { _ISchema, _Transaction, _ISequence, _IStatementExecutor, _IStatement, asSeq, asIndex, _INamedIndex } from '../../interfaces-private';\r\nimport { DropStatement } from 'pgsql-ast-parser';\r\nimport { ExecHelper } from '../exec-utils';\r\nimport { ignore, notNil } from '../../utils';\r\n\r\nexport class DropIndex extends ExecHelper implements _IStatementExecutor {\r\n    private idx: _INamedIndex<any>[];\r\n\r\n\r\n    constructor({ schema }: _IStatement, statement: DropStatement) {\r\n        super(statement);\r\n\r\n        this.idx = notNil(statement.names.map(x => asIndex(schema.getObject(x, {\r\n            nullIfNotFound: statement.ifExists,\r\n        }))));\r\n\r\n        if (this.idx.length) {\r\n            ignore(statement.concurrently);\r\n        } else {\r\n            ignore(statement);\r\n        }\r\n    }\r\n\r\n    execute(t: _Transaction) {\r\n        // commit pending data before making changes\r\n        //  (because the index sequence creation does support further rollbacks)\r\n        t = t.fullCommit();\r\n\r\n        // alter the sequence\r\n        for (const idx of this.idx) {\r\n            idx.onTable.dropIndex(t, idx.name);\r\n        }\r\n\r\n        // new implicit transaction\r\n        t = t.fork();\r\n\r\n        return this.noData(t, 'DROP');\r\n    }\r\n}\r\n","import { _ISchema, _Transaction, _ISequence, _IStatementExecutor, _IStatement, asSeq, asIndex, _INamedIndex, _ITable, asTable } from '../../interfaces-private';\r\nimport { DropStatement } from 'pgsql-ast-parser';\r\nimport { ExecHelper } from '../exec-utils';\r\nimport { ignore, notNil } from '../../utils';\r\n\r\nexport class DropTable extends ExecHelper implements _IStatementExecutor {\r\n    private tables: _ITable[];\r\n    private cascade: boolean;\r\n\r\n\r\n    constructor({ schema }: _IStatement, statement: DropStatement) {\r\n        super(statement);\r\n\r\n        this.tables = notNil(statement.names.map(x => asTable(schema.getObject(x, {\r\n            nullIfNotFound: statement.ifExists,\r\n        }))));\r\n\r\n        this.cascade = statement.cascade === 'cascade';\r\n\r\n        if (!this.tables.length) {\r\n            ignore(statement);\r\n        }\r\n    }\r\n\r\n    execute(t: _Transaction) {\r\n        // commit pending data before making changes\r\n        //  (because it does not support further rollbacks)\r\n        t = t.fullCommit();\r\n\r\n        // drop table\r\n        for (const table of this.tables) {\r\n            table.drop(t, this.cascade);\r\n        }\r\n\r\n        // new implicit transaction\r\n        t = t.fork();\r\n\r\n        return this.noData(t, 'DROP');\r\n    }\r\n}\r\n","import { _ISchema, _Transaction, _ISequence, _IStatementExecutor, _IStatement, asSeq } from '../../interfaces-private';\r\nimport { DropStatement } from 'pgsql-ast-parser';\r\nimport { ExecHelper } from '../exec-utils';\r\nimport { ignore, notNil } from '../../utils';\r\n\r\nexport class DropSequence extends ExecHelper implements _IStatementExecutor {\r\n    private seqs: _ISequence[];\r\n\r\n    constructor({ schema }: _IStatement, statement: DropStatement) {\r\n        super(statement);\r\n\r\n        this.seqs = notNil(statement.names.map(x => asSeq(schema.getObject(x, {\r\n            nullIfNotFound: statement.ifExists,\r\n        }))));\r\n        if (!this.seqs.length) {\r\n            ignore(statement);\r\n        }\r\n    }\r\n\r\n    execute(t: _Transaction) {\r\n        // commit pending data before making changes\r\n        //  (because the index sequence creation does support further rollbacks)\r\n        t = t.fullCommit();\r\n\r\n        // drop the sequence\r\n        for (const seq of this.seqs) {\r\n            seq.drop(t);\r\n        }\r\n\r\n        // new implicit transaction\r\n        t = t.fork();\r\n\r\n        return this.noData(t, 'DROP');\r\n    }\r\n}\r\n","import { _IStatementExecutor, _Transaction, StatementResult } from '../interfaces-private';\r\nimport { ExecHelper } from './exec-utils';\r\nimport { CommitStatement, RollbackStatement, StartTransactionStatement, BeginStatement } from 'pgsql-ast-parser';\r\nimport { ignore } from '../utils';\r\n\r\nexport class CommitExecutor extends ExecHelper implements _IStatementExecutor {\r\n\r\n    constructor(statement: CommitStatement) {\r\n        super(statement)\r\n    }\r\n\r\n    execute(t: _Transaction): StatementResult {\r\n        t = t.commit();\r\n        // recreate an implicit transaction if we're at root\r\n        // (I can see how its usfull, but this is dubious...)\r\n        if (!t.isChild) {\r\n            t = t.fork();\r\n        }\r\n        return this.noData(t, 'COMMIT');\r\n    }\r\n\r\n}\r\n\r\nexport class RollbackExecutor extends ExecHelper implements _IStatementExecutor {\r\n    constructor(statement: RollbackStatement) {\r\n        super(statement);\r\n        ignore(statement);\r\n    }\r\n\r\n    execute(t: _Transaction): StatementResult {\r\n        t = t.rollback();\r\n        return this.noData(t, 'ROLLBACK');\r\n    }\r\n}\r\n\r\n\r\nexport class BeginStatementExec extends ExecHelper implements _IStatementExecutor {\r\n    constructor(statement: BeginStatement | StartTransactionStatement) {\r\n        super(statement);\r\n        ignore(statement);\r\n    }\r\n\r\n    execute(t: _Transaction): StatementResult {\r\n        t = t.fork();\r\n        return this.noData(t, 'BEGIN');\r\n    }\r\n}\r\n","import { _ISchema, _Transaction, SchemaField, NotSupported, _ITable, _IStatementExecutor, asTable, StatementResult, _IStatement, TruncateOpts } from '../../interfaces-private';\r\nimport { TruncateTableStatement } from 'pgsql-ast-parser';\r\nimport { ExecHelper } from '../exec-utils';\r\nimport { buildCtx } from '../../parser/context';\r\n\r\nexport class TruncateTable extends ExecHelper implements _IStatementExecutor {\r\n    private table: _ITable;\r\n    private opts: TruncateOpts;\r\n\r\n    constructor(statement: TruncateTableStatement) {\r\n        super(statement);\r\n        if (statement.tables.length !== 1) {\r\n            throw new NotSupported('Multiple truncations');\r\n        }\r\n        this.opts = {\r\n            cascade: statement.cascade === 'cascade',\r\n            restartIdentity: statement.identity === 'restart',\r\n        };\r\n        const { schema } = buildCtx();\r\n        this.table = asTable(schema.getObject(statement.tables[0]));\r\n    }\r\n\r\n    execute(t: _Transaction): StatementResult {\r\n        this.table.truncate(t, this.opts);\r\n        return this.noData(t, 'TRUNCATE');\r\n    }\r\n}\r\n","import { _IStatementExecutor, _Transaction, StatementResult, GLOBAL_VARS, QueryError } from '../interfaces-private';\r\nimport { ShowStatement } from 'pgsql-ast-parser';\r\nimport { locOf } from './exec-utils';\r\n\r\nexport class ShowExecutor implements _IStatementExecutor {\r\n    constructor(private statement: ShowStatement) { }\r\n\r\n    execute(t: _Transaction): StatementResult {\r\n        const p = this.statement;\r\n        const got = t.getMap(GLOBAL_VARS);\r\n        if (!got.has(p.variable.name)) {\r\n            throw new QueryError(`unrecognized configuration parameter \"${p.variable.name}\"`);\r\n        }\r\n        return {\r\n            state: t,\r\n            result: {\r\n                rows: [{ [p.variable.name]: got.get(p.variable.name) }],\r\n                rowCount: 1,\r\n                command: 'SHOW',\r\n                fields: [],\r\n                location: locOf(p),\r\n            },\r\n        }\r\n    }\r\n}\r\n","import { _IStatementExecutor, _Transaction, StatementResult, GLOBAL_VARS, QueryError } from '../interfaces-private';\r\nimport { SetGlobalStatement, SetTimezone } from 'pgsql-ast-parser';\r\nimport { ignore } from '../utils';\r\nimport { ExecHelper } from './exec-utils';\r\n\r\nexport class SetExecutor extends ExecHelper implements _IStatementExecutor {\r\n\r\n    constructor(private p: SetGlobalStatement | SetTimezone) {\r\n        super(p);\r\n        // todo handle set statements timezone ?\r\n        // They are just ignored as of today (in order to handle pg_dump exports)\r\n        ignore(p);\r\n    }\r\n\r\n    execute(t: _Transaction): StatementResult {\r\n        const p = this.p;\r\n        if (p.type === 'set' && p.set.type === 'value') {\r\n            t.set(GLOBAL_VARS, t.getMap(GLOBAL_VARS)\r\n                .set(p.variable.name, p.set.value));\r\n        }\r\n        return this.noData(t, 'SET');\r\n    }\r\n}\r\n","import { _Transaction, _ISchema, NotSupported, CreateIndexColDef, _ITable, CreateIndexDef, _IStatement, _IStatementExecutor } from '../../interfaces-private';\r\nimport { CreateEnumType } from 'pgsql-ast-parser';\r\nimport { ExecHelper } from '../exec-utils';\r\n\r\nexport class CreateEnum extends ExecHelper implements _IStatementExecutor {\r\n    private onSchema: _ISchema;\r\n    private values: string[];\r\n    private name: string;\r\n\r\n    constructor({ schema }: _IStatement, st: CreateEnumType) {\r\n        super(st);\r\n        this.onSchema = schema.getThisOrSiblingFor(st.name);\r\n        this.values = st.values.map(x => x.value);\r\n        this.name = st.name.name;\r\n    }\r\n\r\n    execute(t: _Transaction) {\r\n        // commit pending data before making changes\r\n        //  (because does not support further rollbacks)\r\n        t = t.fullCommit();\r\n\r\n        // register enum\r\n        this.onSchema\r\n            .registerEnum(this.name, this.values);\r\n\r\n        // new implicit transaction\r\n        t = t.fork();\r\n        return this.noData(t, 'CREATE');\r\n    }\r\n}\r\n","import { _Transaction, asTable, _ISchema, NotSupported, CreateIndexColDef, _ITable, CreateIndexDef, _IStatement, _IStatementExecutor, asView, _IView, QueryError } from '../../interfaces-private';\r\nimport { CreateViewStatement, SelectedColumn } from 'pgsql-ast-parser';\r\nimport { ExecHelper } from '../exec-utils';\r\nimport { ignore } from '../../utils';\r\nimport { View } from '../../schema/view';\r\nimport { buildSelect } from '../select';\r\n\r\nexport class CreateView extends ExecHelper implements _IStatementExecutor {\r\n    private schema: _ISchema;\r\n    private drop: boolean;\r\n    existing: _IView | null;\r\n    toRegister: View;\r\n\r\n\r\n    constructor(st: _IStatement, p: CreateViewStatement) {\r\n        super(p);\r\n        this.schema = st.schema.getThisOrSiblingFor(p.name);\r\n        // check existence\r\n        this.existing = asView(this.schema.getObject(p.name, { nullIfNotFound: true }));\r\n        ignore(p.orReplace);\r\n        this.drop = !!(p.orReplace && this.existing);\r\n\r\n        let view = buildSelect(p.query);\r\n\r\n        // optional column mapping\r\n        if (p.columnNames?.length) {\r\n            if (p.columnNames.length > view.columns.length) {\r\n                throw new QueryError('CREATE VIEW specifies more column names than columns', '42601');\r\n            }\r\n            view = view.select(view.columns.map<string | SelectedColumn>((x, i) => {\r\n                const alias = p.columnNames?.[i]?.name;\r\n                if (!alias) {\r\n                    return x.id!;\r\n                }\r\n                return {\r\n                    expr: { type: 'ref', name: x.id! },\r\n                    alias: { name: alias },\r\n                }\r\n            }));\r\n        }\r\n\r\n        this.toRegister = new View(this.schema, p.name.name, view);\r\n    }\r\n\r\n    execute(t: _Transaction) {\r\n        // commit pending data before making changes\r\n        //  (because does not support further rollbacks)\r\n        t = t.fullCommit();\r\n\r\n        // drop if needed\r\n        if (this.existing && this.drop) {\r\n            this.existing.drop(t);\r\n        }\r\n\r\n        // view creation\r\n        this.toRegister.register();\r\n\r\n        // new implicit transaction\r\n        t = t.fork();\r\n        return this.noData(t, 'CREATE');\r\n    }\r\n}\r\n","import { _Transaction, asTable, _ISchema, NotSupported, CreateIndexColDef, _ITable, CreateIndexDef, _IStatement, _IStatementExecutor, asView, _IView, QueryError } from '../../interfaces-private';\r\nimport { CreateMaterializedViewStatement } from 'pgsql-ast-parser';\r\nimport { ExecHelper } from '../exec-utils';\r\nimport { View } from '../../schema/view';\r\nimport { buildSelect } from '../select';\r\n\r\nexport class CreateMaterializedView extends ExecHelper implements _IStatementExecutor {\r\n    private schema: _ISchema;\r\n    private toRegister?: View;\r\n\r\n\r\n    constructor(st: _IStatement, p: CreateMaterializedViewStatement) {\r\n        super(p);\r\n        this.schema = st.schema.getThisOrSiblingFor(p.name);\r\n        // check existence\r\n        const existing = this.schema.getObject(p.name, { nullIfNotFound: true });\r\n        if (existing) {\r\n            if (p.ifNotExists) {\r\n                return;\r\n            }\r\n            throw new QueryError(`Name already exists: ${p.name.name}`);\r\n        }\r\n\r\n        const view = buildSelect(p.query);\r\n\r\n        // hack: materialized views are implemented as simple views :/  (todo ?)\r\n        this.toRegister = new View(this.schema, p.name.name, view);\r\n    }\r\n\r\n\r\n    execute(t: _Transaction) {\r\n        if (!this.toRegister) {\r\n            return this.noData(t, 'CREATE');\r\n        }\r\n\r\n        // commit pending data before making changes\r\n        //  (because does not support further rollbacks)\r\n        t = t.fullCommit();\r\n\r\n        // view creation\r\n        this.toRegister.register();\r\n\r\n        // new implicit transaction\r\n        t = t.fork();\r\n        return this.noData(t, 'CREATE');\r\n    }\r\n}","import { _Transaction, asTable, _ISchema, NotSupported, CreateIndexColDef, _ITable, CreateIndexDef, _IStatement, _IStatementExecutor, QueryError } from '../../interfaces-private';\r\nimport { CreateSchemaStatement } from 'pgsql-ast-parser';\r\nimport { ExecHelper } from '../exec-utils';\r\nimport { ignore } from '../../utils';\r\n\r\nexport class CreateSchema extends ExecHelper implements _IStatementExecutor {\r\n    private toCreate?: string;\r\n\r\n    constructor(private st: _IStatement, p: CreateSchemaStatement) {\r\n        super(p);\r\n        const sch = this.st.schema.db.getSchema(p.name.name, true);\r\n        if (!p.ifNotExists && sch) {\r\n            throw new QueryError('schema already exists! ' + p.name);\r\n        }\r\n        if (sch) {\r\n            ignore(p);\r\n        } else {\r\n            this.toCreate = p.name.name;\r\n        }\r\n    }\r\n\r\n    execute(t: _Transaction) {\r\n        // commit pending data before making changes\r\n        //  (because does not support further rollbacks)\r\n        t = t.fullCommit();\r\n\r\n        // create schema\r\n        if (this.toCreate) {\r\n            this.st.schema.db.createSchema(this.toCreate);\r\n        }\r\n\r\n        // new implicit transaction\r\n        t = t.fork();\r\n        return this.noData(t, 'CREATE');\r\n    }\r\n}\r\n","import { _Transaction, _ISchema, NotSupported, _ITable, _IStatement, _IStatementExecutor, QueryError, _ArgDefDetails, IType, _IType, nil, FunctionDefinition } from '../../interfaces-private';\r\nimport { CreateFunctionStatement } from 'pgsql-ast-parser';\r\nimport { ExecHelper } from '../exec-utils';\r\nimport { buildValue } from '../../parser/expression-builder';\r\nimport { Types } from '../../datatypes';\r\nimport { ignore, deepEqual } from '../../utils';\r\nimport { withSelection } from '../../parser/context';\r\n\r\nexport class CreateFunction extends ExecHelper implements _IStatementExecutor {\r\n    private onSchema: _ISchema;\r\n    private toRegister: FunctionDefinition;\r\n    private replace: boolean;\r\n\r\n    constructor({ schema }: _IStatement, fn: CreateFunctionStatement) {\r\n        super(fn);\r\n        if (!fn.language) {\r\n            throw new QueryError('Unspecified function language');\r\n        }\r\n        this.onSchema = schema.getThisOrSiblingFor(fn.name);\r\n\r\n        const lang = schema.db.getLanguage(fn.language.name);\r\n\r\n        // determine arg types\r\n        const args = withSelection(schema.dualTable.selection, () => fn.arguments.map<_ArgDefDetails>(a => ({\r\n            name: a.name?.name,\r\n            type: schema.getType(a.type),\r\n            default: a.default && buildValue(a.default),\r\n            mode: a.mode,\r\n        })));\r\n\r\n        // determine return type\r\n        let returns: IType | null = null;\r\n        if (!fn.returns) {\r\n            throw new QueryError('Unspecified function return type');\r\n        }\r\n        if (typeof fn.code !== 'string') {\r\n            throw new QueryError('no function body specified');\r\n        }\r\n        switch (fn.returns.kind) {\r\n            case 'table':\r\n                const columns = fn.returns.columns.map(c => ({\r\n                    name: c.name.name,\r\n                    type: schema.getType(c.type),\r\n                }));\r\n                returns = Types.record(columns).asArray();\r\n                break;\r\n            case 'array':\r\n            case null:\r\n            case undefined:\r\n                returns = schema.getType(fn.returns);\r\n                break;\r\n            default:\r\n                throw NotSupported.never(fn.returns);\r\n        }\r\n\r\n        let argsVariadic: _IType | nil;\r\n        const variad = args.filter(x => x.mode === 'variadic');\r\n        if (variad.length > 1) {\r\n            throw new QueryError(`Expected only one \"VARIADIC\" argument`);\r\n        } else if (variad.length) {\r\n            argsVariadic = variad[0].type;\r\n        }\r\n\r\n        // compile & register the associated function\r\n        const compiled = lang({\r\n            args,\r\n            code: fn.code,\r\n            returns,\r\n            functioName: fn.name.name,\r\n            schema: schema,\r\n        });\r\n\r\n        this.toRegister = {\r\n            name: fn.name.name,\r\n            returns,\r\n            implementation: compiled,\r\n            args: args.filter(x => x.mode !== 'variadic'),\r\n            argsVariadic,\r\n            impure: fn.purity !== 'immutable',\r\n            allowNullArguments: fn.onNullInput === 'call',\r\n        };\r\n        this.replace = fn.orReplace ?? false;\r\n\r\n        // if the function exists\r\n        const existing = this.onSchema.getFunction(this.toRegister.name, args.map(x => x.type));\r\n        if (existing) {\r\n            if (!this.replace) {\r\n                throw new QueryError(`function ${this.toRegister.name} lready exists with same argument types`, '42723');\r\n            }\r\n\r\n            //  ... it must be the same type\r\n            if (existing.returns !== returns) {\r\n                throw new QueryError(`cannot change return type of existing function`, '42P13');\r\n            }\r\n\r\n            // ... argument names must be the same\r\n            for (let i = 0; i < args.length; i++) {\r\n                const exName = existing.args[i].name\r\n                if (exName ?? null !== args[i].name ?? null) {\r\n                    throw new QueryError(`cannot change name of input parameter \"${exName}\"`, '42P13');\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    execute(t: _Transaction) {\r\n        // commit pending data before making changes\r\n        //  (because does not support further rollbacks)\r\n        t = t.fullCommit();\r\n\r\n        this.onSchema.registerFunction(this.toRegister, this.replace);\r\n\r\n        // new implicit transaction\r\n        t = t.fork();\r\n        return this.noData(t, 'CREATE');\r\n    }\r\n}\r\n","import { _IStatementExecutor, _Transaction, StatementResult, _IStatement, CompiledFunction } from '../../interfaces-private';\r\nimport { DoStatement } from 'pgsql-ast-parser';\r\nimport { ExecHelper } from '../../execution/exec-utils';\r\n\r\nexport class DoStatementExec extends ExecHelper implements _IStatementExecutor {\r\n    private compiled: CompiledFunction;\r\n\r\n    constructor({ schema }: _IStatement, st: DoStatement) {\r\n        super(st);\r\n        const lang = schema.db.getLanguage(st.language?.name ?? 'plpgsql');\r\n        this.compiled = lang({\r\n            args: [],\r\n            code: st.code,\r\n            schema: schema,\r\n        });\r\n    }\r\n\r\n    execute(t: _Transaction): StatementResult {\r\n        this.compiled();\r\n        return this.noData(t, 'DO');\r\n    }\r\n}\r\n","import { _ISchema, _Transaction, _ISequence, _IStatementExecutor, _IStatement, asSeq, asType, _IType } from '../../interfaces-private';\r\nimport { DropStatement } from 'pgsql-ast-parser';\r\nimport { ExecHelper } from '../exec-utils';\r\nimport { ignore, notNil } from '../../utils';\r\n\r\nexport class DropType extends ExecHelper implements _IStatementExecutor {\r\n    private types: _IType[];\r\n\r\n    constructor({ schema }: _IStatement, statement: DropStatement) {\r\n        super(statement);\r\n\r\n        this.types = notNil(statement.names.map(x => asType(schema.getObject(x, {\r\n            nullIfNotFound: statement.ifExists,\r\n        }))));\r\n        if (!this.types.length) {\r\n            ignore(statement);\r\n        }\r\n    }\r\n\r\n    execute(t: _Transaction) {\r\n        // commit pending data before making changes\r\n        //  (because the index sequence creation does support further rollbacks)\r\n        t = t.fullCommit();\r\n\r\n        // drop the sequence\r\n        for (const seq of this.types) {\r\n            seq.drop(t);\r\n        }\r\n\r\n        // new implicit transaction\r\n        t = t.fork();\r\n\r\n        return this.noData(t, 'DROP');\r\n    }\r\n}\r\n","import { _ISelection, CastError, DataType, NotSupported, IValue } from '../interfaces-private';\r\nimport { buildValue } from '../parser/expression-builder';\r\nimport { Types, ArrayType } from '../datatypes';\r\nimport { EqFilter } from './eq-filter';\r\nimport { Value } from '../evaluator';\r\nimport { FalseFilter } from './false-filter';\r\nimport { AndFilter } from './and-filter';\r\nimport { OrFilter } from './or-filter';\r\nimport { SeqScanFilter } from './seq-scan';\r\nimport { InFilter } from './in-filter';\r\nimport { NotInFilter } from './not-in-filter';\r\nimport { Expr, ExprBinary, ExprUnary, ExprTernary } from 'pgsql-ast-parser';\r\nimport { StartsWithFilter } from './startswith-filter';\r\nimport { IneqFilter } from './ineq-filter';\r\nimport { hasNullish, nullIsh } from '../utils';\r\nimport { BetweenFilter } from './between-filter';\r\nimport { QueryError } from '../interfaces';\r\nimport { withSelection } from '../parser/context';\r\n\r\nexport function buildFilter<T>(this: void, on: _ISelection<T>, filter: Expr, parentName: string): _ISelection<T> {\r\n    return withSelection(on, () => {\r\n        const where = buildValue(filter);\r\n        if (!where.type.canConvertImplicit(Types.bool)) {\r\n            throw new QueryError(`argument of ${parentName} must be type boolean, not type jsonb`, '42804');\r\n        }\r\n        return _buildFilter(on, filter, where) ?? new SeqScanFilter(on, where)\r\n    });\r\n}\r\n\r\nfunction _buildFilter<T>(this: void, on: _ISelection<T>, filter: Expr, built: IValue): _ISelection<T> | null {\r\n    // check if there is a direct index\r\n    if (built.index) {\r\n        if (built.index.expressions.length !== 1) {\r\n            throw new Error('Was not expecing multiples expressions filter');\r\n        }\r\n        const itype = built.index.expressions[0].type;\r\n        if (itype !== Types.bool) {\r\n            throw new CastError(itype.primary, DataType.bool);\r\n        }\r\n        return new EqFilter(built, true, 'eq', false);\r\n    }\r\n\r\n    // if this filter is a constant expression (ex: 1 = 1)\r\n    // then return directly\r\n    if (built.isConstant) {\r\n        const val = built.cast(Types.bool)\r\n            .get();\r\n        if (val) {\r\n            return on;\r\n        }\r\n        return new FalseFilter(on);\r\n    }\r\n    switch (filter.type) {\r\n        case 'binary':\r\n            return buildBinaryFilter(on, filter);\r\n        case 'unary':\r\n            return buildUnaryFilter(on, filter);\r\n        case 'ternary':\r\n            return buildTernaryFilter(on, filter);\r\n        default:\r\n            return null;\r\n    }\r\n}\r\n\r\nfunction buildUnaryFilter<T>(this: void, on: _ISelection<T>, filter: ExprUnary): _ISelection<T> | null {\r\n    const { operand, op } = filter;\r\n    switch (op) {\r\n        case 'IS NULL':\r\n        case 'IS NOT NULL': {\r\n            const leftValue = buildValue(operand);\r\n            if (leftValue.index) {\r\n                return new EqFilter(leftValue, null, op === 'IS NULL' ? 'eq' : 'neq', true);\r\n            }\r\n            return new SeqScanFilter(on, Value.isNull(leftValue, op === 'IS NULL'));\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction buildBinaryFilter<T>(this: void, on: _ISelection<T>, filter: ExprBinary): _ISelection<T> | null {\r\n    const { left, right, op } = filter;\r\n    switch (op) {\r\n        case '=':\r\n        case '!=':\r\n        case '>':\r\n        case '<':\r\n        case '<=':\r\n        case '>=':\r\n            return buildComparison(on, filter);\r\n        case 'AND':\r\n        case 'OR': {\r\n            const leftFilter = buildFilter(on, left, op);\r\n            const rightFilter = buildFilter(on, right, op);\r\n            if (op === 'OR' && (leftFilter instanceof SeqScanFilter || rightFilter instanceof SeqScanFilter)) {\r\n                return null;\r\n            }\r\n            return op === 'AND'\r\n                ? new AndFilter([leftFilter, rightFilter])\r\n                : new OrFilter(leftFilter, rightFilter);\r\n        }\r\n        case 'IN':\r\n        case 'NOT IN': {\r\n            const value = buildValue(left);\r\n            let arrayValue = buildValue(right);\r\n            // to support things like: \"col in (value)\" - which RHS does not parse to an array\r\n            if (arrayValue.type.primary !== DataType.list) {\r\n                arrayValue = Value.list([arrayValue]);\r\n            }\r\n            const elementType = (arrayValue.type as ArrayType).of.prefer(value.type);\r\n            const array = arrayValue.cast(elementType!.asList());\r\n            // only support scanning indexes with one expression\r\n            if (array.isConstant && value.index?.expressions.length === 1) {\r\n                const arrCst = array.get();\r\n                if (nullIsh(arrCst)) {\r\n                    return new FalseFilter(on);\r\n                }\r\n                return op === 'IN'\r\n                    ? new InFilter(value, arrCst)\r\n                    : new NotInFilter(value, arrCst);\r\n            }\r\n            // todo use indexes on queries like \"WHERE 'whatever' in (indexedOne, indexedTwo)\"\r\n            //   => this is an OrFilter\r\n            return new SeqScanFilter(on, Value.in(value, array, op === 'IN'));\r\n        }\r\n        case 'LIKE': {\r\n            const value = buildValue(left);\r\n            if (value.index && value.index.expressions[0].hash === value.hash) {\r\n                const valueToCompare = buildValue(right);\r\n                if (valueToCompare.isConstant) {\r\n                    const str = valueToCompare.get();\r\n                    if (nullIsh(str)) {\r\n                        return new FalseFilter(on);\r\n                    }\r\n                    const got = /^([^%_]+)([%_]?.+)$/.exec(str);\r\n                    if (got) {\r\n                        const start = got[1];\r\n                        if (start.length === str) {\r\n                            // that's a full string with no tokens => just an '='\r\n                            return buildComparison(on, {\r\n                                type: 'binary',\r\n                                op: '=',\r\n                                left: left,\r\n                                right: right,\r\n                            });\r\n                        }\r\n                        // yea, we can use an index\r\n                        const indexed = new StartsWithFilter(value, start);\r\n                        if (got[2] === '%') {\r\n                            // just a starsWith\r\n                            return indexed;\r\n                        }\r\n                        // use index, but filter again on it.\r\n                        return new SeqScanFilter(indexed, buildValue(filter));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction buildComparison<T>(this: void, on: _ISelection<T>, filter: ExprBinary): _ISelection<T> | null {\r\n    const { op, left, right } = filter;\r\n    let leftValue = buildValue(left);\r\n    let rightValue = buildValue(right);\r\n\r\n    if (leftValue.isConstant && rightValue.isConstant) {\r\n        const global = buildValue(filter);\r\n        const got = global.get();\r\n        if (got) {\r\n            return on;\r\n        }\r\n        return new FalseFilter(on);\r\n    }\r\n\r\n    if (rightValue.isConstant) {\r\n        rightValue = rightValue.cast(leftValue.type);\r\n    } else if (leftValue.isConstant) {\r\n        leftValue = leftValue.cast(rightValue.type);\r\n    }\r\n\r\n    switch (op) {\r\n        case '=':\r\n        case '!=': {\r\n            if (leftValue.index && rightValue.isConstant) {\r\n                return new EqFilter(leftValue, rightValue.get(), op === '=' ? 'eq' : 'neq', false)\r\n            }\r\n            if (rightValue.index && leftValue.isConstant) {\r\n                return new EqFilter(rightValue, leftValue.get(), op === '=' ? 'eq' : 'neq', false);\r\n            }\r\n            break;\r\n        }\r\n        case '>':\r\n        case '>=':\r\n        case '<':\r\n        case '<=':\r\n            if (leftValue.index && leftValue.index.expressions[0].hash === leftValue.hash && rightValue.isConstant) {\r\n                const fop = op === '>' ? 'gt'\r\n                    : op === '>=' ? 'ge'\r\n                        : op === '<' ? 'lt'\r\n                            : 'le';\r\n                return new IneqFilter(leftValue, fop, rightValue.get());\r\n            }\r\n            if (rightValue.index && rightValue.index.expressions[0].hash === rightValue.hash && leftValue.isConstant) {\r\n                const fop = op === '>' ? 'le'\r\n                    : op === '>=' ? 'lt'\r\n                        : op === '<' ? 'ge'\r\n                            : 'gt';\r\n                return new IneqFilter(rightValue, fop, leftValue.get());\r\n            }\r\n            break;\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction buildTernaryFilter<T>(this: void, on: _ISelection<T>, filter: ExprTernary): _ISelection<T> | null {\r\n    switch (filter.op) {\r\n        case 'BETWEEN':\r\n        case 'NOT BETWEEN': {\r\n            const value = buildValue(filter.value);\r\n            const lo = buildValue(filter.lo);\r\n            const hi = buildValue(filter.hi);\r\n            const valueIndex = value.index;\r\n            if (valueIndex && valueIndex.expressions[0].hash === value.hash && lo.isConstant && hi.isConstant) {\r\n                const lov = lo.get();\r\n                const hiv = hi.get();\r\n                if (hasNullish(lov, hiv)) {\r\n                    return new FalseFilter(on);\r\n                }\r\n                return new BetweenFilter(value, lov, hiv, filter.op === 'BETWEEN' ? 'inside' : 'outside');\r\n            }\r\n        }\r\n    }\r\n    return null;\r\n}","import { _ISelection, IValue, _IIndex, _ITable, _Transaction, _Explainer, _SelectExplanation, IndexKey, IndexOp, Stats } from '../interfaces-private';\r\nimport { FilterBase } from './transform-base';\r\nimport { nullIsh } from '../utils';\r\n\r\nexport class EqFilter<T = any> extends FilterBase<T> {\r\n\r\n    private index: _IIndex;\r\n    private opDef: IndexOp;\r\n\r\n    entropy(t: _Transaction): number {\r\n        return this.index.entropy({ ...this.opDef, t });\r\n    }\r\n\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        const stats = this.index.stats(t, [this.equalsCst]);\r\n        if (this.op === 'eq' || !stats) {\r\n            return stats;\r\n        }\r\n        // if neq, then compute from eq and all\r\n        const all = this.index.stats(t);\r\n        if (!all) {\r\n            return null;\r\n        }\r\n        return {\r\n            count: all.count - stats.count,\r\n        };\r\n    }\r\n\r\n    hasItem(item: T, t: _Transaction) {\r\n        const val = this.onValue.get(item, t);\r\n        if (nullIsh(val)) {\r\n            return false;\r\n        }\r\n        const eq = this.onValue.type.equals(val, this.equalsCst);\r\n        if (nullIsh(eq)) {\r\n            return false;\r\n        }\r\n        return this.op === 'eq' ? !!eq : !eq;\r\n    }\r\n\r\n    constructor(private onValue: IValue<T>\r\n        , private equalsCst: any\r\n        , private op: 'eq' | 'neq'\r\n        , private matchNull: boolean) {\r\n        super(onValue.origin!);\r\n        if (onValue.index!.expressions.length !== 1) {\r\n            throw new Error('Unexpected index equality expressions count mismatch');\r\n        }\r\n\r\n        this.index = this.onValue.index!;\r\n        this.opDef = {\r\n            type: op,\r\n            key: [equalsCst],\r\n            t: null as any,\r\n            matchNull: this.matchNull,\r\n        }\r\n    }\r\n\r\n    *enumerate(t: _Transaction): Iterable<T> {\r\n        for (const item of this.index.enumerate({ ...this.opDef, t })) {\r\n            yield item;\r\n        }\r\n    }\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: this.op,\r\n            entropy: this.entropy(e.transaction),\r\n            on: this.onValue.index!.explain(e),\r\n        };\r\n    }\r\n}\r\n","import { _ISelection, IValue, _Explainer, _SelectExplanation, _Transaction, Stats } from '../interfaces-private';\r\nimport { FilterBase } from './transform-base';\r\n\r\nexport class FalseFilter<T = any> extends FilterBase<T> {\r\n\r\n    get index() {\r\n        return null;\r\n    }\r\n\r\n    entropy() {\r\n        return 0;\r\n    }\r\n\r\n    hasItem() {\r\n        return false;\r\n    }\r\n\r\n    enumerate(): Iterable<T> {\r\n        return [];\r\n    }\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return {\r\n            count: 0,\r\n        }\r\n    }\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'empty',\r\n        };\r\n    }\r\n}","import { _ISelection, _IIndex, _ITable, _Transaction, _Explainer, _SelectExplanation, Stats, nil } from '../interfaces-private';\r\nimport { FilterBase } from './transform-base';\r\nimport { SeqScanFilter } from './seq-scan';\r\n\r\n\r\n\r\nexport class AndFilter<T = any> extends FilterBase<T> {\r\n\r\n    get index(): _IIndex<T> | nil {\r\n        return null;\r\n    }\r\n\r\n    private prevEntropy?: { t: _Transaction; ret: number };\r\n\r\n    entropy(t: _Transaction) {\r\n        // just a bit of caching\r\n        if (t === this.prevEntropy?.t) {\r\n            return this.prevEntropy.ret;\r\n        }\r\n        const { best } = this.plan(t);\r\n        const ret = best.entropy(t);\r\n        this.prevEntropy = {\r\n            ret,\r\n            t,\r\n        };\r\n        return ret;\r\n    }\r\n\r\n    hasItem(value: T, t: _Transaction): boolean {\r\n        return this.filters.every(x => x.hasItem(value, t));\r\n    }\r\n\r\n    constructor(private filters: _ISelection<T>[]) {\r\n        super(filters.find(x => !(x instanceof SeqScanFilter)) ?? filters[0]);\r\n        if (filters.some(f => f.columns !== this.base.columns)) {\r\n            throw new Error('Column set mismatch');\r\n        }\r\n    }\r\n\r\n    private plan(t: _Transaction) {\r\n        const sorted = [...this.filters]\r\n            .sort((a, b) => a.entropy(t) > b.entropy(t) ? 1 : -1);\r\n        const [best] = sorted.splice(0, 1);\r\n        return { best, sorted };\r\n    }\r\n\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return null;\r\n    }\r\n\r\n    *enumerate(t: _Transaction): Iterable<T> {\r\n        // sort them so the most restrictive filter is first\r\n        const { best, sorted } = this.plan(t)\r\n        for (const item of best.enumerate(t)) {\r\n            if (!sorted.every(x => x.hasItem(item, t))) {\r\n                continue;\r\n            }\r\n            yield item;\r\n        }\r\n    }\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        const { best, sorted } = this.plan(e.transaction);\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'and',\r\n            enumerate: best.explain(e),\r\n            andCheck: sorted.map(x => x.explain(e)),\r\n        };\r\n    }\r\n\r\n}","import { _ISelection, _IIndex, _ITable, getId, _Transaction, _Explainer, _SelectExplanation, Stats } from '../interfaces-private';\r\nimport { FilterBase } from './transform-base';\r\n\r\n\r\nexport class OrFilter<T = any> extends FilterBase<T> {\r\n\r\n    entropy(t: _Transaction) {\r\n        return this.left.entropy(t) + this.right.entropy(t);\r\n    }\r\n\r\n    hasItem(value: T, t: _Transaction): boolean {\r\n        return this.left.hasItem(value, t) || this.right.hasItem(value, t);\r\n    }\r\n\r\n    constructor(private left: _ISelection<T>, private right: _ISelection<T>) {\r\n        super(left);\r\n        if (left.columns !== right.columns) { //  istanbul ignore next\r\n            throw new Error('Column set mismatch');\r\n        }\r\n    }\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return null;\r\n    }\r\n\r\n    *enumerate(t: _Transaction): Iterable<T> {\r\n        const yielded = new Set<string>();\r\n        for (const item of this.left.enumerate(t)) {\r\n            yield item;\r\n            yielded.add(getId(item));\r\n        }\r\n        for (const item of this.right.enumerate(t)) {\r\n            const id = getId(item);\r\n            if (!yielded.has(id)) {\r\n                yield item;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'union',\r\n            union: [\r\n                this.left.explain(e),\r\n                this.right.explain(e),\r\n            ],\r\n        };\r\n    }\r\n}","import { _ISelection, IValue, _IIndex, _ITable, getId, _Transaction, _Explainer, _SelectExplanation, Stats } from '../interfaces-private';\r\nimport { FilterBase } from './transform-base';\r\nimport { DataType, CastError, QueryError } from '../interfaces';\r\nimport { nullIsh } from '../utils';\r\n\r\nexport class InFilter<T = any> extends FilterBase<T> {\r\n\r\n\r\n    private index: _IIndex;\r\n\r\n    entropy(t: _Transaction) {\r\n        let ret = 0;\r\n        for (const a of this.elts) {\r\n            ret += this.index.entropy({\r\n                type: 'eq',\r\n                key: [a],\r\n                t,\r\n            });\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    hasItem(item: T, t: _Transaction) {\r\n        const val = this.onValue.get(item, t);\r\n        return !nullIsh(val)\r\n            && this.elts.some(x => this.onValue.type.equals(x, val));\r\n    }\r\n\r\n    constructor(private onValue: IValue<T>\r\n        , private elts: any[]) {\r\n        super(onValue.origin!);\r\n        this.index = onValue.index!;\r\n        if (this.index.expressions.length !== 1) {\r\n            throw new Error('Only supports IN with signle expressions index');\r\n        }\r\n        if (!Array.isArray(elts)) {\r\n            throw new QueryError('Cannot iterate element list');\r\n        }\r\n    }\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        const elts = this.elts.map(x => this.index.stats(t, [x]));\r\n        if (elts.some(x => !x)) {\r\n            return null;\r\n        }\r\n        // compute from elements\r\n        const ret: Stats = {\r\n            count: 0,\r\n        };\r\n        for (const i of elts) {\r\n            ret.count += i!.count;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    *enumerate(t: _Transaction): Iterable<T> {\r\n        for (const a of this.elts) {\r\n            yield* this.index.enumerate({\r\n                type: 'eq',\r\n                key: [a],\r\n                t,\r\n            });\r\n        }\r\n    }\r\n\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'eq',\r\n            entropy: this.entropy(e.transaction),\r\n            on: this.index.explain(e),\r\n        };\r\n    }\r\n}","import { _ISelection, IValue, _IIndex, _ITable, getId, _Transaction, _Explainer, _SelectExplanation, IndexKey, Stats } from '../interfaces-private';\r\nimport { FilterBase } from './transform-base';\r\nimport { DataType, CastError, QueryError } from '../interfaces';\r\nimport { nullIsh } from '../utils';\r\n\r\nexport class NotInFilter<T = any> extends FilterBase<T> {\r\n\r\n    private index: _IIndex;\r\n    private keys: IndexKey[];\r\n\r\n    entropy(t: _Transaction) {\r\n        return this.onValue.index!.entropy({\r\n            type: 'nin',\r\n            keys: this.keys,\r\n            t,\r\n        });\r\n    }\r\n\r\n    hasItem(item: T, t: _Transaction): boolean {\r\n        const val = this.onValue.get(item, t);\r\n        return !nullIsh(val)\r\n            && !this.elts.some(x => this.onValue.type.equals(x, val));\r\n    }\r\n\r\n    constructor(private onValue: IValue<T>\r\n        , private elts: any[]) {\r\n        super(onValue.origin!);\r\n        this.index = onValue.index!;\r\n        if (this.index.expressions.length !== 1) {\r\n            throw new Error('Only supports IN with signle expressions index');\r\n        }\r\n        if (!Array.isArray(elts)) {\r\n            throw new QueryError('Cannot iterate element list');\r\n        }\r\n        this.keys = elts.map(x => [x]);\r\n    }\r\n\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        const all = this.base.stats(t);\r\n        if (!all) {\r\n            return null;\r\n        }\r\n        const elts = this.elts.map(x => this.index.stats(t, [x]));\r\n        if (elts.some(x => !x)) {\r\n            return null;\r\n        }\r\n        // compute based on 'all'\r\n        for (const i of elts) {\r\n            all.count -= i!.count;\r\n        }\r\n        return all;\r\n    }\r\n\r\n    *enumerate(t: _Transaction): Iterable<T> {\r\n        yield* this.index.enumerate({\r\n            type: 'nin',\r\n            keys: this.keys,\r\n            t,\r\n        });\r\n    }\r\n\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'neq',\r\n            entropy: this.entropy(e.transaction),\r\n            on: this.onValue.index!.explain(e),\r\n        };\r\n    }\r\n}","import { _ISelection, IValue, _IIndex, _ITable, getId, _Transaction, _Explainer, _SelectExplanation, Stats } from '../interfaces-private';\r\nimport { FilterBase } from './transform-base';\r\nimport { nullIsh } from '../utils';\r\n\r\nexport class StartsWithFilter<T = any> extends FilterBase<T> {\r\n\r\n    get index() {\r\n        return null;\r\n    }\r\n\r\n    entropy(t: _Transaction) {\r\n        return this.onValue.index!.entropy({\r\n            type: 'ge',\r\n            key: [this.startWith],\r\n            t,\r\n        });\r\n    }\r\n\r\n    hasItem(item: T, t: _Transaction) {\r\n        const get = this.onValue.get(item, t);\r\n        return typeof get === 'string'\r\n            && get.startsWith(this.startWith);\r\n    }\r\n\r\n    constructor(private onValue: IValue<T>\r\n        , private startWith: string) {\r\n        super(onValue.origin!);\r\n        if (onValue.index!.expressions[0].hash !== this.onValue.hash) {\r\n            throw new Error('Startwith must be the first component of the index');\r\n        }\r\n    }\r\n\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return null;\r\n    }\r\n\r\n    *enumerate(t: _Transaction): Iterable<T> {\r\n        const index = this.onValue.index!;\r\n        for (const item of index.enumerate({\r\n            type: 'ge',\r\n            key: [this.startWith],\r\n            t,\r\n        })) {\r\n            const got: string = this.onValue.get(item, t);\r\n            if (nullIsh(got) || !got.startsWith(this.startWith)) {\r\n                break;\r\n            }\r\n            yield item;\r\n        }\r\n    }\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'ineq',\r\n            entropy: this.entropy(e.transaction),\r\n            on: this.onValue.index!.explain(e),\r\n        };\r\n    }\r\n}","import { _ISelection, IValue, _IIndex, _ITable, _Transaction, _Explainer, _SelectExplanation, IndexOp, Stats } from '../interfaces-private';\r\nimport { FilterBase } from './transform-base';\r\nimport { nullIsh } from '../utils';\r\n\r\nexport class IneqFilter<T = any> extends FilterBase<T> {\r\n\r\n    private index: _IIndex;\r\n    private opDef: IndexOp;\r\n\r\n    entropy(t: _Transaction) {\r\n        return this.onValue.index!.entropy({ ...this.opDef, t });\r\n    }\r\n\r\n    hasItem(item: T, t: _Transaction) {\r\n        const val = this.onValue.get(item, t);\r\n        if (nullIsh(val)) {\r\n            return false;\r\n        }\r\n        return !!this.onValue.type[this.op](val, this.than);\r\n    }\r\n\r\n    constructor(private onValue: IValue<T>\r\n        , private op: 'gt' | 'ge' | 'lt' | 'le'\r\n        , private than: any) {\r\n        super(onValue.origin!);\r\n\r\n        this.index = this.onValue.index!;\r\n        this.opDef = {\r\n            type: op,\r\n            key: [than],\r\n            t: null as any,\r\n        }\r\n    }\r\n\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return null;\r\n    }\r\n\r\n    *enumerate(t: _Transaction): Iterable<T> {\r\n        for (const item of this.index.enumerate({ ...this.opDef, t })) {\r\n            if (!this.hasItem(item, t)) {\r\n                break;\r\n            }\r\n            yield item;\r\n        }\r\n    }\r\n\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'ineq',\r\n            entropy: this.entropy(e.transaction),\r\n            on: this.onValue.index!.explain(e),\r\n        };\r\n    }\r\n}","import { _ISelection, IValue, _IIndex, _ITable, _Transaction, _Explainer, _SelectExplanation, IndexOp, Stats } from '../interfaces-private';\r\nimport { FilterBase } from './transform-base';\r\nimport { nullIsh } from '../utils';\r\n\r\nexport class BetweenFilter<T = any> extends FilterBase<T> {\r\n\r\n    private opDef: IndexOp;\r\n\r\n\r\n    entropy(t: _Transaction) {\r\n        return this.onValue.index!.entropy({ ...this.opDef, t });\r\n    }\r\n\r\n    constructor(private onValue: IValue<T>\r\n        , private lo: any\r\n        , private hi: any\r\n        , private op: 'inside' | 'outside') {\r\n        super(onValue.origin!);\r\n        if (onValue.index!.expressions[0]?.hash !== onValue.hash) {\r\n            throw new Error('Between index misuse');\r\n        }\r\n        this.opDef = {\r\n            type: op,\r\n            hi: [hi],\r\n            lo: [lo],\r\n            t: null as any,\r\n        }\r\n    }\r\n\r\n    hasItem(value: T, t: _Transaction): boolean {\r\n        const v = this.onValue.get(value, t);\r\n        if (nullIsh(v)) {\r\n            return false;\r\n        }\r\n        if (this.op === 'inside') {\r\n            return !!this.onValue.type.ge(v, this.lo)\r\n                && !!this.onValue.type.le(v, this.hi);\r\n        }\r\n        return !!this.onValue.type.lt(v, this.lo)\r\n            || !!this.onValue.type.gt(v, this.lo);\r\n    }\r\n\r\n    enumerate(t: _Transaction): Iterable<T> {\r\n        return this.onValue.index!.enumerate({ ...this.opDef, t });\r\n    }\r\n\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return null;\r\n    }\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: this.op,\r\n            entropy: this.entropy(e.transaction),\r\n            on: this.onValue.index!.explain(e),\r\n        };\r\n    }\r\n}\r\n","export * from './adapters';\r\n","import { LibAdapters, IMemoryDb, NotSupported, QueryResult } from '../interfaces';\r\nimport lru from 'lru-cache';\r\nimport { compareVersions } from '../utils';\r\nimport { toLiteral } from '../misc/pg-utils';\r\ndeclare var __non_webpack_require__: any;\r\n\r\n\r\n// setImmediate does not exist in Deno\r\ndeclare var setImmediate: any;\r\n\r\n// see https://github.com/oguimbal/pg-mem/issues/170\r\nfunction timeoutOrImmediate(fn: () => void, time: number) {\r\n    if (time || typeof setImmediate === 'undefined') {\r\n        return setTimeout(fn, time);\r\n    }\r\n    // nothing to wait for, but still executing \"later\"\r\n    //  in case calling code relies on some actual async behavior\r\n    return setImmediate(fn);\r\n}\r\n\r\nconst delay = (time: number | undefined) => new Promise<void>(done => timeoutOrImmediate(done, time ?? 0));\r\n\r\nfunction replaceQueryArgs$(this: void, sql: string, values: any[]) {\r\n    return sql.replace(/\\$(\\d+)/g, (str: any, istr: any) => {\r\n        const i = Number.parseInt(istr);\r\n        if (i > values.length) {\r\n            throw new Error('Unmatched parameter in query ' + str);\r\n        }\r\n        const val = values[i - 1];\r\n        return toLiteral(val);\r\n    });\r\n}\r\n\r\n\r\nexport class Adapters implements LibAdapters {\r\n    private _mikroPatched?: boolean;\r\n\r\n    constructor(private db: IMemoryDb) {\r\n    }\r\n\r\n    createPg(queryLatency?: number): { Pool: any; Client: any } {\r\n        const that = this;\r\n        // https://node-postgres.com/features/queries\r\n        interface PgQuery {\r\n            text: string;\r\n            values?: any[];\r\n            rowMode?: 'array';\r\n            types?: any;\r\n        }\r\n        class MemPg {\r\n\r\n            connection = this;\r\n\r\n            on() {\r\n                // nop\r\n            }\r\n\r\n            release() {\r\n            }\r\n\r\n            removeListener() {\r\n            }\r\n\r\n            once(what: string, handler: () => void) {\r\n                if (what === 'connect') {\r\n                    timeoutOrImmediate(handler, queryLatency ?? 0);\r\n                }\r\n            }\r\n\r\n            end(callback: any) {\r\n                if (callback) {\r\n                    callback();\r\n                    return null;\r\n                } else {\r\n                    return Promise.resolve();\r\n                }\r\n            }\r\n\r\n            connect(callback: any) {\r\n                if (callback) {\r\n                    callback(null, this, () => { });\r\n                    return null;\r\n                } else {\r\n                    return Promise.resolve(this);\r\n                }\r\n            }\r\n            query(query: any, valuesOrCallback: any, callback: any) {\r\n                let values: any = null;\r\n                if (Array.isArray(valuesOrCallback)) {\r\n                    values = valuesOrCallback;\r\n                }\r\n                if (callback == null && typeof valuesOrCallback === 'function') {\r\n                    callback = valuesOrCallback;\r\n                }\r\n\r\n                // adapt results\r\n\r\n                const pgquery = this.adaptQuery(query, values);\r\n                try {\r\n                    const result = this.adaptResults(query, that.db.public.query(pgquery.text));\r\n                    if (callback) {\r\n                        timeoutOrImmediate(() => callback(null, result), queryLatency ?? 0);\r\n                        return null;\r\n                    } else {\r\n                        return new Promise(res => timeoutOrImmediate(() => res(result), queryLatency ?? 0));\r\n                    }\r\n                } catch (e) {\r\n                    if (callback) {\r\n                        timeoutOrImmediate(() => callback(e), queryLatency ?? 0);\r\n                        return null;\r\n                    } else {\r\n                        return new Promise((_, rej) => timeoutOrImmediate(() => rej(e), queryLatency ?? 0));\r\n                    }\r\n                }\r\n            }\r\n\r\n            private adaptResults(query: PgQuery, res: QueryResult) {\r\n                if (query.rowMode) {\r\n                    throw new NotSupported('pg rowMode');\r\n                }\r\n                return {\r\n                    ...res,\r\n                    // clone rows to avoid leaking symbols\r\n                    rows: res.rows.map(row => {\r\n                        return Object.entries(row).reduce((obj, [key, val]) => {\r\n                            obj[key] = val;\r\n                            return obj;\r\n                        }, {} as any);\r\n                    }),\r\n                    get fields() {\r\n                        // to implement if needed ? (never seen a lib that uses it)\r\n                        return [];\r\n                    }\r\n                };\r\n            }\r\n\r\n            private adaptQuery(query: string | PgQuery, values: any): PgQuery {\r\n                if (typeof query === 'string') {\r\n                    query = {\r\n                        text: query,\r\n                        values,\r\n                    };\r\n                } else {\r\n                    // clean copy to avoid mutating things outside our scope\r\n                    query = { ...query };\r\n                }\r\n                if (!query.values?.length) {\r\n                    return query;\r\n                }\r\n\r\n                if (query.types?.getTypeParser) {\r\n                    throw new NotSupported('getTypeParser is not supported');\r\n                }\r\n\r\n                // console.log(query);\r\n                // console.log('\\n');\r\n\r\n                query.text = replaceQueryArgs$(query.text, query.values);\r\n                return query;\r\n            }\r\n        }\r\n        return {\r\n            Pool: MemPg,\r\n            Client: MemPg,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * @deprecated Use `createTypeormDataSource` instead.\r\n     */\r\n    createTypeormConnection(postgresOptions: any, queryLatency?: number) {\r\n        const that = this;\r\n        (postgresOptions as any).postgres = that.createPg(queryLatency);\r\n        if (postgresOptions?.type !== 'postgres') {\r\n            throw new NotSupported('Only postgres supported, found ' + postgresOptions?.type ?? '<null>')\r\n        }\r\n\r\n        const { getConnectionManager } = __non_webpack_require__('typeorm')\r\n        const created = getConnectionManager().create(postgresOptions);\r\n        created.driver.postgres = that.createPg(queryLatency);\r\n        return created.connect();\r\n    }\r\n\r\n    createTypeormDataSource(postgresOptions: any, queryLatency?: number) {\r\n        const that = this;\r\n        (postgresOptions as any).postgres = that.createPg(queryLatency);\r\n        if (postgresOptions?.type !== 'postgres') {\r\n            throw new NotSupported('Only postgres supported, found ' + postgresOptions?.type ?? '<null>')\r\n        }\r\n\r\n        const { DataSource } = __non_webpack_require__('typeorm')\r\n        const created = new DataSource(postgresOptions);\r\n        created.driver.postgres = that.createPg(queryLatency);\r\n        return created;\r\n    }\r\n\r\n    createSlonik(queryLatency?: number) {\r\n        const { createMockPool, createMockQueryResult } = __non_webpack_require__('slonik');\r\n        return createMockPool({\r\n            query: async (sql: string, args: any[]) => {\r\n                await delay(queryLatency ?? 0);\r\n                const formatted = replaceQueryArgs$(sql, args);\r\n                const ret = this.db.public.many(formatted);\r\n                return createMockQueryResult(ret);\r\n            },\r\n        });\r\n    }\r\n\r\n\r\n    createPgPromise(queryLatency?: number) {\r\n        // https://vitaly-t.github.io/pg-promise/module-pg-promise.html\r\n        // https://github.com/vitaly-t/pg-promise/issues/743#issuecomment-756110347\r\n        const pgp = __non_webpack_require__('pg-promise')();\r\n        pgp.pg = this.createPg(queryLatency);\r\n        const db = pgp('pg-mem');\r\n        if (compareVersions('10.8.7', db.$config.version) < 0) {\r\n            throw new Error(` pg-mem cannot be used with pg-promise@${db.$config.version},\r\n\r\n        you must install version pg-promise@10.8.7 or newer:\r\n\r\n                npm i pg-promise@latest -S\r\n\r\n            See https://github.com/vitaly-t/pg-promise/issues/743 for details`);\r\n        }\r\n        return db;\r\n    }\r\n\r\n    createPgNative(queryLatency?: number) {\r\n        queryLatency = queryLatency ?? 0;\r\n        const prepared = new lru<string, string>({\r\n            max: 1000,\r\n            maxAge: 5000,\r\n        });\r\n        function handlerFor(a: any, b: any) {\r\n            return typeof a === 'function' ? a : b;\r\n        }\r\n        const that = this;\r\n        return class Client {\r\n            async connect(a: any, b: any) {\r\n                const handler = handlerFor(a, b);\r\n                await delay(queryLatency);\r\n                handler?.();\r\n            }\r\n\r\n            connectSync() {\r\n                // nop\r\n            }\r\n\r\n            async prepare(name: string, sql: string, npar: number, callback: any) {\r\n                await delay(queryLatency);\r\n                this.prepareSync(name, sql, npar);\r\n                callback();\r\n            }\r\n\r\n            prepareSync(name: string, sql: string, npar: number) {\r\n                prepared.set(name, sql);\r\n            }\r\n\r\n            async execute(name: string, a: any, b: any) {\r\n                const handler = handlerFor(a, b);\r\n                const pars = Array.isArray(a) ? a : [];\r\n                await delay(queryLatency);\r\n                try {\r\n                    const rows = this.executeSync(name, pars);\r\n                    handler(null, rows);\r\n                } catch (e) {\r\n                    handler(e);\r\n                }\r\n            }\r\n            executeSync(name: string, pars?: any) {\r\n                pars = Array.isArray(pars) ? pars : [];\r\n                const prep = prepared.get(name);\r\n                if (!prep) {\r\n                    throw new Error('Unkown prepared statement ' + name);\r\n                }\r\n                return this.querySync(prep, pars);\r\n            }\r\n\r\n\r\n            async query(sql: string, b: any, c: any) {\r\n                const handler = handlerFor(b, c);\r\n                const params = Array.isArray(b) ? b : [];\r\n                try {\r\n                    await delay(queryLatency);\r\n                    const result = this.querySync(sql, params);\r\n                    handler(null, result);\r\n                } catch (e) {\r\n                    handler?.(e);\r\n                }\r\n            }\r\n\r\n            querySync(sql: string, params: any[]) {\r\n                sql = replaceQueryArgs$(sql, params);\r\n                const ret = that.db.public.many(sql);\r\n                return ret;\r\n            }\r\n        }\r\n    }\r\n\r\n    createKnex(queryLatency?: number, knexConfig?: object): any {\r\n        const knex = __non_webpack_require__('knex')({\r\n            connection: {},\r\n            ...knexConfig,\r\n            client: 'pg',\r\n        });\r\n        knex.client.driver = this.createPg(queryLatency);\r\n        knex.client.version = 'pg-mem';\r\n        return knex;\r\n    }\r\n\r\n\r\n    async createMikroOrm(mikroOrmOptions: any, queryLatency?: number) {\r\n\r\n        const { MikroORM } = __non_webpack_require__('@mikro-orm/core');\r\n        const { AbstractSqlDriver, PostgreSqlConnection, PostgreSqlPlatform } = __non_webpack_require__('@mikro-orm/postgresql');\r\n        const that = this;\r\n\r\n        // see https://github.com/mikro-orm/mikro-orm/blob/aa71065d0727920db7da9bfdecdb33e6b8165cb5/packages/postgresql/src/PostgreSqlConnection.ts#L5\r\n        class PgMemConnection extends PostgreSqlConnection {\r\n            protected createKnexClient(type: string) {\r\n                return that.createKnex();\r\n            }\r\n\r\n        }\r\n        // see https://github.com/mikro-orm/mikro-orm/blob/master/packages/postgresql/src/PostgreSqlDriver.ts\r\n        class PgMemDriver extends AbstractSqlDriver<PgMemConnection> {\r\n            constructor(config: any) {\r\n                super(config, new PostgreSqlPlatform(), PgMemConnection, ['knex', 'pg']);\r\n            }\r\n        }\r\n\r\n        // hack: this query is not supported by pgsql-ast-parser\r\n        if (!this._mikroPatched) {\r\n            this.db.public.interceptQueries(q => {\r\n                if (q === `set names 'utf8';`) {\r\n                    return [];\r\n                }\r\n                return null;\r\n            });\r\n            this._mikroPatched = true;\r\n        }\r\n\r\n\r\n        const orm = await MikroORM.init({\r\n            ...mikroOrmOptions,\r\n            dbName: 'public',\r\n            driver: PgMemDriver,\r\n        });\r\n        return orm;\r\n    }\r\n\r\n}\r\n","// ====== ALMOST A COPY-PASTE OF https://github.com/brianc/node-postgres/blob/4b229275cfe41ca17b7d69bd39f91ada0068a5d0/packages/pg/lib/utils.js#L71-L82\r\n//   see https://github.com/oguimbal/pg-mem/issues/181\r\n\r\nimport { nullIsh } from '../utils'\r\nimport { bufToString, isBuf } from './buffer-node';\r\nimport { literal } from './pg-escape';\r\nimport stringify from 'json-stable-stringify';\r\n\r\nexport function toLiteral(val: any) {\r\n  return prepareValue(val);\r\n}\r\n\r\n// converts values from javascript types\r\n// to their 'raw' counterparts for use as a postgres parameter\r\n// note: you can override this function to provide your own conversion mechanism\r\n// for complex types, etc...\r\nvar prepareValue = function (val: any, seen?: any[]): any {\r\n  // null and undefined are both null for postgres\r\n  if (nullIsh(val)) {\r\n    return 'null';\r\n  }\r\n\r\n  if (isBuf(val)) {\r\n    return literal(bufToString(val));\r\n  }\r\n  if (val instanceof Date) {\r\n    // if (defaults.parseInputDatesAsUTC) {\r\n    //   return dateToStringUTC(val)\r\n    // } else {\r\n    return literal(dateToString(val));\r\n    // }\r\n  }\r\n\r\n  if (Array.isArray(val)) {\r\n    if (val.length === 0) return `'{}'`;\r\n    return `ARRAY[${val.map(x => toLiteral(x)).join(', ')}]`;\r\n  }\r\n  if (typeof val === 'object') {\r\n    return prepareObject(val, seen);\r\n  }\r\n  return literal(val.toString());\r\n}\r\n\r\nfunction prepareObject(val: any, seen?: any[]) {\r\n  if (val && typeof val.toPostgres === 'function') {\r\n    seen = seen || []\r\n    if (seen.indexOf(val) !== -1) {\r\n      throw new Error('circular reference detected while preparing \"' + val + '\" for query')\r\n    }\r\n    seen.push(val)\r\n\r\n    return prepareValue(val.toPostgres(prepareValue), seen)\r\n  }\r\n  return literal(stringify(val));\r\n}\r\n\r\nfunction pad(number: any, digits: number) {\r\n  number = '' + number\r\n  while (number.length < digits) {\r\n    number = '0' + number\r\n  }\r\n  return number\r\n}\r\n\r\nfunction dateToString(date: Date) {\r\n  var offset = -date.getTimezoneOffset()\r\n\r\n  var year = date.getFullYear()\r\n  var isBCYear = year < 1\r\n  if (isBCYear) year = Math.abs(year) + 1 // negative years are 1 off their BC representation\r\n\r\n  var ret =\r\n    pad(year, 4) +\r\n    '-' +\r\n    pad(date.getMonth() + 1, 2) +\r\n    '-' +\r\n    pad(date.getDate(), 2) +\r\n    'T' +\r\n    pad(date.getHours(), 2) +\r\n    ':' +\r\n    pad(date.getMinutes(), 2) +\r\n    ':' +\r\n    pad(date.getSeconds(), 2) +\r\n    '.' +\r\n    pad(date.getMilliseconds(), 3)\r\n\r\n  if (offset < 0) {\r\n    ret += '-'\r\n    offset *= -1\r\n  } else {\r\n    ret += '+'\r\n  }\r\n\r\n  ret += pad(Math.floor(offset / 60), 2) + ':' + pad(offset % 60, 2)\r\n  if (isBCYear) ret += ' BC'\r\n  return ret\r\n}\r\n\r\nfunction dateToStringUTC(date: Date) {\r\n  var year = date.getUTCFullYear()\r\n  var isBCYear = year < 1\r\n  if (isBCYear) year = Math.abs(year) + 1 // negative years are 1 off their BC representation\r\n\r\n  var ret =\r\n    pad(year, 4) +\r\n    '-' +\r\n    pad(date.getUTCMonth() + 1, 2) +\r\n    '-' +\r\n    pad(date.getUTCDate(), 2) +\r\n    'T' +\r\n    pad(date.getUTCHours(), 2) +\r\n    ':' +\r\n    pad(date.getUTCMinutes(), 2) +\r\n    ':' +\r\n    pad(date.getUTCSeconds(), 2) +\r\n    '.' +\r\n    pad(date.getUTCMilliseconds(), 3)\r\n\r\n  ret += '+00:00'\r\n  if (isBCYear) ret += ' BC'\r\n  return ret\r\n}\r\n\r\nexport function normalizeQueryConfig(config: any, values: any, callback: any) {\r\n  // can take in strings or config objects\r\n  config = typeof config === 'string' ? { text: config } : config\r\n  if (values) {\r\n    if (typeof values === 'function') {\r\n      config.callback = values\r\n    } else {\r\n      config.values = values\r\n    }\r\n  }\r\n  if (callback) {\r\n    config.callback = callback\r\n  }\r\n  return config\r\n}\r\n","import { _Transaction } from './interfaces-private';\r\nimport { Map as ImMap, Set as ImSet } from 'immutable';\r\nimport { NotSupported, QueryError } from './interfaces';\r\n\r\nexport class Transaction implements _Transaction {\r\n    private origData: ImMap<symbol, any>;\r\n    private transientData: any = {};\r\n\r\n    static root() {\r\n        return new Transaction(null, ImMap());\r\n    }\r\n\r\n    get isChild() {\r\n        return !!this.parent;\r\n    }\r\n\r\n    private constructor(private parent: Transaction | null, private data: ImMap<symbol, any>) {\r\n        this.origData = data;\r\n    }\r\n\r\n\r\n    clone() {\r\n        return new Transaction(null, this.data);\r\n    }\r\n\r\n    fork(): _Transaction {\r\n        return new Transaction(this, this.data);\r\n    }\r\n\r\n    commit(): _Transaction {\r\n        if (!this.parent) {\r\n            return this;\r\n        }\r\n        if (this.parent.data !== this.origData) {\r\n            throw new NotSupported('Concurrent transactions');\r\n        }\r\n        this.parent.data = this.data;\r\n        return this.parent;\r\n    }\r\n\r\n    delete(identity: symbol): void {\r\n        this.data = this.data.delete(identity);\r\n    }\r\n\r\n    set<T>(identity: symbol, data: T): T {\r\n        this.data = this.data.set(identity, data);\r\n        return data;\r\n    }\r\n\r\n    get<T>(identity: symbol): T {\r\n        return this.data.get(identity);\r\n    }\r\n\r\n    getMap<T extends ImMap<any, any>>(identity: symbol): T {\r\n        let got = this.data.get(identity);\r\n        if (!got) {\r\n            this.data = this.data.set(identity, got = ImMap());\r\n        }\r\n        return got as any as T;\r\n    }\r\n\r\n    getSet<T>(identity: symbol): ImSet<T> {\r\n        let got = this.data.get(identity);\r\n        if (!got) {\r\n            this.data = this.data.set(identity, got = ImSet());\r\n        }\r\n        return got as any;\r\n    }\r\n\r\n    fullCommit() {\r\n        const ret = this.commit();\r\n        return ret.isChild\r\n            ? ret.fullCommit()\r\n            : ret;\r\n    }\r\n\r\n    rollback() {\r\n        return this.parent ?? this;\r\n    }\r\n\r\n    setTransient<T>(identity: symbol, data: T): T {\r\n        this.transientData[identity] = data as any;\r\n        return data;\r\n    }\r\n\r\n    /** Set transient data, which will only exist within the scope of the current statement */\r\n    getTransient<T>(identity: symbol): T {\r\n        return this.transientData[identity] as T;\r\n    }\r\n\r\n    clearTransientData(): void {\r\n        this.transientData = {};\r\n    }\r\n}\r\n","import { IValue, _ISelection, _Transaction, _Explainer, _SelectExplanation, Stats, nil } from '../interfaces-private';\r\nimport { FilterBase } from './transform-base';\r\nimport { LimitStatement } from 'pgsql-ast-parser';\r\nimport { buildValue } from '../parser/expression-builder';\r\nimport { withSelection } from '../parser/context';\r\n\r\nexport function buildLimit(on: _ISelection, limit: LimitStatement) {\r\n    return withSelection(on, () => {\r\n        const l = limit.limit && buildValue(limit.limit);\r\n        const o = limit.offset && buildValue(limit.offset);\r\n        return new LimitFilter(on, l, o);\r\n    });\r\n}\r\n\r\nclass LimitFilter<T = any> extends FilterBase<T> {\r\n\r\n    get index() {\r\n        return null;\r\n    }\r\n\r\n    entropy(t: _Transaction) {\r\n        return this.selection.entropy(t);\r\n    }\r\n\r\n    hasItem(raw: T, t: _Transaction): boolean {\r\n        return this.base.hasItem(raw, t);\r\n    }\r\n\r\n    constructor(private selection: _ISelection<T>, private take: IValue | nil, private skip: IValue | nil) {\r\n        super(selection);\r\n    }\r\n\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return null;\r\n    }\r\n\r\n    *enumerate(t: _Transaction): Iterable<T> {\r\n        let skip = this.skip?.get(null, t) ?? 0;\r\n        let take = this.take?.get(null, t) ?? Number.MAX_SAFE_INTEGER;\r\n        if (take <= 0) {\r\n            return;\r\n        }\r\n        for (const raw of this.selection.enumerate(t)) {\r\n            if (skip > 0) {\r\n                skip--;\r\n                continue;\r\n            }\r\n            yield raw;\r\n            take--;\r\n            if (!take) {\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'limit',\r\n            take: this.take?.explain(e),\r\n            skip: this.skip?.explain(e),\r\n            on: this.selection.explain(e),\r\n        };\r\n    }\r\n}","import { IValue, _ISelection, _Transaction, _Explainer, _SelectExplanation, Stats, _IIndex, _IType, setId, getId } from '../interfaces-private';\r\nimport { DataSourceBase } from './transform-base';\r\nimport { ColumnNotFound, nil, NotSupported, QueryError } from '../interfaces';\r\nimport { columnEvaluator } from './selection';\r\nimport { reconciliateTypes } from '../datatypes/datatypes';\r\nimport { ExprRef } from 'pgsql-ast-parser';\r\nimport { colByName } from '../utils';\r\n\r\n// https://www.postgresql.org/docs/current/typeconv-union-case.html\r\nexport function buildUnion(left: _ISelection, right: _ISelection) {\r\n    if (left.columns.length !== right.columns.length) {\r\n        throw new QueryError('each UNION query must have the same number of columns');\r\n    }\r\n    const cols: UCol[] = Array(left.columns.length);\r\n    for (let i = 0; i < left.columns.length; i++) {\r\n        const l = left.columns[i];\r\n        const r = right.columns[i];\r\n\r\n        const type = reconciliateTypes([l, r], true);\r\n        if (!type) {\r\n            throw new QueryError(`UNION types ${l.type.name} and ${r.type.name} cannot be matched`);\r\n        }\r\n        cols[i] = {\r\n            name: l.id ?? ('column' + i),\r\n            type,\r\n            lval: l.cast(type),\r\n            rval: r.cast(type),\r\n        };\r\n    }\r\n    return new Union(cols, left, right);\r\n}\r\n\r\ninterface UCol {\r\n    name: string;\r\n    type: _IType;\r\n    lval: IValue;\r\n    rval: IValue;\r\n}\r\n\r\nclass Union<T = any> extends DataSourceBase<T> {\r\n\r\n    get isExecutionWithNoResult(): boolean {\r\n        return false;\r\n    }\r\n\r\n    isAggregation() {\r\n        return false;\r\n    }\r\n\r\n    readonly columns: ReadonlyArray<IValue<any>>;\r\n    private readonly colsByName = new Map<string, IValue>();\r\n\r\n    entropy(t: _Transaction) {\r\n        return this.left.entropy(t) + this.right.entropy(t);\r\n    }\r\n\r\n    hasItem(raw: T, t: _Transaction): boolean {\r\n        return this.left.hasItem(raw, t) || this.right.hasItem(raw, t);\r\n    }\r\n\r\n    constructor(private cols: UCol[]\r\n        , private left: _ISelection\r\n        , private right: _ISelection) {\r\n        super(left.ownerSchema);\r\n        this.columns = cols.map(x => columnEvaluator(this, x.name, x.type));\r\n        for (const c of this.columns) {\r\n            this.colsByName.set(c.id!, c);\r\n        }\r\n    }\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return null;\r\n    }\r\n\r\n    *enumerate(t: _Transaction): Iterable<T> {\r\n        for (const raw of this.left.enumerate(t)) {\r\n            const ret = {} as any;\r\n            setId(ret, getId(raw));\r\n            for (const c of this.cols) {\r\n                ret[c.name] = c.lval.get(raw, t);\r\n            }\r\n            yield ret;\r\n        }\r\n        for (const raw of this.right.enumerate(t)) {\r\n            const ret = {} as any;\r\n            setId(ret, getId(raw));\r\n            for (const c of this.cols) {\r\n                ret[c.name] = c.rval.get(raw, t);\r\n            }\r\n            yield ret;\r\n        }\r\n    }\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'union',\r\n            union: [this.left.explain(e),\r\n            this.right.explain(e)],\r\n        };\r\n    }\r\n\r\n    getColumn(column: string | ExprRef): IValue;\r\n    getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue | nil;\r\n    getColumn(column: string | ExprRef, nullIfNotFound?: boolean): IValue<any> | nil {\r\n        return colByName(this.colsByName, column, nullIfNotFound);\r\n    }\r\n\r\n    getIndex(...forValue: IValue<any>[]): _IIndex<any> | null | undefined {\r\n        // todo use indices on unions\r\n        return null;\r\n    }\r\n\r\n    isOriginOf(a: IValue<any>): boolean {\r\n        return a.origin === this || this.left.isOriginOf(a);\r\n    }\r\n}\r\n","import { Expr } from 'pgsql-ast-parser';\r\nimport { buildValue } from '../parser/expression-builder';\r\nimport { IValue, Stats, _Explainer, _ISelection, _SelectExplanation, _Transaction } from '../interfaces-private';\r\nimport { FilterBase } from './transform-base';\r\nimport objectHash from 'object-hash';\r\nimport { withSelection } from '../parser/context';\r\n\r\nexport function buildDistinct(on: _ISelection, exprs?: Expr[]) {\r\n    return withSelection(on, () => {\r\n        const vals = exprs && exprs.length > 0\r\n            ? exprs.map(v => buildValue(v))\r\n            : on.columns\r\n        return new Distinct(on, vals);\r\n    });\r\n}\r\n\r\n\r\n// todo: use indices to optimize this (avoid iterating everything)\r\n\r\nclass Distinct<T> extends FilterBase<any> {\r\n\r\n    get index() {\r\n        return null;\r\n    }\r\n\r\n    entropy(t: _Transaction) {\r\n        // cant foresight how many items will be filtered\r\n        //  => just asumme nothing will be.\r\n        return this.base.entropy(t);\r\n    }\r\n\r\n    hasItem(raw: T, t: _Transaction): boolean {\r\n        return this.base.hasItem(raw, t);\r\n    }\r\n\r\n    constructor(selection: _ISelection, private exprs: ReadonlyArray<IValue>) {\r\n        super(selection);\r\n    }\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return this.base.stats(t);\r\n    }\r\n\r\n    *enumerate(t: _Transaction): Iterable<T> {\r\n        const got = new Set();\r\n        for (const i of this.base.enumerate(t)) {\r\n            const vals = this.exprs.map(v => v.type.hash(v.get(i, t)));\r\n            const hash = vals.length === 1 ? vals[0] : objectHash(vals);\r\n            if (got.has(hash)) {\r\n                continue;\r\n            }\r\n            got.add(hash);\r\n            yield i;\r\n        }\r\n    }\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'distinct',\r\n            of: this.base.explain(e),\r\n        };\r\n    }\r\n}","import { IValue, _ISelection, _Transaction, _Explainer, _SelectExplanation, Stats, _IAggregation } from '../interfaces-private';\r\nimport { FilterBase } from './transform-base';\r\nimport { OrderByStatement, ExprCall } from 'pgsql-ast-parser';\r\nimport { buildValue } from '../parser/expression-builder';\r\nimport { nullIsh } from '../utils';\r\nimport { withSelection } from '../parser/context';\r\n\r\nexport function buildOrderBy(on: _ISelection, order: OrderByStatement[]) {\r\n    return new OrderBy(on, order);\r\n}\r\n\r\nclass OrderBy<T> extends FilterBase<any> implements _IAggregation {\r\n    order: {\r\n        by: IValue<any>;\r\n        order: 'ASC' | 'DESC';\r\n        nullsLast: boolean;\r\n    }[];\r\n\r\n    get index() {\r\n        return null;\r\n    }\r\n\r\n    isAggregation() {\r\n        return this.selection.isAggregation();\r\n    }\r\n\r\n    getAggregation(name: string, call: ExprCall): IValue {\r\n        return this.asAggreg.getAggregation(name, call);\r\n    }\r\n\r\n    checkIfIsKey(got: IValue<any>): IValue<any> {\r\n        return this.asAggreg.checkIfIsKey(got);\r\n    }\r\n\r\n    private get asAggreg(): _IAggregation {\r\n\r\n        if (!this.selection.isAggregation()) {\r\n            throw new Error('Not an aggregation');\r\n        }\r\n        return this.selection;\r\n    }\r\n\r\n    entropy(t: _Transaction) {\r\n        const ret = this.selection.entropy(t);\r\n        // sort algorithm is n*log(n)\r\n        return ret * Math.log(ret + 1);\r\n    }\r\n\r\n    hasItem(raw: T, t: _Transaction): boolean {\r\n        return this.base.hasItem(raw, t);\r\n    }\r\n\r\n    constructor(private selection: _ISelection<T>, order: OrderByStatement[]) {\r\n        super(selection);\r\n        this.order = withSelection(selection,\r\n            () => order.map(x => ({\r\n                by: buildValue(x.by),\r\n                order: x.order ?? 'ASC',\r\n                nullsLast: x.nulls === 'LAST',\r\n            })));\r\n    }\r\n\r\n\r\n    stats(t: _Transaction): Stats | null {\r\n        return this.base.stats(t);\r\n    }\r\n\r\n\r\n    getIndex(...forValue: IValue<any>[]) {\r\n        // same index as underlying selection, given that ordering does not modify indices.\r\n        return this.base.getIndex(...forValue);\r\n    }\r\n\r\n    enumerate(t: _Transaction): Iterable<T> {\r\n        const all = [...this.base.enumerate(t)];\r\n        all.sort((a, b) => {\r\n            for (const o of this.order) {\r\n                const aval = o.by.get(a, t);\r\n                const bval = o.by.get(b, t);\r\n                const na = nullIsh(aval);\r\n                const nb = nullIsh(bval);\r\n                if (na && nb) {\r\n                    continue;\r\n                }\r\n                if (na || nb) {\r\n                    return (o.order === 'ASC') === (nb === o.nullsLast) ? 1 : -1;\r\n                }\r\n                if (o.by.type.equals(aval, bval)) {\r\n                    continue;\r\n                }\r\n                if (o.by.type.gt(aval, bval)) {\r\n                    return o.order === 'ASC' ? 1 : -1;\r\n                }\r\n                return o.order === 'ASC' ? -1 : 1;\r\n            }\r\n            return 0;\r\n        });\r\n        return all;\r\n    }\r\n\r\n    explain(e: _Explainer): _SelectExplanation {\r\n        return {\r\n            id: e.idFor(this),\r\n            _: 'orderBy',\r\n            of: this.selection.explain(e),\r\n        };\r\n    }\r\n}","import { Types } from '../../datatypes';\r\nimport { DataType, FunctionDefinition, _IDb, _ISchema } from '../../interfaces-private';\r\nimport { PgAttributeTable } from './pg-attribute-list';\r\nimport { PgClassListTable } from './pg-class';\r\nimport { PgConstraintTable } from './pg-constraints-list';\r\nimport { PgIndexTable } from './pg-index-list';\r\nimport { PgNamespaceTable } from './pg-namespace-list';\r\nimport { PgTypeTable } from './pg-type-list';\r\nimport { allFunctions } from '../../functions';\r\nimport { PgRange } from './pg-range';\r\nimport { sqlSubstring } from '../../parser/expression-builder';\r\nimport { PgDatabaseTable } from './pg-database';\r\nimport { registerCommonOperators } from './binary-operators';\r\nimport { registerSqlFunctionLanguage } from './sql-function-language';\r\n\r\n\r\nexport function setupPgCatalog(db: _IDb) {\r\n    const catalog: _ISchema = db.createSchema('pg_catalog');\r\n\r\n    catalog._registerType(Types.bool)\r\n        ._registerType(Types.citext)\r\n        ._registerTypeSizeable(DataType.timestamp, Types.timestamp)\r\n        ._registerTypeSizeable(DataType.timestamptz, Types.timestamptz)\r\n        ._registerType(Types.uuid)\r\n        ._registerType(Types.date)\r\n        ._registerType(Types.time)\r\n        ._registerType(Types.timetz)\r\n        ._registerType(Types.jsonb)\r\n        ._registerType(Types.regtype)\r\n        ._registerType(Types.regclass)\r\n        ._registerType(Types.json)\r\n        ._registerType(Types.null)\r\n        ._registerType(Types.float)\r\n        ._registerType(Types.integer)\r\n        ._registerType(Types.bigint)\r\n        ._registerType(Types.bytea)\r\n        ._registerType(Types.point)\r\n        ._registerType(Types.line)\r\n        ._registerType(Types.lseg)\r\n        ._registerType(Types.box)\r\n        ._registerType(Types.path)\r\n        ._registerType(Types.polygon)\r\n        ._registerType(Types.circle)\r\n        ._registerType(Types.interval)\r\n        ._registerType(Types.inet)\r\n        ._registerType(Types.record([])) // hack to support functions with record input (see row_to_json UT)\r\n        ._registerTypeSizeable(DataType.text, Types.text)\r\n\r\n    new PgConstraintTable(catalog).register();\r\n    new PgClassListTable(catalog).register();\r\n    new PgNamespaceTable(catalog).register();\r\n    new PgAttributeTable(catalog).register();\r\n    new PgIndexTable(catalog).register();\r\n    new PgTypeTable(catalog).register();\r\n    new PgRange(catalog).register();\r\n    new PgDatabaseTable(catalog).register();\r\n\r\n\r\n    // this is an ugly hack...\r\n    const tbl = catalog.declareTable({\r\n        name: 'current_schema',\r\n        fields: [\r\n            { name: 'current_schema', type: Types.text() },\r\n        ]\r\n    }, true);\r\n    tbl.insert({ current_schema: 'public' });\r\n    tbl.setHidden().setReadonly();\r\n\r\n    addFns(catalog, allFunctions);\r\n\r\n    catalog.registerFunction({\r\n        name: 'set_config',\r\n        args: [Types.text(), Types.text(), Types.bool],\r\n        returns: Types.text(),\r\n        impure: true,\r\n        implementation: (cfg: string, val: string, is_local: boolean) => {\r\n            // todo - implement this... used to override search_path in dumps.\r\n            //       => have a dynamic search_path.\r\n            //       => not trivial du to the \"is_local\" arg\r\n            //  https://www.postgresql.org/docs/9.3/functions-admin.html\r\n            return val;\r\n        }\r\n    });\r\n\r\n    catalog.registerFunction({\r\n        name: 'substring',\r\n        args: [Types.text(), Types.integer],\r\n        returns: Types.text(),\r\n        implementation: sqlSubstring,\r\n    })\r\n\r\n    catalog.registerFunction({\r\n        name: 'substring',\r\n        args: [Types.text(), Types.integer, Types.integer],\r\n        returns: Types.text(),\r\n        implementation: sqlSubstring,\r\n    });\r\n\r\n    catalog.registerFunction({\r\n        // required for Sequelize introspection\r\n        name: 'pg_get_indexdef',\r\n        args: [Types.integer],\r\n        returns: Types.text(),\r\n        implementation: (indexId: number) => {\r\n            throw new Error('This stub implementation of \"pg_get_indexdef\" should not be called');\r\n        },\r\n    })\r\n\r\n\r\n    db.getSchema('pg_catalog').registerFunction({\r\n        name: 'col_description',\r\n        args: [DataType.integer, DataType.integer],\r\n        returns: DataType.text,\r\n        implementation: x => 'Fake description provided by pg-mem',\r\n    });\r\n\r\n    registerCommonOperators(catalog);\r\n\r\n\r\n    registerSqlFunctionLanguage(db);\r\n\r\n    catalog.setReadonly()\r\n}\r\n\r\nfunction addFns(catalog: _ISchema, fns: FunctionDefinition[]) {\r\n    for (const f of fns) {\r\n        catalog.registerFunction(f);\r\n    }\r\n}","import { _ITable, _ISelection, IValue, _IIndex, _IDb, IndexKey, setId, _ISchema } from '../../interfaces-private';\r\nimport { nil, Schema } from '../../interfaces';\r\nimport { Types } from '../../datatypes';\r\nimport { ReadOnlyTable } from '../readonly-table';\r\n\r\nexport class PgAttributeTable extends ReadOnlyTable implements _ITable {\r\n\r\n    _schema: Schema = {\r\n        name: 'pg_attribute',\r\n        fields: [\r\n            { name: 'attrelid', type: Types.integer } // oid\r\n            , { name: 'attname', type: Types.text() }\r\n            , { name: 'atttypid', type: Types.integer } // oid\r\n            , { name: 'attstattarget', type: Types.integer }\r\n            , { name: 'attlen', type: Types.integer }\r\n            , { name: 'attnum', type: Types.integer }\r\n            , { name: 'attndims', type: Types.integer }\r\n            , { name: 'attcacheoff', type: Types.integer }\r\n            , { name: 'atttypmod', type: Types.integer }\r\n            , { name: 'attbyval', type: Types.bool }\r\n            , { name: 'attstorage', type: Types.text(1) } // char(1)\r\n            , { name: 'attalign', type: Types.text(1) } // char(1)\r\n            , { name: 'attnotnull', type: Types.bool }\r\n            , { name: 'atthasdef', type: Types.bool }\r\n            , { name: 'atthasmissing', type: Types.bool }\r\n            , { name: 'attidntity', type: Types.text(1) } // char(1)\r\n            , { name: 'attisdropped', type: Types.bool }\r\n            , { name: 'attislocal', type: Types.bool }\r\n            , { name: 'attinhcount', type: Types.integer }\r\n            , { name: 'attcollation', type: Types.integer } // oid\r\n            , { name: 'attacl', type: Types.jsonb } // aclitem[]\r\n            , { name: 'attoptions', type: Types.text().asArray() }\r\n            , { name: 'attfdwoptions', type: Types.text().asArray() }\r\n            , { name: 'attmissingval', type: Types.jsonb }// anyarray\r\n        ]\r\n    };\r\n\r\n\r\n    entropy(): number {\r\n        return 0;\r\n    }\r\n\r\n    *enumerate() {\r\n    }\r\n\r\n    hasItem(value: any): boolean {\r\n        return false;\r\n    }\r\n\r\n    getIndex(forValue: IValue<any>): _IIndex<any> | nil {\r\n        return null;\r\n    }\r\n\r\n}\r\n","import { _ITable, _ISelection, _IIndex, _IDb, _ISchema, _Transaction } from '../../interfaces-private';\r\nimport { Schema } from '../../interfaces';\r\nimport { Types } from '../../datatypes';\r\nimport { ReadOnlyTable } from '../readonly-table';\r\n\r\n// https://www.postgresql.org/docs/12/catalog-pg-class.html\r\n\r\nconst IS_SCHEMA = Symbol('_is_pg_classlist');\r\nexport class PgClassListTable extends ReadOnlyTable implements _ITable {\r\n\r\n    get ownSymbol() {\r\n        return IS_SCHEMA;\r\n    }\r\n\r\n\r\n    _schema: Schema = {\r\n        name: 'pg_class',\r\n        fields: [\r\n            { name: 'oid', type: Types.integer } // hidden oid column\r\n            , { name: 'relname', type: Types.text() }\r\n            , { name: 'relnamespace', type: Types.integer } // oid\r\n            , { name: 'reltype', type: Types.integer } // oid\r\n            , { name: 'reloftype', type: Types.integer } // oid\r\n            , { name: 'relowner', type: Types.integer } // oid\r\n            , { name: 'relam', type: Types.integer } // oid\r\n            , { name: 'relfilenode', type: Types.integer } // oid\r\n            , { name: 'reltablespace', type: Types.integer } // oid\r\n            , { name: 'relpages', type: Types.integer }\r\n            , { name: 'reltyples', type: Types.integer }\r\n            , { name: 'relallvisible', type: Types.integer }\r\n            , { name: 'reltoastrelid', type: Types.integer }\r\n            , { name: 'relhashindex', type: Types.bool }\r\n            , { name: 'relisshared', type: Types.bool }\r\n            , { name: 'relpersistence', type: Types.text(1) } // char(1)\r\n            , { name: 'relkind', type: Types.text(1) } // char(1)\r\n            , { name: 'relnatts', type: Types.integer }\r\n            , { name: 'relchecks', type: Types.integer }\r\n            , { name: 'relhasoids', type: Types.bool }\r\n            , { name: 'relhasrules', type: Types.bool }\r\n            , { name: 'relhastriggers', type: Types.bool }\r\n            , { name: 'relhassubclass', type: Types.bool }\r\n            , { name: 'relrowsecurity', type: Types.bool }\r\n            , { name: 'relforcerowsecurity', type: Types.bool }\r\n            , { name: 'relispopulated', type: Types.bool }\r\n            , { name: 'relreplident', type: Types.text(1) } // char(1)\r\n            , { name: 'relispartition', type: Types.bool }\r\n            , { name: 'relrewrite', type: Types.integer } // oid\r\n            , { name: 'relfrozenxid', type: Types.integer } // xid\r\n            , { name: 'relminmxid', type: Types.integer } // xid\r\n            , { name: 'relacl', type: Types.text() } // alitem[]\r\n            , { name: 'reloptions', type: Types.text().asArray() } // text[]\r\n            , { name: 'relpartbound', type: Types.jsonb } // pg_nod_tr\r\n        ]\r\n    };\r\n\r\n    // private indexes: { [key: string]: _IIndex } = {\r\n    //     'oid': new CustomIndex(this, {\r\n    //         get size() {\r\n    //             return this.size\r\n    //         },\r\n    //         column: this.selection.getColumn('oid'),\r\n    //         byColumnValue: (oid: string, t: _Transaction) => {\r\n    //             return [this.byOid(oid, t)]\r\n    //         }\r\n    //     }),\r\n    //     'relname': new CustomIndex(this, {\r\n    //         get size() {\r\n    //             return this.size\r\n    //         },\r\n    //         column: this.selection.getColumn('relname'),\r\n    //         byColumnValue: (oid: string, t: _Transaction) => {\r\n    //             return [this.byRelName(oid, t)];\r\n    //         }\r\n    //     }),\r\n    // }\r\n\r\n\r\n\r\n    // private byOid(oid: string, t: _Transaction) {\r\n    //     const { type, id } = parseOid(oid);\r\n    //     switch (type) {\r\n    //         case 'table':\r\n    //             return this.makeTable(this.schema.getTable(id, true)!);\r\n    //         case 'index':\r\n    //             return null;\r\n    //         // return this.makeTable(this.db.getIndex(id, true));\r\n    //         default:\r\n    //             throw NotSupported.never(type);\r\n    //     }\r\n    // }\r\n\r\n    // private byRelName(name: string, t: _Transaction) {\r\n    //     return this.schema.getTable(name, true);\r\n    //     // ?? this.db.getIndex(name, true);\r\n    // }\r\n\r\n    entropy(t: _Transaction): number {\r\n        return 0;\r\n    }\r\n\r\n    *enumerate() {\r\n        // for (const t of this.db.listTables()) {\r\n        //     yield this.makeTable(t);\r\n        // }\r\n    }\r\n\r\n\r\n    makeInedx(t: _IIndex<any>): any {\r\n        if (!t) {\r\n            return null;\r\n        }\r\n        // relkind , i = index, S = sequence, t = TOAST table, v = view, m = materialized view, c = composite type, f = foreign table, p = partitioned table, I = partitioned index\r\n        throw new Error('todo');\r\n    }\r\n    makeTable(t: _ITable<any>): any {\r\n        if (!t) {\r\n            return null;\r\n        }\r\n        throw new Error('todo');\r\n        // const ret = {\r\n        //     relname: t.name,\r\n        //     relnamespace: t instanceof MemoryTable\r\n        //         ? MAIN_NAMESPACE\r\n        //         : SCHEMA_NAMESPACE,\r\n        //     relkind: 'r', //  r = ordinary table\r\n        //     [IS_SCHEMA]: true,\r\n        // };\r\n        // return setId(ret, '/schema/pg_class/table/' + t.name);\r\n    }\r\n\r\n    hasItem(value: any): boolean {\r\n        return !!value?.[IS_SCHEMA];\r\n    }\r\n\r\n}\r\n","import { _ITable, _ISelection, IValue, _IIndex, _IDb, IndexKey, setId, _ISchema, _Transaction } from '../../interfaces-private';\r\nimport { nil, Schema } from '../../interfaces';\r\nimport { Types } from '../../datatypes';\r\nimport { TableIndex } from '../table-index';\r\nimport { ReadOnlyTable } from '../readonly-table';\r\n\r\nconst IS_SCHEMA = Symbol('_is_pgconstraint');\r\nexport class PgConstraintTable extends ReadOnlyTable implements _ITable {\r\n\r\n    get ownSymbol() {\r\n        return IS_SCHEMA;\r\n    }\r\n\r\n    _schema: Schema = {\r\n        name: 'pg_constraint',\r\n        fields: [\r\n            { name: 'oid', type: Types.integer } // hidden oid column\r\n            , { name: 'conname', type: Types.text() } // <== 'name' type\r\n            , { name: 'connamespace', type: Types.integer } // <== 'oid' type\r\n            , { name: 'contype', type: Types.text(1) } // <== 'char(1)' type\r\n            , { name: 'condeferrable', type: Types.bool }\r\n            , { name: 'condeferred', type: Types.bool }\r\n            , { name: 'convalidated', type: Types.bool }\r\n            , { name: 'conrelid', type: Types.integer } // <== oid\r\n            , { name: 'contypid', type: Types.integer } // <== oid\r\n            , { name: 'conindid', type: Types.integer } // <== oid\r\n            , { name: 'conparentid', type: Types.integer } // <== oid\r\n            , { name: 'confrelid', type: Types.integer } // <== oid\r\n            , { name: 'confupdtype', type: Types.text(1) } // <== 'char(1)' type\r\n            , { name: 'confdeltype', type: Types.text(1) } // <== 'char(1)' type\r\n            , { name: 'confmatchtype', type: Types.text(1) } // <== 'char(1)' type\r\n            , { name: 'conislocal', type: Types.bool }\r\n            , { name: 'coninhcount', type: Types.integer }\r\n            , { name: 'connoinherit', type: Types.bool }\r\n            , { name: 'conkey', type: Types.integer.asArray() }\r\n            , { name: 'confkey', type: Types.integer.asArray() }\r\n            , { name: 'conpfeqop', type: Types.integer.asArray() } // <== oid[]\r\n            , { name: 'conppeqop', type: Types.integer.asArray() } // <== oid[]\r\n            , { name: 'conffeqop', type: Types.integer.asArray() } // <== oid[]\r\n            , { name: 'conexclop', type: Types.integer.asArray() } // <== oid[]\r\n            , { name: 'conbin', type: Types.text() } // <== weird type\r\n            , { name: 'consrc', type: Types.text() }\r\n        ]\r\n    };\r\n\r\n\r\n    entropy(t: _Transaction): number {\r\n        return this.db.listSchemas()\r\n            .reduce((tot, s) => tot + s.tablesCount(t) * 10 * 3, 0);\r\n    }\r\n\r\n    *enumerate(t: _Transaction) {\r\n        for (const schema of this.db.listSchemas()) {\r\n            for (const it of schema.listTables(t)) {\r\n                yield* this.itemsByTable(it, t);\r\n            }\r\n        }\r\n    }\r\n\r\n    make(table: _ITable, i: number, t: IValue<any>): any {\r\n        if (!t) {\r\n            return null;\r\n        }\r\n        let ret = {};\r\n        for (const { name } of this._schema.fields) {\r\n            (ret as any)[name] = null;\r\n        }\r\n\r\n        ret = {\r\n            ...ret,\r\n            // table_catalog: 'pgmem',\r\n\r\n            [IS_SCHEMA]: true,\r\n        };\r\n        setId(ret, `/schema/${table.ownerSchema.name}/pg_constraint/${table.name}/${i}`);\r\n        return ret;\r\n    }\r\n\r\n    hasItem(value: any): boolean {\r\n        return !!value?.[IS_SCHEMA];\r\n    }\r\n\r\n    getIndex(forValue: IValue<any>): _IIndex<any> | nil {\r\n        if (forValue.id === 'table_name') {\r\n            return new TableIndex(this, forValue);\r\n        }\r\n        return null;\r\n    }\r\n\r\n}\r\n","import { _ITable, _ISelection, IValue, _IIndex, _IDb, IndexKey, setId, _ISchema } from '../../interfaces-private';\r\nimport { Schema } from '../../interfaces';\r\nimport { Types } from '../../datatypes';\r\nimport { ReadOnlyTable } from '../readonly-table';\r\n\r\nexport class PgIndexTable extends ReadOnlyTable implements _ITable {\r\n\r\n    _schema: Schema = {\r\n        name: 'pg_index',\r\n        fields: [\r\n            { name: 'indexrelid', type: Types.integer } // oid\r\n            , { name: 'indrelid', type: Types.integer } // oid\r\n            , { name: 'indnatts', type: Types.integer }\r\n            , { name: 'indnkyatts', type: Types.integer }\r\n            , { name: 'indisunique', type: Types.bool }\r\n            , { name: 'indisprimary', type: Types.bool }\r\n            , { name: 'indisxclusion', type: Types.bool }\r\n            , { name: 'indimmediate', type: Types.bool }\r\n            , { name: 'indisclustered', type: Types.bool }\r\n            , { name: 'indisvalid', type: Types.bool }\r\n            , { name: 'indcheckxmin', type: Types.bool }\r\n            , { name: 'indisready', type: Types.bool }\r\n            , { name: 'indisliv', type: Types.bool }\r\n            , { name: 'indisreplident', type: Types.bool }\r\n            , { name: 'indkey', type: Types.integer.asArray() } // int2vector\r\n            , { name: 'indcollation', type: Types.integer.asArray() } // oidvector\r\n            , { name: 'indclass', type: Types.integer.asArray() } // oidvector\r\n            , { name: 'indoption', type: Types.integer.asArray() } // int2vector\r\n            , { name: 'indeexprs', type: Types.jsonb } // pg_node_tree\r\n            , { name: 'indpred', type: Types.jsonb } // pg_node_tree\r\n        ]\r\n    };\r\n\r\n    entropy(): number {\r\n        return 0;\r\n    }\r\n\r\n    *enumerate() {\r\n    }\r\n\r\n\r\n\r\n    hasItem(value: any): boolean {\r\n        return false;\r\n    }\r\n\r\n}\r\n","import { _ITable, _ISelection, IValue, _IIndex, _IDb, IndexKey, setId, _ISchema } from '../../interfaces-private';\r\nimport { Schema } from '../../interfaces';\r\nimport { Types } from '../../datatypes';\r\nimport { ReadOnlyTable } from '../readonly-table';\r\n\r\nexport class PgNamespaceTable extends ReadOnlyTable implements _ITable {\r\n\r\n    _schema: Schema = {\r\n        name: 'pg_namespace',\r\n        fields: [\r\n            { name: 'oid', type: Types.integer } // hidden oid column\r\n            , { name: 'nspname', type: Types.text() }\r\n            , { name: 'nspowner', type: Types.integer } // oid\r\n            , { name: 'nspacl', type: Types.jsonb } // aclitem[]\r\n        ]\r\n    };\r\n\r\n\r\n    entropy(): number {\r\n        return 0;\r\n    }\r\n\r\n    *enumerate() {\r\n\r\n        // yield {\r\n        //     oid: MAIN_NAMESPACE,\r\n        //     nspname: 'public',\r\n        //     nspowner: null,\r\n        //     nspacl: null,\r\n        // };\r\n        // yield {\r\n        //     oid: MAIN_NAMESPACE,\r\n        //     nspname: 'public',\r\n        //     nspowner: null,\r\n        //     nspacl: null,\r\n        // };\r\n    }\r\n\r\n\r\n\r\n    hasItem(value: any): boolean {\r\n        return false;\r\n    }\r\n}\r\n","import { _ITable, _ISelection, IValue, _IIndex, _IDb, IndexKey, setId, _ISchema } from '../../interfaces-private';\r\nimport { Schema } from '../../interfaces';\r\nimport { Types } from '../../datatypes';\r\nimport { ReadOnlyTable } from '../readonly-table';\r\n\r\nexport class PgTypeTable extends ReadOnlyTable implements _ITable {\r\n\r\n\r\n    _schema: Schema = {\r\n        name: 'pg_type',\r\n        fields: [\r\n            { name: 'oid', type: Types.integer } // hiddn oid column\r\n            , { name: 'typname', type: Types.text() }\r\n            , { name: 'typnamespace', type: Types.integer } // oid\r\n            , { name: 'typowner', type: Types.integer } // oid\r\n            , { name: 'typlen', type: Types.integer }\r\n            , { name: 'typbyval', type: Types.bool }\r\n            , { name: 'typtype', type: Types.text(1) } // char(1)\r\n            , { name: 'typispreferred', type: Types.bool }\r\n            , { name: 'typisdefined', type: Types.bool }\r\n            , { name: 'typdlim', type: Types.text(1) } // char(1)\r\n            , { name: 'typrelid', type: Types.integer } // oid\r\n            , { name: 'typelem', type: Types.integer } // oid\r\n            , { name: 'typarray', type: Types.integer } // oid\r\n            , { name: 'typinput', type: Types.text() } // regproc\r\n            , { name: 'typoutput', type: Types.text() } // regproc\r\n            , { name: 'typreceive', type: Types.text() } // regproc\r\n            , { name: 'typsend', type: Types.text() } // regproc\r\n            , { name: 'typmodin', type: Types.text() } // regproc\r\n            , { name: 'typmodout', type: Types.text() } // regproc\r\n            , { name: 'typanalyze', type: Types.text() } // regproc\r\n            , { name: 'typalign', type: Types.text(1) } // char(1)\r\n            , { name: 'typstorage', type: Types.text(1) } // char(1)\r\n            , { name: 'typnotnull', type: Types.bool }\r\n            , { name: 'typbasetype', type: Types.integer } //oid\r\n            , { name: 'typtypmod', type: Types.integer }\r\n            , { name: 'typndims', type: Types.integer }\r\n            , { name: 'typcollation', type: Types.integer } // oid\r\n            , { name: 'typdfaultbin', type: Types.text() } // pg_nod_tree\r\n            , { name: 'typdefault', type: Types.text() }\r\n            , { name: 'typacl', type: Types.jsonb }\r\n        ]\r\n    };\r\n\r\n\r\n    entropy(): number {\r\n        return 0;\r\n    }\r\n\r\n    *enumerate() {\r\n    }\r\n\r\n\r\n\r\n    hasItem(value: any): boolean {\r\n        return false;\r\n    }\r\n\r\n}\r\n","import { stringFunctions } from './string';\r\nimport { dateFunctions } from './date';\r\nimport { systemFunctions } from './system';\r\nimport { sequenceFunctions } from './sequence-fns';\r\n\r\n\r\nexport const allFunctions = [\r\n    ...stringFunctions\r\n    , ... dateFunctions\r\n    , ... systemFunctions\r\n    , ... sequenceFunctions\r\n]","import { DataType, FunctionDefinition } from '../interfaces-private';\r\n\r\nexport const stringFunctions: FunctionDefinition[] = [\r\n    {\r\n        name: 'lower',\r\n        args: [DataType.text],\r\n        returns: DataType.text,\r\n        implementation: (x: string) => x?.toLowerCase(),\r\n    },\r\n    {\r\n        name: 'upper',\r\n        args: [DataType.text],\r\n        returns: DataType.text,\r\n        implementation: (x: string) => x?.toUpperCase(),\r\n    },\r\n    {\r\n        name: 'concat',\r\n        args: [DataType.text],\r\n        argsVariadic: DataType.text,\r\n        returns: DataType.text,\r\n        allowNullArguments: true,\r\n        implementation: (...x: string[]) => x?.join(''),\r\n    },\r\n]","import { FunctionDefinition } from '../interfaces';\r\nimport moment from 'moment';\r\nimport { DataType, QueryError } from '../interfaces-private';\r\nimport { nullIsh } from '../utils';\r\n\r\n\r\nexport const dateFunctions: FunctionDefinition[] = [\r\n    {\r\n        name: 'to_date',\r\n        args: [DataType.text, DataType.text],\r\n        returns: DataType.date,\r\n        implementation: (data, format) => {\r\n            if (nullIsh(data) || nullIsh(format)) {\r\n                return null; // if one argument is null => null\r\n            }\r\n            const ret = moment.utc(data, format);\r\n            if (!ret.isValid()) {\r\n                throw new QueryError(`The text '${data}' does not match the date format ${format}`);\r\n            }\r\n            return ret.toDate();\r\n        }\r\n    },\r\n    {\r\n        name: 'now',\r\n        returns: DataType.timestamptz,\r\n        impure: true,\r\n        implementation: () => new Date(),\r\n    },\r\n];","import { Types } from '../datatypes';\r\nimport { FunctionDefinition } from '../interfaces';\r\n\r\nexport const systemFunctions: FunctionDefinition[] = [\r\n    {\r\n        // ugly hack...\r\n        name: 'current_schema',\r\n        returns: Types.text(),\r\n        implementation: () => 'public',\r\n    },\r\n]\r\n","import { executionCtx } from '../utils';\r\nimport { Types } from '../datatypes';\r\nimport { FunctionDefinition, QueryError } from '../interfaces';\r\nimport { asSeq, RegClass, _ISequence } from '../interfaces-private';\r\n\r\n// https://www.postgresql.org/docs/8.1/functions-sequence.html\r\n\r\nfunction getSeq(id: RegClass) {\r\n    const { transaction, schema } = executionCtx();\r\n    if (!transaction) {\r\n        throw new QueryError('cannot query sequence value in this context');\r\n    }\r\n    return {\r\n        t: transaction,\r\n        seq: asSeq(schema.getObjectByRegOrName(id)),\r\n    };\r\n}\r\nconst lastVal = Symbol();\r\nexport const sequenceFunctions: FunctionDefinition[] = [\r\n\r\n    {\r\n        name: 'nextval',\r\n        args: [Types.regclass],\r\n        returns: Types.integer,\r\n        implementation: (seqId: RegClass) => {\r\n            const { seq, t } = getSeq(seqId);\r\n            const ret = seq.nextValue(t);\r\n            t.set(lastVal, ret);\r\n            return ret;\r\n        },\r\n        impure: true,\r\n    },\r\n    {\r\n        name: 'currval',\r\n        args: [Types.regclass],\r\n        returns: Types.integer,\r\n        implementation: (seqId: RegClass) => {\r\n            const { seq, t } = getSeq(seqId);\r\n            return seq.currentValue(t);\r\n        },\r\n        impure: true,\r\n    },\r\n    {\r\n        name: 'lastval',\r\n        returns: Types.integer,\r\n        implementation: (seqId: RegClass) => {\r\n            const { transaction } = executionCtx();\r\n            if (!transaction) {\r\n                throw new QueryError('cannot query lastval in this context');\r\n            }\r\n            return transaction.get<number>(lastVal);\r\n        },\r\n        impure: true,\r\n    },\r\n    {\r\n        name: 'setval',\r\n        args: [Types.regclass, Types.integer],\r\n        returns: Types.integer,\r\n        implementation: (seqId: RegClass, val: number) => {\r\n            const { seq, t } = getSeq(seqId);\r\n            if (typeof val !== 'number') {\r\n                throw new QueryError('Invalid setval() value');\r\n            }\r\n            seq.setValue(t, val);\r\n            return val;\r\n        },\r\n        impure: true,\r\n    },\r\n]\r\n","import { _ITable, _ISelection, IValue, _IIndex, _IDb, IndexKey, setId, _ISchema } from '../../interfaces-private';\r\nimport { Schema } from '../../interfaces';\r\nimport { Types } from '../../datatypes';\r\nimport { ReadOnlyTable } from '../readonly-table';\r\n\r\n// https://www.postgresql.org/docs/13/catalog-pg-range.html\r\nexport class PgRange extends ReadOnlyTable implements _ITable {\r\n\r\n\r\n    _schema: Schema = {\r\n        name: 'pg_range',\r\n        fields: [\r\n            { name: 'rngtypid', type: Types.integer } // oid\r\n            , { name: 'rngsubtype', type: Types.integer } // oid\r\n            , { name: 'rngcollation', type: Types.integer } // oid\r\n            , { name: 'rngsubopc', type: Types.integer } // oid\r\n            , { name: 'rngcanonical', type: Types.integer } // oid\r\n            , { name: 'rngsubdiff', type: Types.integer } // oid\r\n        ]\r\n    };\r\n\r\n\r\n    entropy(): number {\r\n        return 0;\r\n    }\r\n\r\n    *enumerate() {\r\n    }\r\n\r\n\r\n\r\n    hasItem(value: any): boolean {\r\n        return false;\r\n    }\r\n\r\n}\r\n","import { _ITable, _ISelection, _IIndex, _IDb, _ISchema, _Transaction, setId } from '../../interfaces-private';\r\nimport { Schema } from '../../interfaces';\r\nimport { Types } from '../../datatypes';\r\nimport { ReadOnlyTable } from '../readonly-table';\r\n\r\n// https://www.postgresql.org/docs/12/catalog-pg-class.html\r\n\r\nconst IS_SCHEMA = Symbol('_is_pg_database');\r\nexport class PgDatabaseTable extends ReadOnlyTable implements _ITable {\r\n\r\n    get ownSymbol() {\r\n        return IS_SCHEMA;\r\n    }\r\n\r\n\r\n    _schema: Schema = {\r\n        name: 'pg_database',\r\n        fields: [\r\n            { name: 'oid', type: Types.integer } // hidden oid column\r\n            , { name: 'datname', type: Types.text() }\r\n            , { name: 'datdba', type: Types.integer }\r\n            , { name: 'encoding', type: Types.integer }\r\n            , { name: 'datcollate', type: Types.text() }\r\n            , { name: 'datctype', type: Types.text() }\r\n            , { name: 'datistemplate', type: Types.bool }\r\n            , { name: 'datlowconn', type: Types.bool }\r\n            , { name: 'datconlimit', type: Types.integer }\r\n            , { name: 'datlastsysoid', type: Types.integer }\r\n            , { name: 'datfrozenxid', type: Types.integer }\r\n            , { name: 'datminmxid', type: Types.integer }\r\n            , { name: 'dattablespace', type: Types.integer }\r\n            , { name: 'datacl', type: Types.jsonb }\r\n        ]\r\n    };\r\n\r\n    entropy(t: _Transaction): number {\r\n        return this.db.listSchemas().length;\r\n    }\r\n\r\n    *enumerate() {\r\n        // this is , whaterver...\r\n        let i = 48593;\r\n        for (const t of this.db.listSchemas()) {\r\n            const ret = {\r\n                oid: ++i,\r\n                datname: t.name,\r\n                [IS_SCHEMA]: true,\r\n            };\r\n            yield setId(ret, '/schema/pg_database/' + t.name);\r\n        }\r\n    }\r\n\r\n\r\n    hasItem(value: any): boolean {\r\n        return !!value?.[IS_SCHEMA];\r\n    }\r\n}\r\n","import { _ISchema, QueryError } from '../../interfaces-private';\r\nimport { numbers, isInteger, dateTypes, Types, numberPriorities } from '../../datatypes';\r\nimport { intervalToSec, queryJson } from '../../utils';\r\nimport moment from 'moment';\r\n\r\nexport function registerCommonOperators(schema: _ISchema) {\r\n    registerNumericOperators(schema);\r\n    registerDatetimeOperators(schema);\r\n    registerJsonOperators(schema);\r\n    registerTextOperators(schema);\r\n}\r\n\r\nfunction* numberPairs() {\r\n    for (const a of numbers) {\r\n        for (const b of numbers) {\r\n            yield [a, b, numberPriorities[a] < numberPriorities[b] ? b : a] as const;\r\n        }\r\n    }\r\n}\r\n\r\nfunction registerNumericOperators(schema: _ISchema) {\r\n    // ======= \"+ - * /\" on numeric types =======\r\n    for (const [left, right, returns] of numberPairs()) {\r\n        schema.registerOperator({\r\n            operator: '+',\r\n            commutative: true,\r\n            left,\r\n            right,\r\n            returns,\r\n            implementation: (a, b) => a + b,\r\n        });\r\n    }\r\n    for (const [left, right, returns] of numberPairs()) {\r\n        schema.registerOperator({\r\n            operator: '-',\r\n            commutative: true,\r\n            left,\r\n            right,\r\n            returns,\r\n            implementation: (a, b) => a - b,\r\n        });\r\n    }\r\n\r\n    for (const [left, right, returns] of numberPairs()) {\r\n        schema.registerOperator({\r\n            operator: '*',\r\n            commutative: true,\r\n            left,\r\n            right,\r\n            returns,\r\n            implementation: (a, b) => a * b,\r\n        });\r\n    }\r\n\r\n    for (const [left, right, returns] of numberPairs()) {\r\n        schema.registerOperator({\r\n            operator: '/',\r\n            commutative: false,\r\n            left,\r\n            right,\r\n            returns,\r\n            implementation: isInteger(returns)\r\n                ? ((a, b) => Math.trunc(a / b))\r\n                : ((a, b) => a / b),\r\n        });\r\n    }\r\n}\r\n\r\n\r\nfunction registerDatetimeOperators(schema: _ISchema) {\r\n    // ======= date/time \"+ -\" timestamp =======\r\n    for (const dt of dateTypes) {\r\n        for (const [operator, f] of [['+', 1], ['-', -1]] as const) {\r\n            schema.registerOperator({\r\n                operator,\r\n                commutative: operator === '+',\r\n                left: dt,\r\n                right: Types.interval,\r\n                returns: dt,\r\n                implementation: (a, b) => moment(a).add(f * intervalToSec(b), 'seconds').toDate(),\r\n            });\r\n        }\r\n    }\r\n\r\n    // ==== date \"+ -\" integer  (add days.. only works on dates, not timestamps)\r\n    for (const [operator, f] of [['+', 1], ['-', -1]] as const) {\r\n        schema.registerOperator({\r\n            operator,\r\n            commutative: operator === '+',\r\n            left: Types.date,\r\n            right: Types.integer,\r\n            returns: Types.date,\r\n            implementation: (a, b) => moment(a).add(f * b, 'days').toDate(),\r\n        });\r\n    }\r\n}\r\n\r\n\r\n\r\nfunction registerJsonOperators(schema: _ISchema) {\r\n    // ======= \"json @> json\" query operator\r\n    schema.registerOperator({\r\n        operator: '@>',\r\n        left: Types.jsonb,\r\n        right: Types.jsonb,\r\n        returns: Types.bool,\r\n        implementation: (a, b) => queryJson(b, a),\r\n    });\r\n\r\n    // ======= \"json - text\" (remove key)\r\n    schema.registerOperator({\r\n        operator: '-',\r\n        left: Types.jsonb,\r\n        right: Types.text(),\r\n        returns: Types.jsonb,\r\n        implementation: (a, b) => {\r\n            if (Array.isArray(a)) {\r\n                return a.filter(x => x !== b);\r\n            }\r\n            if (typeof a === 'object') {\r\n                const ret = { ...a };\r\n                delete ret[b];\r\n                return ret;\r\n            }\r\n            throw new QueryError('cannot delete from scalar', '22023');\r\n        },\r\n    });\r\n\r\n    // ======= \"json - int\" (remove index)\r\n    schema.registerOperator({\r\n        operator: '-',\r\n        left: Types.jsonb,\r\n        right: Types.integer,\r\n        returns: Types.jsonb,\r\n        implementation: (a, b) => {\r\n            if (Array.isArray(a)) {\r\n                const ret = [...a];\r\n                ret.splice(b, 1);\r\n                return ret;\r\n            }\r\n            if (typeof a === 'object') {\r\n                throw new QueryError('cannot delete from object using integer index', '22023');\r\n            }\r\n            throw new QueryError('cannot delete from scalar', '22023');\r\n        },\r\n    })\r\n}\r\n\r\n\r\nfunction registerTextOperators(schema: _ISchema) {\r\n    // ======== \"text || text\" (concat text operator)\r\n    schema.registerOperator({\r\n        operator: '||',\r\n        left: Types.text(),\r\n        right: Types.text(),\r\n        returns: Types.text(),\r\n        implementation: (a, b) => a + b,\r\n    })\r\n}\r\n","import { _IDb, _ISchema, _Transaction, _IType, IValue, _Explainer, _ISelection, setId, getId } from '../../interfaces-private';\r\nimport { parseSql } from '../../parser/parse-cache';\r\nimport { QueryError, NotSupported, DataType } from '../../interfaces';\r\nimport { Statement } from 'pgsql-ast-parser';\r\nimport { executionCtx as executionCtx, pushExecutionCtx, hasExecutionCtx, ExecCtx, randomString } from '../../utils';\r\nimport { SelectExec } from '../../execution/select';\r\nimport { withParameters } from '../../parser/context';\r\nimport { buildParameterList } from '../../evaluator';\r\nimport { StatementExec } from '../../execution/statement-exec';\r\nimport { ArrayType } from '../../datatypes';\r\nimport { RecordType } from '../../datatypes/t-record';\r\n\r\nlet execId = 0;\r\n\r\nexport function registerSqlFunctionLanguage(db: _IDb) {\r\n    db.registerLanguage('sql', ({ code, schema: _schema, args, returns: _returns }) => {\r\n        const schema = _schema as _ISchema;\r\n        const returns = _returns as _IType;\r\n        // parse SQL\r\n        const _parsed = parseSql(code);\r\n        let parsed: Statement;\r\n        if (Array.isArray(_parsed)) {\r\n            if (_parsed.length !== 1) {\r\n                throw new QueryError(`Expected 1 statement in function, got ${_parsed.length}`);\r\n            }\r\n            parsed = _parsed[0];\r\n        } else {\r\n            parsed = _parsed;\r\n        }\r\n        switch (parsed.type) {\r\n            case 'select':\r\n            case 'union':\r\n            case 'union all':\r\n            case 'with':\r\n            case 'with recursive':\r\n            case 'values':\r\n                break;\r\n            default:\r\n                throw new NotSupported(`Unsupported statement type in function: ${parsed.type}`);\r\n        }\r\n\r\n        // build parameter list\r\n        const parameterList = buildParameterList('', args);\r\n\r\n\r\n        // push and push parameters, and a new build context, to avoid leaking parent context in function body\r\n        // ... then, visit & compile tree\r\n        const statement = new StatementExec(schema, parsed, code);\r\n        const executor = withParameters(parameterList, () => statement.compile());\r\n        if (!(executor instanceof SelectExec)) {\r\n            throw new NotSupported(`Unsupported statement type in function: ${parsed.type}`);\r\n        }\r\n\r\n\r\n        // todo: prepare statement here, to avoid optimization on each call.\r\n\r\n\r\n        // get the result transformer, based on the expected function output type\r\n        let transformResult: (values: any[], t: _Transaction, execId: string) => any;\r\n        if (!returns || returns.primary === DataType.null) {\r\n            // returns null\r\n            transformResult = () => null;\r\n        } else if (ArrayType.matches(returns) && RecordType.matches(returns.of)) {\r\n            // returns a table\r\n            const transformItem = returns.of.transformItemFrom(executor.selection);\r\n            if (!transformItem) {\r\n                throw new QueryError(`return type mismatch in function declared to return record`, '42P13');\r\n            }\r\n            transformResult = (v, t, eid) => v?.map(x => {\r\n                return transformItem(x, t, eid);\r\n            });\r\n        } else {\r\n            // returns a single value\r\n            const cols = executor.selection.columns;\r\n            if (cols.length !== 1 || !cols[0].type.canConvertImplicit(returns)) {\r\n                throw new QueryError(`return type mismatch in function declared to return ${returns.name}`, '42P13');\r\n            }\r\n            const col = cols[0].cast(returns);\r\n            transformResult = (v, t) => v[0] ? col.get(v[0], t) : null;\r\n        }\r\n\r\n\r\n        // return compiled function\r\n        const implem = (...args: any[]) => {\r\n            const exec: ExecCtx = hasExecutionCtx() ?\r\n                {\r\n                    // if we have a parent execution context, use it.\r\n                    // except for parameter values, that will be re-bound.\r\n                    ...executionCtx(),\r\n                    parametersValues: args,\r\n                } : {\r\n                    // else, create a brand new execution context.\r\n                    // that is used when a pure function is called with constant arguments:\r\n                    //  => function call will be reduced to a constant based on the\r\n                    //    db state at the time of the statement begining.\r\n                    schema,\r\n                    transaction: db.data,\r\n                    parametersValues: args,\r\n                };\r\n            const eid = 'fne' + execId++;\r\n            // push a new execution context, to avoid leaking parent paramters in the function\r\n            return pushExecutionCtx(exec, () => {\r\n                const ret = executor.execute(exec.transaction);\r\n                return transformResult(ret.result.rows, exec.transaction, eid);\r\n            });\r\n        };\r\n        // hack to tell the expression visitor that\r\n        // (implem as any)[fnAsSelectionColumns] = executor.selection.columns;\r\n        return implem;\r\n    });\r\n}\r\n\r\n// export const fnAsSelectionColumns = Symbol('asSelection');\r\n","\r\nimport { _IDb, _ISchema } from '../../interfaces-private';\r\nimport { ColumnsListSchema } from './columns-list';\r\nimport { TablesSchema } from './table-list';\r\nimport { TableConstraints } from './table-constraints';\r\nimport { KeyColumnUsage } from './key-column-usage';\r\nimport { ConstraintColumnUsage } from './constraint-column-usage';\r\n\r\nexport function setupInformationSchema(db: _IDb) {\r\n    const schema: _ISchema = db.createSchema('information_schema');\r\n\r\n    // SELECT * FROM \"information_schema\".\"tables\" WHERE (\"table_schema\" = 'public' AND \"table_name\" = 'user')\r\n    new TablesSchema(schema).register();\r\n    new ColumnsListSchema(schema).register();\r\n    new TableConstraints(schema).register();\r\n    new KeyColumnUsage(schema).register();\r\n    new ConstraintColumnUsage(schema).register();\r\n\r\n    schema.setReadonly();\r\n}","import { _ITable, _ISelection, IValue, _IIndex, _IDb, IndexKey, setId, _Transaction, _ISchema } from '../../interfaces-private';\r\nimport { Schema, nil } from '../../interfaces';\r\nimport { Types } from '../../datatypes';\r\nimport { TableIndex } from '../table-index';\r\nimport { ReadOnlyTable } from '../readonly-table';\r\n\r\nconst IS_SCHEMA = Symbol('_is_colmun');\r\nexport class ColumnsListSchema extends ReadOnlyTable implements _ITable {\r\n\r\n    get ownSymbol() {\r\n        return IS_SCHEMA;\r\n    }\r\n\r\n    _schema: Schema = {\r\n        name: 'columns',\r\n        fields: [\r\n            { name: 'table_catalog', type: Types.text() }\r\n            , { name: 'table_schema', type: Types.text() }\r\n            , { name: 'table_name', type: Types.text() }\r\n            , { name: 'column_name', type: Types.text() }\r\n            , { name: 'ordinal_position', type: Types.integer }\r\n            , { name: 'column_default', type: Types.text() }\r\n            , { name: 'is_nullable', type: Types.text(3) }\r\n            , { name: 'data_type', type: Types.text() }\r\n            , { name: 'character_maximum_length', type: Types.integer }\r\n            , { name: 'character_octet_length', type: Types.integer }\r\n            , { name: 'numeric_precision', type: Types.integer }\r\n            , { name: 'numeric_precision_radix', type: Types.integer }\r\n            , { name: 'numeric_scale', type: Types.integer }\r\n            , { name: 'datetime_precision', type: Types.integer }\r\n            , { name: 'interval_type', type: Types.text() }\r\n            , { name: 'interval_precision', type: Types.integer }\r\n            , { name: 'character_set_catalog', type: Types.text() }\r\n            , { name: 'character_set_schema', type: Types.text() }\r\n            , { name: 'character_set_name', type: Types.text() }\r\n            , { name: 'collation_catalog', type: Types.text() }\r\n            , { name: 'collation_schema', type: Types.text() }\r\n            , { name: 'collation_name', type: Types.text() }\r\n            , { name: 'domain_catalog', type: Types.text() }\r\n            , { name: 'domain_schema', type: Types.text() }\r\n            , { name: 'domain_name', type: Types.text() }\r\n            , { name: 'udt_catalog', type: Types.text() } // <====\r\n            , { name: 'udt_schema', type: Types.text() } // <====\r\n            , { name: 'udt_name', type: Types.text() } // <====\r\n            , { name: 'scope_catalog', type: Types.text() } // <====\r\n            , { name: 'scope_schema', type: Types.text() } // <====\r\n            , { name: 'scope_name', type: Types.text() } // <====\r\n            , { name: 'maximum_cardinality', type: Types.integer } // <====\r\n            , { name: 'dtd_identifier', type: Types.integer } // <=== INDEX\r\n            , { name: 'is_self_referencing', type: Types.text(3) }\r\n            , { name: 'is_identity', type: Types.text(3) } // <==\r\n            , { name: 'identity_generation', type: Types.text() } // <==\r\n            , { name: 'identity_start', type: Types.text() } // <==\r\n            , { name: 'identity_document', type: Types.text() } // <==\r\n            , { name: 'identity_increment', type: Types.text() } // <==\r\n            , { name: 'identity_maximum', type: Types.text() } // <==\r\n            , { name: 'identity_minimum', type: Types.text() } // <==\r\n            , { name: 'identity_cycle', type: Types.text(3) } // <==\r\n            , { name: 'is_generated', type: Types.text() } // <==\r\n            , { name: 'generation_expression', type: Types.text() } // <==\r\n            , { name: 'is_updatable', type: Types.text(3) } // <==\r\n        ]\r\n    };\r\n\r\n\r\n    entropy(t: _Transaction): number {\r\n        return this.db.listSchemas()\r\n            .reduce((tot, s) => tot + s.tablesCount(t) * 10, 0);\r\n    }\r\n\r\n    *enumerate(t: _Transaction) {\r\n        for (const s of this.db.listSchemas()) {\r\n            for (const it of s.listTables(t)) {\r\n                yield* this.itemsByTable(it, t);\r\n            }\r\n        }\r\n    }\r\n\r\n    make(table: _ITable, i: number, t: IValue<any>): any {\r\n        if (!t) {\r\n            return null;\r\n        }\r\n        let ret = {};\r\n        for (const { name } of this._schema.fields) {\r\n            (ret as any)[name] = null;\r\n        }\r\n\r\n        ret = {\r\n            ...ret,\r\n            table_catalog: 'pgmem',\r\n            table_schema: 'public',\r\n            table_name: table.name,\r\n            column_name: t.id,\r\n            ordinal_position: i,\r\n            is_nullable: 'NO',\r\n            data_type: t.type.primary, // <== todo\r\n            numeric_precision: null, // <== todo\r\n            numeric_precision_radix: null, // <== todo\r\n            numeric_scale: null, // <== todo\r\n\r\n            udt_catalog: 'pgmem',\r\n            udt_schema: 'pg_catalog',\r\n            udt_name: t.type.primary, // <== todo\r\n\r\n            dtd_identifier: i, // <== todo\r\n\r\n            is_self_referencing: 'NO',\r\n            is_identity: 'NO',\r\n\r\n            is_updatable: 'YES',\r\n            is_generated: 'NEVER',\r\n            identity_cycle: 'NO',\r\n\r\n\r\n            [IS_SCHEMA]: true,\r\n        };\r\n        setId(ret, `/schema/${table.ownerSchema.name}/table/${table.name}/${i}`);\r\n        return ret;\r\n    }\r\n\r\n    hasItem(value: any): boolean {\r\n        return !!value?.[IS_SCHEMA];\r\n    }\r\n\r\n    getIndex(forValue: IValue<any>): _IIndex<any> | nil {\r\n        if (forValue.id === 'table_name') {\r\n            return new TableIndex(this, forValue);\r\n        }\r\n        return null;\r\n    }\r\n\r\n}\r\n","import { _ITable, _ISelection, IValue, _IIndex, _IDb, IndexKey, setId, _ISchema, _Transaction, _Explainer } from '../../interfaces-private';\r\nimport { Schema, nil } from '../../interfaces';\r\nimport { Types } from '../../datatypes';\r\nimport { TableIndex } from '../table-index';\r\nimport { ReadOnlyTable } from '../readonly-table';\r\n\r\nconst IS_SCHEMA = Symbol('_is_schema');\r\nexport class TablesSchema extends ReadOnlyTable implements _ITable {\r\n\r\n    get ownSymbol() {\r\n        return IS_SCHEMA;\r\n    }\r\n\r\n    isOriginOf(v: IValue): boolean {\r\n        return v.origin === this || v.origin === this.selection;\r\n    }\r\n\r\n    _schema: Schema = {\r\n        name: 'tables',\r\n        fields: [\r\n            { name: 'table_catalog', type: Types.text() }\r\n            , { name: 'table_schema', type: Types.text() }\r\n            , { name: 'table_name', type: Types.text() }\r\n            , { name: 'table_type', type: Types.text() }\r\n            , { name: 'self_referencing_column_name', type: Types.text() }\r\n            , { name: 'reference_generation', type: Types.text() }\r\n            , { name: 'user_defined_type_catalog', type: Types.text() }\r\n            , { name: 'user_defined_type_schema', type: Types.text() }\r\n            , { name: 'user_defined_type_name', type: Types.text() }\r\n            , { name: 'is_insertable_into', type: Types.text(3) }\r\n            , { name: 'is_typed', type: Types.text(3) }\r\n            , { name: 'commit_action', type: Types.text() }\r\n        ]\r\n    };\r\n\r\n    entropy(t: _Transaction): number {\r\n        return this.db.listSchemas()\r\n            .reduce((tot, s) => tot + s.tablesCount(t), 0);\r\n    }\r\n\r\n    *enumerate(t: _Transaction) {\r\n        for (const s of this.db.listSchemas()) {\r\n            for (const it of s.listTables(t)) {\r\n                yield this.make(it);\r\n            }\r\n        }\r\n    }\r\n\r\n    make(t: _ITable<any>): any {\r\n        if (!t) {\r\n            return null;\r\n        }\r\n        const ret = {\r\n            table_catalog: 'pgmem',\r\n            table_schema: 'public',\r\n            table_name: t.name,\r\n            table_type: 'BASE TABLE',\r\n            self_referencing_column_name: null,\r\n            reference_generation: null,\r\n            user_defined_type_catalog: null,\r\n            user_defined_type_schema: null,\r\n            user_defined_type_name: null,\r\n            is_insertable_into: 'YES',\r\n            is_typed: 'NO',\r\n            commit_action: null,\r\n            [IS_SCHEMA]: true,\r\n        };\r\n        setId(ret, '/schema/table/' + t.name);\r\n        return ret;\r\n    }\r\n\r\n    hasItem(value: any): boolean {\r\n        return !!value?.[IS_SCHEMA];\r\n    }\r\n\r\n    getIndex(forValue: IValue<any>): _IIndex<any> | nil {\r\n        if (forValue?.id === 'table_name') {\r\n            return new TableIndex(this, forValue);\r\n        }\r\n        return null;\r\n    }\r\n\r\n}\r\n","import { _ITable, _ISelection, IValue, _IIndex, _IDb, IndexKey, setId, _ISchema } from '../../interfaces-private';\r\nimport { Schema } from '../../interfaces';\r\nimport { Types } from '../../datatypes';\r\nimport { ReadOnlyTable } from '../readonly-table';\r\n\r\n// https://www.postgresql.org/docs/13/catalog-pg-range.html\r\nexport class TableConstraints extends ReadOnlyTable implements _ITable {\r\n\r\n\r\n    _schema: Schema = {\r\n        name: 'table_constraints',\r\n        fields: [\r\n            { name: 'constraint_catalog', type: Types.text() }\r\n            , { name: 'constraint_schema', type: Types.text() }\r\n            , { name: 'constraint_name', type: Types.text() }\r\n            , { name: 'table_catalog', type: Types.text() }\r\n            , { name: 'table_schema', type: Types.text() }\r\n            , { name: 'table_name', type: Types.text() }\r\n            , { name: 'constraint_type', type: Types.text() }\r\n            , { name: 'is_deferrable', type: Types.bool }\r\n            , { name: 'initially_deferred', type: Types.bool }\r\n            , { name: 'enforced', type: Types.bool }\r\n        ]\r\n    };\r\n\r\n\r\n    entropy(): number {\r\n        return 0;\r\n    }\r\n\r\n    *enumerate() {\r\n    }\r\n\r\n\r\n    hasItem(value: any): boolean {\r\n        return false;\r\n    }\r\n\r\n}\r\n","import { _ITable, _ISelection, IValue, _IIndex, _IDb, IndexKey, setId, _ISchema } from '../../interfaces-private';\r\nimport { Schema } from '../../interfaces';\r\nimport { Types } from '../../datatypes';\r\nimport { ReadOnlyTable } from '../readonly-table';\r\n\r\n\r\nexport class KeyColumnUsage extends ReadOnlyTable implements _ITable {\r\n\r\n\r\n    _schema: Schema = {\r\n        name: 'key_column_usage',\r\n        fields: [\r\n            { name: 'constraint_catalog', type: Types.text() }\r\n            , { name: 'constraint_schema', type: Types.text() }\r\n            , { name: 'constraint_name', type: Types.text() }\r\n            , { name: 'table_catalog', type: Types.text() }\r\n            , { name: 'table_schema', type: Types.text() }\r\n            , { name: 'table_name', type: Types.text() }\r\n            , { name: 'column_name', type: Types.text() }\r\n            , { name: 'ordinal_position', type: Types.integer }\r\n            , { name: 'position_in_unique_constraint', type: Types.integer }\r\n        ]\r\n    };\r\n\r\n\r\n    entropy(): number {\r\n        return 0;\r\n    }\r\n\r\n    *enumerate() {\r\n    }\r\n\r\n\r\n    hasItem(value: any): boolean {\r\n        return false;\r\n    }\r\n\r\n}\r\n","import { _ITable, _ISelection, IValue, _IIndex, _IDb, IndexKey, setId, _ISchema } from '../../interfaces-private';\r\nimport { Schema } from '../../interfaces';\r\nimport { Types } from '../../datatypes';\r\nimport { ReadOnlyTable } from '../readonly-table';\r\n\r\nexport class ConstraintColumnUsage extends ReadOnlyTable implements _ITable {\r\n\r\n\r\n    _schema: Schema = {\r\n        name: 'constraint_column_usage',\r\n        fields: [\r\n            { name: 'constraint_catalog', type: Types.text() }\r\n            , { name: 'constraint_schema', type: Types.text() }\r\n            , { name: 'constraint_name', type: Types.text() }\r\n\r\n            , { name: 'table_catalog', type: Types.text() }\r\n            , { name: 'table_schema', type: Types.text() }\r\n            , { name: 'table_name', type: Types.text() }\r\n\r\n            , { name: 'column_name', type: Types.text() }\r\n        ]\r\n    };\r\n\r\n\r\n    entropy(): number {\r\n        return 0;\r\n    }\r\n\r\n    *enumerate() {\r\n    }\r\n\r\n\r\n    hasItem(value: any): boolean {\r\n        return false;\r\n    }\r\n\r\n}\r\n"],"sourceRoot":""}